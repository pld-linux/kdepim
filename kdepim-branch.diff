Index: akregator/ChangeLog
===================================================================
--- akregator/ChangeLog	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/ChangeLog	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -2,6 +2,23 @@
 ===================
 (c) 2004-2006 the Akregator authors.
 
+Changes after 1.2.4:
+-----------------------------
+
+Bug fixes:
+
+ 2006/09/18 Set default font sizes, prevents use of font size 1 in article viewer on first startup -fo
+ 2006/08/28 Do not create multiple items in the feed lists when dragging feeds to a folder
+            that was moved before (#124303) -fo
+ 2006/08/26 Fix a possible crash in the internal browser when going forward -fo
+ 2006/08/26 show error messages while browsing as HTML, not as annoying popups (#107740) -fo
+ 2006/08/25 Show title of selected feed in window caption (#111471) -fo
+ 2006/08/25 Konqueror plugins: correctly enable/disable icon when enabling/disabling the plugin (#132823) -fo
+ 2006/08/21 Don't crash on very long URLs (>255 chars) used for feed logos (#130849) -fo
+ 2006/08/20 Konqueror plugins: Fix crash when using the Akregator plugin in file manager mode (#124891) -fo
+ 2006/08/20 Feed detection: Fix detection when relative URLs are used in the link tags (#132687) -fo
+ 2006/08/17 Speak selected text in internal browser when using the "Speak Text" button (#132505) -fo
+
 Changes after 1.2.3:
 -----------------------------
 
Index: akregator/src/aboutdata.cpp
===================================================================
--- akregator/src/aboutdata.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/aboutdata.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -31,7 +31,7 @@
 AboutData::AboutData()
     : KAboutData("akregator", I18N_NOOP("Akregator"), AKREGATOR_VERSION, I18N_NOOP("A KDE Feed Aggregator"),
                  License_GPL, I18N_NOOP("(C) 2004, 2005 Akregator developers"), 0,
-                     "http://akregator.sourceforge.net/")
+                     "http://akregator.kde.org/")
 {
     addAuthor( "Frank Osterfeld", I18N_NOOP("Maintainer"), "frank.osterfeld@kdemail.net" );
     addAuthor( "Teemu Rytilahti", I18N_NOOP("Developer"), "tpr@d5k.net" );
Index: akregator/src/articleviewer.cpp
===================================================================
--- akregator/src/articleviewer.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/articleviewer.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -187,8 +187,7 @@
     const QColorGroup & cg = QApplication::palette().active();
     
     // from kmail::headerstyle.cpp
-    m_normalModeCSS = QString (
-            "<style type=\"text/css\">\n"
+    m_normalModeCSS = QString(
             "@media screen, print {"
             "body {\n"
             "  font-family: \"%1\" ! important;\n"
@@ -199,7 +198,7 @@
             .arg(QString::number(pointsToPixel(Settings::mediumFontSize()))+"px")
             .arg(cg.text().name())
             .arg(cg.base().name());
-    m_normalModeCSS += (
+    m_normalModeCSS += QString(
     "a {\n"
     + QString("  color: %1 ! important;\n")
     + QString(!Settings::underlineLinks() ? " text-decoration: none ! important;\n" : "")
@@ -223,6 +222,7 @@
             .arg(cg.highlightedText().name())
             .arg(cg.highlightedText().name())
             .arg(cg.highlightedText().name());
+    
     m_normalModeCSS += QString(
     ".headertitle {\n"
     "  background: %1 ! important;\n"
@@ -253,11 +253,12 @@
     ".content > P:first-child {\n margin-top: 1px; }\n"
     ".content > DIV:first-child {\n margin-top: 1px; }\n"
     ".content > BR:first-child {\n display: none;  }\n"
-    //".contentlink {\n display: block; }\n"
-    "}\n\n" // @media screen, print
-    // Why did we need that, bug #108187?
-    //"@media screen { body { overflow: auto; } }\n"
-    "\n\n");
+    "iframe {display: none !important; }\n"
+    "frame {display: none !important; }\n"
+    "frameset {display: none !important; }\n"
+    "object {display: none !important; }\n"
+    "applet {display: none !important; }\n"
+    "}\n\n"); // @media screen, print    
 }
 
 void ArticleViewer::generateCombinedModeCSS()
@@ -266,7 +267,7 @@
     
     // from kmail::headerstyle.cpp
     m_combinedModeCSS = QString (
-            "<style type=\"text/css\">\n"
+//            "<style type=\"text/css\">\n"
             "@media screen, print {"
             "body {\n"
             "  font-family: \"%1\" ! important;\n"
@@ -331,11 +332,12 @@
     ".content > P:first-child {\n margin-top: 1px; }\n"
     ".content > DIV:first-child {\n margin-top: 1px; }\n"
     ".content > BR:first-child {\n display: none;  }\n"
-    //".contentlink {\n display: block; }\n"
-    "}\n\n" // @media screen, print
-    // Why did we need that, bug #108187?
-    //"@media screen { body { overflow: auto; } }\n"
-    "\n\n");
+    "iframe {display: none !important; }\n"
+    "frame {display: none !important; }\n"
+    "frameset {display: none !important; }\n"
+    "object {display: none !important; }\n"
+    "applet {display: none !important; }\n"
+    "}\n\n"); // @media screen, print
 }
 
 void ArticleViewer::reload()
@@ -384,7 +386,7 @@
             "<p>Thank you,</p>\n"
             "<p style='margin-bottom: 0px'>&nbsp; &nbsp; The Akregator Team</p>\n")
             .arg(AKREGATOR_VERSION) // Akregator version
-            .arg("http://akregator.sourceforge.net/"); // Akregator homepage URL
+            .arg("http://akregator.kde.org/"); // Akregator homepage URL
 
     QString fontSize = QString::number( pointsToPixel( Settings::mediumFontSize() ));
     QString appTitle = i18n("Akregator");
@@ -428,8 +430,7 @@
 
     if (feed && !feed->image().isNull())
     {
-        QString url=feed->xmlUrl();
-        QString file = url.replace("/", "_").replace(":", "_");
+        QString file = Utils::fileNameForUrl(feed->xmlUrl());
         KURL u(m_imageDir);
         u.setFileName(file);
         text += QString("<a href=\"%1\"><img class=\"headimage\" src=\"%2.png\"></a>\n").arg(feed->htmlUrl()).arg(u.url());
@@ -493,13 +494,15 @@
     QString text;
     text = QString("<div class=\"headerbox\" dir=\"%1\">\n").arg(QApplication::reverseLayout() ? "rtl" : "ltr");
 
+    KURL link = article.link();
+    
     if (!article.title().isEmpty())
     {
         text += QString("<div class=\"headertitle\" dir=\"%1\">\n").arg(directionOf(Utils::stripTags(article.title())));
-        if (article.link().isValid())
-            text += "<a href=\""+article.link().url()+"\">";
+        if (link.isValid())
+            text += "<a href=\""+link.url()+"\">";
         text += article.title().replace("<", "&lt;").replace(">", "&gt;"); // TODO: better leave things escaped in the parser
-        if (article.link().isValid())
+        if (link.isValid())
             text += "</a>";
         text += "</div>\n";
     }
@@ -524,8 +527,7 @@
 
     if (feed && !feed->image().isNull())
     {
-        QString url=feed->xmlUrl();
-        QString file = url.replace("/", "_").replace(":", "_");
+        QString file = Utils::fileNameForUrl(feed->xmlUrl());
         KURL u(m_imageDir);
         u.setFileName(file);
         text += QString("<a href=\"%1\"><img class=\"headimage\" src=\"%2.png\"></a>\n").arg(feed->htmlUrl()).arg(u.url());
@@ -554,13 +556,13 @@
         text += "</a>";
     }
 
-    if (article.link().isValid() || (article.guidIsPermaLink() && KURL(article.guid()).isValid()))
+    if (link.isValid() || (article.guidIsPermaLink() && KURL(article.guid()).isValid()))
     {
         text += "<p><a class=\"contentlink\" href=\"";
         // in case link isn't valid, fall back to the guid permaLink.
-        if (article.link().isValid())
+        if (link.isValid())
         {
-            text += article.link().url();
+            text += link.url();
         }
         else
          {
@@ -586,16 +588,10 @@
 
 void ArticleViewer::beginWriting()
 {
-    QString head = QString("<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">\n <html><head><title>.</title>");
-    
-    if (m_viewMode == CombinedView)
-        head += m_combinedModeCSS;
-    else
-        head += m_normalModeCSS; 
-
-    head += "</style></head><body>";
+    QString head = QString("<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">\n <html><head><title>.</title></head>");
     view()->setContentsPos(0,0);
     begin(m_link);
+    setUserStyleSheet(m_viewMode == CombinedView ? m_combinedModeCSS : m_normalModeCSS);
     write(head);
 }
 
Index: akregator/src/storagefactory.h
===================================================================
--- akregator/src/storagefactory.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/storagefactory.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -25,6 +25,8 @@
 #ifndef AKREGATOR_BACKEND_STORAGEFACTORY_H
 #define AKREGATOR_BACKEND_STORAGEFACTORY_H
 
+#include "akregator_export.h"
+
 class QString;
 class QStringList;
 class QWidget;
@@ -33,7 +35,7 @@
 
 class Storage;
 
-class StorageFactory
+class AKREGATOR_EXPORT StorageFactory
 {
     public:
     
Index: akregator/src/feed.cpp
===================================================================
--- akregator/src/feed.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/feed.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -46,6 +46,7 @@
 #include "feedstorage.h"
 #include "storage.h"
 #include "treenodevisitor.h"
+#include "utils.h"
 
 #include "librss/librss.h"
 
@@ -205,8 +206,9 @@
 
 void Feed::loadImage()
 {
-    QString u = d->xmlUrl;
-    QString imageFileName = KGlobal::dirs()->saveLocation("cache", "akregator/Media/") + u.replace("/", "_").replace(":", "_")+".png";
+    QString imageFileName = KGlobal::dirs()->saveLocation("cache", "akregator/Media/") 
+                            + Utils::fileNameForUrl(d->xmlUrl) + 
+".png";
     d->imagePixmap.load(imageFileName, "PNG");
 }
         
@@ -585,8 +587,9 @@
     if (image.isNull())
         return;
     d->imagePixmap=image;
-    QString u = d->xmlUrl;
-    d->imagePixmap.save(KGlobal::dirs()->saveLocation("cache", "akregator/Media/")+u.replace("/", "_").replace(":", "_")+".png","PNG");
+    d->imagePixmap.save(KGlobal::dirs()->saveLocation("cache", "akregator/Media/") 
+                        + Utils::fileNameForUrl(d->xmlUrl) + 
+".png","PNG");
     nodeModified();
 }
 
Index: akregator/src/akregator.kcfg
===================================================================
--- akregator/src/akregator.kcfg	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/akregator.kcfg	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -44,8 +44,10 @@
  <group name="HTML Settings" >
   <entry key="Fonts" type="StringList" />
   <entry key="MediumFontSize" type="Int">
+    <default>12</default>
   </entry>
   <entry key="MinimumFontSize" type="Int">
+  <default>8</default>
   </entry>
   <entry key="UnderlineLinks" type="Bool"> 
   </entry>
Index: akregator/src/articlelistview.cpp
===================================================================
--- akregator/src/articlelistview.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/articlelistview.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -424,6 +424,11 @@
         setSelected(next, true);
         setCurrentItem(next);
     }
+    else
+    {
+        d->noneSelected = true;
+    }
+    
 
     setUpdatesEnabled(true);
     triggerUpdate();
@@ -465,7 +470,11 @@
         setSelected(next, true);
         setCurrentItem(next);
     }
-
+    else
+    {
+        d->noneSelected = true;
+    }
+     
     setUpdatesEnabled(true);
     triggerUpdate();
 }
@@ -745,8 +754,11 @@
     ArticleItem* ai = dynamic_cast<ArticleItem*> (item);
     if (ai)
         emit signalArticleChosen( ai->article() );
-    else 
+    else
+    {
+        d->noneSelected = true;
         emit signalArticleChosen( Article() );
+    }
 } 
 
 
Index: akregator/src/librss/feeddetector.h
===================================================================
--- akregator/src/librss/feeddetector.h	(.../tags/KDE/3.5.4/kdepim)	(revision 0)
+++ akregator/src/librss/feeddetector.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -0,0 +1,80 @@
+/*
+    This file is part of Akregator.
+
+    Copyright (C) 2004 Teemu Rytilahti <tpr@d5k.net>
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+
+    As a special exception, permission is given to link this program
+    with any edition of Qt, and distribute the resulting executable,
+    without including the source code for Qt in the source distribution.
+*/
+ 
+#ifndef LIBRSS_FEEDDETECTOR_H
+#define LIBRSS_FEEDDETECTOR_H
+
+#include <qstring.h>
+#include <qvaluelist.h>
+
+class QStringList;
+class KURL;
+
+namespace RSS
+{
+
+    class FeedDetectorEntry
+    {
+        public:
+            FeedDetectorEntry() {}
+            FeedDetectorEntry(const QString& url, const QString& title) 
+                : m_url(url), m_title(title) {}
+
+            const QString& url() const { return m_url; } 
+            const QString& title() const { return m_title; }
+
+        private:	
+            const QString m_url;
+            const QString m_title;
+    };	
+
+    typedef QValueList<FeedDetectorEntry> FeedDetectorEntryList; 
+
+    /** a class providing functions to detect linked feeds in HTML sources */
+    class FeedDetector
+    {
+        public:
+            /** \brief searches an HTML page for feeds listed in @c <link> tags
+            @c <link> tags with @c rel attribute values @c alternate or 
+            @c service.feed are considered as feeds 
+            @param s the html source to scan (the actual source, no URI)
+            @return a list containing the detected feeds
+            */
+            static FeedDetectorEntryList extractFromLinkTags(const QString& s);
+
+            /** \brief searches an HTML page for slightly feed-like looking links and catches everything not running away quickly enough. 
+            Extracts links from @c <a @c href> tags which end with @c xml, @c rss or @c rdf
+            @param s the html source to scan (the actual source, no URI)
+            @return a list containing the detected feeds
+            */
+            static QStringList extractBruteForce(const QString& s);
+
+            static QString fixRelativeURL(const QString &s, const KURL &baseurl);
+            
+        private:
+            FeedDetector() {}
+    };
+}
+
+#endif //LIBRSS_FEEDDETECTOR_H
Index: akregator/src/librss/loader.cpp
===================================================================
--- akregator/src/librss/loader.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/librss/loader.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
  */
 #include "loader.h"
 #include "document.h"
+#include "feeddetector.h"
 
 #include <kio/job.h>
 #include <kprocess.h>
@@ -377,74 +378,35 @@
 void Loader::discoverFeeds(const QByteArray &data)
 {
     QString str = QString(data).simplifyWhiteSpace();
-    QString s2;
-    //QTextStream ts( &str, IO_WriteOnly );
-    //ts << data.data();
-
-    // "<[\\s]link[^>]*rel[\\s]=[\\s]\\\"[\\s]alternate[\\s]\\\"[^>]*>"
-    // "type[\\s]=[\\s]\\\"application/rss+xml\\\""
-    // "href[\\s]=[\\s]\\\"application/rss+xml\\\""
-    QRegExp rx( "(?:REL)[^=]*=[^sAa]*(?:service.feed|ALTERNATE)[\\s]*[^s][^s](?:[^>]*)(?:HREF)[^=]*=[^A-Z0-9-_~,./$]*([^'\">\\s]*)", false);
-    if (rx.search(str)!=-1)
-        s2=rx.cap(1);
-    else{
-    // does not support Atom/RSS autodiscovery.. try finding feeds by brute force....
-        int pos=0;
-        QStringList feeds;
-        QString host=d->url.host();
-        rx.setPattern("(?:<A )[^H]*(?:HREF)[^=]*=[^A-Z0-9-_~,./]*([^'\">\\s]*)");
-        while ( pos >= 0 ) {
-            pos = rx.search( str, pos );
-            s2=rx.cap(1);
-            if (s2.endsWith(".rdf") || s2.endsWith(".rss") || s2.endsWith(".xml"))
-                    feeds.append(s2);
-            if ( pos >= 0 ) {
-                pos += rx.matchedLength();
-            }
-        }
-
-        s2=feeds.first();
-        KURL testURL;
-        // loop through, prefer feeds on same host
-        QStringList::Iterator end( feeds.end() );
-        for ( QStringList::Iterator it = feeds.begin(); it != end; ++it ) {
-            testURL=*it;
-            if (testURL.host()==host)
-            {
-                s2=*it;
-                break;
-            }
-        }
-    }
-
-    if (s2.isNull()) {
-        //kdDebug() << "No feed found for a site" << endl;
-        return;
-    }
-
-    if (KURL::isRelativeURL(s2))
+    
+    QStringList feeds; 
+    
+    FeedDetectorEntryList list = FeedDetector::extractFromLinkTags(str); 
+    
+    for (FeedDetectorEntryList::ConstIterator it = list.begin(); it != list.end(); ++it)
     {
-        if (s2.startsWith("//"))
+        feeds += (*it).url();
+    }  
+    
+    if (list.isEmpty())
+        feeds = FeedDetector::extractBruteForce(str);
+        
+    QString feed = feeds.first();
+    QString host = d->url.host();
+    KURL testURL;
+    // loop through, prefer feeds on same host
+    QStringList::Iterator end( feeds.end() );
+    for ( QStringList::Iterator it = feeds.begin(); it != end; ++it) 
+    {
+        testURL=*it;
+        if (testURL.host() == host)
         {
-            s2=s2.prepend(d->url.protocol()+":");
-            d->discoveredFeedURL=s2;
+            feed = *it;
+            break;
         }
-        else if (s2.startsWith("/"))
-        {
-            d->discoveredFeedURL=d->url;
-            d->discoveredFeedURL.setPath(s2);
-        }
-        else
-        {
-            d->discoveredFeedURL=d->url;
-            d->discoveredFeedURL.addPath(s2);
-        }
-        d->discoveredFeedURL.cleanPath();
     }
-    else
-        d->discoveredFeedURL=s2;
 
-    d->discoveredFeedURL.cleanPath();
+    d->discoveredFeedURL = feed.isNull() ? QString() : FeedDetector::fixRelativeURL(feed, d->url); 
 }
 
 #include "loader.moc"
Index: akregator/src/librss/Makefile.am
===================================================================
--- akregator/src/librss/Makefile.am	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/librss/Makefile.am	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -9,7 +9,7 @@
   loader.h librss.h enclosure.h
 
 librsslocal_la_SOURCES = article.cpp document.cpp image.cpp textinput.cpp \
-  tools_p.cpp loader.cpp enclosure.cpp category.cpp
+  tools_p.cpp loader.cpp enclosure.cpp category.cpp feeddetector.cpp
 
 librsslocal_la_METASOURCES = AUTO
 
Index: akregator/src/librss/feeddetector.cpp
===================================================================
--- akregator/src/librss/feeddetector.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 0)
+++ akregator/src/librss/feeddetector.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -0,0 +1,179 @@
+/*
+    This file is part of Akregator.
+
+    Copyright (C) 2004 Teemu Rytilahti <tpr@d5k.net>
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+
+    As a special exception, permission is given to link this program
+    with any edition of Qt, and distribute the resulting executable,
+    without including the source code for Qt in the source distribution.
+*/
+ 
+#include <qregexp.h>
+#include <qstring.h>
+#include <qstringlist.h>
+#include <qvaluelist.h>
+#include <kcharsets.h>
+#include <kurl.h>
+
+#include "feeddetector.h"
+
+
+using namespace RSS;
+
+FeedDetectorEntryList FeedDetector::extractFromLinkTags(const QString& s)	
+{
+    //reduce all sequences of spaces, newlines etc. to one space:
+    QString str = s.simplifyWhiteSpace();
+
+    // extracts <link> tags
+    QRegExp reLinkTag("<[\\s]?LINK[^>]*REL[\\s]?=[\\s]?\\\"[\\s]?(ALTERNATE|SERVICE\\.FEED)[\\s]?\\\"[^>]*>", false);
+
+    // extracts the URL (href="url")
+    QRegExp reHref("HREF[\\s]?=[\\s]?\\\"([^\\\"]*)\\\"", false);
+    // extracts type attribute
+    QRegExp reType("TYPE[\\s]?=[\\s]?\\\"([^\\\"]*)\\\"", false);
+    // extracts the title (title="title")
+    QRegExp reTitle("TITLE[\\s]?=[\\s]?\\\"([^\\\"]*)\\\"", false);
+
+    int pos = 0;
+    int matchpos = 0;
+
+    // get all <link> tags
+    QStringList linkTags;
+    //int strlength = str.length();
+    while ( matchpos != -1 )
+    {
+        matchpos = reLinkTag.search(str, pos);
+        if (matchpos != -1)
+        {
+            linkTags.append( str.mid(matchpos, reLinkTag.matchedLength()) );
+            pos = matchpos + reLinkTag.matchedLength();
+        }
+    }
+
+    FeedDetectorEntryList list;
+
+    for ( QStringList::Iterator it = linkTags.begin(); it != linkTags.end(); ++it )
+    {
+        QString type;
+        int pos = reType.search(*it, 0);
+        if (pos != -1)
+            type = reType.cap(1).lower();
+
+        // we accept only type attributes indicating a feed
+        if ( type != "application/rss+xml" && type != "application/rdf+xml"
+	      && type != "application/atom+xml" && type != "text/xml" )
+            continue;
+                
+        QString title;
+        pos = reTitle.search(*it, 0);
+        if (pos != -1)
+        title = reTitle.cap(1);
+
+        title = KCharsets::resolveEntities(title);
+
+        QString url;
+        pos = reHref.search(*it, 0);
+        if (pos != -1)
+            url = reHref.cap(1);
+
+        url = KCharsets::resolveEntities(url);
+
+        // if feed has no title, use the url as preliminary title (until feed is parsed)
+        if ( title.isEmpty() )
+            title = url;
+
+        if ( !url.isEmpty() )
+            list.append(FeedDetectorEntry(url, title) );		
+    }
+
+
+    return list;
+}
+
+QStringList FeedDetector::extractBruteForce(const QString& s)
+{
+    QString str = s.simplifyWhiteSpace();
+    
+    QRegExp reAhrefTag("<[\\s]?A[^>]?HREF=[\\s]?\\\"[^\\\"]*\\\"[^>]*>", false);
+    
+    // extracts the URL (href="url")
+    QRegExp reHref("HREF[\\s]?=[\\s]?\\\"([^\\\"]*)\\\"", false);
+
+    QRegExp rssrdfxml(".*(RSS|RDF|XML)", false);
+
+    int pos = 0;
+    int matchpos = 0;
+    
+    // get all <a href> tags and capture url
+    QStringList list;
+    //int strlength = str.length();
+    while ( matchpos != -1 )
+    {
+        matchpos = reAhrefTag.search(str, pos);
+        if ( matchpos != -1 )
+        {
+            QString ahref = str.mid(matchpos, reAhrefTag.matchedLength());
+            int hrefpos = reHref.search(ahref, 0);
+            if ( hrefpos != -1 )
+            {
+                QString url = reHref.cap(1);
+
+                url = KCharsets::resolveEntities(url);
+
+                if ( rssrdfxml.exactMatch(url) )
+                    list.append(url);
+            }
+
+            pos = matchpos + reAhrefTag.matchedLength();
+        }
+    }
+    
+    return list;
+}
+
+QString FeedDetector::fixRelativeURL(const QString &s, const KURL &baseurl)
+{
+    QString s2=s;
+    KURL u;
+    if (KURL::isRelativeURL(s2))
+    {
+        if (s2.startsWith("//"))
+        {
+            s2=s2.prepend(baseurl.protocol()+":");
+            u=s2;
+        }
+        else if (s2.startsWith("/"))
+        {
+            KURL b2(baseurl);
+            b2.setPath(QString()); // delete path and query, so that only protocol://host remains
+            b2.setQuery(QString());
+            u = KURL(b2, s2.remove(0,1)); // remove leading "/" 
+        }
+        else
+        {
+            u = KURL(baseurl, s2);
+        }
+    }
+    else
+        u=s2;
+
+    u.cleanPath();
+    //kdDebug() << "AKREGATOR_PLUGIN_FIXURL: " << "url=" << s << " baseurl=" << baseurl.url() << " fixed=" << u.url() << 
+    //endl;
+    return u.url();
+}
Index: akregator/src/mk4storage/akregator_mk4storage_plugin.desktop
===================================================================
--- akregator/src/mk4storage/akregator_mk4storage_plugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/mk4storage/akregator_mk4storage_plugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[es]=Dorsal de almacenamiento Metakit
 Name[et]=Metakiti salvestamisrakendus
 Name[eu]=Metakit-en biltegiratze euskarria
+Name[fa]=پشتیبان ذخیره‌گاه Metakit
 Name[fi]=Metakit-tallennusajuri
 Name[fr]=Stockage avec Metakit
 Name[hu]=Metakit tároló
@@ -44,6 +45,7 @@
 Comment[es]=Extensión para Akregator
 Comment[et]=Akregatori plugin
 Comment[eu]=Akregator-en plugina
+Comment[fa]=وصله برای Akregator
 Comment[fi]=Liitännäinen Akregatoriin
 Comment[fr]=Module pour Akregator
 Comment[ga]=Breiseán Akregator
Index: akregator/src/mk4storage/Makefile.am
===================================================================
--- akregator/src/mk4storage/Makefile.am	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/mk4storage/Makefile.am	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -21,10 +21,7 @@
 libakregator_mk4storage_plugin_la_SOURCES = feedstoragemk4impl.cpp \
                                             storagemk4impl.cpp \
                                             storagefactorymk4impl.cpp \
-                                            mk4confwidgetbase.ui \
-                                            mk4confwidget.cpp \
-                                            mk4plugin.cpp \
-                                            mk4config.kcfgc
+                                            mk4plugin.cpp
 
 METASOURCES = AUTO
 
Index: akregator/src/mk4storage/storagefactorymk4impl.cpp
===================================================================
--- akregator/src/mk4storage/storagefactorymk4impl.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/mk4storage/storagefactorymk4impl.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -23,8 +23,8 @@
 */
 #include "storagefactorymk4impl.h"
 #include "storagemk4impl.h"
-#include "mk4confwidget.h"
-#include "mk4config.h"
+//#include "mk4confwidget.h"
+//#include "mk4config.h"
 
 #include <klocale.h>
 #include <qstring.h>
@@ -53,7 +53,7 @@
 
 
 void StorageFactoryMK4Impl::configure()
-{
+{ /*
     MK4ConfWidgetBase* confWidget = new MK4ConfWidget();
     // fill with Settings
     
@@ -64,6 +64,7 @@
     }
 
     delete confWidget;
+  */
 }
 
 }
Index: akregator/src/feedlistview.cpp
===================================================================
--- akregator/src/feedlistview.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/feedlistview.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -72,47 +72,8 @@
     DisconnectNodeVisitor* disconnectNodeVisitor;
     CreateItemVisitor* createItemVisitor;
     DeleteItemVisitor* deleteItemVisitor;
-    DragAndDropVisitor* dragAndDropVisitor;
 };
 
-class NodeListView::DragAndDropVisitor : public TreeNodeVisitor
-{
-
-public:
-    DragAndDropVisitor(NodeListView* view) : m_view(view) {}
-
-    /*
-    virtual bool visitTagNode(TagNode* node)
-    {
-        if (m_mode == ArticlesDropped)
-        {
-            Tag tag = node->tag();
-            QValueList<ArticleDragItem>::ConstIterator end(m_items.end());
-            for (QValueList<ArticleDragItem>::ConstIterator it = m_items.begin(); it != end; ++it)
-            {
-                Article a = Kernel::self()->feedList()->findArticle((*it).feedURL, (*it).guid);
-                if (!a.isNull())
-                     a.addTag(tag.id());
-            }
-        }
-        return true;
-    }
-*/
-    void articlesDropped(TreeNode* node, const QValueList<ArticleDragItem>& items)
-    {
-        m_items = items;
-        m_mode = ArticlesDropped;
-        visit(node);
-    }
-
-private:
-    NodeListView* m_view;
-    QValueList<ArticleDragItem> m_items;
-     
-    enum Mode { ArticlesDropped };
-    Mode m_mode;
-};
-
 class NodeListView::ConnectNodeVisitor : public TreeNodeVisitor
 {
     public:
@@ -210,6 +171,7 @@
                     m_view->setSelected(item, false);
             }
             
+            m_view->disconnectFromNode(node);
             delete item;
             return true;
         
@@ -245,6 +207,9 @@
 
         virtual bool visitTagNode(TagNode* node)
         {
+            if (m_view->findNodeItem(node))
+                return true;
+            
             TagNodeItem* item = 0;
             TreeNode* prev = node->prevSibling();
             FolderItem* parentItem = static_cast<FolderItem*>(m_view->findNodeItem(node->parent()));
@@ -276,6 +241,9 @@
 
         virtual bool visitTagFolder(TagFolder* node)
         {
+            if (m_view->findNodeItem(node))
+                return true;
+         
             TagFolderItem* item = 0;
             TreeNode* prev = node->prevSibling();
             FolderItem* parentItem = static_cast<FolderItem*>(m_view->findNodeItem(node->parent()));
@@ -311,6 +279,9 @@
         
         virtual bool visitFolder(Folder* node)
         {
+            if (m_view->findNodeItem(node))
+                return true;
+                     
             FolderItem* item = 0;
             TreeNode* prev = node->prevSibling();
             FolderItem* parentItem = static_cast<FolderItem*>(m_view->findNodeItem(node->parent()));
@@ -345,6 +316,9 @@
         
         virtual bool visitFeed(Feed* node)
         {
+            if (m_view->findNodeItem(node))
+                return true;
+         
             FeedItem* item = 0;
             TreeNode* prev = node->prevSibling();
             FolderItem* parentItem = static_cast<FolderItem*>(m_view->findNodeItem(node->parent()));
@@ -386,7 +360,6 @@
     d->disconnectNodeVisitor = new DisconnectNodeVisitor(this);
     d->createItemVisitor = new CreateItemVisitor(this);
     d->deleteItemVisitor = new DeleteItemVisitor(this);
-    d->dragAndDropVisitor = new DragAndDropVisitor(this);
 
     setMinimumSize(150, 150);
     addColumn(i18n("Feeds"));
@@ -426,7 +399,6 @@
     delete d->disconnectNodeVisitor;
     delete d->createItemVisitor;
     delete d->deleteItemVisitor;
-    delete d->dragAndDropVisitor;
     delete d;
     d = 0;
 }
@@ -536,26 +508,14 @@
     {
         openFolder();
 
-        FolderItem* parent = dynamic_cast<FolderItem*> (d->parent);
-        TreeNodeItem* afterMe = 0;
-
-        if(d->afterme)
-            afterMe = dynamic_cast<TreeNodeItem*> (d->afterme);
-
-        if (ArticleDrag::canDecode(e))
+        if (KURLDrag::canDecode(e))
         {
-            QPoint vp = contentsToViewport(e->pos());
-            TreeNodeItem* tni = dynamic_cast<TreeNodeItem*>(itemAt(vp));
-            if (tni != 0 && tni->node() != 0)
-            {
-                QValueList<ArticleDragItem> items;
-                ArticleDrag::decode(e, items);
-                d->dragAndDropVisitor->articlesDropped(tni->node(), items);
-
-            }
-        }
-        else if (KURLDrag::canDecode(e))
-        {
+            FolderItem* parent = dynamic_cast<FolderItem*> (d->parent);
+            TreeNodeItem* afterMe = 0;
+            
+            if(d->afterme)
+                afterMe = dynamic_cast<TreeNodeItem*> (d->afterme);
+            
             KURL::List urls;
             KURLDrag::decode( e, urls );
             e->accept();
Index: akregator/src/plugin.h
===================================================================
--- akregator/src/plugin.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/plugin.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -4,6 +4,8 @@
 #ifndef AKREGATOR_PLUGIN_H
 #define AKREGATOR_PLUGIN_H
 
+#include "akregator_export.h"
+
 #define AKREGATOR_EXPORT_PLUGIN( classname ) \
     extern "C" { \
          Akregator::Plugin* create_plugin() { return new classname; } \
@@ -17,7 +19,7 @@
 {
 //    class PluginConfig;
 
-    class Plugin
+    class AKREGATOR_EXPORT Plugin
     {
         public:
             virtual ~Plugin();
Index: akregator/src/Makefile.am
===================================================================
--- akregator/src/Makefile.am	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/Makefile.am	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -39,7 +39,8 @@
 #########################################################################
 
 # install headers (for storage plugins)
-akregatorinclude_HEADERS = storage.h feedstorage.h storagefactory.h storagefactoryregistry.h plugin.h
+akregatorinclude_HEADERS = storage.h feedstorage.h storagefactory.h storagefactoryregistry.h \
+                           plugin.h articleinterceptor.h akregator_export.h
 akregatorincludedir = $(includedir)/akregator
 
 # this is a lib shared by both the KPart and the main application
Index: akregator/src/pageviewer.cpp
===================================================================
--- akregator/src/pageviewer.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/pageviewer.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -175,7 +175,7 @@
 // Taken from KDevelop (lib/widgets/kdevhtmlpart.cpp)
 void PageViewer::slotForward()
 {
-    if (  d->current != d->history.fromLast() )
+    if ( d->current != d->history.fromLast() && d->current != d->history.end() )
     {
         QValueList<HistoryEntry>::Iterator tmp = d->current;
         ++tmp;
Index: akregator/src/viewer.cpp
===================================================================
--- akregator/src/viewer.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/viewer.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -51,7 +51,7 @@
     : KHTMLPart(parent, name), m_url(0)
 {
     setZoomFactor(100);
-    setJScriptEnabled(true);
+    setJScriptEnabled(false);
     setJavaEnabled(true);
     setMetaRefreshEnabled(true);
     setPluginsEnabled(true);
Index: akregator/src/utils.h
===================================================================
--- akregator/src/utils.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/utils.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -43,6 +43,14 @@
     */
 
     static uint calcHash(const QString& str);
+    
+    /**
+     * returns a file name for a URL, with chars like "/" ":"
+     * replaced by "_". Too long URLs (>255 chars) are shortened and
+     * appended with a hash value.
+     * 
+     */
+    static QString fileNameForUrl(const QString& url);
 };
 
 }
Index: akregator/src/storagefactoryregistry.h
===================================================================
--- akregator/src/storagefactoryregistry.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/storagefactoryregistry.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -25,6 +25,8 @@
 #ifndef AKREGATOR_BACKEND_STORAGEFACTORYREGISTRY_H
 #define AKREGATOR_BACKEND_STORAGEFACTORYREGISTRY_H
 
+#include "akregator_export.h"
+
 class QString;
 class QStringList;
 
@@ -33,7 +35,7 @@
 
 class StorageFactory;
 
-class StorageFactoryRegistry
+class AKREGATOR_EXPORT StorageFactoryRegistry
 {
     public:
         static StorageFactoryRegistry* self();
Index: akregator/src/akregator_run.cpp
===================================================================
--- akregator/src/akregator_run.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/akregator_run.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -31,7 +31,7 @@
 
 
 BrowserRun::BrowserRun(QWidget* mainWindow, Viewer* currentViewer, const KURL& url, const KParts::URLArgs& args, OpeningMode mode)
-    : KParts::BrowserRun(url, args, 0L, mainWindow, false, true)
+    : KParts::BrowserRun(url, args, 0L, mainWindow, false, false, true)
 {
     m_currentViewer = currentViewer;
     m_openingMode = mode;
Index: akregator/src/storage.h
===================================================================
--- akregator/src/storage.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/storage.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -27,6 +27,8 @@
 
 #include <qobject.h>
 
+#include "akregator_export.h"
+
 class QString;
 class QStringList;
 
@@ -39,7 +41,7 @@
     
     An archive implementation must implement Storage, FeedStorage and StorageFactory. See mk4storage for an example.
 */
-class Storage : public QObject
+class AKREGATOR_EXPORT Storage : public QObject
 {
     public:
 
Index: akregator/src/aboutdata.h
===================================================================
--- akregator/src/aboutdata.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/aboutdata.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -28,7 +28,7 @@
 #include <kaboutdata.h>
 #include <kdepimmacros.h>
 
-#define AKREGATOR_VERSION "1.2.4"
+#define AKREGATOR_VERSION "1.2.5"
 
 namespace Akregator {
 /**
Index: akregator/src/akregator_plugin.desktop
===================================================================
--- akregator/src/akregator_plugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/akregator_plugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Comment[es]=Extensión para Akregator
 Comment[et]=Akregatori plugin
 Comment[eu]=Akregator-en plugina
+Comment[fa]=وصله برای Akregator
 Comment[fi]=Liitännäinen Akregatoriin
 Comment[fr]=Module pour Akregator
 Comment[ga]=Breiseán Akregator
Index: akregator/src/akregator_export.h
===================================================================
--- akregator/src/akregator_export.h	(.../tags/KDE/3.5.4/kdepim)	(revision 0)
+++ akregator/src/akregator_export.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -0,0 +1,28 @@
+/*
+    This file is part of Akregator.
+
+     Copyright (C) 2006 Frank Osterfeld <frank.osterfeld at kdemail.net>
+
+    This library is free software; you can redistribute it and/or
+    modify it under the terms of the GNU Library General Public
+    License as published by the Free Software Foundation; either
+    version 2 of the License, or (at your option) any later version.
+
+    This library is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    Library General Public License for more details.
+
+    You should have received a copy of the GNU Library General Public License
+    along with this library; see the file COPYING.LIB.  If not, write to
+    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+    Boston, MA 02110-1301, USA.
+*/
+#ifndef AKREGATOR_AKREGATOREXPORT_H
+#define AKREGATOR_AKREGATOREXPORT_H
+
+#include <kdepimmacros.h>
+
+#define AKREGATOR_EXPORT KDE_EXPORT
+
+#endif
Index: akregator/src/akregator.desktop
===================================================================
--- akregator/src/akregator.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/akregator.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -15,6 +15,7 @@
 GenericName[es]=Lector de orígenes RSS
 GenericName[et]=RSS-kanalite lugemisvahend
 GenericName[eu]=RSS iturri Irakurlea
+GenericName[fa]=خوانندۀ خوراندن RSS
 GenericName[fi]=RSS-syötelukija
 GenericName[fr]=Lecteur de flux RSS
 GenericName[ga]=Léitheoir na bhFothaí RSS
@@ -55,10 +56,10 @@
 Comment[es]=Un agregador de RSS para KDE
 Comment[et]=KDE RSS-kanalite lugemisvahend
 Comment[eu]=KDE-ren RSS gehitzailea
+Comment[fa]=یک انبوهه‌ساز RSS برای KDE
 Comment[fi]=RSS-syötelukija
 Comment[fr]=Un lecteur de flux RSS pour KDE
 Comment[ga]=Comhbhailitheoir RSS le haghaidh KDE
-Comment[he]==קורא חדשות (RSS) עבור KDE
 Comment[hu]=KDE-s hírolvasó RSS hírcsatornákhoz
 Comment[is]=RSS fréttaforrit fyrir KDE
 Comment[it]=Un concentratore KDE per RSS
Index: akregator/src/feedstorage.h
===================================================================
--- akregator/src/feedstorage.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/feedstorage.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -27,6 +27,8 @@
 #include <qobject.h>
 #include <qstring.h>
 
+#include "akregator_export.h"
+
 class QStringList;
 
 
@@ -34,7 +36,7 @@
 namespace Backend {
 
 /** a convenience class to handle categories in the backend */
-class Category 
+class AKREGATOR_EXPORT Category 
 {
     public:
 
@@ -62,7 +64,7 @@
 
 class Storage;
 
-class FeedStorage : public QObject
+class AKREGATOR_EXPORT FeedStorage : public QObject
 {
     public:
     
Index: akregator/src/utils.cpp
===================================================================
--- akregator/src/utils.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/utils.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -44,4 +44,16 @@
     return hash;
 }
 
+QString Utils::fileNameForUrl(const QString& url_p)
+{
+    QString url2(url_p);
+    
+    url2 = url2.replace("/", "_").replace(":", "_");
+    
+    if (url2.length() > 255)
+        url2 = url2.left(200) + QString::number(Akregator::Utils::calcHash(url2), 16);
+    
+    return url2;
 }
+
+}
Index: akregator/src/articleinterceptor.h
===================================================================
--- akregator/src/articleinterceptor.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/articleinterceptor.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,15 +1,19 @@
 #ifndef AKREGATOR_ARTICLEINTERCEPTOR_H
 #define AKREGATOR_ARTICLEINTERCEPTOR_H
 
+#include "akregator_export.h"
+
 template <class T> class QValueList;
 
 namespace Akregator {
 
 class Article;
 
-/** Interface for intercepting new articles which were just fetched before adding them to the archive. E.g. an article filter could implement this interface to get fetched articles and label them */
+/** Interface for intercepting new articles which were just fetched before adding 
+ *  them to the archive. E.g. an article filter could implement this interface to 
+ *  get fetched articles and label them */
 
-class ArticleInterceptor
+class AKREGATOR_EXPORT ArticleInterceptor
 {
     public:
         /** processes an article. Note that the interceptor may modify the article */
@@ -18,7 +22,7 @@
 };
 
 /** Singleton managing the interceptors */
-class ArticleInterceptorManager
+class AKREGATOR_EXPORT ArticleInterceptorManager
 {
     public:
 
Index: akregator/src/eventsrc
===================================================================
--- akregator/src/eventsrc	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/eventsrc	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -15,6 +15,7 @@
 Name[es]=Origen añadido
 Name[et]=Kanal lisatud
 Name[eu]=Iturria gehituta
+Name[fa]=خوراندن اضافه شده‌
 Name[fi]=Syöte lisätty
 Name[fr]=Flux ajouté
 Name[ga]=Cuireadh fotha leis
@@ -55,6 +56,7 @@
 Comment[es]=Se ha añadido remotamente un origen a Akregator
 Comment[et]=Akregatorile lisati väljastpoolt uus kanal
 Comment[eu]=Iturri berri bat gehitu da urrunetik Akregator-era
+Comment[fa]=یک خوراندن جدید که به صورت دور به Akregator اضافه شده بود
 Comment[fi]=Uusi syöte lisättiin Akregatoriin ulkopuolelta
 Comment[fr]=Un flux a été ajouté à distance à Akregator
 Comment[he]=נוסף ערוץ ל־Akregator מרחוק
@@ -98,6 +100,7 @@
 Name[es]=Artículos nuevos
 Name[et]=Uued artiklid
 Name[eu]=Artikulu berriak
+Name[fa]=مقالات جدید
 Name[fi]=Uudet artikkelit
 Name[fr]=Nouveaux articles
 Name[ga]=Altanna Nua
@@ -139,6 +142,7 @@
 Comment[es]=Se obtuvieron los artículos nuevos
 Comment[et]=Tõmmati uued artiklid
 Comment[eu]=Artikulu berriak eskuratu dira
+Comment[fa]=مقالات جدید واکشی شده بود
 Comment[fi]=Uutta postia saapunut
 Comment[fr]=Les nouveaux articles ont été relevés
 Comment[ga]=Fuarthas ailt nua
Index: akregator/src/akregator_view.cpp
===================================================================
--- akregator/src/akregator_view.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ akregator/src/akregator_view.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -819,6 +819,9 @@
         m_articleViewer->slotShowSummary(node);
     }
 
+    if (node)
+        m_mainFrame->setCaption(node->title());
+
     m_actionManager->slotNodeSelected(node);
 
     updateTagActions();
@@ -1394,7 +1397,10 @@
     }
     else
     {
-        // TODO: read selected page viewer
+        QString selectedText = static_cast<PageViewer *>(m_currentFrame->part())->selectedText();
+        
+        if (!selectedText.isEmpty())
+            SpeechClient::self()->slotSpeak(selectedText, "en");
     }
 }
 
Index: pixmaps/cr16-action-newappointment.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: pixmaps/cr16-action-newappointment.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Index: pixmaps/cr32-action-journal.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr32-action-journal.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Index: pixmaps/cr16-action-journal.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr16-action-journal.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Index: pixmaps/cr16-action-inverse_recur.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr16-action-inverse_recur.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:keywords
   + Author Date Id Revision

Index: pixmaps/cr22-action-newtodo.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr22-action-newtodo.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:keywords
   + Author Date Id Revision

Index: pixmaps/cr16-action-bell.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr16-action-bell.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:keywords
   + Author Date Id Revision

Index: pixmaps/cr16-action-readonlyevent.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr16-action-readonlyevent.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:keywords
   + Author Date Id Revision

Index: pixmaps/cr16-action-recur.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr16-action-recur.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:keywords
   + Author Date Id Revision

Index: pixmaps/cr22-action-newjournal.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr22-action-newjournal.png
___________________________________________________________________
Name: svn:mime-type
   + image/png

Index: pixmaps/cr22-action-checkmark.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr22-action-checkmark.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:keywords
   + Author Date Id Revision

Index: pixmaps/cr22-action-newrecurevent.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr22-action-newrecurevent.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:keywords
   + Author Date Id Revision

Index: pixmaps/cr22-action-appointment.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr22-action-appointment.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:keywords
   + Author Date Id Revision

Index: pixmaps/cr22-action-checkedbox.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr22-action-checkedbox.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:keywords
   + Author Date Id Revision

Index: pixmaps/cr32-action-appointment.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr32-action-appointment.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:keywords
   + Author Date Id Revision

Index: pixmaps/cr16-action-appointment.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr16-action-appointment.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:keywords
   + Author Date Id Revision

Index: pixmaps/Makefile.am
===================================================================
--- pixmaps/Makefile.am	(.../tags/KDE/3.5.4/kdepim)	(revision 0)
+++ pixmaps/Makefile.am	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -0,0 +1,2 @@
+kdepimicondir = $(kde_datadir)/kdepim/icons
+kdepimicon_ICON = AUTO                                                                                                                                         

Property changes on: pixmaps/Makefile.am
___________________________________________________________________
Name: svn:mime-type
   + text/x-am
Name: svn:keywords
   + Author Date Id Revision
Name: svn:eol-style
   + native

Index: pixmaps/cr22-action-todo.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr22-action-todo.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:keywords
   + Author Date Id Revision

Index: pixmaps/cr22-action-checkedclipboard.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr22-action-checkedclipboard.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:keywords
   + Author Date Id Revision

Index: pixmaps/cr32-action-todo.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr32-action-todo.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:keywords
   + Author Date Id Revision

Index: pixmaps/cr22-action-newappointment.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: pixmaps/cr22-action-newappointment.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Index: pixmaps/cr16-action-todo.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr16-action-todo.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:keywords
   + Author Date Id Revision

Index: pixmaps/cr32-action-newappointment.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: pixmaps/cr32-action-newappointment.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Index: pixmaps/cr22-action-journal.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr22-action-journal.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:keywords
   + Author Date Id Revision

Index: pixmaps/cr22-action-checkedbox_mask.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: pixmaps/cr22-action-checkedbox_mask.png
___________________________________________________________________
Name: svn:mime-type
   + image/png
Name: svn:keywords
   + Author Date Id Revision


Property changes on: pixmaps
___________________________________________________________________
Name: svn:ignore
   + Makefile.in
Makefile

Index: kmobile/libkmobile.desktop
===================================================================
--- kmobile/libkmobile.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmobile/libkmobile.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Name[es]=Manejador de dispositivos hardware móviles de bajo nivel para KDE
 Name[et]=KDE mobiilide riistvara süvataseme draiver
 Name[eu]=KDE-ren dispositibo mugikorren behe-mailako hardware kontrolatzailea
+Name[fa]=گردانندۀ سخت افزاری سطح پایین دستگاه سیار KDE
 Name[fi]=KDE:n matkapuhelimen matalan tason laiteajuri
 Name[fr]=Pilote matériel de bas niveau des périphériques mobiles pour KDE
 Name[ga]=Tiománaí crua-earraí íseal-leibhéil do ghléasanna móibíleacha KDE
Index: kmobile/devices/gnokii/libkmobile_gnokii.desktop
===================================================================
--- kmobile/devices/gnokii/libkmobile_gnokii.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmobile/devices/gnokii/libkmobile_gnokii.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Teléfono móvil u organizador (gnokii)
 Name[et]=Mobiiltelefon või Organizer (gnokii)
 Name[eu]=Mugikorra edo antolatzailea (gnokii)
+Name[fa]=تلفن همراه یا سازمان‌دهنده (gnokii)
 Name[fi]=Matkapuhelin tai organisoija (gnokii)
 Name[fr]=Téléphone portable ou organiseur (gnokii)
 Name[ga]=Fón Póca nó Eagraí (gnokii)
@@ -59,6 +60,7 @@
 Comment[es]=Este manejador admite muchos teléfonos móviles NOKIA y de otras marcas vía la biblioteca gnokii
 Comment[et]=See draiver toetab gnokii teegi vahendusel paljusid Nokia ja teisi mobiiltelefone
 Comment[eu]=Kontrolatzaile honek NOKIA eta beste mugikor asko onartzen ditu gnokii liburutegiaren bidez
+Comment[fa]=این گرداننده، اغلب تلفنهای همراه نوکیا و غیره را از طریق کتابخانۀ gnokii پشتیبانی می‌کند
 Comment[fi]=Tämä ajuri tukee monia Nokian ja muita matkapuhelimia gnokii-kirjaston kautta
 Comment[fr]=Ce pilote prend en charge beaucoup de téléphones portables Nokia et autres à l'aide de la bibliothèque gnokii
 Comment[ga]=Tacaíonn an tiománaí seo le neart fóin NOKIA agus cinn eile, tríd an leabharlann gnokii
Index: kmobile/devices/skeleton/libkmobile_skeleton.desktop
===================================================================
--- kmobile/devices/skeleton/libkmobile_skeleton.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmobile/devices/skeleton/libkmobile_skeleton.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Name[es]=Dispositivo Skeleton
 Name[et]=Mallseade
 Name[eu]=Skeleton dispositiboa
+Name[fa]=دستگاه Skeleton
 Name[fi]=Luurankolaite
 Name[fr]=Périphérique modèle
 Name[ga]=Creatghléas
@@ -58,6 +59,7 @@
 Comment[es]=Dispositivo móvil Skeleton
 Comment[et]=Mobiili mallseade
 Comment[eu]=Skeleton dispositibo mugikorra
+Comment[fa]=دستگاه Skeleton سیار
 Comment[fi]=Matkapuhelimen luurankolaite
 Comment[fr]=Modèle de périphérique mobile
 Comment[ga]=Creatghléas Móibíleach
Index: kmobile/devices/gammu/libkmobile_gammu.desktop
===================================================================
--- kmobile/devices/gammu/libkmobile_gammu.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmobile/devices/gammu/libkmobile_gammu.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Teléfono móvil u organizador (gammu)
 Name[et]=Mobiiltelefon või Organizer (gammu)
 Name[eu]=Mugikorra edo antolatzailea (gammu)
+Name[fa]=تلفن همراه یا سازمان دهنده (gammu)
 Name[fi]=Matkapuhelin tai organisaattori (gammu)
 Name[fr]=Téléphone portable ou organiseur (gammu)
 Name[ga]=Fón Póca nó Eagraí (gammu)
@@ -59,6 +60,7 @@
 Comment[es]=Este manejador admite muchos teléfonos móviles NOKIA y de otras marcas vía la biblioteca gammu
 Comment[et]=See draiver toetab gammu teegi vahendusel paljusid Nokia ja teisi mobiiltelefone
 Comment[eu]=Kontrolatzaile honek NOKIA eta beste mugikor asko onartzen ditu gammu liburutegiaren bidez
+Comment[fa]=این گرداننده، اغلب تلفنهای همراه نوکیا و غیره را از طریق کتابخانۀ gammu پشتیبانی می‌کند
 Comment[fi]=Tämä ajuri tukee monia Nokian ja muita matkapuhelimia gammu-kirjaston kautta
 Comment[fr]=Ce pilote prend en charge beaucoup de téléphones portables Nokia et autres à l'aide de la bibliothèque gammu
 Comment[ga]=Tacaíonn an tiománaí seo le neart fóin NOKIA agus cinn eile, tríd an leabharlann gammu
Index: kmobile/devices/digicam/libkmobile_digicam.desktop
===================================================================
--- kmobile/devices/digicam/libkmobile_digicam.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmobile/devices/digicam/libkmobile_digicam.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Cámara digital
 Name[et]=Digitaalkaamera
 Name[eu]=Kamera digitala
+Name[fa]=دوربین رقمی‌
 Name[fi]=digitaalikamera
 Name[fr]=Appareil photo numérique
 Name[ga]=Ceamara Digiteach
@@ -62,6 +63,7 @@
 Comment[es]=Este manejador admite muchas cámaras digitales
 Comment[et]=See draiver toetab paljusid digitaalkaameraid
 Comment[eu]=Kontrolatzaile honek kamera digital asko onartzen ditu
+Comment[fa]=این گرداننده اغلب دوربینهای رقمی را پشتیبانی می‌کند
 Comment[fi]=Tämä ajuri tukee useita digitaalikameroita
 Comment[fr]=Ce pilote prend en charge beaucoup d'appareils photo numériques
 Comment[ga]=Tacaíonn an tiománaí seo le neart ceamaraí digiteacha
Index: kmobile/kmobile.desktop
===================================================================
--- kmobile/kmobile.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmobile/kmobile.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -12,6 +12,7 @@
 Name[nn]=KMobil
 Name[sv]=Kmobile
 Name[ta]=கேநடமாடும் தொலைபேசி
+Name[zh_TW]=KMobile 行動裝置
 
 GenericName=Manage Mobile Devices
 GenericName[be]=Кіраваньне мабільнымі прыладамі
@@ -27,6 +28,7 @@
 GenericName[es]=Gestiona dispositivos móviles
 GenericName[et]=Mobiilihaldur
 GenericName[eu]=Dispositibo mugikorrak kudeatu
+GenericName[fa]=مدیریت دستگاههای سیار
 GenericName[fi]=Hallitse matkapuhelinlaitteita
 GenericName[fr]=Gérer les périphériques mobiles
 GenericName[ga]=Bainistigh Gléasanna Móibíleacha
@@ -75,6 +77,7 @@
 Comment[es]=A gestor de dispositivos móviles para KDE
 Comment[et]=KDE mobiilihaldur
 Comment[eu]=KDE-ren dispositibo mugikorren kudeatzailea
+Comment[fa]=یک مدیر دستگاههای سیار KDE
 Comment[fi]=KDE:n matkapuhelinlaitteiden hallinta
 Comment[fr]=Un gestionnaire de périphériques mobiles pour KDE
 Comment[ga]=Bainisteoir Gléasanna Móibíleacha KDE
Index: kmobile/kioslave/mimetypes/mobile_addressbook.desktop
===================================================================
--- kmobile/kioslave/mimetypes/mobile_addressbook.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmobile/kioslave/mimetypes/mobile_addressbook.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Comment[es]=Contactos del dispositivo móvil
 Comment[et]=Mobiili kontaktid
 Comment[eu]=Kontaktuak dispositibo mugikorrean
+Comment[fa]=تماسها در دستگاه سیار
 Comment[fi]=Mobiililaitteen yhteystiedot
 Comment[fr]=Contacts dans le périphérique mobile
 Comment[ga]=Teagmhálacha i nGléas Móibíleach
Index: kmobile/kioslave/mimetypes/mobile_notes.desktop
===================================================================
--- kmobile/kioslave/mimetypes/mobile_notes.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmobile/kioslave/mimetypes/mobile_notes.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Comment[es]=Notas del dispositivo móvil
 Comment[et]=Mobiili märkmed (Notes)
 Comment[eu]=Oharrak dispositibo mugikorrean
+Comment[fa]=یادداشتها در دستگاه سیار
 Comment[fi]=Mobiililaitteen muistio
 Comment[fr]=Notes dans un périphérique mobile
 Comment[ga]=Nótaí i nGléas Móibíleach
Index: kmobile/kioslave/mimetypes/mobile_calendar.desktop
===================================================================
--- kmobile/kioslave/mimetypes/mobile_calendar.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmobile/kioslave/mimetypes/mobile_calendar.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Comment[es]=Calendario del dispositivo móvil
 Comment[et]=Mobiili kalender
 Comment[eu]=Egutegia dispositibo mugikorrean
+Comment[fa]=تقویم در دستگاه سیار
 Comment[fi]=Mobiililaitteen kalenteri
 Comment[fr]=Calendrier dans un périphérique mobile
 Comment[ga]=Féilire i nGléas Móibíleach
Index: kmobile/kioslave/mimetypes/mobile_device.desktop
===================================================================
--- kmobile/kioslave/mimetypes/mobile_device.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmobile/kioslave/mimetypes/mobile_device.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Comment[es]=Dispositivo móvil
 Comment[et]=Mobiil
 Comment[eu]=Dispositibo mugikorra
+Comment[fa]=دستگاه سیار
 Comment[fi]=Mobiililaite
 Comment[fr]=Périphérique mobile
 Comment[ga]=Gléas Móibíleach
Index: wizards/groupwarewizard.desktop
===================================================================
--- wizards/groupwarewizard.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ wizards/groupwarewizard.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Name[es]=Asistente de groupware de KDE
 Name[et]=KDE Groupware nõustaja
 Name[eu]=KDE groupware morroia
+Name[fa]=جادوگر KDE Groupware
 Name[fi]=KDE Groupwaren ohjattu toiminto
 Name[fr]=Assistant KDE de travail collaboratif
 Name[ga]=Draoi Groupware KDE
Index: kresources/egroupware/kabc_xmlrpc.desktop
===================================================================
--- kresources/egroupware/kabc_xmlrpc.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/egroupware/kabc_xmlrpc.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[es]=Servidor de eGroupware (por medio de XML-RPC)
 Name[et]=eGroupware server (XML-RPC vahendusel)
 Name[eu]=eGroupware zerbitzaria (XML-RPC bidez)
+Name[fa]=کارساز eGroupware (از طریق XML-RPC)
 Name[fi]=eGroupware-palvelin (XML-RPC kautta)
 Name[fr]=Serveur eGroupware (via XML-RPC)
 Name[ga]=Freastalaí eGroupware (via XML-RPC)
Index: kresources/egroupware/xmlrpciface.cpp
===================================================================
--- kresources/egroupware/xmlrpciface.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/egroupware/xmlrpciface.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -200,7 +200,14 @@
   {
       case QVariant::String:
       case QVariant::CString:
-      return "<value><string>" + arg.toString() + "</string></value>\r\n";
+        {
+        QString result = arg.toString();
+        result = result.replace( "&", "&amp;" );
+        result = result.replace( "\"", "&quot;" );
+        result = result.replace( "<", "&lt;" );
+        result = result.replace( ">", "&gt;" );
+        return "<value><string>" + result + "</string></value>\r\n";
+        }
       case QVariant::Int:
       return "<value><int>" + QString::number( arg.toInt() ) + "</int></value>\r\n";
       case QVariant::Double:
Index: kresources/egroupware/knotes_xmlrpc.desktop
===================================================================
--- kresources/egroupware/knotes_xmlrpc.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/egroupware/knotes_xmlrpc.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[es]=Servidor de eGroupware (por medio de XML-RPC)
 Name[et]=eGroupware server (XML-RPC vahendusel)
 Name[eu]=eGroupware zerbitzaria (XML-RPC bidez)
+Name[fa]=کارساز eGroupware (از طریق XML-RPC)
 Name[fi]=eGroupware-palvelin (XML-RPC kautta)
 Name[fr]=Serveur eGroupware (via XML-RPC)
 Name[ga]=Freastalaí eGroupware (via XML-RPC)
Index: kresources/egroupware/kcal_xmlrpc.desktop
===================================================================
--- kresources/egroupware/kcal_xmlrpc.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/egroupware/kcal_xmlrpc.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[es]=Servidor de eGroupware (por medio de XML-RPC)
 Name[et]=eGroupware server (XML-RPC vahendusel)
 Name[eu]=eGroupware zerbitzaria (XML-RPC bidez)
+Name[fa]=کارساز eGroupware (از طریق XML-RPC)
 Name[fi]=eGroupware-palvelin (XML-RPC kautta)
 Name[fr]=Serveur eGroupware (via XML-RPC)
 Name[ga]=Freastalaí eGroupware (via XML-RPC)
Index: kresources/tvanytime/kcal_tvanytime.desktop
===================================================================
--- kresources/tvanytime/kcal_tvanytime.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/tvanytime/kcal_tvanytime.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[es]=Programación de TV
 Name[et]=Telekavad
 Name[eu]=TB planifikazioak
+Name[fa]=زمان‌بندیهای تلویزیون‌
 Name[fi]=TV-ohjelmat
 Name[fr]=Programmes TV
 Name[ga]=Sceidil Teilifíse
Index: kresources/exchange/exchange.desktop
===================================================================
--- kresources/exchange/exchange.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/exchange/exchange.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -16,6 +16,7 @@
 Name[es]=Servidor Exchange 2000
 Name[et]=Exchange 2000 server
 Name[eu]=Exchange 2000 zerbitzaria
+Name[fa]=کارساز Exchange ۲۰۰۰
 Name[fi]=Exchange 2000 -palvelin
 Name[fr]=Serveur Exchange2000
 Name[ga]=Freastalaí Exchange 2000
Index: kresources/exchange/exchange_deprecated.desktop
===================================================================
--- kresources/exchange/exchange_deprecated.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/exchange/exchange_deprecated.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Name[es]=Servidor Exchange 2000 (obsoleto)
 Name[et]=Exchange 2000 server (iganenud)
 Name[eu]=Exchange 2000 zerbitzaria (zaharkituta)
+Name[fa]=کارسازExchange ۲۰۰۰ (محکوم)
 Name[fi]=Exchange 2000 -palvelin (vanhentunut)
 Name[fr]=Serveur Exchange2000 (désuet)
 Name[ga]=Freastalaí Exchange 2000 (as dáta)
Index: kresources/groupwise/kcal_groupwise.desktop
===================================================================
--- kresources/groupwise/kcal_groupwise.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/groupwise/kcal_groupwise.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[es]=Servidor de Novell GroupWise
 Name[et]=Novelli GroupWise server
 Name[eu]=Novell GroupWise zerbitzaria
+Name[fa]=کارساز Novell GroupWise
 Name[fi]=Novell GroupWise -palvelin
 Name[fr]=Serveur de travail collaboratif GroupWise de Novell
 Name[ga]=Freastalaí Novell GroupWise
Index: kresources/groupwise/soap/types.xsd
===================================================================
--- kresources/groupwise/soap/types.xsd	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/groupwise/soap/types.xsd	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -524,7 +524,7 @@
 					<xs:element name="officialVersion" type="xs:unsignedInt" minOccurs="0"/>
 					<xs:element name="currentVersion" type="xs:unsignedInt" minOccurs="0"/>
 					<xs:element name="versionNumber" type="xs:unsignedInt" minOccurs="0"/>
-					<xs:element name="versionDescription" minOccurs="0"/>
+					<xs:element name="versionDescription" type="xs:string" minOccurs="0"/>
 					<xs:element name="fileSize" type="xs:unsignedInt" minOccurs="0"/>
 					<xs:element name="acl" type="tns:AccessControlList" minOccurs="0"/>
 				</xs:sequence>
Index: kresources/groupwise/kabc_groupwise.desktop
===================================================================
--- kresources/groupwise/kabc_groupwise.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/groupwise/kabc_groupwise.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[es]=Servidor de Novell GroupWise
 Name[et]=Novelli GroupWise server
 Name[eu]=Novell GroupWise zerbitzaria
+Name[fa]=کارساز Novell GroupWise
 Name[fi]=Novell GroupWise -palvelin
 Name[fr]=Serveur de travail collaboratif GroupWise de Novell
 Name[ga]=Freastalaí Novell GroupWise
Index: kresources/groupwise/kioslave/groupwise.cpp
===================================================================
--- kresources/groupwise/kioslave/groupwise.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/groupwise/kioslave/groupwise.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -21,6 +21,8 @@
 
 #include "groupwiseserver.h"
 
+#include <qregexp.h>
+
 #include <libkdepim/kabcresourcecached.h>
 
 #include <libkcal/freebusy.h>
@@ -164,6 +166,12 @@
     QString email = file.left( file.length() - 4 );
     debugMessage( "Email: " + email );
 
+    // Sanitise local Nuernberg email addresses
+    kdDebug() << "Email before sanitizing: " << email << endl;
+    email = email.replace(QRegExp("\\.EMEA5-1\\.EMEA5" ), "" );
+    email = email.replace(QRegExp("\\.Suse.INTERNET" ), "" );
+    kdDebug() << "Email after sanitizing: " << email << endl;
+
     QString u = soapUrl( url );
 
     QString user = url.user();
Index: kresources/slox/kcal_slox.desktop
===================================================================
--- kresources/slox/kcal_slox.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/slox/kcal_slox.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[es]=Servidor Openexchange de SUSE LINUX
 Name[et]=SUSE LINUX Openexchange server
 Name[eu]=SUSE LINUX Openexchange zerbitzaria
+Name[fa]=کارساز SUSE LINUX Openexchange
 Name[fi]=Suse Linux Openexchange -palvelin
 Name[fr]=Serveur SUSE Linux Openexchange
 Name[ga]=Freastalaí Openexchange SUSE LINUX
Index: kresources/slox/kcal_ox.desktop
===================================================================
--- kresources/slox/kcal_ox.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/slox/kcal_ox.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -9,6 +9,7 @@
 Name[es]=Servidor OpenXchange
 Name[et]=OpenXchange server
 Name[eu]=OpenXchange zerbitzaria
+Name[fa]=کارساز OpenXchange
 Name[fi]=OpenXchange-palvelin
 Name[fr]=Serveur OpenXchange
 Name[ga]=Freastalaí Openexchange
Index: kresources/slox/kabc_slox.desktop
===================================================================
--- kresources/slox/kabc_slox.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/slox/kabc_slox.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[es]=Servidor Openexchange de SUSE LINUX
 Name[et]=SUSE LINUX Openexchange server
 Name[eu]=SUSE LINUX Openexchange zerbitzaria
+Name[fa]=کارساز SUSE LINUX Openexchange
 Name[fi]=Suse Linux Openexchange -palvelin
 Name[fr]=Serveur SUSE Linux Openexchange
 Name[ga]=Freastalaí Openexchange SUSE LINUX
Index: kresources/slox/kabc_ox.desktop
===================================================================
--- kresources/slox/kabc_ox.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/slox/kabc_ox.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -9,6 +9,7 @@
 Name[es]=Servidor OpenXchange
 Name[et]=OpenXchange server
 Name[eu]=OpenXchange zerbitzaria
+Name[fa]=کارساز OpenXchange
 Name[fi]=OpenXchange-palvelin
 Name[fr]=Serveur OpenXchange
 Name[ga]=Freastalaí Openexchange
Index: kresources/featureplan/kcal_resourcefeatureplan.desktop
===================================================================
--- kresources/featureplan/kcal_resourcefeatureplan.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/featureplan/kcal_resourcefeatureplan.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -8,6 +8,7 @@
 Name[es]=Plan de características XML
 Name[et]=XML võimaluste plaan
 Name[eu]=XML eginbide plana
+Name[fa]=نقشۀ ویژگی XML
 Name[fi]=XML-ominaisuussuunnitelma
 Name[fr]=Plan de fonctionnalités XML
 Name[hu]=XML FeaturePlan
Index: kresources/groupdav/kabc_groupdav.desktop
===================================================================
--- kresources/groupdav/kabc_groupdav.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/groupdav/kabc_groupdav.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Name[es]=Servidor GroupDAV (por ejemplo, OpenGroupware)
 Name[et]=GroupDAV server (nt. OpenGroupware)
 Name[eu]=GroupDAV zerbitzaria (adib. OpenGroupware)
+Name[fa]=کارساز GroupDAV (مثلاً OpenGroupware)
 Name[fi]=GroupDAV-palvelin (esim. OpenGroupware)
 Name[fr]=GroupDAV Serveur (ex. OpenGroupware)
 Name[ga]=Freastalaí GroupDAV (m.sh. OpenGroupware)
Index: kresources/groupdav/kcal_groupdav.desktop
===================================================================
--- kresources/groupdav/kcal_groupdav.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/groupdav/kcal_groupdav.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Name[es]=Servidor GroupDAV (por ejemplo, OpenGroupware)
 Name[et]=GroupDAV server (nt. OpenGroupware)
 Name[eu]=GroupDAV zerbitzaria (adib. OpenGroupware)
+Name[fa]=کارساز GroupDAV (مثلاً OpenGroupware)
 Name[fi]=GroupDAV-palvelin (esim. OpenGroupware)
 Name[fr]=GroupDAV Serveur (ex. OpenGroupware)
 Name[ga]=Freastalaí GroupDAV (m.sh. OpenGroupware)
Index: kresources/blogging/blogging.desktop
===================================================================
--- kresources/blogging/blogging.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/blogging/blogging.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -9,6 +9,7 @@
 Name[es]=Diarios, como bitácoras en un servidor
 Name[et]=Päevik veebipäevikuna serveris
 Name[eu]=Egunkariak blog moduan zerbitzarian
+Name[fa]=نشریه‌ها به عنوان وب‌نوشتها روی یک کارساز
 Name[fi]=Päiväkirjat blogeina palvelimella
 Name[fr]=Journaux (blogs) sur un serveur
 Name[hu]=Naplók blogként tárolása a kiszolgálón
Index: kresources/kolab/kabc/kolab.desktop
===================================================================
--- kresources/kolab/kabc/kolab.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/kolab/kabc/kolab.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Name[es]=Libreta de direcciones en servidor IMAP por medio de KMail
 Name[et]=Aadressiraamat IMAP-serveris (KMaili vahendusel)
 Name[eu]=Helbide-liburua IMAP zerbitzarian KMail-en bidez
+Name[fa]=کتاب نشانی روی کارساز IMAP از طریق KMail
 Name[fi]=Osoitekirja IMAP-palvelimella KMailin avulla
 Name[fr]=Carnet d'adresse sur serveur IMAP (via KMail)
 Name[ga]=Leabhar Seoltaí ar Fhreastalaí IMAP via KMail
Index: kresources/kolab/knotes/kolabresource.desktop
===================================================================
--- kresources/kolab/knotes/kolabresource.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/kolab/knotes/kolabresource.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Name[es]=Servidor IMAP por medio de KMail
 Name[et]=IMAP-server (KMaili vahendusel)
 Name[eu]=IMAP zerbitzaria KMail-en bidez
+Name[fa]=کارساز IMAP از طریق KMail
 Name[fi]=IMAP-palvelin KMailin avulla
 Name[fr]=Serveur IMAP (via KMail)
 Name[ga]=Freastalaí IMAP via KMail
Index: kresources/kolab/kcal/kolab.desktop
===================================================================
--- kresources/kolab/kcal/kolab.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/kolab/kcal/kolab.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Name[es]=Calendario en servidor IMAP por medio de KMail
 Name[et]=Kalender IMAP-serveris (KMaili vahendusel)
 Name[eu]=Egutegia IMAP zerbitzarian KMail-en bidez
+Name[fa]=تقویم روی کارساز IMAP از طریق  KMail
 Name[fi]=Kalenteri IMAP-palvelimella KMailin avulla
 Name[fr]=Agenda sur serveur IMAP (via KMail)
 Name[ga]=Féilire ar Fhreastalaí IMAP via KMail
Index: kresources/birthdays/kabc.desktop
===================================================================
--- kresources/birthdays/kabc.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/birthdays/kabc.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Cumpleaños desde KAddressBook
 Name[et]=Sünnipäevad KDE aadressiraamatust
 Name[eu]=Urtebetetzeak KAddressBook-etik
+Name[fa]=تولدها از KAddressBook
 Name[fi]=Syntymäpäivät KDE:n osoitekirjasta
 Name[fr]=Dates de naissance de KAddressBook
 Name[ga]=Breithlaethanta ó KAddressBook
Index: kresources/groupware/kabc_groupware.desktop
===================================================================
--- kresources/groupware/kabc_groupware.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/groupware/kabc_groupware.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -9,6 +9,7 @@
 Name[es]=Servidor de Groupware
 Name[et]=Grupitöö server
 Name[eu]=Groupware zerbitzaria
+Name[fa]=کارساز Groupware 
 Name[fi]=Groupware-palvelin
 Name[fr]=Serveur de travail collaboratif
 Name[ga]=Freastalaí Groupware
Index: kresources/groupware/kcal_groupware.desktop
===================================================================
--- kresources/groupware/kcal_groupware.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/groupware/kcal_groupware.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -9,6 +9,7 @@
 Name[es]=Servidor de Groupware
 Name[et]=Grupitöö server
 Name[eu]=Groupware zerbitzaria
+Name[fa]=کارساز Groupware 
 Name[fi]=Groupware-palvelin
 Name[fr]=Serveur de travail collaboratif
 Name[ga]=Freastalaí Groupware
Index: kresources/remote/remote.desktop
===================================================================
--- kresources/remote/remote.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/remote/remote.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Name[es]=Calendario en un archivo remoto
 Name[et]=Kalender võrgufailis
 Name[eu]=Egutegia urruneko fitxategi batean
+Name[fa]=تقویم در پروندۀ دور
 Name[fi]=Kalenteri etätiedostossa
 Name[fr]=Calendrier dans un fichier distant
 Name[ga]=Féilire i gCianchomhad
Index: kresources/newexchange/kabc_newexchange.desktop
===================================================================
--- kresources/newexchange/kabc_newexchange.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/newexchange/kabc_newexchange.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[es]=Libreta de direcciones en un servidor Exchange (experimental)
 Name[et]=Aadressiraamat Exchange-serveris (eksperimentaalne)
 Name[eu]=Helbide-liburua Exchange zerbitzari batean (esperimentala)
+Name[fa]=کتاب نشانی روی یک کارساز مبادله )تجربی(
 Name[fi]=Osoitekirja Exchange-palvelimella (kokeellinen)
 Name[fr]=Carnet d'adresse sur un serveur Exchange (expérimental)
 Name[ga]=Leabhar Seoltaí ar Fhreastalaí Exchange (trialach)
Index: kresources/newexchange/kabc_newexchange_final.desktop
===================================================================
--- kresources/newexchange/kabc_newexchange_final.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/newexchange/kabc_newexchange_final.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Name[es]=Libreta de direcciones en un servidor Exchange
 Name[et]=Aadressiraamat Exchange-serveris
 Name[eu]=Helbide-liburua Exchange zerbitzari (esperimentala)
+Name[fa]=کتاب نشانی روی یک کارساز مبادله‌
 Name[fi]=Osoitekirja Exchange-palvelimella
 Name[fr]=Carnet d'adresse sur un serveur Exchange
 Name[ga]=Leabhar Seoltaí ar Fhreastalaí Exchange
Index: kresources/newexchange/kcal_newexchange.desktop
===================================================================
--- kresources/newexchange/kcal_newexchange.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/newexchange/kcal_newexchange.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[es]=Calendario en un servidor Exchange (experimental)
 Name[et]=Kalender Exchange-serveris (eksperimentaalne)
 Name[eu]=Egutegia Exchange zerbitzari batean (esperimentala)
+Name[fa]=تقویم روی یک کارساز مبادله )تجربی(
 Name[fi]=Kalenteri Exchange-palvelimella (kokeellinen)
 Name[fr]=Agenda sur un serveur Exchange (expérimental)
 Name[ga]=Féilire ar Fhreastalaí Exchange (trialach)
Index: kresources/newexchange/kcal_newexchange_final.desktop
===================================================================
--- kresources/newexchange/kcal_newexchange_final.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kresources/newexchange/kcal_newexchange_final.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -12,6 +12,7 @@
 Name[es]=Calendario en un servidor Exchange
 Name[et]=Kalender Exchange-serveris
 Name[eu]=Egutegia Exchange zerbitzari batean
+Name[fa]=تقویم روی یک کارساز مبادله‌
 Name[fi]=Kalenteri Exchange-palvelimella
 Name[fr]=Agenda sur un serveur Exchange
 Name[ga]=Féilire ar Fhreastalaí Exchange
Index: certmanager/conf/kleopatra_config_appear.desktop
===================================================================
--- certmanager/conf/kleopatra_config_appear.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ certmanager/conf/kleopatra_config_appear.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -27,6 +27,7 @@
 Name[es]=Apariencia
 Name[et]=Välimus
 Name[eu]=Itxura
+Name[fa]=ظاهر
 Name[fi]=Ulkoasu
 Name[fr]=Apparence
 Name[ga]=Cuma
@@ -75,6 +76,7 @@
 Comment[es]=Configuración de colores y tipografías
 Comment[et]=Värvide ja fontide seadistamine
 Comment[eu]=Kolore eta letra-tipoen konfigurazioa
+Comment[fa]=پیکربندی رنگها و قلمها
 Comment[fi]=Värien ja kirjasinten asetukset
 Comment[fr]=Configuration des polices et des couleurs
 Comment[ga]=Cumraíocht na nDathanna/gClófhoirne
@@ -122,6 +124,7 @@
 Keywords[es]=color, tipografía, configuración
 Keywords[et]=värv, font, seadistamine
 Keywords[eu]=kolore,letra-tipo, konfigurazioa
+Keywords[fa]=رنگ،قلم،پیکربندی‌
 Keywords[fi]=värit,kirjasimet,asetukset
 Keywords[fr]=couleur,police,configuration,paramètres,réglages,couleurs,polices
 Keywords[ga]=dath,cló,cumraíocht
Index: certmanager/conf/kleopatra_config_dnorder.desktop
===================================================================
--- certmanager/conf/kleopatra_config_dnorder.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ certmanager/conf/kleopatra_config_dnorder.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -24,6 +24,7 @@
 Name[es]=Orden de atributos DN
 Name[et]=DN-atribuutide järjekord
 Name[eu]=DN-atributu ordena
+Name[fa]=ترتیب خصیصۀ DN
 Name[fi]=DN-attribuuttien järjestys
 Name[fr]=Ordre des attributs DN
 Name[gl]=Orde de DN-Attribute
@@ -66,13 +67,14 @@
 Comment[es]=Configura el orden en el que se muestran los atributos DN
 Comment[et]=DN-atribuutide näitamise järjekorra seadistamine
 Comment[eu]=Konfiguratu DN atributuak zein ordenetan erakutsiko diren
+Comment[fa]=پیکربندی ترتیبی که خصیصه‌های DN با آن نمایش داده می‌شوند
 Comment[fi]=Määrittele missä järjestyksessä DN-attribuutit näytetään
 Comment[fr]=Configurer l'ordre dans lequel les attributs DN sont affichés
 Comment[gl]=Configurar a orde en que se amosan os atributos DN
 Comment[he]=הגדרה של הסדר שבהם מאפייני DN מוצגים
 Comment[hu]=A DN-attribútumok megjelenítési sorrendjének beállítása
 Comment[is]=Stilla röð DN eiginleikanna
-Comment[it]=Configuraz l'ordine in cui sono mostrati gli attributi DN
+Comment[it]=Configura l'ordine in cui sono mostrati gli attributi DN
 Comment[ja]=DN 属性を表示する順位を設定
 Comment[km]=កំណត់​រចនាសម្ព័ន្ធ​លំដាប់ ដែល​ត្រូវ​បង្ហាញ​គុណលក្ខណៈ DN
 Comment[lt]=Konfigūruoti DN savybių rodymo tvarką
@@ -109,6 +111,7 @@
 Keywords[es]=DN,orden,RDN,atributo
 Keywords[et]=DN,järjekord,RDN,atribuut
 Keywords[eu]=DN, ordena, RDN, atributua
+Keywords[fa]=DN،ترتیب،RDN،خصیصه‌
 Keywords[fi]=DN,järjestys,RDN,attribuutti
 Keywords[fr]=DN,ordre,RDN,attribut
 Keywords[ga]=DN,ord,RDN,aitreabúid
Index: certmanager/conf/kleopatra_config_dirserv.desktop
===================================================================
--- certmanager/conf/kleopatra_config_dirserv.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ certmanager/conf/kleopatra_config_dirserv.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -24,6 +24,7 @@
 Name[es]=Servicios de directorio
 Name[et]=Kataloogiteenused
 Name[eu]=Direktorio zerbitzuak
+Name[fa]=خدمات فهرست راهنما
 Name[fi]=Hakemistopalvelut
 Name[fr]=Services de répertoires
 Name[ga]=Seirbhísí Eolaire
@@ -68,6 +69,7 @@
 Comment[es]=Configuración de los servicios de directorio LDAP
 Comment[et]=LDAP kataloogiteenuste seadistused
 Comment[eu]=LDAP direktorio zerbitzuen konfigurazioa
+Comment[fa]=پیکربندی خدمات فهرست راهنمای LDAP
 Comment[fi]=Hakemistopalveluiden asetukset
 Comment[fr]=Configuration des répertoires LDAP
 Comment[gl]=Configuración dos servicios de directorio LDAP
@@ -112,6 +114,7 @@
 Keywords[es]=ldap,directorio,servicios
 Keywords[et]=ldap,kataloog,teenused
 Keywords[eu]=Idap, direktorio, zerbitzuak
+Keywords[fa]=ldap،فهرست راهنما،خدمات‌‌
 Keywords[fi]=ldap,hakemisto,palvelut
 Keywords[fr]=ldap,dossier,dossiers,service,services
 Keywords[ga]=ldap,eolaire,seirbhísí
Index: certmanager/lib/libkleopatrarc.desktop
===================================================================
--- certmanager/lib/libkleopatrarc.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ certmanager/lib/libkleopatrarc.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[es]=Clave no validada
 Name[et]=Võtme ehtsus kontrollimatu
 Name[eu]=Balidatu gabeko gakoa
+Name[fa]=کلید بدون اعتبار
 Name[fi]=Varmistamaton avain
 Name[fr]=Clé non validée
 Name[he]=מפתח לא מוודא
@@ -55,6 +56,7 @@
 Name[es]=Clave caducada
 Name[et]=Aegunud võti
 Name[eu]=Iraungitako gakoa
+Name[fa]=کلید منقضی‌
 Name[fi]=Vanhentunut avain
 Name[fr]=Clé expirée
 Name[he]=מפתח לא תקף
@@ -97,6 +99,7 @@
 Name[es]=Clave revocada
 Name[et]=Tühistatud võti
 Name[eu]=Errebokatutako gakoa
+Name[fa]=کلید لغو شده‌
 Name[fi]=Peruutettu avain
 Name[fr]=Clé révoquée
 Name[he]=מפתח לא קביל
@@ -140,6 +143,7 @@
 Name[es]=Certificado raíz de confianza
 Name[et]=Usaldusväärne juursertifikaat
 Name[eu]=Konfidantzazko erro ziurtagiria
+Name[fa]=گواهینامۀ معتبر کاربر ارشد
 Name[fi]=Luotettu juurivarmenne
 Name[fr]=Certificat racine de confiance
 Name[hu]=Megbízható gyökértanúsítvány
@@ -182,6 +186,7 @@
 Name[es]=Certificado raíz no de confianza
 Name[et]=Ebausaldusväärne juursertifikaat
 Name[eu]=Konfidantza gabeko erro ziurtagiria
+Name[fa]=گواهینامۀ بدون اعتبار کاربر ارشد
 Name[fi]=Ei-luotettu juurivarmenne
 Name[fr]=Certificat racine non fiable
 Name[hu]=Nem megbízható gyökértanúsítvány
@@ -223,6 +228,7 @@
 Name[es]=Otras claves
 Name[et]=Muud võtmed
 Name[eu]=Beste gakoak
+Name[fa]=کلیدهای دیگر
 Name[fi]=Muut avaimet
 Name[fr]=Autres clés
 Name[ga]=Eochracha Eile
Index: karm/karm_part.cpp
===================================================================
--- karm/karm_part.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ karm/karm_part.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -693,7 +693,11 @@
   return _taskView->importPlanner(fileName);
 }
 
+void karmPart::startNewSession()
+{
+  _taskView->startNewSession();
+  _taskView->save();
+} 
 
-
 #include <qpopupmenu.h>
 #include "karm_part.moc"
Index: karm/timekard.cpp
===================================================================
--- karm/timekard.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ karm/timekard.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -343,7 +343,7 @@
 
 QDate Week::end() const
 {
-  return _start.addDays(7);
+  return _start.addDays(6);
 }
 
 QString Week::name() const
Index: karm/karm_part.h
===================================================================
--- karm/karm_part.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ karm/karm_part.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -112,7 +112,7 @@
     void fileOpen();
     void fileSaveAs();
     void slotSelectionChanged();
-
+    void startNewSession(); 
 };
 
 class KInstance;
Index: karm/support/karm.desktop
===================================================================
--- karm/support/karm.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ karm/support/karm.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -9,6 +9,7 @@
 Name[sv]=Karm
 Name[ta]=Kஅம்
 Name[xh]=KAlrm
+Name[zh_TW]=KArm 個人時程紀錄
 GenericName=Personal Time Tracker
 GenericName[af]=Persoonlike Tyd Volger
 GenericName[ar]=جدول المواعيد
@@ -26,6 +27,7 @@
 GenericName[es]=Cronómetro personal
 GenericName[et]=Personaalne ajaarvestus
 GenericName[eu]=Kronometro pertsonala
+GenericName[fa]=ردیاب زمان شخصی 
 GenericName[fi]=Henkilökohtainen ajanhallintaohjelma
 GenericName[fr]=Chronomètre individuel de tâches
 GenericName[gl]=Xestor Persoal de Proxectos
Index: kmail/kmfoldersearch.h
===================================================================
--- kmail/kmfoldersearch.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmfoldersearch.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -71,6 +71,7 @@
   bool running() const { return mRunning; }
   void stop();
   int foundCount() const { return mFoundCount; }
+  int searchCount() const { return mSearchCount; }
   QString currentFolder() const { return mLastFolder; }
 
 public slots:
@@ -101,6 +102,7 @@
   SerNumList mSerNums;
   QString mLastFolder;
   int mFoundCount;
+  int mSearchCount;
   QTimer *mProcessNextBatchTimer;
 };
 
@@ -162,7 +164,7 @@
   virtual int updateIndex();
 
   // Examine the message
-  void slotSearchExamineMsgDone( KMFolder*, Q_UINT32 serNum, 
+  void slotSearchExamineMsgDone( KMFolder*, Q_UINT32 serNum,
                                  const KMSearchPattern*, bool );
 
 public:
Index: kmail/kmreadermainwin.rc
===================================================================
--- kmail/kmreadermainwin.rc	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmreadermainwin.rc	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,5 +1,5 @@
 <!DOCTYPE kpartgui>
-<kpartgui version="4" name="kmreadermainwin" >
+<kpartgui version="7" name="kmreadermainwin" >
  <MenuBar>
   <Menu noMerge="1" name="file" >
    <text>&amp;File</text>
@@ -9,6 +9,11 @@
    <Separator/>
    <Action name="file_close" />
   </Menu>
+  <Menu name="edit" >
+    <text>&amp;Edit</text>
+    <Action name="move_to_trash" />
+  </Menu>
+
   <Menu noMerge="1" name="view">
    <text>&amp;View</text>
    <Action name="view_headers"/>
@@ -33,6 +38,7 @@
      <text>&amp;Forward</text>
      <Action name="message_forward_as_attachment" />
      <Action name="message_forward_inline" />
+     <Action name="message_forward_as_digest" />
      <Action name="message_forward_redirect" />
    </Menu>
   </Menu>
@@ -51,5 +57,7 @@
   <Separator/>
   <Action name="message_reply_menu" />
   <Action name="message_forward"/>
+  <Separator/>
+  <Action name="move_to_trash" />
  </ToolBar>
 </kpartgui>
Index: kmail/searchwindow.h
===================================================================
--- kmail/searchwindow.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/searchwindow.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -86,13 +86,13 @@
    * @param curFolder The folder to use as the new base for searches.
    */
   void activateFolder( KMFolder* curFolder );
-  
+
   /**
    * Provides access to the list of currently selected message in the listview.
    * @return The list of currenty selected search result messages.
    */
   KMMessageList selectedMessages();
-  
+
   /**
    * Provides access to the currently selected message.
    * @return the currently selected message.
@@ -115,13 +115,15 @@
   virtual void slotContextMenuRequested( QListViewItem*, const QPoint &, int );
   virtual void copySelectedToFolder( int menuId );
   virtual void moveSelectedToFolder( int menuId );
-  virtual void slotFolderActivated( KMFolder* );
+  virtual void slotFolderActivated();
   void slotClearSelection();
   void slotReplyToMsg();
   void slotReplyAllToMsg();
   void slotReplyListToMsg();
-  void slotForwardMsg();
+  void slotForwardInlineMsg();
   void slotForwardAttachedMsg();
+  void slotForwardDigestMsg();
+  void slotRedirectMsg();
   void slotSaveMsg();
   void slotSaveAttachments();
   void slotPrintMsg();
@@ -167,8 +169,8 @@
   QWidget* mLastFocus; // to remember the position of the focus
   QMap<int,KMFolder*> mMenuToFolder;
   KAction *mReplyAction, *mReplyAllAction, *mReplyListAction, *mSaveAsAction,
-    *mForwardAction, *mForwardAttachedAction, *mPrintAction, *mClearAction,
-    *mSaveAtchAction;
+    *mForwardInlineAction, *mForwardAttachedAction, *mForwardDigestAction,
+    *mRedirectAction, *mPrintAction, *mClearAction, *mSaveAtchAction;
   KActionMenu *mForwardActionMenu;
   QValueList<QGuardedPtr<KMFolder> > mFolders;
 
Index: kmail/kmfilterdlg.cpp
===================================================================
--- kmail/kmfilterdlg.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmfilterdlg.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -69,6 +69,12 @@
 	   "it is deleted, but you can always leave the "
 	   "dialog by clicking <em>Cancel</em> to discard the "
 	   "changes made.</p></qt>" );
+const char * _wt_filterlist_top =
+I18N_NOOP( "<qt><p>Click this button to move the currently-"
+	   "selected filter to the <em>top</em> of the list above.</p>"
+	   "<p>This is useful since the order of the filters in the list "
+	   "determines the order in which they are tried on messages: "
+	   "The topmost filter gets tried first.</p></qt>" );
 const char * _wt_filterlist_up =
 I18N_NOOP( "<qt><p>Click this button to move the currently-"
 	   "selected filter <em>up</em> one in the list above.</p>"
@@ -85,6 +91,12 @@
 	   "The topmost filter gets tried first.</p>"
 	   "<p>If you have clicked this button accidentally, you can undo this "
 	   "by clicking on the <em>Up</em> button.</p></qt>" );
+const char * _wt_filterlist_bot =
+I18N_NOOP( "<qt><p>Click this button to move the currently-"
+	   "selected filter to the <em>bottom</em> of the list above.</p>"
+	   "<p>This is useful since the order of the filters in the list "
+	   "determines the order in which they are tried on messages: "
+	   "The topmost filter gets tried first.</p></qt>" );
 const char * _wt_filterlist_rename =
 I18N_NOOP( "<qt><p>Click this button to rename the currently-selected filter.</p>"
 	   "<p>Filters are named automatically, as long as they start with "
@@ -268,7 +280,7 @@
   	     this, SLOT(slotApplicableAccountsChanged()) );
     connect( mAccountList, SIGNAL(spacePressed(QListViewItem*)),
   	     this, SLOT(slotApplicableAccountsChanged()) );
-    
+
     // transfer changes from the 'stop processing here'
     // check box to the filter
     connect( mStopProcessingHere, SIGNAL(toggled(bool)),
@@ -434,7 +446,7 @@
       mFilter->setApplicability( KMFilter::ButImap );
     else if ( mApplyOnForChecked->isChecked() )
       mFilter->setApplicability( KMFilter::Checked );
-      
+
     mApplyOnForAll->setEnabled( mApplyOnIn->isChecked() );
     mApplyOnForTraditional->setEnabled(  mApplyOnIn->isChecked() );
     mApplyOnForChecked->setEnabled( mApplyOnIn->isChecked() );
@@ -566,6 +578,10 @@
   //----------- the first row of buttons
   QHBox *hb = new QHBox(this);
   hb->setSpacing(4);
+  mBtnTop = new KPushButton( QString::null, hb );
+  mBtnTop->setAutoRepeat( true );
+  mBtnTop->setIconSet( BarIconSet( "top", KIcon::SizeSmall ) );
+  mBtnTop->setMinimumSize( mBtnTop->sizeHint() * 1.2 );
   mBtnUp = new KPushButton( QString::null, hb );
   mBtnUp->setAutoRepeat( true );
   mBtnUp->setIconSet( BarIconSet( "up", KIcon::SizeSmall ) );
@@ -574,10 +590,18 @@
   mBtnDown->setAutoRepeat( true );
   mBtnDown->setIconSet( BarIconSet( "down", KIcon::SizeSmall ) );
   mBtnDown->setMinimumSize( mBtnDown->sizeHint() * 1.2 );
+  mBtnBot = new KPushButton( QString::null, hb );
+  mBtnBot->setAutoRepeat( true );
+  mBtnBot->setIconSet( BarIconSet( "bottom", KIcon::SizeSmall ) );
+  mBtnBot->setMinimumSize( mBtnBot->sizeHint() * 1.2 );
+  QToolTip::add( mBtnTop, i18n("Top") );
   QToolTip::add( mBtnUp, i18n("Up") );
   QToolTip::add( mBtnDown, i18n("Down") );
+  QToolTip::add( mBtnBot, i18n("Bottom") );
+  QWhatsThis::add( mBtnTop, i18n(_wt_filterlist_top) );
   QWhatsThis::add( mBtnUp, i18n(_wt_filterlist_up) );
   QWhatsThis::add( mBtnDown, i18n(_wt_filterlist_down) );
+  QWhatsThis::add( mBtnBot, i18n(_wt_filterlist_bot) );
 
   //----------- the second row of buttons
   hb = new QHBox(this);
@@ -606,10 +630,14 @@
 	   this, SLOT(slotSelected(int)) );
   connect( mListBox, SIGNAL( doubleClicked ( QListBoxItem * )),
            this, SLOT( slotRename()) );
+  connect( mBtnTop, SIGNAL(clicked()),
+	   this, SLOT(slotTop()) );
   connect( mBtnUp, SIGNAL(clicked()),
 	   this, SLOT(slotUp()) );
   connect( mBtnDown, SIGNAL(clicked()),
 	   this, SLOT(slotDown()) );
+  connect( mBtnBot, SIGNAL(clicked()),
+	   this, SLOT(slotBottom()) );
   connect( mBtnNew, SIGNAL(clicked()),
 	   this, SLOT(slotNew()) );
   connect( mBtnCopy, SIGNAL(clicked()),
@@ -720,7 +748,7 @@
 		       "IMAP account. Such filters will only be applied "
 		       "when manually filtering and when filtering "
 		       "incoming online IMAP mail.");
-    KMessageBox::information( this, str, QString::null, 
+    KMessageBox::information( this, str, QString::null,
 			      "filterDlgOnlineImapCheck" );
   }
   // allow usage of the filters again.
@@ -811,6 +839,21 @@
   enableControls();
 }
 
+void KMFilterListBox::slotTop()
+{
+  if ( mIdxSelItem < 0 ) {
+    kdDebug(5006) << "KMFilterListBox::slotTop called while no filter is selected, ignoring." << endl;
+    return;
+  }
+  if ( mIdxSelItem == 0 ) {
+    kdDebug(5006) << "KMFilterListBox::slotTop called while the _topmost_ filter is selected, ignoring." << endl;
+    return;
+  }
+
+  swapFilters( mIdxSelItem, 0 );
+  enableControls();
+}
+
 void KMFilterListBox::slotUp()
 {
   if ( mIdxSelItem < 0 ) {
@@ -841,6 +884,21 @@
   enableControls();
 }
 
+void KMFilterListBox::slotBottom()
+{
+  if ( mIdxSelItem < 0 ) {
+    kdDebug(5006) << "KMFilterListBox::slotBottom called while no filter is selected, ignoring." << endl;
+    return;
+  }
+  if ( mIdxSelItem == (int)mListBox->count() - 1 ) {
+    kdDebug(5006) << "KMFilterListBox::slotBottom called while the _last_ filter is selected, ignoring." << endl;
+    return;
+  }
+
+  swapFilters( mIdxSelItem, mListBox->count()-1 );
+  enableControls();
+}
+
 void KMFilterListBox::slotRename()
 {
   if ( mIdxSelItem < 0 ) {
@@ -888,8 +946,10 @@
   bool theLast = ( mIdxSelItem >= (int)mFilterList.count() - 1 );
   bool aFilterIsSelected = ( mIdxSelItem >= 0 );
 
+  mBtnTop->setEnabled( aFilterIsSelected && !theFirst );
   mBtnUp->setEnabled( aFilterIsSelected && !theFirst );
   mBtnDown->setEnabled( aFilterIsSelected && !theLast );
+  mBtnBot->setEnabled( aFilterIsSelected && !theLast );
   mBtnCopy->setEnabled( aFilterIsSelected );
   mBtnDelete->setEnabled( aFilterIsSelected );
   mBtnRename->setEnabled( aFilterIsSelected );
@@ -983,7 +1043,20 @@
   mIdxSelItem += movedOne - untouchedOne;
 }
 
+void KMFilterListBox::swapFilters( int from, int to )
+{
+  QListBoxItem *item = mListBox->item( from );
+  mListBox->takeItem( item );
+  mListBox->insertItem( item, to );
 
+  KMFilter* filter = mFilterList.take( from );
+  mFilterList.insert( to, filter );
+
+  mIdxSelItem = to;
+  mListBox->setCurrentItem( mIdxSelItem );
+  mListBox->setSelected( mIdxSelItem, true );
+}
+
 //=============================================================================
 //
 // class KMFilterActionWidget
Index: kmail/kmail.antispamrc
===================================================================
--- kmail/kmail.antispamrc	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmail.antispamrc	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -106,6 +106,11 @@
 UseRegExp=0
 SupportsBayes=1
 SupportsUnsure=1
+ScoreName=Spambayes 
+ScoreHeader=X-Spambayes-Classification 
+ScoreType=Decimal 
+ScoreValueRegexp=(?:spam|ham);\ ([\\d\\.]+) 
+ScoreThresholdRegexp=
 
 [Spamtool #6]
 HeadersOnly=yes
@@ -171,10 +176,10 @@
 Executable=bsfilter --help > /dev/null
 URL=http://bsfilter.org/
 PipeFilterName=Bsfilter Check
-PipeCmdDetect=bsfilter --pipe --insert-flag --insert-probability
+PipeCmdDetect=bsfilter --pipe --insert-flag --insert-probability --header-prefix BSFilter
 ExecCmdSpam=bsfilter --add-spam --update
 ExecCmdHam=bsfilter --add-clean --update
-DetectionHeader=X-Spam-Flag
+DetectionHeader=X-BSFilter-Flag
 DetectionPattern=Yes
 DetectionPattern2=
 DetectionOnly=0
@@ -182,7 +187,7 @@
 SupportsBayes=1
 SupportsUnsure=0
 ScoreName=Bsfilter
-ScoreHeader=X-Spam-Probability
+ScoreHeader=X-BSFilter-Probability
 ScoreType=Decimal
 ScoreValueRegexp=(.+)
 ScoreThresholdRegexp=
Index: kmail/kmmainwin.rc
===================================================================
--- kmail/kmmainwin.rc	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmmainwin.rc	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -2,7 +2,7 @@
      the same menu entries at the same place in KMail and Kontact  -->
 
 <!DOCTYPE kpartgui>
-<kpartgui version="88" name="kmmainwin" >
+<kpartgui version="89" name="kmmainwin" >
  <MenuBar>
   <Menu noMerge="1" name="file" >
    <text>&amp;File</text>
@@ -120,6 +120,7 @@
      <text>&amp;Forward</text>
      <Action name="message_forward_as_attachment" />
      <Action name="message_forward_inline" />
+     <Action name="message_forward_as_digest" />
      <Action name="message_forward_redirect" />
    </Menu>
    <Action name="send_again" />
Index: kmail/imapaccountbase.cpp
===================================================================
--- kmail/imapaccountbase.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/imapaccountbase.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -976,7 +976,8 @@
 
     QValueList<QGuardedPtr<KMFolder> > mSaveList = mMailCheckFolders;
     mMailCheckFolders = mFoldersQueuedForChecking;
-    kmkernel->acctMgr()->singleCheckMail(this, true);
+    if ( kmkernel->acctMgr() )
+      kmkernel->acctMgr()->singleCheckMail(this, true);
     mMailCheckFolders = mSaveList;
     mFoldersQueuedForChecking.clear();
   }
@@ -1144,14 +1145,16 @@
      ImapAccountBase::JobIterator it = findJob(job);
      if ( it == jobsEnd() ) return;
      int errorCode = job->error();
+     KMFolder * const parent = (*it).parent;
+     const QString path = (*it).path;
      if (errorCode && errorCode != KIO::ERR_CANNOT_OPEN_FOR_WRITING)
      {
        bool cont = handleJobError( job, i18n( "Error while uploading status of messages to server: " ) + '\n' );
-       emit imapStatusChanged( (*it).parent, (*it).path, cont );
+       emit imapStatusChanged( parent, path, cont );
      }
      else
      {
-       emit imapStatusChanged( (*it).parent, (*it).path, true );
+       emit imapStatusChanged( parent, path, true );
        removeJob(it);
      }
   }
Index: kmail/kmheaders.cpp
===================================================================
--- kmail/kmheaders.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmheaders.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1359,7 +1359,7 @@
     int msgCountToFilter = msgList->count();
     for (KMMsgBase* msgBase=msgList->first(); msgBase; msgBase=msgList->next()) {
       int diff = msgCountToFilter - ++msgCount;
-      if ( diff < 10 || !( msgCount % 20 ) ) {
+      if ( diff < 10 || !( msgCount % 20 ) || msgCount <= 10 ) {
         QString statusMsg = i18n("Filtering message %1 of %2");
         statusMsg = statusMsg.arg( msgCount ).arg( msgCountToFilter );
         KPIM::BroadcastStatus::instance()->setStatusMsg( statusMsg );
Index: kmail/folderrequester.cpp
===================================================================
--- kmail/folderrequester.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/folderrequester.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -100,10 +100,14 @@
 void FolderRequester::setFolder( const QString &idString )
 {
   KMFolder *folder = kmkernel->findFolderById( idString );
-  if ( folder )
+  if ( folder ) {
     setFolder( folder );
-  else {
-    edit->setText( i18n( "Unknown folder '%1'" ).arg( idString ) );
+  } else {
+    if ( !idString.isEmpty() ) {
+      edit->setText( i18n( "Unknown folder '%1'" ).arg( idString ) );
+    } else {
+      edit->setText( i18n( "Please select a folder" ) );
+    }
     mFolder = 0;
   }
   mFolderId = idString;
Index: kmail/kmacctlocal.cpp
===================================================================
--- kmail/kmacctlocal.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmacctlocal.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -31,7 +31,7 @@
 //-----------------------------------------------------------------------------
 KMAcctLocal::KMAcctLocal(AccountManager* aOwner, const QString& aAccountName, uint id):
   KMAccount(aOwner, aAccountName, id), mHasNewMail( false ),
-  mProcessingNewMail( false ), mAddedOk( true ), mNumMsgs( 0 ),
+  mAddedOk( true ), mNumMsgs( 0 ),
   mMsgsFetched( 0 ), mMailFolder( 0 )
 {
   mLock = procmail_lockfile;
@@ -73,14 +73,9 @@
 //-----------------------------------------------------------------------------
 void KMAcctLocal::processNewMail(bool)
 {
-  if ( mProcessingNewMail )
-    return;
-
   mHasNewMail = false;
-  mProcessingNewMail = true;
 
   if ( !preProcess() ) {
-    mProcessingNewMail = false;
     return;
   }
 
@@ -99,7 +94,6 @@
   }
 
   postProcess();
-  mProcessingNewMail = false;
 }
 
 
Index: kmail/dcopimap.desktop
===================================================================
--- kmail/dcopimap.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/dcopimap.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -15,6 +15,7 @@
 Comment[es]=Programa de correo con un interfaz DCOP
 Comment[et]=E-posti rakendus DCOP-liidesega
 Comment[eu]=DCOP interfazedun posta programa
+Comment[fa]=برنامۀ نامه با یک واسط DCOP
 Comment[fi]=Sähköpostisovellus DCOP-rajapinnalla
 Comment[fr]=Programme de messagerie avec une interface DCOP
 Comment[hi]=डीकॉप इंटरफेस सहित एक डाक प्रोग्राम
Index: kmail/profiles/profile-high-contrast-rc.desktop
===================================================================
--- kmail/profiles/profile-high-contrast-rc.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/profiles/profile-high-contrast-rc.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -12,6 +12,7 @@
 Name[es]=Alto contraste
 Name[et]=Suur kontrast
 Name[eu]=Kontraste altua
+Name[fa]=سایه‌روشن زیاد
 Name[fi]=Korkea kontrasti
 Name[fr]=Contraste élevé
 Name[ga]=Ardchodarsnacht
@@ -61,6 +62,7 @@
 Comment[es]=Tamaños grandes de tipografía para usuarios con deficiencias visuales
 Comment[et]=Suured fondid halva nägemisega kasutajatele
 Comment[eu]=Letra-tipo handiagoak ikusmen arazoak dituzten erabiltzaileentzat
+Comment[fa]=اندزه قلمهای افزایش یافته برای کاربرانی که از نظر تصویری زیان دیده‌اند
 Comment[fi]=Suurennettu kirjasinkoko heikkonäköisille käyttäjille
 Comment[fr]=Des polices de caractères plus grandes pour les malvoyants
 Comment[gl]=Tamaños de fonte aumentados para usuarios con discapacidade visual
@@ -84,7 +86,7 @@
 Comment[pt_BR]=Fontes de tamanho maior para usuários com visão reduzida
 Comment[ro]=Mărimi de font mari pentru utilizatori cu handicap
 Comment[ru]=Увеличенные размеры шрифтов для людей с ослабленным зрением
-Comment[sk]=Zväčšená veľkosť písma pre zrakovo postihnutých používateľov
+Comment[sk]=Zväčšená veľkosť písma pre zrakovo postihnutých užívateľov
 Comment[sl]=Povečane velikosti pisav za uporabnike s slabšim vidom
 Comment[sr]=Повећани фонтови за кориснике са лошијим видом
 Comment[sr@Latn]=Povećani fontovi za korisnike sa lošijim vidom
Index: kmail/profiles/profile-default-rc.desktop
===================================================================
--- kmail/profiles/profile-default-rc.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/profiles/profile-default-rc.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -16,6 +16,7 @@
 Name[es]=Predeterminado
 Name[et]=Vaikimisi
 Name[eu]=Lehenetsia
+Name[fa]=پیش‌فرض‌
 Name[fi]=Oletus
 Name[fr]=Défaut
 Name[ga]=Réamhshocrú
@@ -78,6 +79,7 @@
 Comment[es]=Perfil estándar
 Comment[et]=Standardprofiil
 Comment[eu]=Profil estandarra
+Comment[fa]=profile استاندارد
 Comment[fi]=Normaali profiili
 Comment[fr]=Profil standard
 Comment[ga]=Próifíl chaighdeánach
Index: kmail/profiles/profile-html-rc.desktop
===================================================================
--- kmail/profiles/profile-html-rc.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/profiles/profile-html-rc.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,6 +1,7 @@
 [KMail Profile]
 Name=HTML
 Name[bg]=Поддръжка на HTML
+Name[fa]=زنگام
 Comment=Standard profile with HTML preview enabled - less secure!
 Comment[ar]=تشكيل قياسي مع تمكين استعراض HTML - أقل أمانا!
 Comment[az]=HTML nümayişli standard - ən az etibarlı!
@@ -16,6 +17,7 @@
 Comment[es]=Perfil estándar con las vista HTML activada - menos seguro
 Comment[et]=Standardprofiil HTML-i eelvaatlusega - pole nii turvaline!
 Comment[eu]=HTML aurrebista gaituta duen profil estandarra - sekuritate gutxiago du
+Comment[fa]=profile استاندارد با پیش‌نمایش زنگام فعال شده - با ایمنی کمتر!
 Comment[fi]=Normaali profiili HTML-esikatselua käyttäville - vähemmän turvallinen.
 Comment[fr]=Profil standard avec l'aperçu HTML activé - Moins sécurisé !
 Comment[gl]=Perfil estándar con previsualización HTML activada - menos seguro!
Index: kmail/profiles/profile-purist-rc.desktop
===================================================================
--- kmail/profiles/profile-purist-rc.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/profiles/profile-purist-rc.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -7,6 +7,7 @@
 Name[eo]=Puristo
 Name[es]=Purista
 Name[eu]=Purista
+Name[fa]=سَره گرا
 Name[fi]=Puristi
 Name[fr]=Puriste
 Name[gl]=Purista
@@ -55,6 +56,7 @@
 Comment[es]=La mayoría de las características desactivadas; se usan las opciones globales de KDE
 Comment[et]=Enamik võimalusi välja lülitatud, kasutatakse KDE seadistusi
 Comment[eu]=Eginbide gehienak ezgaituta, KDE-ren ezarpen globalak erabiliko dira
+Comment[fa]=اغلب ویژگیها خاموش شد، تنظیمات سراسری KDE استفاده می‌شوند
 Comment[fi]=Suurin osa ominaisuuksia on pois päältä, käytetään KDE:n järjestelmänlaajuisia asetuksia.
 Comment[fr]=Presque toutes les fonctionnalités désactivées, utilisation de la configuration globale de KDE
 Comment[gl]=A maioría das características desactivadas, empréganse as opcións globais de KDE
Index: kmail/profiles/profile-secure-rc.desktop
===================================================================
--- kmail/profiles/profile-secure-rc.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/profiles/profile-secure-rc.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Name[es]=Más seguro
 Name[et]=Kõige turvalisem
 Name[eu]=Seguruena
+Name[fa]=بیشترین امنیت‌
 Name[fi]=Turvallisin
 Name[fr]=Le plus sécurisé
 Name[gl]=O máis seguro
@@ -58,6 +59,7 @@
 Comment[es]=Pone todas las opciones necesarias para lograr la máxima seguridad
 Comment[et]=Kõik võimalused maksimaalse turvalisuse tagamiseks
 Comment[eu]=Sekuritate maximoa lortzeko aukera guztiak ezartzen ditu
+Comment[fa]=همۀ گزینه‌های لازم را تنظیم می‌کند تا به امنیت بیشینه دست یابد
 Comment[fi]=Asettaa kaikki tarvittavat asetukset suurimman turvallisuuden saavuttamiseksi
 Comment[fr]=Règle toutes les options nécessaires pour atteindre une sécurité maximale
 Comment[gl]=Estabelece tódalas opcións precisas para acada-la máxima seguridade
Index: kmail/application_octetstream.desktop
===================================================================
--- kmail/application_octetstream.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/application_octetstream.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -6,6 +6,7 @@
 Name[da]=Program oktetstrøm
 Name[es]=Aplicación en flujo de octetos
 Name[eu]=Aplikazioa/zortzikote-jarioa
+Name[fa]=Octetstream کاربرد
 Name[fi]=Octetstream-sovellus
 Name[fr]=Application (flux d'octets)
 Name[hu]=Alkalmazás-adatfolyam
@@ -38,6 +39,7 @@
 Comment[es]=Un accesorio de formato para el cuerpo de application/octet-stream
 Comment[et]=Põhiosa vormindamisplugin (MIME tüübile application/octet-stream)
 Comment[eu]=Gorputz-zati formateatzaile plugin bat aplikazio/zortikote-jarioentzat
+Comment[fa]=یک وصلۀ قالب دهندۀ بخش بدنه برای کاربرد/octet-stream
 Comment[fi]=Muokkainliitännäinen application/octet-stream-muodolle
 Comment[fr]=Un module formateur de corps pour application (flux d'octets)
 Comment[hu]=Formázómodul application/octet-stream típusú adatfolyamokhoz
Index: kmail/rulewidgethandlermanager.cpp
===================================================================
--- kmail/rulewidgethandlermanager.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/rulewidgethandlermanager.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1055,7 +1055,7 @@
     QComboBox *statusCombo = new QComboBox( valueStack,
                                             "statusRuleValueCombo" );
     for ( int i = 0; i < KMail::StatusValueCountWithoutHidden; ++i ) {
-      statusCombo->insertItem( SmallIcon( KMail::StatusValues[ i ].icon ), i18n( KMail::StatusValues[ i ].text ) );
+      statusCombo->insertItem( UserIcon( KMail::StatusValues[ i ].icon ), i18n( KMail::StatusValues[ i ].text ) );
     }
     statusCombo->adjustSize();
     QObject::connect( statusCombo, SIGNAL( activated( int ) ),
Index: kmail/kmedit.cpp
===================================================================
--- kmail/kmedit.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmedit.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -248,8 +248,6 @@
                                                 col1, col2, col3, col4,
                                                 mSpellConfig );
 
-  connect( mSpellChecker, SIGNAL(activeChanged(const QString &)),
-           mComposer, SLOT(slotStatusMessage(const QString &)));
   connect( mSpellChecker, SIGNAL(newSuggestions(const QString&, const QStringList&, unsigned int)),
            this, SLOT(addSuggestion(const QString&, const QStringList&, unsigned int)) );
 }
Index: kmail/kmmessage.h
===================================================================
--- kmail/kmmessage.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmmessage.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -33,7 +33,7 @@
 class KMMessagePart;
 class KMMsgInfo;
 class KMHeaders;
-class KMForwardCommand;
+class KMForwardDigestCommand;
 
 namespace KMime {
   class CharFreq;
@@ -66,7 +66,7 @@
 /** This is a Mime Message. */
 class KMMessage: public KMMsgBase, public KMail::ISubject
 {
-  friend class ::KMForwardCommand;    // needed for MIME Digest forward
+  friend class ::KMForwardDigestCommand; // needed for MIME Digest forward
 
 public:
   // promote some of KMMsgBase's methods to public:
@@ -811,7 +811,7 @@
   bool transferInProgress() const;
   /** Set that the message shall not be deleted because it is still required */
   void setTransferInProgress(bool value, bool force = false);
-  
+
   /** Returns an mbox message separator line for this message, i.e. a
       string of the form
       "From local@domain.invalid Sat Jun 12 14:00:00 2004\n".
Index: kmail/kmmsgdict.cpp
===================================================================
--- kmail/kmmsgdict.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmmsgdict.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -210,7 +210,7 @@
       << "null pointer to storage. Requested serial: " << msgSerNum
       << endl;
     kdDebug(5006) << "  Message info: Subject: " << msg->subject() << ", To: "
-      << msg->toStrip() << ", Date: " << msg->dateStr() << endl; 
+      << msg->toStrip() << ", Date: " << msg->dateStr() << endl;
     return 0;
   }
 
@@ -255,7 +255,7 @@
       << "number, null pointer to storage. Requested serial: " << msgSerNum
       << endl;
     kdDebug(5006) << "  Message info: Subject: " << msg->subject() << ", To: "
-      << msg->toStrip() << ", Date: " << msg->dateStr() << endl; 
+      << msg->toStrip() << ", Date: " << msg->dateStr() << endl;
     return;
   }
 
@@ -345,9 +345,11 @@
 unsigned long KMMsgDict::getMsgSerNum(KMFolder *folder, int index) const
 {
   unsigned long msn = 0;
-  KMMsgDictREntry *rentry = folder->storage()->rDict();
-  if (rentry)
-    msn = rentry->getMsn(index);
+  if ( folder ) {
+    KMMsgDictREntry *rentry = folder->storage()->rDict();
+    if (rentry)
+      msn = rentry->getMsn(index);
+  }
   return msn;
 }
 
Index: kmail/kmail_config_misc.desktop
===================================================================
--- kmail/kmail_config_misc.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmail_config_misc.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -71,6 +71,7 @@
 Comment[es]=Opciones que no encajan en ningún otro sitio
 Comment[et]=Seadistused, mis kuhugi mujale ei sobi
 Comment[eu]=Beste inon egokitzen ez diren ezarpenak
+Comment[fa]=تنظیماتی که مناسب جای دیگر نیستند
 Comment[fi]=Muut asetukset
 Comment[fr]=Paramètres qui ne rentrent dans aucune autre catégorie
 Comment[gl]=Opcións que non se encadran noutro sitio
Index: kmail/kmacctcachedimap.cpp
===================================================================
--- kmail/kmacctcachedimap.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmacctcachedimap.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -209,7 +209,7 @@
 
 void KMAcctCachedImap::processNewMail( bool /*interactive*/ )
 {
-  assert( mFolder );
+  assert( mFolder );  // George says "better to crash then lose mail"
 
   if ( mMailCheckFolders.isEmpty() )
     processNewMail( mFolder, true );
@@ -223,7 +223,8 @@
 void KMAcctCachedImap::processNewMail( KMFolderCachedImap* folder,
                                        bool recurse )
 {
-  assert( folder );
+  assert( folder ); // George says "better to crash then lose mail"
+
   // This should never be set for a cached IMAP account
   mAutoExpunge = false;
   mCountLastUnread = 0;
@@ -236,7 +237,7 @@
     QStringList nsToList = namespaces()[PersonalNS];
     QStringList otherNSToCheck = namespaces()[OtherUsersNS];
     otherNSToCheck += namespaces()[SharedNS];
-    for ( QStringList::Iterator it = otherNSToCheck.begin(); 
+    for ( QStringList::Iterator it = otherNSToCheck.begin();
           it != otherNSToCheck.end(); ++it ) {
       if ( (*it).isEmpty() ) {
         // empty namespaces are included in the "normal" listing
Index: kmail/kmreadermainwin.cpp
===================================================================
--- kmail/kmreadermainwin.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmreadermainwin.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -41,6 +41,7 @@
 #include "kmfolder.h"
 #include "kmmainwidget.h"
 #include "kmfoldertree.h"
+#include "kmmsgdict.h"
 
 #include "kmreadermainwin.h"
 
@@ -115,6 +116,7 @@
 {
   mReaderWin->setOverrideEncoding( encoding );
   mReaderWin->setMsg( msg, true );
+  mReaderWin->slotTouchMessage();
   setCaption( msg->subject() );
   mMsg = msg;
   menuBar()->show();
@@ -122,6 +124,49 @@
 }
 
 //-----------------------------------------------------------------------------
+void KMReaderMainWin::slotTrashMsg()
+{
+  // find the real msg by its sernum
+  KMFolder* parent;
+  int index;
+  KMMsgDict::instance()->getLocation( mMsg->getMsgSerNum(), &parent, &index );
+  if ( parent && !parent->isTrash() ) {
+    // open the folder (ref counted)
+    parent->open();
+    KMMessage *msg = parent->getMsg( index );
+    if (msg) {
+      KMDeleteMsgCommand *command = new KMDeleteMsgCommand( parent, msg );
+      command->start();
+    }
+    parent->close();
+  }
+  close();
+}
+
+//-----------------------------------------------------------------------------
+void KMReaderMainWin::slotFind()
+{
+  mReaderWin->slotFind();
+}
+
+void KMReaderMainWin::slotFindNext()
+{
+  mReaderWin->slotFindNext();
+}
+
+//-----------------------------------------------------------------------------
+void KMReaderMainWin::slotCopy()
+{
+  mReaderWin->slotCopySelectedText();
+}
+
+//-----------------------------------------------------------------------------
+void KMReaderMainWin::slotMarkAll()
+{
+  mReaderWin->selectAll();
+}
+
+//-----------------------------------------------------------------------------
 void KMReaderMainWin::slotPrintMsg()
 {
   KMCommand *command = new KMPrintCommand( this, mReaderWin->message(),
@@ -164,14 +209,14 @@
 }
 
 //-----------------------------------------------------------------------------
-void KMReaderMainWin::slotForwardMsg()
+void KMReaderMainWin::slotForwardInlineMsg()
 {
    KMCommand *command = 0;
    if ( mReaderWin->message() && mReaderWin->message()->parent() ) {
-    command = new KMForwardCommand( this, mReaderWin->message(),
+    command = new KMForwardInlineCommand( this, mReaderWin->message(),
         mReaderWin->message()->parent()->identity() );
    } else {
-    command = new KMForwardCommand( this, mReaderWin->message() );
+    command = new KMForwardInlineCommand( this, mReaderWin->message() );
    }
    command->start();
 }
@@ -190,6 +235,19 @@
 }
 
 //-----------------------------------------------------------------------------
+void KMReaderMainWin::slotForwardDigestMsg()
+{
+   KMCommand *command = 0;
+   if ( mReaderWin->message() && mReaderWin->message()->parent() ) {
+     command = new KMForwardDigestCommand( this, mReaderWin->message(),
+        mReaderWin->message()->parent()->identity() );
+   } else {
+     command = new KMForwardDigestCommand( this, mReaderWin->message() );
+   }
+   command->start();
+}
+
+//-----------------------------------------------------------------------------
 void KMReaderMainWin::slotRedirectMsg()
 {
   KMCommand *command = new KMRedirectCommand( this, mReaderWin->message() );
@@ -235,6 +293,16 @@
   closeShortcut.append( KKey(Key_Escape));
   closeAction->setShortcut(closeShortcut);
 
+  //----- Edit Menu
+  KStdAction::copy( this, SLOT( slotCopy() ), actionCollection() );
+  KStdAction::selectAll( this, SLOT( slotMarkAll() ), actionCollection() );
+  KStdAction::find( this, SLOT(slotFind()), actionCollection() );
+  KStdAction::findNext( this, SLOT( slotFindNext() ), actionCollection() );
+  mTrashAction = new KAction( KGuiItem( i18n( "&Move to Trash" ), "edittrash",
+                              i18n( "Move message to trashcan" ) ),
+                              Key_Delete, this, SLOT( slotTrashMsg() ),
+                              actionCollection(), "move_to_trash" );
+
   //----- View Menu
   mViewSourceAction = new KAction( i18n("&View Source"), Key_V, this,
                                    SLOT(slotShowMsgSrc()), actionCollection(),
@@ -245,22 +313,34 @@
 					"mail_forward", actionCollection(),
 					"message_forward" );
   connect( mForwardActionMenu, SIGNAL( activated() ), this,
-           SLOT( slotForwardMsg() ) );
+           SLOT( slotForwardInlineMsg() ) );
 
-  mForwardAction = new KAction( i18n("&Inline..."), "mail_forward",
-				SHIFT+Key_F, this, SLOT(slotForwardMsg()),
-				actionCollection(), "message_forward_inline" );
-  mForwardActionMenu->insert( mForwardAction );
-
   mForwardAttachedAction = new KAction( i18n("Message->Forward->","As &Attachment..."),
-				       "mail_forward", Key_F, this,
-					SLOT(slotForwardAttachedMsg()), actionCollection(),
+                                        "mail_forward", Key_F, this,
+					SLOT(slotForwardAttachedMsg()),
+                                        actionCollection(),
 					"message_forward_as_attachment" );
   mForwardActionMenu->insert( mForwardAttachedAction );
 
+  mForwardInlineAction = new KAction( i18n("&Inline..."),
+                                      "mail_forward", SHIFT+Key_F, this,
+                                      SLOT(slotForwardInlineMsg()),
+                                      actionCollection(),
+                                      "message_forward_inline" );
+  mForwardActionMenu->insert( mForwardInlineAction );
+
+  mForwardDigestAction = new KAction( i18n("Message->Forward->","As Di&gest..."),
+                                      "mail_forward", 0, this,
+                                      SLOT(slotForwardDigestMsg()),
+                                      actionCollection(),
+                                      "message_forward_as_digest" );
+  mForwardActionMenu->insert( mForwardDigestAction );
+
   mRedirectAction = new KAction( i18n("Message->Forward->","&Redirect..."),
-				 Key_E, this, SLOT(slotRedirectMsg()),
-				 actionCollection(), "message_forward_redirect" );
+				 "mail_forward", Key_E, this,
+                                 SLOT(slotRedirectMsg()),
+				 actionCollection(),
+                                 "message_forward_redirect" );
   mForwardActionMenu->insert( mRedirectAction );
 
   mReplyActionMenu = new KActionMenu( i18n("Message->","&Reply"),
@@ -355,7 +435,9 @@
       return;
     }
 
-    if( !aMsg.parent()->isSent() && !aMsg.parent()->isDrafts() ) {
+    if ( ! ( aMsg.parent() && ( aMsg.parent()->isSent() || aMsg.parent()->isDrafts() ) ) ) {
+      // add the reply and forward actions only if we are not in a sent-mail or drafts
+      // folder
       mReplyActionMenu->plug( menu );
       mForwardActionMenu->plug( menu );
       menu->insertSeparator();
Index: kmail/kmaccount.h
===================================================================
--- kmail/kmaccount.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmaccount.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -309,7 +309,7 @@
   QValueList<KMMessage*> mReceipts;
   QPtrList<FolderJob>  mJobList;
   bool mHasInbox : 1;
-  ProgressItem *mMailCheckProgressItem;
+  QGuardedPtr<ProgressItem> mMailCheckProgressItem;
 
 private:
     /**
Index: kmail/kmail_config_composer.desktop
===================================================================
--- kmail/kmail_config_composer.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmail_config_composer.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -25,6 +25,7 @@
 Name[es]=Editor
 Name[et]=Koostaja
 Name[eu]=Editorea
+Name[fa]=مؤلف
 Name[fi]=Kirjoittaminen
 Name[fr]=Éditeur
 Name[ga]=Cumadóir
@@ -69,6 +70,7 @@
 Comment[es]=Frases y comportamiento general
 Comment[et]=Väljendid ja üldine käitumine
 Comment[eu]=Esaldiak eta portamolde orokorra
+Comment[fa]=عبارات و رفتار کلی
 Comment[fi]=Ilmaukset ja yleiset asetukset
 Comment[fr]=Phrases et comportement général
 Comment[gl]=Frases e comportamento xeral
@@ -88,7 +90,7 @@
 Comment[pt_BR]=Frases & Comportamento Geral
 Comment[ru]=Фразы и общие параметры
 Comment[se]=Frásat ja oppalaš láhtten
-Comment[sk]=Frázy a všeobecné chovanie
+Comment[sk]=Frázy a všeobecné správanie
 Comment[sl]=Fraze in splošno obnašanje
 Comment[sr]=Фразе и опште понашање
 Comment[sr@Latn]=Fraze i opšte ponašanje
@@ -110,6 +112,7 @@
 Keywords[es]=kmail,editor
 Keywords[et]=kmail,koostaja
 Keywords[eu]=kmail,editorea
+Keywords[fa]=kmail،مؤلف
 Keywords[fi]=kmail,kirjoitus
 Keywords[fr]=KMail,éditeur
 Keywords[gl]=kmail,editor
Index: kmail/kmsearchpattern.cpp
===================================================================
--- kmail/kmsearchpattern.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmsearchpattern.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -371,7 +371,7 @@
     // I think only the "from"-field makes sense.
     msgContents = msg->headerField( field() );
     if ( msgContents.isEmpty() )
-      return false;
+      return ( function() == FuncIsInAddressbook ) ? false : true;
   }
 
   // these two functions need the kmmessage therefore they don't call matchesInternal
Index: kmail/searchwindow.cpp
===================================================================
--- kmail/searchwindow.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/searchwindow.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -269,16 +269,27 @@
                                         "mail_forward", ac,
                                         "search_message_forward" );
   connect( mForwardActionMenu, SIGNAL(activated()), this,
-           SLOT(slotForwardMsg()) );
-  mForwardAction = new KAction( i18n("&Inline..."), "mail_forward",
-                                0, this, SLOT(slotForwardMsg()),
-                                ac, "search_message_forward_inline" );
-  mForwardActionMenu->insert( mForwardAction );
+           SLOT(slotForwardInlineMsg()) );
   mForwardAttachedAction = new KAction( i18n("Message->Forward->","As &Attachment..."),
-                                       "mail_forward", 0, this,
+                                        "mail_forward", 0, this,
                                         SLOT(slotForwardAttachedMsg()), ac,
                                         "search_message_forward_as_attachment" );
   mForwardActionMenu->insert( mForwardAttachedAction );
+  mForwardInlineAction = new KAction( i18n("&Inline..."),
+                                      "mail_forward", 0, this,
+                                      SLOT(slotForwardInlineMsg()), ac,
+                                      "search_message_forward_inline" );
+  mForwardActionMenu->insert( mForwardInlineAction );
+  mForwardDigestAction = new KAction( i18n("Message->Forward->","As Di&gest..."),
+                                      "mail_forward", 0, this,
+                                      SLOT(slotForwardDigestMsg()), ac,
+                                      "search_message_forward_as_digest" );
+  mForwardActionMenu->insert( mForwardDigestAction );
+  mRedirectAction = new KAction( i18n("Message->Forward->","&Redirect..."),
+                                      "mail_forward", 0, this,
+                                      SLOT(slotRedirectMsg()), ac,
+                                      "search_message_forward_redirect" );
+  mForwardActionMenu->insert( mRedirectAction );
   mSaveAsAction = KStdAction::saveAs( this, SLOT(slotSaveMsg()), ac, "search_file_save_as" );
   mSaveAtchAction = new KAction( i18n("Save Attachments..."), "attach", 0,
                                  this, SLOT(slotSaveAttachments()), ac, "search_save_attachments" );
@@ -291,7 +302,7 @@
           this, SLOT(folderInvalidated(KMFolder*)));
 
   connect(mCbxFolders, SIGNAL(folderChanged(KMFolder*)),
-          this, SLOT(slotFolderActivated(KMFolder*)));
+          this, SLOT(slotFolderActivated()));
 
 }
 
@@ -328,33 +339,33 @@
 //-----------------------------------------------------------------------------
 void SearchWindow::updStatus(void)
 {
-    QString genMsg, detailMsg;
-    int numMatches = 0, count = 0;
+    QString genMsg, detailMsg, procMsg;
+    int numMatches = 0, numProcessed = 0;
     KMSearch const *search = (mFolder) ? (mFolder->search()) : 0;
     QString folderName;
     if (search) {
         numMatches = search->foundCount();
+        numProcessed = search->searchCount();
         folderName = search->currentFolder();
     }
 
     if (mFolder && mFolder->search() && !mFolder->search()->running()) {
+        procMsg = i18n("%n message searched", "%n messages searched",
+                       numProcessed);
         if(!mStopped) {
-            genMsg = i18n("Done");
-            detailMsg = i18n("%n match (%1)", "%n matches (%1)", numMatches)
-                        .arg(i18n("%n message processed",
-                                  "%n messages processed", count));
+            genMsg = i18n("Done.");
+            detailMsg = i18n("%n match in %1", "%n matches in %1",
+                             numMatches).arg(procMsg);
         } else {
-            genMsg = i18n("Search canceled");
-            detailMsg = i18n("%n match so far (%1)",
-                             "%n matches so far (%1)", numMatches)
-                        .arg(i18n("%n message processed",
-                                  "%n messages processed", count));
+            genMsg = i18n("Search canceled.");
+            detailMsg = i18n("%n match so far in %1", "%n matches so far in %1",
+                             numMatches).arg(procMsg);
         }
     } else {
+        procMsg = i18n("%n message", "%n messages", numProcessed);
         genMsg = i18n("%n match", "%n matches", numMatches);
-        detailMsg = i18n("Searching in %1 (message %2)")
-                    .arg(folderName)
-                    .arg(count);
+        detailMsg = i18n("Searching in %1. %2 searched so far")
+                    .arg(folderName).arg(procMsg);
     }
 
     mStatusBar->changeItem(genMsg, 0);
@@ -377,10 +388,9 @@
 
 
 //-----------------------------------------------------------------------------
-void SearchWindow::slotFolderActivated( KMFolder* folder )
+void SearchWindow::slotFolderActivated()
 {
     mChkbxSpecificFolders->setChecked(true);
-    mBtnSearch->setEnabled(folder);
 }
 
 //-----------------------------------------------------------------------------
@@ -705,6 +715,8 @@
     mReplyAllAction->setEnabled( single_actions );
     mReplyListAction->setEnabled( single_actions );
     mPrintAction->setEnabled( single_actions );
+    mForwardDigestAction->setEnabled( !single_actions );
+    mRedirectAction->setEnabled( single_actions );
 }
 
 //-----------------------------------------------------------------------------
@@ -773,9 +785,9 @@
 }
 
 //-----------------------------------------------------------------------------
-void SearchWindow::slotForwardMsg()
+void SearchWindow::slotForwardInlineMsg()
 {
-    KMCommand *command = new KMForwardCommand(this, selectedMessages());
+    KMCommand *command = new KMForwardInlineCommand(this, selectedMessages());
     command->start();
 }
 
@@ -787,6 +799,20 @@
 }
 
 //-----------------------------------------------------------------------------
+void SearchWindow::slotForwardDigestMsg()
+{
+    KMCommand *command = new KMForwardDigestCommand(this, selectedMessages());
+    command->start();
+}
+
+//-----------------------------------------------------------------------------
+void SearchWindow::slotRedirectMsg()
+{
+    KMCommand *command = new KMRedirectCommand(this, message());
+    command->start();
+}
+
+//-----------------------------------------------------------------------------
 void SearchWindow::slotSaveMsg()
 {
     KMSaveMsgCommand *saveCommand = new KMSaveMsgCommand(this,
Index: kmail/kmreaderwin.cpp
===================================================================
--- kmail/kmreaderwin.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmreaderwin.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1103,6 +1103,13 @@
           break;
         }
       }
+      if ( i == encodings.size() ) {
+        // the value of encoding is unknown => use Auto
+        kdWarning(5006) << "Unknown override character encoding \"" << encoding
+                        << "\". Using Auto instead." << endl;
+        mSelectEncodingAction->setCurrentItem( 0 );
+        mOverrideEncoding = QString::null;
+      }
     }
   }
   update( true );
@@ -1942,6 +1949,12 @@
 }
 
 //-----------------------------------------------------------------------------
+void KMReaderWin::slotFindNext()
+{
+  mViewer->findTextNext();
+}
+
+//-----------------------------------------------------------------------------
 void KMReaderWin::slotToggleFixedFont()
 {
   QScrollView * scrollview = static_cast<QScrollView *>(mViewer->widget());
Index: kmail/kmmessage.cpp
===================================================================
--- kmail/kmmessage.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmmessage.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -86,7 +86,8 @@
 
 //-----------------------------------------------------------------------------
 KMMessage::KMMessage(DwMessage* aMsg)
-  : mMsg(aMsg),
+  : KMMsgBase(),
+    mMsg(aMsg),
     mNeedsAssembly(true),
     mDecodeHTML(false),
     mOverrideCodec(0),
@@ -706,6 +707,8 @@
                                            const QTextCodec*& codec,
                                            bool& isHTML ) const
 {
+  if ( !root ) return;
+
   isHTML = false;
   // initialy parse the complete message to decrypt any encrypted parts
   {
@@ -736,6 +739,7 @@
   const QTextCodec * codec = 0;
 
   partNode * root = partNode::fromMessage( this );
+  if ( !root ) return QString::null;
   parseTextStringFromDwPart( root, parsedString, codec, isHTML );
   delete root;
 
@@ -3819,7 +3823,7 @@
 //-----------------------------------------------------------------------------
 QCString KMMessage::charset() const
 {
-  if ( mMsg->Headers().HasContentType() ) {  
+  if ( mMsg->Headers().HasContentType() ) {
     DwMediaType &mType=mMsg->Headers().ContentType();
     mType.Parse();
     DwParameter *param=mType.FirstParameter();
@@ -3981,6 +3985,9 @@
 //-----------------------------------------------------------------------------
 void KMMessage::updateBodyPart(const QString partSpecifier, const QByteArray & data)
 {
+  if ( !data.data() || !data.size() )
+    return;
+
   DwString content( data.data(), data.size() );
   if ( numBodyParts() > 0 &&
        partSpecifier != "0" &&
@@ -4006,7 +4013,7 @@
     {
       // update headers
       // get rid of EOL
-      content.resize( content.length()-2 );
+      content.resize( QMAX( content.length(), 2 ) - 2 );
       // we have to delete the fields first as they might have been created by
       // an earlier call to DwHeaders::FieldBody
       mLastUpdated->Headers().DeleteAllFields();
Index: kmail/kmail_config_identity.desktop
===================================================================
--- kmail/kmail_config_identity.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmail_config_identity.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -25,6 +25,7 @@
 Name[es]=Identidades
 Name[et]=Identiteedid
 Name[eu]=Identitateak
+Name[fa]=هویتها
 Name[fi]=Henkilöllisyydet
 Name[fr]=Identités
 Name[ga]=Aitheantais
@@ -71,6 +72,7 @@
 Comment[es]=Gestionar identidades
 Comment[et]=Identiteetide haldus
 Comment[eu]=Identitateak kudeatu
+Comment[fa]=مدیریت هویتها
 Comment[fi]=Henkilöllisyysasetukset
 Comment[fr]=Gestion des identités
 Comment[gl]=Xestionar Identidades
@@ -115,6 +117,7 @@
 Keywords[es]=kmail,identidad
 Keywords[et]=kmail,identiteet
 Keywords[eu]=kmail,identitatea
+Keywords[fa]=kmail،هویت
 Keywords[fi]=kmail,henkilöllisyys
 Keywords[fr]=KMail,identités
 Keywords[ga]=kmail,aitheantas
Index: kmail/kmaccount.cpp
===================================================================
--- kmail/kmaccount.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmaccount.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -377,7 +377,12 @@
 {
   if (mTimer)
     mTimer->stop();
-  kmkernel->acctMgr()->singleCheckMail(this, false);
+
+  if ( kmkernel ) {
+    AccountManager *acctmgr = kmkernel->acctMgr();
+    if ( acctmgr )
+      acctmgr->singleCheckMail(this, false);
+  }
 }
 
 //-----------------------------------------------------------------------------
Index: kmail/kmcommands.cpp
===================================================================
--- kmail/kmcommands.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmcommands.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -555,8 +555,7 @@
 
 KMCommand::Result KMMailtoOpenAddrBookCommand::execute()
 {
-  QString addr = KMMessage::decodeMailtoUrl( mUrl.path() );
-  KAddrBookExternal::openEmail( KPIM::getEmailAddress(addr), addr ,
+  KAddrBookExternal::openEmail( KMMessage::decodeMailtoUrl( mUrl.path() ),
                                 parentWidget() );
 
   return OK;
@@ -847,7 +846,7 @@
   if ( msg ) {
     QCString str( msg->mboxMessageSeparator() );
     str += KMFolderMbox::escapeFrom( msg->asString() );
-    str += "\n";
+    str += '\n';
     msg->setTransferInProgress(false);
 
     mData = str;
@@ -1124,143 +1123,72 @@
 }
 
 
-KMForwardCommand::KMForwardCommand( QWidget *parent,
+KMForwardInlineCommand::KMForwardInlineCommand( QWidget *parent,
   const QPtrList<KMMsgBase> &msgList, uint identity )
   : KMCommand( parent, msgList ),
     mIdentity( identity )
 {
 }
 
-KMForwardCommand::KMForwardCommand( QWidget *parent, KMMessage *msg,
-                                    uint identity )
+KMForwardInlineCommand::KMForwardInlineCommand( QWidget *parent,
+  KMMessage *msg, uint identity )
   : KMCommand( parent, msg ),
     mIdentity( identity )
 {
 }
 
-KMCommand::Result KMForwardCommand::execute()
+KMCommand::Result KMForwardInlineCommand::execute()
 {
   QPtrList<KMMessage> msgList = retrievedMsgs();
 
-  if (msgList.count() >= 2) {
-    // ask if they want a mime digest forward
+  if (msgList.count() >= 2) { // Multiple forward
 
-    if (KMessageBox::questionYesNo( parentWidget(),
-                                    i18n("Forward selected messages as "
-                                         "a MIME digest?"), QString::null, i18n("Send Digest"), i18n("Send") )
-        == KMessageBox::Yes) {
-      uint id = 0;
-      KMMessage *fwdMsg = new KMMessage;
-      KMMessagePart *msgPart = new KMMessagePart;
-      QString msgPartText;
-      int msgCnt = 0; // incase there are some we can't forward for some reason
+    uint id = 0;
+    QCString msgText = "";
+    QPtrList<KMMessage> linklist;
+    for ( KMMessage *msg = msgList.first(); msg; msg = msgList.next() ) {
+      // set the identity
+      if (id == 0)
+        id = msg->headerField( "X-KMail-Identity" ).stripWhiteSpace().toUInt();
 
-      // dummy header initialization; initialization with the correct identity
-      // is done below
-      fwdMsg->initHeader(id);
-      fwdMsg->setAutomaticFields(true);
-      fwdMsg->mMsg->Headers().ContentType().CreateBoundary(1);
-      QCString boundary( fwdMsg->mMsg->Headers().ContentType().Boundary().c_str() );
-      msgPartText = i18n("\nThis is a MIME digest forward. The content of the"
-                         " message is contained in the attachment(s).\n\n\n");
-      // iterate through all the messages to be forwarded
-      for (KMMessage *msg = msgList.first(); msg; msg = msgList.next()) {
-        // set the identity
-        if (id == 0)
-          id = msg->headerField("X-KMail-Identity").stripWhiteSpace().toUInt();
-        // set the part header
-        msgPartText += "--";
-        msgPartText += QString::fromLatin1( boundary );
-        msgPartText += "\nContent-Type: MESSAGE/RFC822";
-        msgPartText += QString("; CHARSET=%1").arg(msg->charset());
-        msgPartText += "\n";
-        DwHeaders dwh;
-        dwh.MessageId().CreateDefault();
-        msgPartText += QString("Content-ID: %1\n").arg(dwh.MessageId().AsString().c_str());
-        msgPartText += QString("Content-Description: %1").arg(msg->subject());
-        if (!msg->subject().contains("(fwd)"))
-          msgPartText += " (fwd)";
-        msgPartText += "\n\n";
-        // remove headers that shouldn't be forwarded
-        msg->removePrivateHeaderFields();
-        msg->removeHeaderField("BCC");
-        // set the part
-        msgPartText += msg->headerAsString();
-        msgPartText += "\n";
-        msgPartText += msg->body();
-        msgPartText += "\n";     // eot
-        msgCnt++;
-        fwdMsg->link(msg, KMMsgStatusForwarded);
-      }
-      if ( id == 0 )
-        id = mIdentity; // use folder identity if no message had an id set
-      fwdMsg->initHeader(id);
-      msgPartText += "--";
-      msgPartText += QString::fromLatin1( boundary );
-      msgPartText += "--\n";
-      QCString tmp;
-      msgPart->setTypeStr("MULTIPART");
-      tmp.sprintf( "Digest; boundary=\"%s\"", boundary.data() );
-      msgPart->setSubtypeStr( tmp );
-      msgPart->setName("unnamed");
-      msgPart->setCte(DwMime::kCte7bit);   // does it have to be 7bit?
-      msgPart->setContentDescription(QString("Digest of %1 messages.").arg(msgCnt));
-      // THIS HAS TO BE AFTER setCte()!!!!
-      msgPart->setBodyEncoded(QCString(msgPartText.ascii()));
-      KCursorSaver busy(KBusyPtr::busy());
-      KMail::Composer * win = KMail::makeComposer( fwdMsg, id );
-      win->addAttach(msgPart);
-      win->show();
-      return OK;
-    } else {            // NO MIME DIGEST, Multiple forward
-      uint id = 0;
-      QCString msgText = "";
-      QPtrList<KMMessage> linklist;
-      for (KMMessage *msg = msgList.first(); msg; msg = msgList.next()) {
-        // set the identity
-        if (id == 0)
-          id = msg->headerField("X-KMail-Identity").stripWhiteSpace().toUInt();
+      msgText += msg->createForwardBody();
+      linklist.append( msg );
+    }
+    if ( id == 0 )
+      id = mIdentity; // use folder identity if no message had an id set
+    KMMessage *fwdMsg = new KMMessage;
+    fwdMsg->initHeader( id );
+    fwdMsg->setAutomaticFields( true );
+    fwdMsg->setCharset( "utf-8" );
+    fwdMsg->setBody( msgText );
 
-        msgText += msg->createForwardBody();
-        linklist.append(msg);
-      }
-      if ( id == 0 )
-        id = mIdentity; // use folder identity if no message had an id set
-      KMMessage *fwdMsg = new KMMessage;
-      fwdMsg->initHeader(id);
-      fwdMsg->setAutomaticFields(true);
-      fwdMsg->setCharset("utf-8");
-      fwdMsg->setBody(msgText);
+    for ( KMMessage *msg = linklist.first(); msg; msg = linklist.next() )
+      fwdMsg->link( msg, KMMsgStatusForwarded );
 
-      for (KMMessage *msg = linklist.first(); msg; msg = linklist.next())
-        fwdMsg->link(msg, KMMsgStatusForwarded);
+    KCursorSaver busy( KBusyPtr::busy() );
+    KMail::Composer * win = KMail::makeComposer( fwdMsg, id );
+    win->setCharset("");
+    win->show();
 
-      KCursorSaver busy(KBusyPtr::busy());
+  } else { // forward a single message at most
+
+    KMMessage *msg = msgList.getFirst();
+    if ( !msg || !msg->codec() )
+      return Failed;
+
+    KCursorSaver busy( KBusyPtr::busy() );
+    KMMessage *fwdMsg = msg->createForward();
+
+    uint id = msg->headerField( "X-KMail-Identity" ).stripWhiteSpace().toUInt();
+    if ( id == 0 )
+      id = mIdentity;
+    {
       KMail::Composer * win = KMail::makeComposer( fwdMsg, id );
-      win->setCharset("");
+      win->setCharset( fwdMsg->codec()->mimeName(), true );
+      win->setBody( QString::fromUtf8( msg->createForwardBody() ) );
       win->show();
-      return OK;
     }
   }
-
-  // forward a single message at most.
-  KMMessage *msg = msgList.getFirst();
-  if ( !msg || !msg->codec() )
-    return Failed;
-
-  KCursorSaver busy(KBusyPtr::busy());
-  KMMessage *fwdMsg = msg->createForward();
-
-  uint id = msg->headerField("X-KMail-Identity").stripWhiteSpace().toUInt();
-  if ( id == 0 )
-    id = mIdentity;
-  {
-    KMail::Composer * win = KMail::makeComposer( fwdMsg, id );
-    win->setCharset( fwdMsg->codec()->mimeName(), true );
-    win->setBody( QString::fromUtf8( msg->createForwardBody() ) );
-    win->show();
-  }
-
   return OK;
 }
 
@@ -1329,8 +1257,95 @@
 }
 
 
+KMForwardDigestCommand::KMForwardDigestCommand( QWidget *parent,
+           const QPtrList<KMMsgBase> &msgList, uint identity, KMail::Composer *win )
+  : KMCommand( parent, msgList ), mIdentity( identity ),
+    mWin( QGuardedPtr<KMail::Composer>( win ))
+{
+}
+
+KMForwardDigestCommand::KMForwardDigestCommand( QWidget *parent,
+           KMMessage * msg, uint identity, KMail::Composer *win )
+  : KMCommand( parent, msg ), mIdentity( identity ),
+    mWin( QGuardedPtr< KMail::Composer >( win ))
+{
+}
+
+KMCommand::Result KMForwardDigestCommand::execute()
+{
+  QPtrList<KMMessage> msgList = retrievedMsgs();
+
+  if ( msgList.count() < 2 )
+    return Undefined; // must have more than 1 for a digest
+
+  uint id = 0;
+  KMMessage *fwdMsg = new KMMessage;
+  KMMessagePart *msgPart = new KMMessagePart;
+  QString msgPartText;
+  int msgCnt = 0; // incase there are some we can't forward for some reason
+
+  // dummy header initialization; initialization with the correct identity
+  // is done below
+  fwdMsg->initHeader( id );
+  fwdMsg->setAutomaticFields( true );
+  fwdMsg->mMsg->Headers().ContentType().CreateBoundary( 1 );
+  QCString boundary( fwdMsg->mMsg->Headers().ContentType().Boundary().c_str() );
+  msgPartText = i18n("\nThis is a MIME digest forward. The content of the"
+                     " message is contained in the attachment(s).\n\n\n");
+  // iterate through all the messages to be forwarded
+  for ( KMMessage *msg = msgList.first(); msg; msg = msgList.next() ) {
+    // set the identity
+    if ( id == 0 )
+      id = msg->headerField( "X-KMail-Identity" ).stripWhiteSpace().toUInt();
+    // set the part header
+    msgPartText += "--";
+    msgPartText += QString::fromLatin1( boundary );
+    msgPartText += "\nContent-Type: MESSAGE/RFC822";
+    msgPartText += QString( "; CHARSET=%1" ).arg( msg->charset() );
+    msgPartText += '\n';
+    DwHeaders dwh;
+    dwh.MessageId().CreateDefault();
+    msgPartText += QString( "Content-ID: %1\n" ).arg( dwh.MessageId().AsString().c_str() );
+    msgPartText += QString( "Content-Description: %1" ).arg( msg->subject() );
+    if ( !msg->subject().contains( "(fwd)" ) )
+      msgPartText += " (fwd)";
+    msgPartText += "\n\n";
+    // remove headers that shouldn't be forwarded
+    msg->removePrivateHeaderFields();
+    msg->removeHeaderField( "BCC" );
+    // set the part
+    msgPartText += msg->headerAsString();
+    msgPartText += '\n';
+    msgPartText += msg->body();
+    msgPartText += '\n';     // eot
+    msgCnt++;
+    fwdMsg->link( msg, KMMsgStatusForwarded );
+  }
+
+  if ( id == 0 )
+    id = mIdentity; // use folder identity if no message had an id set
+  fwdMsg->initHeader( id );
+  msgPartText += "--";
+  msgPartText += QString::fromLatin1( boundary );
+  msgPartText += "--\n";
+  QCString tmp;
+  msgPart->setTypeStr( "MULTIPART" );
+  tmp.sprintf( "Digest; boundary=\"%s\"", boundary.data() );
+  msgPart->setSubtypeStr( tmp );
+  msgPart->setName( "unnamed" );
+  msgPart->setCte( DwMime::kCte7bit );   // does it have to be 7bit?
+  msgPart->setContentDescription( QString( "Digest of %1 messages." ).arg( msgCnt ) );
+  // THIS HAS TO BE AFTER setCte()!!!!
+  msgPart->setBodyEncoded( QCString( msgPartText.ascii() ) );
+  KCursorSaver busy( KBusyPtr::busy() );
+  KMail::Composer * win = KMail::makeComposer( fwdMsg, id );
+  win->addAttach( msgPart );
+  win->show();
+  return OK;
+}
+
 KMRedirectCommand::KMRedirectCommand( QWidget *parent,
-  KMMessage *msg )
+                                      KMMessage *msg )
   : KMCommand( parent, msg )
 {
 }
@@ -1477,7 +1492,7 @@
   int msgCountToFilter = msgList.count();
   for (KMMessage *msg = msgList.first(); msg; msg = msgList.next()) {
     int diff = msgCountToFilter - ++msgCount;
-    if ( diff < 10 || !( msgCount % 20 ) ) {
+    if ( diff < 10 || !( msgCount % 20 ) || msgCount <= 10 ) {
       QString statusMsg = i18n("Filtering message %1 of %2");
       statusMsg = statusMsg.arg( msgCount ).arg( msgCountToFilter );
       KPIM::BroadcastStatus::instance()->setStatusMsg( statusMsg );
@@ -1911,7 +1926,7 @@
       msg = srcFolder->getMsg(idx);
     }
 
-    if ( msg->transferInProgress() &&
+    if ( msg && msg->transferInProgress() &&
          srcFolder->folderType() == KMFolderTypeImap )
     {
       // cancel the download
@@ -2890,7 +2905,7 @@
 
 void KMHandleAttachmentCommand::atmProperties()
 {
-  KMMsgPartDialogCompat dlg( 0, true );
+  KMMsgPartDialogCompat dlg( parentWidget() , 0, true );
   KMMessagePart& msgPart = mNode->msgPart();
   dlg.setMsgPart( &msgPart );
   dlg.exec();
Index: kmail/messagecomposer.cpp
===================================================================
--- kmail/messagecomposer.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/messagecomposer.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -2155,9 +2155,11 @@
   }
 
   mSignature = signature;
-  Q_ASSERT( !mSignature.isNull() ); // if you hit this, check gpg-agent is running, then blame gpgme.
-  if ( mSignature.isNull() ) {
-    KMessageBox::error( mComposeWin, i18n( "The signing operation failed for an unknown reason." ) );
+  if ( mSignature.isEmpty() ) {
+    KMessageBox::sorry( mComposeWin,
+                        i18n( "The signing operation failed. "
+                              "Please make sure that the gpg-agent program "
+                              "is running." ) );
   }
 }
 
Index: kmail/kmfoldercachedimap.cpp
===================================================================
--- kmail/kmfoldercachedimap.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmfoldercachedimap.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1208,6 +1208,10 @@
 
 void KMFolderCachedImap::slotImapStatusChanged(KMFolder* folder, const QString&, bool cont)
 {
+  if ( mSyncState == SYNC_STATE_INITIAL ){
+      kdDebug(5006) << "IMAP status changed but reset " << endl;
+      return; // we were reset
+  }
   if ( folder->storage() == this ) {
     --mStatusFlagsJobs;
     if ( mStatusFlagsJobs == 0 || !cont ) // done or aborting
@@ -2010,6 +2014,7 @@
 // called by KMAcctCachedImap::killAllJobs
 void KMFolderCachedImap::resetSyncState()
 {
+  if ( mSyncState == SYNC_STATE_INITIAL ) return;
   mSubfoldersForSync.clear();
   mSyncState = SYNC_STATE_INITIAL;
   close();
Index: kmail/kmail_part.rc
===================================================================
--- kmail/kmail_part.rc	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmail_part.rc	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -2,7 +2,7 @@
      the same menu entries at the same place in KMail and Kontact  -->
 
 <!DOCTYPE kpartgui>
-<kpartgui version="6" name="kmail_part" >
+<kpartgui version="7" name="kmail_part" >
  <MenuBar>
   <Menu noMerge="1" name="file" >
    <text>&amp;File</text>
@@ -117,6 +117,7 @@
      <text>&amp;Forward</text>
      <Action name="message_forward_as_attachment" />
      <Action name="message_forward_inline" />
+     <Action name="message_forward_as_digest" />
      <Action name="message_forward_redirect" />
    </Menu>
    <Action name="send_again" />
Index: kmail/eventsrc
===================================================================
--- kmail/eventsrc	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/eventsrc	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -20,6 +20,7 @@
 Name[es]=Hay correo nuevo
 Name[et]=Saabus uus kiri
 Name[eu]=Posta berri bat iritsi da
+Name[fa]=نامۀ جدید رسیده
 Name[fi]=Uutta postia saapunut
 Name[fr]=Un nouveau message est arrivé
 Name[gl]=Hai Correo Novo
@@ -66,6 +67,7 @@
 Comment[es]=Hay correo nuevo
 Comment[et]=Saabus uus kiri
 Comment[eu]=Posta berri bat iritsi da
+Comment[fa]=نامۀ جدید رسیده
 Comment[fi]=Uutta postia saapunut
 Comment[fr]=Un nouveau message est arrivé
 Comment[gl]=Hai correo novo
Index: kmail/kmmainwidget.cpp
===================================================================
--- kmail/kmmainwidget.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmmainwidget.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -516,6 +516,7 @@
 #endif
   mSearchAndHeaders = new QVBox( headerParent );
   mSearchToolBar = new KToolBar( mSearchAndHeaders, "search toolbar");
+  mSearchToolBar->setMovingEnabled(false);
   mSearchToolBar->boxLayout()->setSpacing( KDialog::spacingHint() );
   QLabel *label = new QLabel( i18n("S&earch:"), mSearchToolBar, "kde toolbar widget" );
 
@@ -1276,14 +1277,16 @@
 
 
 //-----------------------------------------------------------------------------
-void KMMainWidget::slotForwardMsg()
+void KMMainWidget::slotForwardInlineMsg()
 {
   KMMessageList* selected = mHeaders->selectedMsgs();
   KMCommand *command = 0L;
   if(selected && !selected->isEmpty()) {
-    command = new KMForwardCommand( this, *selected, mFolder->identity() );
+    command = new KMForwardInlineCommand( this, *selected,
+                                          mFolder->identity() );
   } else {
-    command = new KMForwardCommand( this, mHeaders->currentMsg(), mFolder->identity() );
+    command = new KMForwardInlineCommand( this, mHeaders->currentMsg(),
+                                          mFolder->identity() );
   }
 
   command->start();
@@ -1304,7 +1307,20 @@
   command->start();
 }
 
+//-----------------------------------------------------------------------------
+void KMMainWidget::slotForwardDigestMsg()
+{
+  KMMessageList* selected = mHeaders->selectedMsgs();
+  KMCommand *command = 0L;
+  if(selected && !selected->isEmpty()) {
+    command = new KMForwardDigestCommand( this, *selected, mFolder->identity() );
+  } else {
+    command = new KMForwardDigestCommand( this, mHeaders->currentMsg(), mFolder->identity() );
+  }
 
+  command->start();
+}
+
 //-----------------------------------------------------------------------------
 void KMMainWidget::slotEditMsg()
 {
@@ -2459,19 +2475,35 @@
 					"mail_forward", actionCollection(),
 					"message_forward" );
   connect( mForwardActionMenu, SIGNAL(activated()), this,
-	   SLOT(slotForwardMsg()) );
+	   SLOT(slotForwardInlineMsg()) );
 
   mForwardAttachedAction = new KAction( i18n("Message->Forward->","As &Attachment..."),
 				       "mail_forward", Key_F, this,
-					SLOT(slotForwardAttachedMsg()), actionCollection(),
+					SLOT(slotForwardAttachedMsg()),
+                                        actionCollection(),
 					"message_forward_as_attachment" );
   mForwardActionMenu->insert( forwardAttachedAction() );
-  mForwardAction = new KAction( i18n("&Inline..."), "mail_forward",
-				SHIFT+Key_F, this, SLOT(slotForwardMsg()),
-				actionCollection(), "message_forward_inline" );
+  mForwardInlineAction = new KAction( i18n("&Inline..."), "mail_forward",
+                                      SHIFT+Key_F, this,
+                                      SLOT(slotForwardInlineMsg()),
+                                      actionCollection(),
+                                      "message_forward_inline" );
 
-  mForwardActionMenu->insert( forwardAction() );
+  mForwardActionMenu->insert( forwardInlineAction() );
+  mForwardDigestAction = new KAction( i18n("Message->Forward->","As Di&gest..."),
+                                      "mail_forward", 0, this,
+                                      SLOT(slotForwardDigestMsg()),
+                                      actionCollection(),
+                                      "message_forward_as_digest" );
+  mForwardActionMenu->insert( forwardDigestAction() );
+  mRedirectAction = new KAction( i18n("Message->Forward->","&Redirect..."),
+                                 "mail_forward", Key_E, this,
+                                 SLOT(slotRedirectMsg()),
+				 actionCollection(),
+                                 "message_forward_redirect" );
+  mForwardActionMenu->insert( redirectAction() );
 
+
   mSendAgainAction = new KAction( i18n("Send A&gain..."), 0, this,
 		      SLOT(slotResendMsg()), actionCollection(), "send_again" );
 
@@ -2502,12 +2534,6 @@
 				  "reply_list" );
   mReplyActionMenu->insert( mReplyListAction );
 
-  mRedirectAction = new KAction( i18n("Message->Forward->","&Redirect..."),
-                                 "mail_forward",
-				 Key_E, this, SLOT(slotRedirectMsg()),
-				 actionCollection(), "message_forward_redirect" );
-  mForwardActionMenu->insert( redirectAction() );
-
   mNoQuoteReplyAction = new KAction( i18n("Reply Without &Quote..."), SHIFT+Key_R,
     this, SLOT(slotNoQuoteReplyToMsg()), actionCollection(), "noquotereply" );
 
@@ -2572,13 +2598,13 @@
   mToggleTodoAction = new KToggleAction(i18n("Mark Message as &To-do"), "mail_todo",
                                  0, this, SLOT(slotSetMsgStatusTodo()),
                                  actionCollection(), "status_todo");
-  mToggleTodoAction->setCheckedState( i18n("Mark Message as Not &To-do") );
+  mToggleTodoAction->setCheckedState( i18n("Remove &To-do Message Mark") );
   mStatusMenu->insert( mToggleTodoAction );
 
   mToggleSentAction = new KToggleAction(i18n("Mark Message as &Sent"), "kmmsgsent",
                                  0, this, SLOT(slotSetMsgStatusSent()),
                                  actionCollection(), "status_sent");
-  mToggleSentAction->setCheckedState( i18n("Mark Message as Not &Sent") );
+  mToggleSentAction->setCheckedState( i18n("Remove &Sent Mark") );
 
 
   //----- "Mark Thread" submenu
@@ -2615,7 +2641,7 @@
   mToggleThreadTodoAction = new KToggleAction(i18n("Mark Thread as &To-do"), "mail_todo",
                                        0, this, SLOT(slotSetThreadStatusTodo()),
                                        actionCollection(), "thread_todo");
-  mToggleThreadTodoAction->setCheckedState( i18n("Mark Thread as Not &To-do") );
+  mToggleThreadTodoAction->setCheckedState( i18n("Remove &To-do Thread Mark") );
   mThreadStatusMenu->insert( mToggleThreadTodoAction );
 
   //------- "Watch and ignore thread" actions
@@ -2876,7 +2902,7 @@
 void KMMainWidget::slotShowMsgSrc()
 {
   if ( mMsgView )
-    mMsgView->setUpdateAttachment( false );  
+    mMsgView->setUpdateAttachment( false );
   KMMessage *msg = mHeaders->currentMsg();
   if ( !msg )
     return;
@@ -2959,6 +2985,10 @@
       allSelectedInCommonThread = true;
     }
 
+    QListViewItem *curItemParent = mHeaders->currentItem();
+    bool parent_thread = 0;
+    if ( curItemParent && curItemParent->firstChild() != 0 ) parent_thread = 1;
+
     bool mass_actions = count >= 1;
     bool thread_actions = mass_actions && allSelectedInCommonThread &&
                           mHeaders->isThreaded();
@@ -2993,8 +3023,9 @@
     mTrashAction->setEnabled( mass_actions && !mFolder->isReadOnly() );
     mDeleteAction->setEnabled( mass_actions && !mFolder->isReadOnly() );
     mFindInMessageAction->setEnabled( mass_actions );
-    mForwardAction->setEnabled( mass_actions );
+    mForwardInlineAction->setEnabled( mass_actions );
     mForwardAttachedAction->setEnabled( mass_actions );
+    mForwardDigestAction->setEnabled( count > 1 || parent_thread );
 
     forwardMenu()->setEnabled( mass_actions );
 
@@ -3014,7 +3045,7 @@
 
     mSendAgainAction->setEnabled( single_actions &&
              ( mHeaders->currentMsg() && mHeaders->currentMsg()->isSent() )
-          || ( mFolder && mHeaders->currentMsg() && 
+          || ( mFolder && mHeaders->currentMsg() &&
               ( kmkernel->folderIsDraftOrOutbox( mFolder )
              || kmkernel->folderIsSentMailFolder( mFolder ) ) ) );
     mSaveAsAction->setEnabled( mass_actions );
Index: kmail/kmcommands.h
===================================================================
--- kmail/kmcommands.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmcommands.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -460,15 +460,15 @@
   QString mSelection;
 };
 
-class KDE_EXPORT KMForwardCommand : public KMCommand
+class KDE_EXPORT KMForwardInlineCommand : public KMCommand
 {
   Q_OBJECT
 
 public:
-  KMForwardCommand( QWidget *parent, const QPtrList<KMMsgBase> &msgList,
-                    uint identity = 0 );
-  KMForwardCommand( QWidget *parent, KMMessage * msg,
-                    uint identity = 0 );
+  KMForwardInlineCommand( QWidget *parent, const QPtrList<KMMsgBase> &msgList,
+                          uint identity = 0 );
+  KMForwardInlineCommand( QWidget *parent, KMMessage * msg,
+                          uint identity = 0 );
 
 private:
   virtual Result execute();
@@ -494,6 +494,23 @@
   QGuardedPtr<KMail::Composer> mWin;
 };
 
+class KDE_EXPORT KMForwardDigestCommand : public KMCommand
+{
+  Q_OBJECT
+
+public:
+  KMForwardDigestCommand( QWidget *parent, const QPtrList<KMMsgBase> &msgList,
+			    uint identity = 0, KMail::Composer *win = 0 );
+  KMForwardDigestCommand( QWidget *parent, KMMessage * msg,
+			    uint identity = 0, KMail::Composer *win = 0 );
+
+private:
+  virtual Result execute();
+
+  uint mIdentity;
+  QGuardedPtr<KMail::Composer> mWin;
+};
+
 class KDE_EXPORT KMRedirectCommand : public KMCommand
 {
   Q_OBJECT
Index: kmail/kmcomposewin.cpp
===================================================================
--- kmail/kmcomposewin.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmcomposewin.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1466,8 +1466,9 @@
   statusBar()->insertItem("", 0, 1);
   statusBar()->setItemAlignment(0, AlignLeft | AlignVCenter);
 
-  statusBar()->insertItem(i18n(" Column: %1 ").arg("     "),2,0,true);
-  statusBar()->insertItem(i18n(" Line: %1 ").arg("     "),1,0,true);
+  statusBar()->insertItem(i18n( " Spellcheck: %1 ").arg( "   " ), 3, 0, true );
+  statusBar()->insertItem(i18n( " Column: %1 ").arg("     "), 2, 0, true);
+  statusBar()->insertItem(i18n( " Line: %1 ").arg("     "), 1, 0, true);
 }
 
 
@@ -2612,7 +2613,7 @@
   KConfigGroup composer(KMKernel::config(), "Composer");
   if ( GlobalSettings::self()->showMessagePartDialogOnAttach() ) {
     const KCursorSaver saver( QCursor::ArrowCursor );
-    KMMsgPartDialogCompat dlg;
+    KMMsgPartDialogCompat dlg(mMainWidget);
     int encodings = 0;
     for ( QValueListConstIterator<int> it = allowedCTEs.begin() ;
           it != allowedCTEs.end() ; ++it )
@@ -2944,7 +2945,7 @@
   KMMessagePart* msgPart = mAtmList.at(idx);
   msgPart->setCharset(mCharset);
 
-  KMMsgPartDialogCompat dlg;
+  KMMsgPartDialogCompat dlg(mMainWidget);
   dlg.setMsgPart(msgPart);
   KMAtmListViewItem* listItem = (KMAtmListViewItem*)(mAtmItemList.at(idx));
   if( canSignEncryptAttachments() && listItem ) {
@@ -4125,8 +4126,16 @@
 //-----------------------------------------------------------------------------
 void KMComposeWin::slotAutoSpellCheckingToggled( bool on )
 {
-  if ( mEditor->autoSpellChecking(on) == -1 )
+  if ( mEditor->autoSpellChecking(on) == -1 ) {
     mAutoSpellCheckingAction->setChecked(false); // set it to false again
+  }
+
+  QString temp;
+  if ( on )
+    temp = i18n( "Spellcheck: on" );
+  else
+    temp = i18n( "Spellcheck: off" );
+  statusBar()->changeItem( temp, 3 );
 }
 //-----------------------------------------------------------------------------
 void KMComposeWin::slotSpellcheck()
@@ -4298,24 +4307,34 @@
   }
 
   QString edtText = mEditor->text();
-  bool appendNewSig = true;
+
+  if ( mOldSigText.isEmpty() ) {
+    const KPIM::Identity &id =
+      kmkernel->
+      identityManager()->
+      identityForUoidOrDefault( mMsg->headerField( "X-KMail-Identity" ).
+                                stripWhiteSpace().toUInt() );
+    mOldSigText = id.signatureText();
+  }
+
   // try to truncate the old sig
-  if( !mOldSigText.isEmpty() )
-  {
-    if( edtText.endsWith( mOldSigText ) )
-      edtText.truncate( edtText.length() - mOldSigText.length() );
-    else
-      appendNewSig = false;
-  }
+  // First remove any trailing whitespace
+  while ( !edtText.isEmpty() && edtText[edtText.length()-1].isSpace() )
+    edtText.truncate( edtText.length() - 1 );
+  // From the sig too, just in case
+  while ( !mOldSigText.isEmpty() && mOldSigText[mOldSigText.length()-1].isSpace() )
+    mOldSigText.truncate( mOldSigText.length() - 1 );
+
+  if( edtText.endsWith( mOldSigText ) )
+    edtText.truncate( edtText.length() - mOldSigText.length() );
+
   // now append the new sig
   mOldSigText = ident.signatureText();
-  if( appendNewSig )
-  {
-    if( (!mOldSigText.isEmpty()) &&
-                   (GlobalSettings::self()->autoTextSignature()=="auto") )
-      edtText.append( mOldSigText );
-    mEditor->setText( edtText );
+  if( ( !mOldSigText.isEmpty() ) &&
+      ( GlobalSettings::self()->autoTextSignature() == "auto" ) ) {
+    edtText.append( mOldSigText );
   }
+  mEditor->setText( edtText );
 
   // disable certain actions if there is no PGP user identity set
   // for this profile
@@ -4599,27 +4618,29 @@
 
 void KMComposeWin::fontChanged( const QFont &f )
 {
-  QFontDatabase *fontdb = new QFontDatabase();
+  QFont fontTemp = f;
+  fontTemp.setBold( true );
+  fontTemp.setItalic( true );
+  QFontInfo fontInfo( fontTemp );
 
-  if ( fontdb->bold(f.family(), "Bold") ) {
-    textBoldAction->setChecked( f.bold() ); // if the user has the default font with bold, then show it in the buttonstate
-    textBoldAction->setEnabled(true);
+  if ( fontInfo.bold() ) {
+    textBoldAction->setChecked( f.bold() );
+    textBoldAction->setEnabled( true ) ;
+  } else {
+    textBoldAction->setEnabled( false );
   }
-  else
-    textBoldAction->setEnabled(false);
 
-  if ( fontdb->italic(f.family(), "Italic") ) {
+  if ( fontInfo.italic() ) {
     textItalicAction->setChecked( f.italic() );
-    textItalicAction->setEnabled(true);
+    textItalicAction->setEnabled( true ) ;
+  } else {
+    textItalicAction->setEnabled( false );
   }
-  else
-    textItalicAction->setEnabled(false);
 
   textUnderAction->setChecked( f.underline() );
 
   fontAction->setFont( f.family() );
   fontSizeAction->setFontSize( f.pointSize() );
-  delete fontdb;
 }
 
 void KMComposeWin::alignmentChanged( int a )
Index: kmail/kmreaderwin.h
===================================================================
--- kmail/kmreaderwin.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmreaderwin.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -321,6 +321,8 @@
 
   /** The user selected "Find" from the menu. */
   void slotFind();
+  /** The user selected "Find Next" from the menu. */
+  void slotFindNext();
 
   /** The user toggled the "Fixed Font" flag from the view menu. */
   void slotToggleFixedFont();
@@ -351,7 +353,8 @@
   void slotIMChat();
   void contactStatusChanged( const QString &uid);
 
-	void slotLevelQuote( int l );
+  void slotLevelQuote( int l );
+  void slotTouchMessage();
 
 protected slots:
   void slotCycleHeaderStyles();
@@ -370,7 +373,6 @@
   /** Some attachment operations. */
   void slotAtmView( int id, const QString& name );
   void slotDelayedResize();
-  void slotTouchMessage();
   void slotHandleAttachment( int );
 
 protected:
Index: kmail/kmail_view.desktop
===================================================================
--- kmail/kmail_view.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmail_view.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[sv]=Kmail
 Name[ta]=Kஅஞ்சல்
 Name[th]=จัดการจดหมาย - K
+Name[zh_TW]=KMail 郵件軟體
 Type=Application
 Exec=kmail --view %u
 Icon=kmail
Index: kmail/configuredialog.cpp
===================================================================
--- kmail/configuredialog.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/configuredialog.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -2309,6 +2309,13 @@
     }
     i++;
   }
+  if ( i == encodings.size() ) {
+    // the current value of overrideCharacterEncoding is an unknown encoding => reset to Auto
+    kdWarning(5006) << "Unknown override character encoding \"" << currentOverrideEncoding
+                    << "\". Resetting to Auto." << endl;
+    mOverrideCharsetCombo->setCurrentItem( 0 );
+    GlobalSettings::self()->setOverrideCharacterEncoding( QString::null );
+  }
 }
 
 void AppearancePage::ReaderTab::doLoadFromGlobalSettings()
Index: kmail/kmmsgpartdlg.h
===================================================================
--- kmail/kmmsgpartdlg.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmmsgpartdlg.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -140,7 +140,7 @@
 class KMMsgPartDialogCompat : public KMMsgPartDialog {
   Q_OBJECT
 public:
-  KMMsgPartDialogCompat( const char * caption=0, bool=FALSE );
+  KMMsgPartDialogCompat( QWidget * parent=0, const char * caption=0, bool=FALSE );
   virtual ~KMMsgPartDialogCompat();
 
   /** Display information about this message part. */
Index: kmail/kmfolderimap.cpp
===================================================================
--- kmail/kmfolderimap.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmfolderimap.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -112,7 +112,7 @@
   if (mOpenCount > 0) mOpenCount--;
   if (mOpenCount > 0 && !aForced) return;
   if (isSelected() && !aForced) {
-      kdWarning(5006) << "Trying to close the selected folder " << label() << 
+      kdWarning(5006) << "Trying to close the selected folder " << label() <<
           " - ignoring!" << endl;
       return;
   }
@@ -320,7 +320,7 @@
   if ( !mAccount->hasCapability("uidplus") ) {
     // Remember the status with the MD5 as key
     // so it can be transfered to the new message
-    mMetaDataMap.insert( aMsg->msgIdMD5(), 
+    mMetaDataMap.insert( aMsg->msgIdMD5(),
         new KMMsgMetaData(aMsg->status(), serNum) );
   }
 
@@ -349,7 +349,7 @@
     if ( !uidplus ) {
       // Remember the status with the MD5 as key
       // so it can be transfered to the new message
-      mMetaDataMap.insert( msg->msgIdMD5(), 
+      mMetaDataMap.insert( msg->msgIdMD5(),
           new KMMsgMetaData(msg->status(), msg->getMsgSerNum()) );
     }
     msg->setTransferInProgress( false );
@@ -367,7 +367,7 @@
 //-----------------------------------------------------------------------------
 int KMFolderImap::addMsg(KMMessage* aMsg, int* aIndex_ret)
 {
-  QPtrList<KMMessage> list; 
+  QPtrList<KMMessage> list;
   list.append(aMsg);
   QValueList<int> index;
   int ret = addMsg(list, index);
@@ -458,7 +458,7 @@
     // transfer from local folders or other accounts
     QPtrListIterator<KMMessage> it( msgList );
     KMMessage* msg;
-    while ( ( msg = it.current() ) != 0 ) 
+    while ( ( msg = it.current() ) != 0 )
     {
       ++it;
       if ( !msg->transferInProgress() )
@@ -505,7 +505,7 @@
       mMetaDataMap.insert( msg->msgIdMD5(), new KMMsgMetaData(msg->status()) );
     }
   }
-  
+
   QValueList<ulong> uids;
   getUids(msgList, uids);
   QStringList sets = makeSets(uids, false);
@@ -611,7 +611,7 @@
   // start personal namespace listing and send it directly to slotListResult
   for ( QStringList::Iterator it = personal.begin(); it != personal.end(); ++it )
   {
-    KMail::ListJob* job = new KMail::ListJob( mAccount, type, this, 
+    KMail::ListJob* job = new KMail::ListJob( mAccount, type, this,
 	mAccount->addPathToNamespace( *it ) );
     job->setNamespace( *it );
     connect( job, SIGNAL(receivedFolders(const QStringList&, const QStringList&,
@@ -632,7 +632,7 @@
         this, SLOT(slotCheckNamespace(const QStringList&, const QStringList&,
             const QStringList&, const QStringList&, const ImapAccountBase::jobData&)));
     job->start();
-  }  
+  }
 }
 
 //-----------------------------------------------------------------------------
@@ -644,13 +644,13 @@
 {
   kdDebug(5006) << "slotCheckNamespace - " << subfolderNames.join(",") << endl;
 
-  // get a correct foldername: 
+  // get a correct foldername:
   // strip / and make sure it does not contain the delimiter
   QString name = jobData.path.mid( 1, jobData.path.length()-2 );
   name.remove( mAccount->delimiterForNamespace( name ) );
   if ( name.isEmpty() ) {
     // happens when an empty namespace is defined
-    slotListResult( subfolderNames, subfolderPaths, 
+    slotListResult( subfolderNames, subfolderPaths,
         subfolderMimeTypes, subfolderAttributes, jobData );
     return;
   }
@@ -658,9 +658,9 @@
   folder()->createChildFolder();
   KMFolderNode *node = 0;
   for ( node = folder()->child()->first(); node;
-        node = folder()->child()->next()) 
+        node = folder()->child()->next())
   {
-    if ( !node->isDir() && node->name() == name ) 
+    if ( !node->isDir() && node->name() == name )
       break;
   }
   if ( subfolderNames.isEmpty() )
@@ -680,9 +680,9 @@
       kdDebug(5006) << "found namespace folder " << name << endl;
       if ( !mAccount->listOnlyOpenFolders() )
       {
-        KMFolderImap* nsFolder = 
+        KMFolderImap* nsFolder =
           static_cast<KMFolderImap*>(static_cast<KMFolder*>(node)->storage());
-        nsFolder->slotListResult( subfolderNames, subfolderPaths, 
+        nsFolder->slotListResult( subfolderNames, subfolderPaths,
             subfolderMimeTypes, subfolderAttributes, jobData );
       }
     } else
@@ -692,17 +692,17 @@
       KMFolder *fld = folder()->child()->createFolder( name );
       if ( fld ) {
         KMFolderImap* f = static_cast<KMFolderImap*> ( fld->storage() );
-        f->initializeFrom( this, mAccount->addPathToNamespace( name ), 
+        f->initializeFrom( this, mAccount->addPathToNamespace( name ),
             "inode/directory" );
         f->close();
         if ( !mAccount->listOnlyOpenFolders() )
         {
-          f->slotListResult( subfolderNames, subfolderPaths, 
+          f->slotListResult( subfolderNames, subfolderPaths,
               subfolderMimeTypes, subfolderAttributes, jobData );
         }
       }
       kmkernel->imapFolderMgr()->contentsChanged();
-    }  
+    }
   }
 }
 
@@ -748,8 +748,8 @@
                                    const ImapAccountBase::jobData& jobData )
 {
   mSubfolderState = imapFinished;
-  //kdDebug(5006) << label() << ": folderNames=" << subfolderNames << " folderPaths=" 
-  //<< subfolderPaths << " mimeTypes=" << subfolderMimeTypes << endl;  
+  //kdDebug(5006) << label() << ": folderNames=" << subfolderNames << " folderPaths="
+  //<< subfolderPaths << " mimeTypes=" << subfolderMimeTypes << endl;
 
   // don't react on changes
   kmkernel->imapFolderMgr()->quiet(true);
@@ -770,9 +770,9 @@
     KMFolderImap* parent = findParent( subfolderPaths.first(), subfolderNames.first() );
     if ( parent )
     {
-      kdDebug(5006) << "KMFolderImap::slotListResult - pass listing to " 
+      kdDebug(5006) << "KMFolderImap::slotListResult - pass listing to "
         << parent->label() << endl;
-      parent->slotListResult( subfolderNames, subfolderPaths, 
+      parent->slotListResult( subfolderNames, subfolderPaths,
           subfolderMimeTypes, subfolderAttributes, jobData );
       // cleanup
       QStringList list;
@@ -798,13 +798,13 @@
     // create folders if necessary
     for ( node = folder()->child()->first(); node;
           node = folder()->child()->next() ) {
-      if ( !node->isDir() && node->name() == subfolderNames[i] ) 
+      if ( !node->isDir() && node->name() == subfolderNames[i] )
         break;
     }
     if ( node ) {
       f = static_cast<KMFolderImap*>(static_cast<KMFolder*>(node)->storage());
-    } 
-    else if ( subfolderPaths[i].upper() != "/INBOX/" ) 
+    }
+    else if ( subfolderPaths[i].upper() != "/INBOX/" )
     {
       kdDebug(5006) << "create folder " << subfolderNames[i] << endl;
       KMFolder *fld = folder()->child()->createFolder(subfolderNames[i]);
@@ -829,12 +829,12 @@
 
       f->initializeFrom( this, subfolderPaths[i], subfolderMimeTypes[i] );
       f->setChildrenState( subfolderAttributes[i] );
-      if ( mAccount->listOnlyOpenFolders() && 
-           f->hasChildren() != FolderStorage::ChildrenUnknown ) 
+      if ( mAccount->listOnlyOpenFolders() &&
+           f->hasChildren() != FolderStorage::ChildrenUnknown )
       {
         settingsChanged = true;
       }
-      
+
       if ( settingsChanged )
       {
         // tell the tree our information changed
@@ -915,7 +915,7 @@
 }
 
 //-----------------------------------------------------------------------------
-void KMFolderImap::checkFolders( const QStringList& subfolderNames, 
+void KMFolderImap::checkFolders( const QStringList& subfolderNames,
     const QString& myNamespace )
 {
   QPtrList<KMFolder> toRemove;
@@ -928,14 +928,14 @@
       KMFolderImap* imapFld = static_cast<KMFolderImap*>( fld->storage() );
       // as more than one namespace can be listed in the root folder we need to make sure
       // that the folder is within the current namespace
-      bool isInNamespace = ( myNamespace.isEmpty() || 
+      bool isInNamespace = ( myNamespace.isEmpty() ||
           myNamespace == mAccount->namespaceForFolder( imapFld ) );
-      kdDebug(5006) << node->name() << " in namespace " << myNamespace << ":" << 
+      kdDebug(5006) << node->name() << " in namespace " << myNamespace << ":" <<
         isInNamespace << endl;
       // ignore some cases
       QString name = node->name();
-      bool ignore = ( ( this == mAccount->rootFolder() ) && 
-          ( imapFld->imapPath() == "/INBOX/" || 
+      bool ignore = ( ( this == mAccount->rootFolder() ) &&
+          ( imapFld->imapPath() == "/INBOX/" ||
             mAccount->isNamespaceFolder( name ) ||
 	    !isInNamespace ) );
       // additional sanity check for broken folders
@@ -960,7 +960,7 @@
 }
 
 //-----------------------------------------------------------------------------
-void KMFolderImap::initializeFrom( KMFolderImap* parent, QString folderPath, 
+void KMFolderImap::initializeFrom( KMFolderImap* parent, QString folderPath,
                                    QString mimeType )
 {
   setAccount( parent->account() );
@@ -1060,7 +1060,7 @@
 //-----------------------------------------------------------------------------
 ulong KMFolderImap::lastUid()
 {
-  if ( mLastUid > 0 ) 
+  if ( mLastUid > 0 )
       return mLastUid;
   open();
   if (count() > 0)
@@ -1083,7 +1083,7 @@
   if (job->error()) {
     if ( job->error() != KIO::ERR_ACCESS_DENIED ) {
       // we suppress access denied messages because they are normally a result of
-      // explicitely set ACLs. Do not save this information (e.g. setNoContent) so that 
+      // explicitely set ACLs. Do not save this information (e.g. setNoContent) so that
       // we notice when this changes
       mAccount->handleJobError( job, i18n("Error while querying the server status.") );
     }
@@ -1095,19 +1095,19 @@
     int a = cstr.find("X-uidValidity: ");
     int b = cstr.find("\r\n", a);
     QString uidv;
-    if ( (b - a - 15) >= 0 ) 
+    if ( (b - a - 15) >= 0 )
         uidv = cstr.mid(a + 15, b - a - 15);
     a = cstr.find("X-Access: ");
     b = cstr.find("\r\n", a);
     QString access;
-    if ( (b - a - 10) >= 0 ) 
+    if ( (b - a - 10) >= 0 )
         access = cstr.mid(a + 10, b - a - 10);
     mReadOnly = access == "Read only";
     a = cstr.find("X-Count: ");
     b = cstr.find("\r\n", a);
     int exists = -1;
     bool ok = false;
-    if ( (b - a - 9) >= 0 ) 
+    if ( (b - a - 9) >= 0 )
         exists = cstr.mid(a + 9, b - a - 9).toInt(&ok);
     if ( !ok ) exists = -1;
     QString startUid;
@@ -1275,7 +1275,7 @@
         uid = (*it).items.remove(uid);
         if ( msgBase->getMsgSerNum() > 0 ) {
           saveMsgMetaData( static_cast<KMMessage*>(msgBase) );
-        }        
+        }
       }
       else break;  // happens only, if deleted mails reappear on the server
     }
@@ -1382,6 +1382,8 @@
 //-----------------------------------------------------------------------------
 void KMFolderImap::flagsToStatus(KMMsgBase *msg, int flags, bool newMsg)
 {
+  if ( !msg ) return;
+
   const KMMsgStatus oldStatus = msg->status();
   // Set flags if they are new
   if ( (flags & 4) && (oldStatus & KMMsgStatusFlag) == 0 )
@@ -1455,7 +1457,7 @@
   (*it).cdata += QCString(data, data.size() + 1);
   int pos = (*it).cdata.find("\r\n--IMAPDIGEST");
   if ( pos == -1 ) {
-    // if we do not find the pattern in the complete string we will not find 
+    // if we do not find the pattern in the complete string we will not find
     // it in a substring.
     return;
   }
@@ -1552,7 +1554,7 @@
         if ( folder()->isSystemFolder() && imapPath() == "/INBOX/"
             && kmkernel->filterMgr()->atLeastOneIncomingFilterAppliesTo( mAccount->id() ) )
             mAccount->execFilters( msg->getMsgSerNum() );
-        
+
         if ( count() > 1 ) {
           unGetMsg(count() - 1);
         }
@@ -2120,7 +2122,7 @@
   // set the deleted flag for all messages in the folder
   KURL url = mAccount->getUrl();
   url.setPath( imapPath() + ";UID=1:*");
-  if ( mAccount->makeConnection() == ImapAccountBase::Connected ) 
+  if ( mAccount->makeConnection() == ImapAccountBase::Connected )
   {
     KIO::SimpleJob *job = KIO::file_delete(url, FALSE);
     KIO::Scheduler::assignJobToSlave(mAccount->slave(), job);
@@ -2216,7 +2218,7 @@
       createFolder( *it );
     }
   }
-  mFoldersPendingCreation.clear();  
+  mFoldersPendingCreation.clear();
 }
 
 //-----------------------------------------------------------------------------
@@ -2268,10 +2270,10 @@
 //-----------------------------------------------------------------------------
 bool KMFolderImap::isMoveable() const
 {
-  return ( hasChildren() == HasNoChildren && 
+  return ( hasChildren() == HasNoChildren &&
       !folder()->isSystemFolder() ) ? true : false;
 }
- 
+
 //-----------------------------------------------------------------------------
 const ulong KMFolderImap::serNumForUID( ulong uid )
 {
Index: kmail/configure.in.in
===================================================================
--- kmail/configure.in.in	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/configure.in.in	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -6,8 +6,9 @@
 
 missing_indexlib=ignore
 AC_ARG_ENABLE(indexlib,
-	AC_HELP_STRING([--enable-indexlib],[Enable full-text indexing in KMail.]),
-	AC_DEFINE(HAVE_INDEXLIB,1,[Define if you want full-text indexing in KMail])
+	AC_HELP_STRING([--enable-indexlib],[Enable EXPERIMENTAL full-text indexing in KMail.
+ Use are your own risk!]),
+	AC_DEFINE(HAVE_INDEXLIB,1,[Define if you want EXPERIMENTAL full-text indexing in KMail])
 	missing_indexlib=no
 	)
 
Index: kmail/popaccount.cpp
===================================================================
--- kmail/popaccount.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/popaccount.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -35,6 +35,7 @@
 #include "protocols.h"
 #include "kmglobal.h"
 #include "util.h"
+#include "accountmanager.h"
 
 #include <kdebug.h>
 #include <kstandarddirs.h>
@@ -157,6 +158,9 @@
         return;
       } else {
         setPasswd( passwd, b );
+        if ( b ) {
+          kmkernel->acctMgr()->writeConfig( true );
+        }
         mAskAgain = FALSE;
       }
     }
Index: kmail/kmail_config_appearance.desktop
===================================================================
--- kmail/kmail_config_appearance.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmail_config_appearance.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -26,6 +26,7 @@
 Name[es]=Apariencia
 Name[et]=Välimus
 Name[eu]=Itxura
+Name[fa]=ظاهر
 Name[fi]=Ulkoasu
 Name[fr]=Apparence
 Name[ga]=Cuma
@@ -74,6 +75,7 @@
 Comment[es]=Apariencia visual personalizada
 Comment[et]=Välimuse seadistused
 Comment[eu]=Pertsonalizatu itxura
+Comment[fa]=سفارشی کردن ظاهر تصویری‌
 Comment[fi]=Ulkonäköasetukset
 Comment[fr]=Personnalisation de l'apparence
 Comment[gl]=Personalizar a apariencia visual
@@ -118,6 +120,7 @@
 Keywords[es]=kmail,apariencia
 Keywords[et]=kmail,välimus
 Keywords[eu]=kmail,itxura
+Keywords[fa]=kmail،ظاهر
 Keywords[fi]=kmail,ulkonäkö
 Keywords[fr]=KMail,apparence
 Keywords[ga]=kmail,cuma
Index: kmail/recipientseditor.cpp
===================================================================
--- kmail/recipientseditor.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/recipientseditor.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -318,7 +318,8 @@
 // ------------ RecipientsView ---------------------
 
 RecipientsView::RecipientsView( QWidget *parent )
-  : QScrollView( parent ), mCurDelLine( 0 ), mModified( false )
+  : QScrollView( parent ), mCurDelLine( 0 ), mModified( false ),
+    mFirstColumnWidth( 0 ), mLineHeight( 0 )
 {
   setHScrollBarMode( AlwaysOff );
   setLineWidth( 0 );
Index: kmail/kmacctlocal.h
===================================================================
--- kmail/kmacctlocal.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmacctlocal.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -46,7 +46,6 @@
   QString mLocation;
   QString mProcmailLockFileName;
   bool mHasNewMail;
-  bool mProcessingNewMail;
   bool mAddedOk;
   LockType mLock;
   int mNumMsgs;
Index: kmail/KMail.desktop
===================================================================
--- kmail/KMail.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/KMail.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[sv]=Kmail
 Name[ta]=Kஅஞ்சல்
 Name[th]=จัดการจดหมาย - K
+Name[zh_TW]=KMail 郵件軟體
 Type=Application
 Exec=kmail -caption "%c" %i %m
 Icon=kmail
@@ -31,6 +32,7 @@
 GenericName[es]=Cliente de correo
 GenericName[et]=E-posti klient
 GenericName[eu]=Posta bezeroa
+GenericName[fa]=کارخواه نامه
 GenericName[fi]=Sähköpostiohjelma
 GenericName[fr]=Logiciel de messagerie électronique
 GenericName[ga]=Cliant Ríomhphoist
Index: kmail/kmfoldersearch.cpp
===================================================================
--- kmail/kmfoldersearch.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmfoldersearch.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -78,6 +78,7 @@
     mRoot = 0;
     mSearchPattern = 0;
     mFoundCount = 0;
+    mSearchCount = 0;
 
     mProcessNextBatchTimer = new QTimer();
     connect(mProcessNextBatchTimer, SIGNAL(timeout()), this, SLOT(slotProcessNextBatch()));
@@ -154,6 +155,7 @@
     }
 
     mFoundCount = 0;
+    mSearchCount = 0;
     mRunning = true;
     mRunByIndex = false;
     // check if this query can be done with the index
@@ -217,6 +219,7 @@
                 account->ignoreJobsForFolder( folder );
             }
             folder->storage()->search( 0 );
+            mSearchCount += folder->count();
             folder->close();
         }
     }
@@ -282,6 +285,7 @@
           SLOT( slotSearchFolderResult( KMFolder*, QValueList<Q_UINT32>,
                                         const KMSearchPattern*, bool ) ) );
       --mRemainingFolders;
+      mSearchCount += folder->count();
       folder->close();
       mOpenedFolders.remove( folder );
       if ( mRemainingFolders <= 0 )
@@ -940,18 +944,18 @@
       unsigned int count = mFoldersCurrentlyBeingSearched[folder];
       mFoldersCurrentlyBeingSearched.replace( folder, count+1 );
     } else {
-      connect( folder->storage(), 
+      connect( folder->storage(),
               SIGNAL( searchDone( KMFolder*, Q_UINT32, const KMSearchPattern*, bool ) ),
               this,
-              SLOT( slotSearchExamineMsgDone( KMFolder*, Q_UINT32, 
+              SLOT( slotSearchExamineMsgDone( KMFolder*, Q_UINT32,
                       const KMSearchPattern*, bool ) ) );
       mFoldersCurrentlyBeingSearched.insert( folder, 1 );
     }
     folder->storage()->search( search()->searchPattern(), serNum );
 }
 
-void KMFolderSearch::slotSearchExamineMsgDone( KMFolder* folder, 
-                                               Q_UINT32 serNum, 
+void KMFolderSearch::slotSearchExamineMsgDone( KMFolder* folder,
+                                               Q_UINT32 serNum,
                                                const KMSearchPattern* pattern,
                                                bool matches )
 {
@@ -1103,10 +1107,10 @@
       unsigned int count = mFoldersCurrentlyBeingSearched[aFolder];
       mFoldersCurrentlyBeingSearched.replace( aFolder, count+1 );
     } else {
-      connect( aFolder->storage(), 
+      connect( aFolder->storage(),
               SIGNAL( searchDone( KMFolder*, Q_UINT32, const KMSearchPattern*, bool ) ),
               this,
-              SLOT( slotSearchExamineMsgDone( KMFolder*, Q_UINT32, 
+              SLOT( slotSearchExamineMsgDone( KMFolder*, Q_UINT32,
                       const KMSearchPattern*, bool ) ) );
       mFoldersCurrentlyBeingSearched.insert( aFolder, 1 );
     }
Index: kmail/kmfilterdlg.h
===================================================================
--- kmail/kmfilterdlg.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmfilterdlg.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -124,12 +124,18 @@
   /** Called when the user clicks the 'Delete' button. Deletes the
       current filter. */
   void slotDelete();
+  /** Called when the user clicks the 'Top' button. Moves the current
+      filter to the top line. */
+  void slotTop();
   /** Called when the user clicks the 'Up' button. Moves the current
       filter up one line. */
   void slotUp();
   /** Called when the user clicks the 'Down' button. Moves the current
       filter down one line. */
   void slotDown();
+  /** Called when the user clicks the 'Bottom' button. Moves the current
+      filter to the bottom line. */
+  void slotBottom();
   /** Called when the user clicks the 'Rename' button. Pops up a
       dialog prompting to enter the new name. */
   void slotRename();
@@ -140,14 +146,16 @@
   /** The listbox displaying the filter list. */
   QListBox *mListBox;
   /** The various action buttons. */
-  QPushButton *mBtnNew, *mBtnCopy, *mBtnDelete, *mBtnUp, *mBtnDown, *mBtnRename;
+  QPushButton *mBtnNew, *mBtnCopy, *mBtnDelete, *mBtnRename;
+  QPushButton *mBtnTop, *mBtnUp, *mBtnDown, *mBtnBot;
   /** The index of the currently selected item. */
   int mIdxSelItem;
   bool mShowLater;
 private:
   void enableControls();
   void insertFilter( KMFilter* aFilter );
-  void swapNeighbouringFilters( int untouchedOne, int movedOne);
+  void swapFilters( int from, int to );
+  void swapNeighbouringFilters( int untouchedOne, int movedOne );
   bool bPopFilter;
 };
 
Index: kmail/dcopmail.desktop
===================================================================
--- kmail/dcopmail.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/dcopmail.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -15,6 +15,7 @@
 Comment[es]=Programa de correo con un interfaz DCOP
 Comment[et]=E-posti rakendus DCOP-liidesega
 Comment[eu]=DCOP interfazedun posta programa
+Comment[fa]=برنامۀ نامه با یک واسط DCOP
 Comment[fi]=Sähköpostisovellus DCOP-rajapinnalla
 Comment[fr]=Programme de messagerie avec une interface DCOP
 Comment[hi]=डीकॉप इंटरफेस सहित एक डाक प्रोग्राम
Index: kmail/kmmainwidget.h
===================================================================
--- kmail/kmmainwidget.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmmainwidget.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -112,8 +112,9 @@
   KAction *replyListAction() const { return mReplyListAction; }
   KActionMenu * replyMenu() const { return mReplyActionMenu; }
   KActionMenu *forwardMenu() const { return mForwardActionMenu; }
-  KAction *forwardAction() const { return mForwardAction; }
+  KAction *forwardInlineAction() const { return mForwardInlineAction; }
   KAction *forwardAttachedAction() const { return mForwardAttachedAction; }
+  KAction *forwardDigestAction() const { return mForwardDigestAction; }
   KAction *redirectAction() const { return mRedirectAction; }
   KAction *noQuoteReplyAction() const { return mNoQuoteReplyAction; }
   KActionMenu *filterMenu() const { return mFilterMenu; }
@@ -373,8 +374,9 @@
   void slotReplyAuthorToMsg();
   void slotReplyListToMsg();
   void slotReplyAllToMsg();
-  void slotForwardMsg();
+  void slotForwardInlineMsg();
   void slotForwardAttachedMsg();
+  void slotForwardDigestMsg();
   void slotRedirectMsg();
   void slotNoQuoteReplyToMsg();
   void slotSubjectFilter();
@@ -407,9 +409,10 @@
     *mSaveAttachmentsAction, *mOpenAction, *mViewSourceAction;
   // Composition actions
   KAction *mPrintAction, *mReplyAction, *mReplyAllAction, *mReplyAuthorAction,
-      *mReplyListAction,
-      *mForwardAction, *mForwardAttachedAction, *mRedirectAction,
-      *mNoQuoteReplyAction;
+    *mReplyListAction,
+    *mForwardInlineAction, *mForwardAttachedAction, *mForwardDigestAction,
+    *mRedirectAction,
+    *mNoQuoteReplyAction;
   KActionMenu *mReplyActionMenu;
   KActionMenu *mForwardActionMenu;
   // Filter actions
Index: kmail/kmmsgpartdlg.cpp
===================================================================
--- kmail/kmmsgpartdlg.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmmsgpartdlg.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -331,8 +331,8 @@
 
 
 
-KMMsgPartDialogCompat::KMMsgPartDialogCompat( const char *, bool readOnly)
-  : KMMsgPartDialog(), mMsgPart( 0 )
+KMMsgPartDialogCompat::KMMsgPartDialogCompat( QWidget * parent, const char *, bool readOnly)
+  : KMMsgPartDialog(QString::null, parent ), mMsgPart( 0 )
 {
   setShownEncodings( SevenBit|EightBit|QuotedPrintable|Base64 );
   if (readOnly)
Index: kmail/networkaccount.h
===================================================================
--- kmail/networkaccount.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/networkaccount.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -25,6 +25,8 @@
 #ifndef __KMAIL_NETWORKACCOUNT_H__
 #define __KMAIL_NETWORKACCOUNT_H__
 
+#include <qguardedptr.h>
+
 #include "kmaccount.h"
 
 #include "sieveconfig.h"
@@ -125,7 +127,7 @@
 
   protected:
     KMail::SieveConfig mSieveConfig;
-    KIO::Slave * mSlave;
+    QGuardedPtr<KIO::Slave> mSlave;
     QString mLogin, mPasswd, mAuth, mHost;
     unsigned short int mPort;
     bool mStorePasswd : 1;
Index: kmail/kmreadermainwin.h
===================================================================
--- kmail/kmreadermainwin.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmreadermainwin.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -38,15 +38,21 @@
 
   /** Copy selected messages to folder with corresponding to given menuid */
   void copySelectedToFolder( int menuId );
+  void slotTrashMsg();
   void slotPrintMsg();
   void slotReplyToMsg();
   void slotReplyAllToMsg();
   void slotReplyAuthorToMsg();
   void slotReplyListToMsg();
-  void slotForwardMsg();
+  void slotForwardInlineMsg();
   void slotForwardAttachedMsg();
+  void slotForwardDigestMsg();
   void slotRedirectMsg();
   void slotShowMsgSrc();
+  void slotMarkAll();
+  void slotCopy();
+  void slotFind();
+  void slotFindNext();
 
   void slotConfigChanged();
 
@@ -59,9 +65,9 @@
   KURL mUrl;
   QMap<int,KMFolder*> mMenuToFolder;
   // a few actions duplicated from kmmainwidget
-  KAction *mPrintAction, *mReplyAction, *mReplyAllAction, *mReplyAuthorAction,
-          *mReplyListAction, *mForwardAction,
-          *mForwardAttachedAction, *mRedirectAction,
+  KAction *mTrashAction, *mPrintAction, *mReplyAction, *mReplyAllAction, *mReplyAuthorAction,
+          *mReplyListAction, *mForwardInlineAction,
+          *mForwardAttachedAction, *mForwardDigestAction, *mRedirectAction,
           *mViewSourceAction;
   KActionMenu *mReplyActionMenu;
   KActionMenu *mForwardActionMenu;
Index: kmail/kmail_config_security.desktop
===================================================================
--- kmail/kmail_config_security.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmail_config_security.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -26,6 +26,7 @@
 Name[es]=Seguridad
 Name[et]=Turvalisus
 Name[eu]=Sekuritatea
+Name[fa]=امنیت
 Name[fi]=Turvallisuus
 Name[fr]=Sécurité
 Name[ga]=Slándáil
@@ -73,6 +74,7 @@
 Comment[es]=Opciones de seguridad y privacidad
 Comment[et]=Turvalisus- ja privaatsusseadistused
 Comment[eu]=Sekuritate & pribakortasun ezarpenak
+Comment[fa]=امنیت و تنظیمات محرمانگی‌
 Comment[fi]=Turvallisuus- ja yksityisyysasetukset
 Comment[fr]=Paramètres de sécurité et de confidentialité
 Comment[gl]=Opcións de Seguridade e Intimidade
@@ -117,6 +119,7 @@
 Keywords[es]=kmail,seguridad
 Keywords[et]=kmail,turvalisus
 Keywords[eu]=kmail,sekuritate
+Keywords[fa]=kmail،امنیت
 Keywords[fi]=kmail,turvallisuus
 Keywords[fr]=KMail,sécurité
 Keywords[ga]=kmail,slándáil
Index: kmail/kmail_config_accounts.desktop
===================================================================
--- kmail/kmail_config_accounts.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmail_config_accounts.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -26,6 +26,7 @@
 Name[es]=Cuentas
 Name[et]=Kontod
 Name[eu]=Kontuak
+Name[fa]=حسابها
 Name[fi]=Tilit
 Name[fr]=Comptes
 Name[ga]=Cuntais
@@ -70,6 +71,7 @@
 Comment[es]=Configuración para enviar y recibir mensajes
 Comment[et]=Kirjade saatmise ja saamise seadistused
 Comment[eu]=Mezuak bidali eta jasotzeko konfigurazioa
+Comment[fa]=برپایی برای ارسال و دریافت پیامها
 Comment[fi]=Viestien lähetys- ja vastaanottoasetukset
 Comment[fr]=Configuration de l'envoi et de la réception de messages
 Comment[hu]=Küldési és fogadási beállítások
@@ -110,6 +112,7 @@
 Keywords[es]=kmail,cuentas
 Keywords[et]=kmail,kontod
 Keywords[eu]=kmail,kontuak
+Keywords[fa]=kmail،حسابها
 Keywords[fi]=kmail,tilit
 Keywords[fr]=KMail,comptes
 Keywords[ga]=kmail,cuntais
Index: kmail/kmsender.cpp
===================================================================
--- kmail/kmsender.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmsender.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -173,7 +173,7 @@
   }
 
   //Ensure the message is correctly and fully parsed
-  
+
   /* The above was added by Marc and seems to be necessary to ensure
    * the mail is in a sane state before sending. The unGet makes the
    * attached unencrypted version of the mail (if there is one ) disappear.
@@ -331,10 +331,10 @@
         imapSentFolder =
           kmkernel->imapFolderMgr()->findIdString( mCurrentMsg->fcc() );
     }
-    // No, or no usable sentFolder, and no, or no usable imapSentFolder, 
+    // No, or no usable sentFolder, and no, or no usable imapSentFolder,
     // let's try the on in the identity
     if ( ( sentFolder == 0 || sentFolder->isReadOnly() )
-      && ( imapSentFolder == 0 || imapSentFolder->isReadOnly() ) 
+      && ( imapSentFolder == 0 || imapSentFolder->isReadOnly() )
       && !id.fcc().isEmpty() )
     {
       sentFolder = kmkernel->folderMgr()->findIdString( id.fcc() );
@@ -600,7 +600,7 @@
   QStringList to, cc, bcc;
   QString sender;
   extractSenderToCCAndBcc( mCurrentMsg, &sender, &to, &cc, &bcc );
-  
+
   // MDNs are required to have an empty envelope from as per RFC2298.
   if ( messageIsDispositionNotificationReport( mCurrentMsg ) && GlobalSettings::self()->sendMDNsWithEmptySender() )
     sender = "<>";
@@ -1052,13 +1052,15 @@
   QString query = "headers=0&from=";
   query += KURL::encode_string( sender );
 
-  if ( !to.empty() )
-    query += "&to=" + to.join( "&to=" );
-  if ( !cc.empty() )
-    query += "&cc=" + cc.join( "&cc=" );
-  if ( !bcc.empty() )
-    query += "&bcc=" + bcc.join( "&bcc=" );
+  QStringList::ConstIterator it;
 
+  for ( it = to.begin(); it != to.end(); ++it )
+    query += "&to=" + KURL::encode_string(*it);
+  for ( it = cc.begin(); it != cc.end(); ++it )
+    query += "&cc=" + KURL::encode_string(*it);
+  for ( it = bcc.begin(); it != bcc.end(); ++it )
+    query += "&bcc=" + KURL::encode_string(*it);
+
   KMTransportInfo * ti = mSender->transportInfo();
 
   if ( ti->specifyHostname )
Index: kmail/kmversion.h
===================================================================
--- kmail/kmversion.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmail/kmversion.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -3,6 +3,6 @@
 #ifndef kmversion_h
 #define kmversion_h
 
-#define KMAIL_VERSION "1.9.4"
+#define KMAIL_VERSION "1.9.5"
 
 #endif /*kmversion_h*/
Index: networkstatus/networkstatus.desktop
===================================================================
--- networkstatus/networkstatus.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ networkstatus/networkstatus.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[es]=Daemon de estado de la red
 Name[et]=Võrguoleku deemon
 Name[eu]=Sarearen egoera deabrua
+Name[fa]=شبح وضعیت شبکه‌
 Name[fi]=Verkkotilan tarkkailija
 Name[fr]=Suivi de l'état du réseau
 Name[hu]=Hálózati állapotjelző szolgáltatás
@@ -47,6 +48,7 @@
 Comment[es]=Sigue la pista de las interfaces de red y proporciona notificaciones a las aplicaciones que están usando la red.
 Comment[et]=Jälgib võrguliideste olekut ja annab sellest võrgu vahendusel rakendustele teada.
 Comment[eu]=Sare interfazeen egoera jarraitzen du eta sarea darabilten aplikazioei jakinarazten die.
+Comment[fa]=وضعیت واسطهای شبکه را شیار داده و با استفاده از شبکه، برای کاربردها اخطار فراهم می‌کند.
 Comment[fi]=Tarkkailee verkkoliitäntöjen tilaa ja varoittaa verkkoa käyttäviä sovelluksia.
 Comment[fr]=Surveille l'état des interfaces réseaux et fournit des notifications aux applications qui utilisent le réseau
 Comment[hu]=Figyeli a hálózati csatolók állapotát és értesítési lehetőséget biztosít hálózati alkalmazások számára.
Index: indexlib/leafdata.cpp
===================================================================
--- indexlib/leafdata.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ indexlib/leafdata.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -117,6 +117,15 @@
 		unsigned nbytes = end().raw() - first.raw();
 		std::memmove( const_cast<unsigned char*>( first.raw() ), next.raw(), nbytes );
 		set_usedbytes( usedbytes() - nbytes );
+		unsigned char* iter = const_cast<unsigned char*>( first.raw() );
+		for ( ; iter < end().raw(); ++iter) {
+			if (*iter) --*iter;
+			else {
+				++iter;
+				byte_io::write<uint32_t>(iter,byte_io::read<uint32_t>(iter)-1);
+				iter += byte_io::byte_lenght<uint32_t>();
+			}
+		}
 	}
 }
 
Index: indexlib/memreference.h
===================================================================
--- indexlib/memreference.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ indexlib/memreference.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -85,12 +85,24 @@
 }
 
 template <typename T>
+memory_reference<T> operator --( memory_reference<T> ref ) {
+	return ref = ref - 1;
+}
+
+template <typename T>
 T operator ++( memory_reference<T> ref, int ) {
 	T v = ref;
 	ref = ref + 1;
 	return v;
 }
 
+template <typename T>
+T operator --( memory_reference<T> ref, int ) {
+	T v = ref;
+	ref = ref - 1;
+	return v;
+}
+
 template <typename T, typename U>
 memory_reference<T> operator -= ( memory_reference<T> ref, U v ) {
 	return ref = ref - v;
Index: indexlib/tests/stringarray-test.cpp
===================================================================
--- indexlib/tests/stringarray-test.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ indexlib/tests/stringarray-test.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -12,17 +12,16 @@
 }
 
 void test_size() {
-	cleanup();
 	stringarray test( fname );
 	test.add( "one" );
 	test.add( "one" );
 	test.add( "one" );
 	test.add( "one" );
 	//BOOST_CHECK_EQUAL( test.size(), 4 );
+	cleanup();
 }
 
 void test_put_recover() {
-	cleanup();
 	stringarray test( fname );
 	BOOST_CHECK_EQUAL( test.add( "one" ), 0 );
 	BOOST_CHECK_EQUAL( test.add( "two" ), 1 );
@@ -34,10 +33,10 @@
 	BOOST_CHECK_EQUAL( test.get( 2 ), "three" );
 	BOOST_CHECK_EQUAL( test.get( 3 ), "four" );
 
+	cleanup();
 }
 
 void test_persistent() {
-	cleanup();
 	{
 		stringarray test( fname );
 		BOOST_CHECK_EQUAL( test.add( "one" ), 0 );
@@ -55,10 +54,10 @@
 		BOOST_CHECK_EQUAL( test.get( 3 ), "four" );
 
 	}
+	cleanup();
 }
 
 void cstr() {
-	cleanup();
 	stringarray test( fname );
 
 	test.add( "one" );
@@ -72,10 +71,10 @@
 	BOOST_CHECK( !strcmp( test.get_cstr( 2 ), "three" ) );
 	BOOST_CHECK( !strcmp( test.get_cstr( 3 ), "four" ) );
 
+	cleanup();
 }
 
 void erase() {
-	cleanup();
 	stringarray test( fname );
 
 	test.add( "one" );
@@ -87,8 +86,10 @@
 	BOOST_CHECK_EQUAL( test.get( 0 ), "one" );
 	BOOST_CHECK_EQUAL( test.get( 1 ), "three" );
 	BOOST_CHECK_EQUAL( test.size(), 3u );
+	cleanup();
 }
 
+
 test_suite* get_suite() {
 	test_suite* test = BOOST_TEST_SUITE( "Memvector tests" );
 	test->add( BOOST_TEST_CASE( &test_size ) );
Index: indexlib/tests/ifile-test.cpp
===================================================================
--- indexlib/tests/ifile-test.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ indexlib/tests/ifile-test.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,15 +1,34 @@
 #include <boost/test/unit_test.hpp>
 #include "ifile.h"
+#include <string>
+#include <stdarg.h>
 
 using namespace ::boost::unit_test;
 namespace ifile_test {
-using indexlib::detail::ifile;
+//using indexlib::detail::ifile;
 const char* fname = "ifile-test-delete-me";
 void cleanup() {
 	ifile::remove( fname );
 }
 
 inline
+bool check_results( const ifile& ifi, const char* str, ... ) {
+	const char* s;
+	va_list args;
+	va_start( args, str );
+	std::vector<unsigned> res = ifi.search( str )->list();
+	unsigned i = 0;
+
+	while ( s = va_arg( args, const char* ) ) {
+		if ( i == res.size() ) return false;
+		if ( std::string( s ) != ifi.lookup_docname( res[ i++ ] ) ) return false;
+	}
+	va_end( args );
+	return i == res.size();
+}
+
+
+inline
 unsigned count_results( const ifile& ifi, const char* str ) {
 	return ifi.search( str )->list().size();
 }
@@ -107,14 +126,29 @@
 	BOOST_CHECK_EQUAL( count_results( ifi, "something two" ), 2u );
 }
 
+void remove_doc() {
+	cleanup();
+	ifile ifi( fname );
+	ifi.add( "one two three four", "0" );
+	ifi.add( "two three four", "1" );
+	ifi.add( "three four five", "2" );
+	ifi.remove_doc( "1" );
+
+	BOOST_CHECK( check_results( ifi, "one", "0", NULL ) );
+	BOOST_CHECK( check_results( ifi, "two", "0", NULL ) );
+	BOOST_CHECK( check_results( ifi, "three", "0", "2", NULL ) );
+	BOOST_CHECK_EQUAL( count_results( ifi, "four" ), 0u );
+}
+
 test_suite* get_suite() {
 	test_suite* test = BOOST_TEST_SUITE( "Ifile tests" );
 	test->add( BOOST_TEST_CASE( &simple ) );
 	test->add( BOOST_TEST_CASE( &ndocs ) );
 	test->add( BOOST_TEST_CASE( &space ) );
-	test->add( BOOST_TEST_CASE( &numbers ) );
+	//test->add( BOOST_TEST_CASE( &numbers ) );
 	test->add( BOOST_TEST_CASE( &partial ) );
 	test->add( BOOST_TEST_CASE( &several ) );
+	test->add( BOOST_TEST_CASE( &remove) );
 	return test;
 }
 
Index: knode/knode_config_identity.desktop
===================================================================
--- knode/knode_config_identity.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ knode/knode_config_identity.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -25,6 +25,7 @@
 Name[es]=Identidad
 Name[et]=Identiteet
 Name[eu]=Identitatea
+Name[fa]=هویت‌
 Name[fi]=Henkilöllisyys
 Name[fr]=Identité
 Name[ga]=Aitheantas
@@ -72,6 +73,7 @@
 Comment[es]=Información personal
 Comment[et]=Personaalne info
 Comment[eu]=Informazio pertsonala
+Comment[fa]=اطلاعات شخصی
 Comment[fi]=Omat tiedot
 Comment[fr]=Informations personnelles
 Comment[ga]=Eolas Pearsanta
Index: knode/knode_config_accounts.desktop
===================================================================
--- knode/knode_config_accounts.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ knode/knode_config_accounts.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -26,6 +26,7 @@
 Name[es]=Cuentas
 Name[et]=Kontod
 Name[eu]=Kontuak
+Name[fa]=حسابها
 Name[fi]=Tilit
 Name[fr]=Comptes
 Name[ga]=Cuntais
@@ -70,6 +71,7 @@
 Comment[es]=Configuración de los servidores de grupos de noticias y de correo
 Comment[et]=Uudiste- ja e-posti serverite seadistus
 Comment[eu]=Berri-talde eta posta zerbitzarien konfigurazioa
+Comment[fa]=برپایی برای کارسازهای نامه و  Newsgroup
 Comment[fi]=Uutisryhmien ja sähköpostipalvelinten asetukset
 Comment[fr]=Configuration les serveurs de messagerie et de groupes de discussion
 Comment[gl]=Configuración para Servidores de Correo e Novas
Index: knode/articlewidget.cpp
===================================================================
--- knode/articlewidget.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ knode/articlewidget.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1421,7 +1421,7 @@
 
 void ArticleWidget::slotOpenInAddressBook()
 {
-  KAddrBookExternal::openEmail( mCurrentURL.path(), mCurrentURL.path(), this );
+  KAddrBookExternal::openEmail( mCurrentURL.path(), this );
 }
 
 void ArticleWidget::slotOpenAttachment()
Index: knode/knode_config_read_news.desktop
===================================================================
--- knode/knode_config_read_news.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ knode/knode_config_read_news.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -24,6 +24,7 @@
 Name[es]=Leer noticias
 Name[et]=Uudiste lugemine
 Name[eu]=Berrien irakurketa
+Name[fa]=خواندن اخبار
 Name[fi]=Uutisryhmien lukeminen
 Name[fr]=Lecture de nouvelles
 Name[gl]=Ler Noticias
Index: knode/knode_config_privacy.desktop
===================================================================
--- knode/knode_config_privacy.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ knode/knode_config_privacy.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -23,6 +23,7 @@
 Name[es]=Firmar/Verificar
 Name[et]=Signeerimine/kontroll
 Name[eu]=Sinadura/Egiaztapena
+Name[fa]=امضا/وارسی‌
 Name[fi]=Allekirjoittaminen/tarkistaminen
 Name[fr]=Signature/Vérification
 Name[gl]=Asinando/Verificando
@@ -64,6 +65,7 @@
 Comment[es]=Proteja su privacidad firmando y verificando sus envíos
 Comment[et]=Kaitseb sinu privaatsust postitusi signeerides ja konrollides
 Comment[eu]=Babestu zure pribakortasuna argitarapenak sinatu eta egiaztatuz
+Comment[fa]=حفظ محرمانگی خود با امضا و وارسی ارسالهای سریع
 Comment[fi]=Suojele yksityisyyttäsi allekirjoittamalla ja varmentamalla posti
 Comment[fr]=Protection de votre vie privée lors de la signature et vérification des envois
 Comment[hu]=Az adatok védelme az üzenetek elektronikus aláírásával, titkosításával
Index: knode/knode_config_cleanup.desktop
===================================================================
--- knode/knode_config_cleanup.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ knode/knode_config_cleanup.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -23,6 +23,7 @@
 Name[es]=Limpiar
 Name[et]=Puhastamine
 Name[eu]=Garbiketa
+Name[fa]=پاک‌سازی‌
 Name[fi]=Siivoaminen
 Name[fr]=Nettoyage
 Name[ga]=Glan
@@ -66,6 +67,7 @@
 Comment[es]=Preservar el espacio de disco
 Comment[et]=Kettaruumi eest hoolitsemine
 Comment[eu]=Diskaren espazioa mantendu
+Comment[fa]=حفظ فضای دیسک
 Comment[fi]=Kiintolevytilan säästäminen
 Comment[fr]=Préservation de l'espace disque
 Comment[gl]=Preservar Espacio en Disco
Index: knode/knode_config_appearance.desktop
===================================================================
--- knode/knode_config_appearance.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ knode/knode_config_appearance.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -26,6 +26,7 @@
 Name[es]=Apariencia
 Name[et]=Välimus
 Name[eu]=Itxura
+Name[fa]=ظاهر
 Name[fi]=Ulkoasu
 Name[fr]=Apparence
 Name[ga]=Cuma
@@ -74,6 +75,7 @@
 Comment[es]=Apariencia visual personalizada
 Comment[et]=Välimuse seadistused
 Comment[eu]=Pertsonalizatu itxura
+Comment[fa]=سفارشی کردن ظاهر تصویری‌
 Comment[fi]=Ulkonäköasetukset
 Comment[fr]=Personnalisation de l'apparence
 Comment[gl]=Personalizar a apariencia visual
Index: knode/knode_config_post_news.desktop
===================================================================
--- knode/knode_config_post_news.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ knode/knode_config_post_news.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -23,6 +23,7 @@
 Name[es]=Enviar noticias
 Name[et]=Uudiste postitamine
 Name[eu]=Berrien argitaratzea
+Name[fa]=ارسال سریع اخبار
 Name[fi]=Viestien lähettäminen
 Name[fr]=Postage de nouvelles
 Name[gl]=Publicando Noticias
Index: knode/KNode.desktop
===================================================================
--- knode/KNode.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ knode/KNode.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Name[sv]=Knode
 Name[ta]=Kநோடு
 Name[th]=อ่านข่าว - K
+Name[zh_TW]=KNode 新聞閱讀器
 GenericName=News Reader
 GenericName[ar]=قارئ أخبار
 GenericName[az]=Xəbər Oxuyucu
@@ -29,6 +30,7 @@
 GenericName[es]=Lector de noticias
 GenericName[et]=Uudistelugeja
 GenericName[eu]=Berri Irakurlea
+GenericName[fa]=خوانندۀ اخبار
 GenericName[fi]=Uutisryhmien lukuohjelma
 GenericName[fr]=Lecteur de forums de discussion
 GenericName[ga]=Léitheoir Nuachta
Index: kioslaves/imap4/imap4.cc
===================================================================
--- kioslaves/imap4/imap4.cc	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kioslaves/imap4/imap4.cc	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -152,7 +152,7 @@
 #ifdef HAVE_LIBSASL2
   sasl_done();
 #endif
-  
+
   return 0;
 }
 
@@ -747,7 +747,7 @@
       }
 
       readBufferLen -= copyLen;
-      if (readBufferLen) 
+      if (readBufferLen)
         memmove(readBuffer, &readBuffer[copyLen], readBufferLen);
       if (buffer[buffer.size() - 1] == '\n') return TRUE;
     }
@@ -945,10 +945,10 @@
   if (type == ITYPE_BOX)
   {
     bool ask = ( aInfo.find( "ASKUSER" ) != -1 );
-    if ( ask && 
+    if ( ask &&
         messageBox(QuestionYesNo,
           i18n("The following folder will be created on the server: %1 "
-               "What do you want to store in this folder?").arg( aBox ), 
+               "What do you want to store in this folder?").arg( aBox ),
           i18n("Create Folder"),
           i18n("&Messages"), i18n("&Subfolders")) == KMessageBox::No )
     {
@@ -1212,7 +1212,7 @@
  * No-op: data = 'N'
  * Namespace: data = 'n'. Result shipped in infoMessage() signal
  *                        The format is: section=namespace=delimiter
- *                        Note that the namespace can be empty               
+ *                        Note that the namespace can be empty
  * Unsubscribe: data = 'U' + URL (KURL)
  * Subscribe: data = 'u' + URL (KURL)
  * Change the status: data = 'S' + URL (KURL) + Flags (QCString)
@@ -1264,7 +1264,7 @@
     break;
   }
   case 'n':
-  { 
+  {
     // namespace in the form "section=namespace=delimiter"
     // entries are separated by ,
     infoMessage( imapNamespaces.join(",") );
@@ -1313,7 +1313,7 @@
     finished();
     break;
   }
-  case 'A': 
+  case 'A':
   {
     // acl
     int cmd;
@@ -1325,7 +1325,7 @@
     }
     break;
   }
-  case 'M': 
+  case 'M':
   {
     // annotatemore
     int cmd;
@@ -1337,7 +1337,7 @@
     }
     break;
   }
-  case 'S': 
+  case 'S':
   {
     // status
     KURL _url;
@@ -1374,7 +1374,7 @@
     finished();
     break;
   }
-  case 'E': 
+  case 'E':
   {
     // search
     specialSearchCommand( stream );
@@ -1665,7 +1665,7 @@
   QString aBox, aSequence, aLType, aSection, aValidity, aDelimiter, aInfo;
   // parseURL with caching
   enum IMAP_TYPE aType =
-    parseURL (_url, aBox, aSection, aLType, aSequence, aValidity, aDelimiter, 
+    parseURL (_url, aBox, aSection, aLType, aSequence, aValidity, aDelimiter,
         aInfo, true);
 
   UDSEntry entry;
@@ -1924,16 +1924,23 @@
       } else completeQueue.removeRef(cmd);
     }
 
-    if (!myAuth.isEmpty () && myAuth != "*"
-        && !hasCapability (QString ("AUTH=") + myAuth))
-    {
-      error (ERR_COULD_NOT_LOGIN, i18n("The authentication method %1 is not "
-        "supported by the server.").arg(myAuth));
-      closeConnection();
-      return false;
+    if (myAuth.isEmpty () || myAuth == "*") {
+      if (hasCapability (QString ("LOGINDISABLED"))) {
+        error (ERR_COULD_NOT_LOGIN, i18n("LOGIN is disabled by the server."));
+        closeConnection();
+        return false;
+      }
     }
+    else {
+      if (!hasCapability (QString ("AUTH=") + myAuth)) {
+        error (ERR_COULD_NOT_LOGIN, i18n("The authentication method %1 is not "
+          "supported by the server.").arg(myAuth));
+        closeConnection();
+        return false;
+      }
+    }
 
-    if (  greeting.contains(  QRegExp(  "Cyrus IMAP4 v2.1" ) ) ) {
+    if ( greeting.contains(  QRegExp(  "Cyrus IMAP4 v2.1" ) ) ) {
       removeCapability( "ANNOTATEMORE" );
     }
 
@@ -1961,7 +1968,7 @@
     }
     else
     {
-#ifdef HAVE_LIBSASL2      
+#ifdef HAVE_LIBSASL2
       if (!clientAuthenticate (this, authInfo, myHost, myAuth, mySSL, resultInfo))
         error(KIO::ERR_COULD_NOT_LOGIN, i18n("Unable to authenticate via %1.\n"
 	"The server %2 replied:\n%3").arg(myAuth).arg(myHost).arg(resultInfo));
@@ -2002,12 +2009,12 @@
       if ( it != listResponses.end() )
       {
         namespaceToDelimiter[QString::null] = (*it).hierarchyDelimiter();
-        kdDebug(7116) << "makeLogin - delimiter for empty ns='" << 
+        kdDebug(7116) << "makeLogin - delimiter for empty ns='" <<
           (*it).hierarchyDelimiter() << "'" << endl;
         if ( !hasCapability("NAMESPACE") )
         {
           // server does not support namespaces
-          QString nsentry = QString::number( 0 ) + "==" 
+          QString nsentry = QString::number( 0 ) + "=="
             + (*it).hierarchyDelimiter();
           imapNamespaces.append( nsentry );
         }
@@ -2336,7 +2343,7 @@
               }
             }
             // if we got no list response for the box see if it's a prefix
-            if ( retVal == ITYPE_UNKNOWN && 
+            if ( retVal == ITYPE_UNKNOWN &&
                  namespaceToDelimiter.contains(_box) ) {
               retVal = ITYPE_DIR;
             }
@@ -2354,7 +2361,7 @@
     else
       kdDebug(7116) << "IMAP4::parseURL: no login!" << endl;
 
-  } 
+  }
   else // empty box
   {
     // the root is just a dir
@@ -2383,7 +2390,7 @@
   if ( _hierarchyDelimiter.isEmpty() &&
        (_type == "LIST" || _type == "LSUB" || _type == "LSUBNOCHECK") )
   {
-    // this shouldn't happen but when the delimiter is really empty 
+    // this shouldn't happen but when the delimiter is really empty
     // we try to reconstruct it from the URL
     if (!_box.isEmpty())
     {
Index: kioslaves/sieve/sieve.protocol
===================================================================
--- kioslaves/sieve/sieve.protocol	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kioslaves/sieve/sieve.protocol	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -20,6 +20,7 @@
 Description[es]=Un ioslave para el protocolo de filtrado de correo Sieve
 Description[et]=Sieve e-kirjade filtreerimise protokolli IO-moodul
 Description[eu]=Sieve posta iragazketa protokoloarentztko  irteerako/sarrerako mendeko bat
+Description[fa]=یک  ioslave برای قرارداد پالایش نامۀ Sieve
 Description[fi]=Siirräntätyöskentelijä Sieve-sähköpostiensuodatusyhteyskäytännölle
 Description[fr]=Un ioslave pour le protocole de filtrage de messagerie Sieve
 Description[hu]=KDE-protokoll a Sieve levélszűrő protokollhoz
Index: doc/kmail/menus.docbook
===================================================================
--- doc/kmail/menus.docbook	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ doc/kmail/menus.docbook	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -926,16 +926,24 @@
 </menuchoice>
 </term>
 <listitem>
-<para>Forwards the message to a new recipient. Using <guimenuitem>Inline</guimenuitem>,
-the message's text and some important header fields will be copied to the body of the new message
-with a text marking the forwarded part. Attachments will be forwarded
-as attachments of the new message. Using <guimenuitem>As Attachment</guimenuitem>
-the message and its attachments will become an attachment of the new message. The original message
-headers will be included in the forwarded message, too.
-<guimenuitem>Redirect</guimenuitem> works like forward, except that the message stays the same (even
-the <guilabel>From:</guilabel> field). The user who redirected the message is added in special
-header fields (<literal>Redirect-From</literal>, <literal>Redirect-Date</literal>, <literal>Redirect-To</literal>,
-&etc;).</para>
+<para>Forwards the message to a new recipient.
+Using <guimenuitem>As Attachment</guimenuitem> the message and its attachments
+will become an attachment of the new message. The original message headers will
+be included in the forwarded message, too.
+
+Using <guimenuitem>Inline</guimenuitem>, the message's text and some important
+header fields will be copied to the body of the new message with a text marking
+the forwarded part. Attachments will be forwarded as attachments of the new
+message.
+
+<guimenuitem>As Digest</guimenuitem> concatenates the messages together as a
+MIME digest attachment.
+
+<guimenuitem>Redirect</guimenuitem> works like forward, except that the message
+stays the same (even the <guilabel>From:</guilabel> field). The user who
+redirected the message is added in special header fields (<literal>Redirect-From</literal>,
+<literal>Redirect-Date</literal>, <literal>Redirect-To</literal>, &etc;).
+</para>
 </listitem>
 </varlistentry>
 
Index: kalarm/alarmevent.cpp
===================================================================
--- kalarm/alarmevent.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/alarmevent.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,7 +1,7 @@
 /*
  *  alarmevent.cpp  -  represents calendar alarms and events
  *  Program:  kalarm
- *  Copyright (c) 2001-2006 by David Jarvie <software@astrojar.org.uk>
+ *  Copyright © 2001-2006 by David Jarvie <software@astrojar.org.uk>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -40,6 +40,12 @@
 
 const QCString APPNAME("KALARM");
 
+// KAlarm version which first used the current calendar/event format.
+// If this changes, KAEvent::convertKCalEvents() must be changed correspondingly.
+// The string version is the KAlarm version string used in the calendar file.
+QString KAEvent::calVersionString()  { return QString::fromLatin1("1.3.1"); }
+int     KAEvent::calVersion()        { return KAlarm::Version(1,3,1); }
+
 // Custom calendar properties.
 // Note that all custom property names are prefixed with X-KDE-KALARM- in the calendar file.
 // - General alarm properties
@@ -71,6 +77,7 @@
 static const QString TEMPL_AFTER_TIME_CATEGORY = QString::fromLatin1("TMPLAFTTIME;");
 static const QString KMAIL_SERNUM_CATEGORY     = QString::fromLatin1("KMAIL:");
 static const QString KORGANIZER_CATEGORY       = QString::fromLatin1("KORG");
+static const QString DEFER_CATEGORY            = QString::fromLatin1("DEFER;");
 static const QString ARCHIVE_CATEGORY          = QString::fromLatin1("SAVE");
 static const QString ARCHIVE_CATEGORIES        = QString::fromLatin1("SAVE:");
 static const QString LOG_CATEGORY              = QString::fromLatin1("LOG:");
@@ -167,6 +174,7 @@
 	mDisplayingFlags         = event.mDisplayingFlags;
 	mReminderMinutes         = event.mReminderMinutes;
 	mArchiveReminderMinutes  = event.mArchiveReminderMinutes;
+	mDeferDefaultMinutes     = event.mDeferDefaultMinutes;
 	mRevision                = event.mRevision;
 	mRemainingRecurrences    = event.mRemainingRecurrences;
 	mAlarmCount              = event.mAlarmCount;
@@ -211,12 +219,14 @@
 	mAutoClose              = false;
 	mArchiveRepeatAtLogin   = false;
 	mArchiveReminderMinutes = 0;
+	mDeferDefaultMinutes    = 0;
 	mLateCancel             = 0;
 	mKMailSerialNumber      = 0;
 	mBgColour               = QColor(255, 255, 255);    // missing/invalid colour - return white background
 	mFgColour               = QColor(0, 0, 0);          // and black foreground
 	mDefaultFont            = true;
 	mEnabled                = true;
+	bool ok;
 	bool floats = false;
 	const QStringList& cats = event.categories();
 	for (unsigned int i = 0;  i < cats.count();  ++i)
@@ -273,23 +283,26 @@
 				}
 			}
 		}
+		else if (cats[i].startsWith(DEFER_CATEGORY))
+		{
+			mDeferDefaultMinutes = static_cast<int>(cats[i].mid(DEFER_CATEGORY.length()).toUInt(&ok));
+			if (!ok)
+				mDeferDefaultMinutes = 0;    // invalid parameter
+		}
 		else if (cats[i].startsWith(TEMPL_AFTER_TIME_CATEGORY))
 		{
-			bool ok;
 			mTemplateAfterTime = static_cast<int>(cats[i].mid(TEMPL_AFTER_TIME_CATEGORY.length()).toUInt(&ok));
 			if (!ok)
 				mTemplateAfterTime = -1;    // invalid parameter
 		}
 		else if (cats[i].startsWith(LATE_CANCEL_CATEGORY))
 		{
-			bool ok;
 			mLateCancel = static_cast<int>(cats[i].mid(LATE_CANCEL_CATEGORY.length()).toUInt(&ok));
 			if (!ok  ||  !mLateCancel)
 				mLateCancel = 1;    // invalid parameter defaults to 1 minute
 		}
 		else if (cats[i].startsWith(AUTO_CLOSE_CATEGORY))
 		{
-			bool ok;
 			mLateCancel = static_cast<int>(cats[i].mid(AUTO_CLOSE_CATEGORY.length()).toUInt(&ok));
 			if (!ok  ||  !mLateCancel)
 				mLateCancel = 1;    // invalid parameter defaults to 1 minute
@@ -694,6 +707,7 @@
 	mKMailSerialNumber      = 0;
 	mReminderMinutes        = 0;
 	mArchiveReminderMinutes = 0;
+	mDeferDefaultMinutes    = 0;
 	mRepeatInterval         = 0;
 	mRepeatCount            = 0;
 	mArchiveRepeatAtLogin   = false;
@@ -977,6 +991,8 @@
 		cats.append(LOG_CATEGORY + mLogFile);
 	if (mLateCancel)
 		cats.append(QString("%1%2").arg(mAutoClose ? AUTO_CLOSE_CATEGORY : LATE_CANCEL_CATEGORY).arg(mLateCancel));
+	if (mDeferDefaultMinutes)
+		cats.append(QString("%1%2").arg(DEFER_CATEGORY).arg(mDeferDefaultMinutes));
 	if (!mTemplateName.isEmpty()  &&  mTemplateAfterTime >= 0)
 		cats.append(QString("%1%2").arg(TEMPL_AFTER_TIME_CATEGORY).arg(mTemplateAfterTime));
 	if (mArchive  &&  !original)
@@ -2539,7 +2555,7 @@
 	// KAlarm pre-1.3.1 XTERM category
 	static const QString EXEC_IN_XTERM_CAT  = QString::fromLatin1("XTERM");
 
-	if (version >= KAlarm::Version(1,3,1))
+	if (version >= calVersion())
 		return;
 
 	kdDebug(5950) << "KAEvent::convertKCalEvents(): adjusting version " << version << endl;
@@ -2550,6 +2566,8 @@
 	bool pre_1_2_1 = (version < KAlarm::Version(1,2,1));
 	bool pre_1_3_0 = (version < KAlarm::Version(1,3,0));
 	bool pre_1_3_1 = (version < KAlarm::Version(1,3,1));
+	Q_ASSERT(calVersion() == KAlarm::Version(1,3,1));
+
 	QDateTime dt0(QDate(1970,1,1), QTime(0,0,0));
 	QTime startOfDay = Preferences::startOfDay();
 
@@ -2869,6 +2887,7 @@
 	}
 	else if (mDeferral == CANCEL_DEFERRAL)
 		kdDebug(5950) << "-- mDeferral:cancel:\n";
+	kdDebug(5950) << "-- mDeferDefaultMinutes:" << mDeferDefaultMinutes << ":\n";
 	if (mDisplaying)
 	{
 		kdDebug(5950) << "-- mDisplayingTime:" << mDisplayingTime.toString() << ":\n";
Index: kalarm/messagewin.cpp
===================================================================
--- kalarm/messagewin.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/messagewin.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -146,6 +146,7 @@
 	  mVolume(event.soundVolume()),
 	  mFadeVolume(event.fadeVolume()),
 	  mFadeSeconds(QMIN(event.fadeSeconds(), 86400)),
+	  mDefaultDeferMinutes(event.deferDefaultMinutes()),
 	  mAlarmType(alarm.type()),
 	  mAction(event.action()),
 	  mKMailSerialNumber(event.kmailSerialNumber()),
@@ -671,6 +672,7 @@
 #endif
 		config->writeEntry(QString::fromLatin1("Speak"), mSpeak);
 		config->writeEntry(QString::fromLatin1("Height"), height());
+		config->writeEntry(QString::fromLatin1("DeferMins"), mDefaultDeferMinutes);
 		config->writeEntry(QString::fromLatin1("NoDefer"), mNoDefer);
 		config->writeEntry(QString::fromLatin1("KMailSerial"), mKMailSerialNumber);
 	}
@@ -685,33 +687,34 @@
 */
 void MessageWin::readProperties(KConfig* config)
 {
-	mInvalid           = config->readBoolEntry(QString::fromLatin1("Invalid"), false);
-	mEventID           = config->readEntry(QString::fromLatin1("EventID"));
-	mAlarmType         = KAAlarm::Type(config->readNumEntry(QString::fromLatin1("AlarmType")));
-	mMessage           = config->readEntry(QString::fromLatin1("Message"));
-	mAction            = KAEvent::Action(config->readNumEntry(QString::fromLatin1("Type")));
-	mFont              = config->readFontEntry(QString::fromLatin1("Font"));
-	mBgColour          = config->readColorEntry(QString::fromLatin1("BgColour"));
-	mFgColour          = config->readColorEntry(QString::fromLatin1("FgColour"));
-	mConfirmAck        = config->readBoolEntry(QString::fromLatin1("ConfirmAck"));
+	mInvalid             = config->readBoolEntry(QString::fromLatin1("Invalid"), false);
+	mEventID             = config->readEntry(QString::fromLatin1("EventID"));
+	mAlarmType           = KAAlarm::Type(config->readNumEntry(QString::fromLatin1("AlarmType")));
+	mMessage             = config->readEntry(QString::fromLatin1("Message"));
+	mAction              = KAEvent::Action(config->readNumEntry(QString::fromLatin1("Type")));
+	mFont                = config->readFontEntry(QString::fromLatin1("Font"));
+	mBgColour            = config->readColorEntry(QString::fromLatin1("BgColour"));
+	mFgColour            = config->readColorEntry(QString::fromLatin1("FgColour"));
+	mConfirmAck          = config->readBoolEntry(QString::fromLatin1("ConfirmAck"));
 	QDateTime invalidDateTime;
-	QDateTime dt       = config->readDateTimeEntry(QString::fromLatin1("Time"), &invalidDateTime);
-	bool dateOnly      = config->readBoolEntry(QString::fromLatin1("DateOnly"));
+	QDateTime dt         = config->readDateTimeEntry(QString::fromLatin1("Time"), &invalidDateTime);
+	bool dateOnly        = config->readBoolEntry(QString::fromLatin1("DateOnly"));
 	mDateTime.set(dt, dateOnly);
-	mCloseTime         = config->readDateTimeEntry(QString::fromLatin1("Expiry"), &invalidDateTime);
+	mCloseTime           = config->readDateTimeEntry(QString::fromLatin1("Expiry"), &invalidDateTime);
 #ifndef WITHOUT_ARTS
-	mAudioFile         = config->readPathEntry(QString::fromLatin1("AudioFile"));
-	mVolume            = static_cast<float>(config->readNumEntry(QString::fromLatin1("Volume"))) / 100;
-	mFadeVolume        = -1;
-	mFadeSeconds       = 0;
+	mAudioFile           = config->readPathEntry(QString::fromLatin1("AudioFile"));
+	mVolume              = static_cast<float>(config->readNumEntry(QString::fromLatin1("Volume"))) / 100;
+	mFadeVolume          = -1;
+	mFadeSeconds         = 0;
 	if (!mAudioFile.isEmpty())
 		mAudioRepeat = true;
 #endif
-	mSpeak             = config->readBoolEntry(QString::fromLatin1("Speak"));
-	mRestoreHeight     = config->readNumEntry(QString::fromLatin1("Height"));
-	mNoDefer           = config->readBoolEntry(QString::fromLatin1("NoDefer"));
-	mKMailSerialNumber = config->readUnsignedLongNumEntry(QString::fromLatin1("KMailSerial"));
-	mShowEdit          = false;
+	mSpeak               = config->readBoolEntry(QString::fromLatin1("Speak"));
+	mRestoreHeight       = config->readNumEntry(QString::fromLatin1("Height"));
+	mDefaultDeferMinutes = config->readNumEntry(QString::fromLatin1("DeferMins"));
+	mNoDefer             = config->readBoolEntry(QString::fromLatin1("NoDefer"));
+	mKMailSerialNumber   = config->readUnsignedLongNumEntry(QString::fromLatin1("KMailSerial"));
+	mShowEdit            = false;
 	if (mAlarmType != KAAlarm::INVALID_ALARM)
 	{
 		// Recreate the event from the calendar file (if possible)
@@ -1505,18 +1508,22 @@
 {
 	mDeferDlg = new DeferAlarmDlg(i18n("Defer Alarm"), QDateTime::currentDateTime().addSecs(60),
 	                              false, this, "deferDlg");
+	if (mDefaultDeferMinutes > 0)
+		mDeferDlg->setDeferMinutes(mDefaultDeferMinutes);
 	mDeferDlg->setLimit(mEventID);
 	if (!Preferences::modalMessages())
 		lower();
 	if (mDeferDlg->exec() == QDialog::Accepted)
 	{
-		DateTime dateTime = mDeferDlg->getDateTime();
+		DateTime dateTime  = mDeferDlg->getDateTime();
+		int      delayMins = mDeferDlg->deferMinutes();
 		const Event* kcalEvent = mEventID.isNull() ? 0 : AlarmCalendar::activeCalendar()->event(mEventID);
 		if (kcalEvent)
 		{
 			// The event still exists in the calendar file.
 			KAEvent event(*kcalEvent);
 			bool repeat = event.defer(dateTime, (mAlarmType & KAAlarm::REMINDER_ALARM), true);
+			event.setDeferDefaultMinutes(delayMins);
 			KAlarm::updateEvent(event, 0, true, !repeat);
 		}
 		else
@@ -1536,6 +1543,7 @@
 				event.setArchive();
 				event.setEventID(mEventID);
 			}
+			event.setDeferDefaultMinutes(delayMins);
 			// Add the event back into the calendar file, retaining its ID
 			// and not updating KOrganizer
 			KAlarm::addEvent(event, 0, true, false);
Index: kalarm/editdlg.cpp
===================================================================
--- kalarm/editdlg.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/editdlg.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,7 +1,7 @@
 /*
  *  editdlg.cpp  -  dialogue to create or modify an alarm or alarm template
  *  Program:  kalarm
- *  Copyright (c) 2001-2006 by David Jarvie <software@astrojar.org.uk>
+ *  Copyright © 2001-2006 by David Jarvie <software@astrojar.org.uk>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -267,7 +267,7 @@
 	grid->setRowStretch(2, 1);
 	mAlarmTypeStack->addWidget(mDisplayAlarmsFrame, 0);
 	mAlarmTypeStack->addWidget(mCommandFrame, 1);
-	mAlarmTypeStack->addWidget(mEmailFrame, 1);
+	mAlarmTypeStack->addWidget(mEmailFrame, 2);
 
 	// Deferred date/time: visible only for a deferred recurring event.
 	mDeferGroup = new QGroupBox(1, Qt::Vertical, i18n("Deferred Alarm"), mainPage, "deferGroup");
@@ -367,6 +367,7 @@
 	      i18n("How often the alarm recurs.\nThe times shown are those configured in the Recurrence tab and in the Simple Repetition dialog."));
 	box->setFixedHeight(box->sizeHint().height());
 	layout->addWidget(box);
+	layout->addStretch();
 
 	// Simple repetition button
 	mSimpleRepetition = new RepetitionButton(i18n("Simple Repetition"), true, mainPage);
@@ -376,20 +377,28 @@
 	QWhatsThis::add(mSimpleRepetition, i18n("Set up a simple, or additional, alarm repetition"));
 	layout->addWidget(mSimpleRepetition);
 
+	// Reminder
+	static const QString reminderText = i18n("Enter how long in advance of the main alarm to display a reminder alarm.");
+	mReminder = new Reminder(i18n("Rem&inder:"),
+	                         i18n("Check to additionally display a reminder in advance of the main alarm time(s)."),
+	                         QString("%1\n\n%2").arg(reminderText).arg(TimeSpinBox::shiftWhatsThis()),
+	                         true, true, mainPage);
+	mReminder->setFixedSize(mReminder->sizeHint());
+	topLayout->addWidget(mReminder, 0, Qt::AlignAuto);
+
+	// Late cancel selector - default = allow late display
+	mLateCancel = new LateCancelSelector(true, mainPage);
+	topLayout->addWidget(mLateCancel, 0, Qt::AlignAuto);
+
 	if (theApp()->korganizerEnabled())
 	{
 		// Show in KOrganizer checkbox
 		mShowInKorganizer = new CheckBox(i18n_ShowInKOrganizer(), mainPage);
 		mShowInKorganizer->setFixedSize(mShowInKorganizer->sizeHint());
 		QWhatsThis::add(mShowInKorganizer, i18n("Check to copy the alarm into KOrganizer's calendar"));
-		layout->addWidget(mShowInKorganizer);
+		topLayout->addWidget(mShowInKorganizer);
 	}
-	layout->addStretch();
 
-	// Late cancel selector - default = allow late display
-	mLateCancel = new LateCancelSelector(true, mainPage);
-	topLayout->addWidget(mLateCancel, 0, Qt::AlignAuto);
-
 	setButtonWhatsThis(Ok, i18n("Schedule the alarm at the specified time."));
 
 	// Initialise the state of all controls according to the specified event, if any
@@ -463,15 +472,6 @@
 	mSoundPicker->setFixedSize(mSoundPicker->sizeHint());
 	frameLayout->addWidget(mSoundPicker, 0, Qt::AlignAuto);
 
-	// Reminder
-	static const QString reminderText = i18n("Enter how long in advance of the main alarm to display a reminder alarm.");
-	mReminder = new Reminder(i18n("Rem&inder:"),
-	                         i18n("Check to additionally display a reminder in advance of the main alarm time(s)."),
-	                         QString("%1\n\n%2").arg(reminderText).arg(TimeSpinBox::shiftWhatsThis()),
-	                         true, true, mDisplayAlarmsFrame);
-	mReminder->setFixedSize(mReminder->sizeHint());
-	frameLayout->addWidget(mReminder, 0, Qt::AlignAuto);
-
 	// Acknowledgement confirmation required - default = no confirmation
 	layout = new QHBoxLayout(frameLayout);
 	mConfirmAck = createConfirmAckCheckbox(mDisplayAlarmsFrame);
@@ -1060,7 +1060,7 @@
 		mSavedEmailAttach += mEmailAttachList->text(i);
 	mSavedEmailBcc         = mEmailBcc->isChecked();
 	if (mTimeWidget)
-		mSavedDateTime = mTimeWidget->getDateTime(false, false);
+		mSavedDateTime = mTimeWidget->getDateTime(0, false, false);
 	mSavedLateCancel       = mLateCancel->minutes();
 	mSavedAutoClose        = mLateCancel->isAutoClose();
 	if (mShowInKorganizer)
@@ -1094,7 +1094,7 @@
 			return true;
 	}
 	else
-		if (mSavedDateTime != mTimeWidget->getDateTime(false, false))
+		if (mSavedDateTime != mTimeWidget->getDateTime(0, false, false))
 			return true;
 	if (mSavedTypeRadio        != mActionGroup->selected()
 	||  mSavedLateCancel       != mLateCancel->minutes()
@@ -1403,7 +1403,7 @@
 	else
 	{
 		QWidget* errWidget;
-		mAlarmDateTime = mTimeWidget->getDateTime(!(timedRecurrence || repeated), false, &errWidget);
+		mAlarmDateTime = mTimeWidget->getDateTime(0, !(timedRecurrence || repeated), false, &errWidget);
 		if (errWidget)
 		{
 			// It's more than just an existing deferral being changed, so the time matters
@@ -1573,7 +1573,7 @@
 		return;
 	bool limit = true;
 	int repeatCount = mSimpleRepetition->count();
-	DateTime start = mTimeWidget->getDateTime(!repeatCount, !mExpiredRecurrence);
+	DateTime start = mTimeWidget->getDateTime(0, !repeatCount, !mExpiredRecurrence);
 	if (!start.isValid())
 	{
 		if (!mExpiredRecurrence)
@@ -1655,7 +1655,7 @@
 	if (!mReadOnly  &&  !mTemplate)
 	{
 		QDateTime now = QDateTime::currentDateTime();
-		mAlarmDateTime = mTimeWidget->getDateTime(false, false);
+		mAlarmDateTime = mTimeWidget->getDateTime(0, false, false);
 		bool expired = (mAlarmDateTime.dateTime() < now);
 		if (mRecurSetDefaultEndDate)
 		{
@@ -1684,7 +1684,7 @@
 		bool atLogin = (mRecurrenceEdit->repeatType() == RecurrenceEdit::AT_LOGIN);
 		if (atLogin)
 		{
-			mAlarmDateTime = mTimeWidget->getDateTime(false, false);
+			mAlarmDateTime = mTimeWidget->getDateTime(0, false, false);
 			mRecurrenceEdit->setEndDateTime(mAlarmDateTime.dateTime());
 		}
 		mReminder->enableOnceOnly(recurs && !atLogin);
@@ -1832,6 +1832,7 @@
 		mFilePadding->hide();
 		mTextMessageEdit->show();
 		mFontColourButton->show();
+		mReminder->show();
 		mSoundPicker->showSpeak(true);
 		setButtonWhatsThis(Try, i18n("Display the alarm message now"));
 		mAlarmTypeStack->raiseWidget(mDisplayAlarmsFrame);
@@ -1844,6 +1845,7 @@
 		mFileBox->show();
 		mFilePadding->show();
 		mFontColourButton->hide();
+		mReminder->show();
 		mSoundPicker->showSpeak(false);
 		setButtonWhatsThis(Try, i18n("Display the file now"));
 		mAlarmTypeStack->raiseWidget(mDisplayAlarmsFrame);
@@ -1853,6 +1855,7 @@
 	}
 	else if (mCommandRadio->isOn())
 	{
+		mReminder->hide();
 		setButtonWhatsThis(Try, i18n("Execute the specified command now"));
 		mAlarmTypeStack->raiseWidget(mCommandFrame);
 		mCmdCommandEdit->setNoSelect();
@@ -1860,6 +1863,7 @@
 	}
 	else if (mEmailRadio->isOn())
 	{
+		mReminder->hide();
 		setButtonWhatsThis(Try, i18n("Send the email to the specified addressees now"));
 		mAlarmTypeStack->raiseWidget(mEmailFrame);
 		mEmailToEdit->setNoSelect();
Index: kalarm/functions.h
===================================================================
--- kalarm/functions.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/functions.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,7 +1,7 @@
 /*
  *  functions.h  -  miscellaneous functions
  *  Program:  kalarm
- *  Copyright Â© 2004-2006 by David Jarvie <software@astrojar.org.uk>
+ *  Copyright © 2004-2006 by David Jarvie <software@astrojar.org.uk>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -63,8 +63,13 @@
  *  If a text file, its type is distinguished.
  */
 FileType            fileType(const QString& mimetype);
+/** Return current KAlarm version number */
+int                 Version();
 inline int          Version(int major, int minor, int rev)     { return major*10000 + minor*100 + rev; }
 int                 getVersionNumber(const QString& version, QString* subVersion = 0);
+/** Return which version of KAlarm was the first to use the current calendar/event format */
+inline int          currentCalendarVersion()        { return KAEvent::calVersion(); }
+inline QString      currentCalendarVersionString()  { return KAEvent::calVersionString(); }
 QString             browseFile(const QString& caption, QString& defaultDir, const QString& initialFile = QString::null,
                                const QString& filter = QString::null, int mode = 0, QWidget* parent = 0, const char* name = 0);
 bool                edit(const QString& eventID);
Index: kalarm/deferdlg.h
===================================================================
--- kalarm/deferdlg.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/deferdlg.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,7 +1,7 @@
 /*
  *  deferdlg.h  -  dialogue to defer an alarm
  *  Program:  kalarm
- *  Copyright (C) 2002 - 2004 by David Jarvie <software@astrojar.org.uk>
+ *  Copyright © 2002-2004,2006 by David Jarvie <software@astrojar.org.uk>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -35,7 +35,9 @@
 		              bool cancelButton, QWidget* parent = 0, const char* name = 0);
 		void             setLimit(const DateTime&);
 		DateTime         setLimit(const QString& eventID);
-		const DateTime&  getDateTime() const  { return mAlarmDateTime; }
+		const DateTime&  getDateTime() const   { return mAlarmDateTime; }
+		void             setDeferMinutes(int mins);
+		int              deferMinutes() const  { return mDeferMinutes; }
 
 	protected slots:
 		virtual void     slotOk();
@@ -50,6 +52,7 @@
 		DateTime         mAlarmDateTime;
 		DateTime         mLimitDateTime;   // latest date/time allowed for deferral
 		QString          mLimitEventID;    // event from whose recurrences to derive the limit date/time for deferral
+		int              mDeferMinutes;    // number of minutes deferral selected, or 0 if date/time entered
 };
 
 #endif // DEFERDLG_H
Index: kalarm/alarmcalendar.h
===================================================================
--- kalarm/alarmcalendar.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/alarmcalendar.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -61,6 +61,7 @@
 		QString               path() const                        { return mUrl.prettyURL(); }
 		QString               urlString() const                   { return mUrl.url(); }
 
+		static QString        icalProductId();
 		static bool           initialiseCalendars();
 		static void           terminateCalendars();
 		static AlarmCalendar* activeCalendar()        { return mCalendars[ACTIVE]; }
Index: kalarm/alarmevent.h
===================================================================
--- kalarm/alarmevent.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/alarmevent.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,7 +1,7 @@
 /*
  *  alarmevent.h  -  represents calendar alarms and events
  *  Program:  kalarm
- *  Copyright (c) 2001-2005 by David Jarvie <software@astrojar.org.uk>
+ *  Copyright © 2001-2006 by David Jarvie <software@astrojar.org.uk>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -353,6 +353,7 @@
 		bool               defer(const DateTime&, bool reminder, bool adjustRecurrence = false);
 		void               cancelDefer();
 		void               cancelCancelledDeferral();
+		void               setDeferDefaultMinutes(int minutes)               { mDeferDefaultMinutes = minutes;  mUpdated = true; }
 		bool               setDisplaying(const KAEvent&, KAAlarm::Type, const QDateTime&);
 		void               reinstateFromDisplaying(const KAEvent& dispEvent);
 		void               setArchive()                                      { mArchive = true;  mUpdated = true; }
@@ -389,6 +390,7 @@
 		int                reminderArchived() const       { return mArchiveReminderMinutes; }
 		DateTime           deferDateTime() const          { return mDeferralTime; }
 		DateTime           deferralLimit(DeferLimitType* = 0) const;
+		int                deferDefaultMinutes() const    { return mDeferDefaultMinutes; }
 		DateTime           nextDateTime(bool includeReminders = true) const;
 		const QString&     messageFileOrCommand() const   { return mText; }
 		QString            logFile() const                { return mLogFile; }
@@ -447,6 +449,8 @@
 #else
 		void               dumpDebug() const;
 #endif
+		static int         calVersion();
+		static QString     calVersionString();
 		static bool        adjustStartOfDay(const KCal::Event::List&);
 		static void        convertKCalEvents(KCal::Calendar&, int version, bool adjustSummerTime);
 
@@ -484,6 +488,7 @@
 		int                mDisplayingFlags;  // type of alarm which is currently being displayed
 		int                mReminderMinutes;  // how long in advance reminder is to be, or 0 if none
 		int                mArchiveReminderMinutes;  // original reminder period if now expired, or 0 if none
+		int                mDeferDefaultMinutes; // default number of minutes for deferral dialogue, or 0 to select time control
 		int                mRevision;         // SEQUENCE: revision number of the original alarm, or 0
 		KARecurrence*      mRecurrence;       // RECUR: recurrence specification, or 0 if none
 		int                mRemainingRecurrences; // remaining number of alarm recurrences including initial time, -1 to repeat indefinitely
Index: kalarm/messagewin.h
===================================================================
--- kalarm/messagewin.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/messagewin.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,7 +1,7 @@
 /*
  *  messagewin.h  -  displays an alarm message
  *  Program:  kalarm
- *  Copyright (c) 2001 - 2005 by David Jarvie <software@astrojar.org.uk>
+ *  Copyright © 2001-2006 by David Jarvie <software@astrojar.org.uk>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -105,6 +105,7 @@
 		float               mVolume;
 		float               mFadeVolume;
 		int                 mFadeSeconds;
+		int                 mDefaultDeferMinutes;
 		KAAlarm::Type       mAlarmType;
 		KAEvent::Action     mAction;
 		unsigned long       mKMailSerialNumber; // if email text, message's KMail serial number, else 0
Index: kalarm/kalarm.h
===================================================================
--- kalarm/kalarm.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/kalarm.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -26,7 +26,8 @@
 #include <config.h>
 #endif
 
-#define KALARM_VERSION "1.4.3"
+#define KALARM_VERSION "1.4.5"
+#define KALARM_NAME "KAlarm"
 
 #include <kdeversion.h>
 
Index: kalarm/mainwindow.cpp
===================================================================
--- kalarm/mainwindow.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/mainwindow.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -335,7 +335,7 @@
 	mActionShowTimeTo->setCheckedState(i18n("Hide Time t&o Alarms"));
 	mActionShowExpired     = new KToggleAction(i18n_e_ShowExpiredAlarms(), "history", Qt::CTRL+Qt::Key_P, this, SLOT(slotShowExpired()), actions, "showExpiredAlarms");
 	mActionShowExpired->setCheckedState(i18n_e_HideExpiredAlarms());
-	mActionToggleTrayIcon  = new KToggleAction(i18n("Show in System &Tray"), Qt::CTRL+Qt::Key_Y, this, SLOT(slotToggleTrayIcon()), actions, "showInSystemTray");
+	mActionToggleTrayIcon  = new KToggleAction(i18n("Show in System &Tray"), 0, this, SLOT(slotToggleTrayIcon()), actions, "showInSystemTray");
 	mActionToggleTrayIcon->setCheckedState(i18n("Hide From System &Tray"));
 	new KAction(i18n("Import &Alarms..."), 0, this, SLOT(slotImportAlarms()), actions, "importAlarms");
 	new KAction(i18n("Import &Birthdays..."), 0, this, SLOT(slotBirthdays()), actions, "importBirthdays");
Index: kalarm/alarmtimewidget.h
===================================================================
--- kalarm/alarmtimewidget.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/alarmtimewidget.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,7 +1,7 @@
 /*
  *  alarmtimewidget.h  -  alarm date/time entry widget
  *  Program:  kalarm
- *  Copyright (C) 2001 - 2005 by David Jarvie <software@astrojar.org.uk>
+ *  Copyright © 2001-2006 by David Jarvie <software@astrojar.org.uk>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -42,7 +42,7 @@
 		};
 		AlarmTimeWidget(const QString& groupBoxTitle, int mode, QWidget* parent = 0, const char* name = 0);
 		AlarmTimeWidget(int mode, QWidget* parent = 0, const char* name = 0);
-		DateTime         getDateTime(bool checkExpired = true, bool showErrorMessage = true, QWidget** errorWidget = 0) const;
+		DateTime         getDateTime(int* minsFromNow = 0, bool checkExpired = true, bool showErrorMessage = true, QWidget** errorWidget = 0) const;
 		void             setDateTime(const DateTime&);
 		void             setMinDateTimeIsCurrent();
 		void             setMinDateTime(const QDateTime& = QDateTime());
@@ -51,7 +51,7 @@
 		void             setReadOnly(bool);
 		bool             anyTime() const               { return mAnyTime; }
 		void             enableAnyTime(bool enable);
-		void             selectTimeFromNow();
+		void             selectTimeFromNow(int minutes = 0);
 		QSize            sizeHint() const              { return minimumSizeHint(); }
 
 		static QString   i18n_w_TimeFromNow();     // text of 'Time from now:' radio button, with 'w' shortcut
Index: kalarm/kalarmd/kalarmd.desktop
===================================================================
--- kalarm/kalarmd/kalarmd.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/kalarmd/kalarmd.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -12,6 +12,7 @@
 Name[es]=Daemon de KAlarm
 Name[et]=KAlarmi häiredeemon
 Name[eu]=KAlarm deabrua
+Name[fa]=شبح KAlarm
 Name[fi]=Hälytyspalvelin
 Name[fr]=Démon d'alarme
 Name[ga]=Deamhan KAlarm
Index: kalarm/kalarmd/kalarmd.autostart.desktop
===================================================================
--- kalarm/kalarmd/kalarmd.autostart.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/kalarmd/kalarmd.autostart.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -12,6 +12,7 @@
 Name[es]=Daemon de KAlarm
 Name[et]=KAlarmi häiredeemon
 Name[eu]=KAlarm deabrua
+Name[fa]=شبح KAlarm
 Name[fi]=Hälytyspalvelin
 Name[fr]=Démon d'alarme
 Name[ga]=Deamhan KAlarm
@@ -53,6 +54,7 @@
 Comment[es]=Inicio automático al ingresar del daemon de alarma de KAlarm
 Comment[et]=KAlarmi häiredeemoni automaatne käivitamine
 Comment[eu]=KAlarm alarma deabrua saioa hastean automatikoki abiatzen da
+Comment[fa]=آغاز خودکار هشدار KAlarm در ورود
 Comment[fi]=KOrganizer/KAlarm-hälytyspalvelimen automaattikäynnistys sisäänkirjautuessa
 Comment[fr]=Le démon d'alarme de KOrganizer et de KAlarm démarre automatiquement lors de la connexion
 Comment[he]=הפעלה אוטומטית של תהליך הרקע תזכורות של KAlarm בעת ההפעלה
Index: kalarm/Changelog
===================================================================
--- kalarm/Changelog	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/Changelog	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,5 +1,11 @@
 KAlarm
 
+=== Version 1.4.5 (KDE 3.5.5) --- 29 September 2006 ===
+Improve edit dialogue layout (Reminder controls moved to below Time box).
+
+=== Version 1.4.4 --- 11 July 2006 ===
+Use an alarm's previous deferral time interval as default for its next deferral.
+
 === Version 1.4.3 (KDE 3.5.4) --- 11 July 2006 ===
 Add facility to import alarms from other calendar files.
 Fix Defer dialog time interval maximum to match maximum date/time value.
Index: kalarm/kalarmapp.cpp
===================================================================
--- kalarm/kalarmapp.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/kalarmapp.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -109,8 +109,7 @@
 {
 	Preferences::initialise();
 	Preferences::connect(SIGNAL(preferencesChanged()), this, SLOT(slotPreferencesChanged()));
-	KCal::CalFormat::setApplication(aboutData()->programName(),
-	                                QString::fromLatin1("-//K Desktop Environment//NONSGML KAlarm " KALARM_VERSION "//EN"));
+	KCal::CalFormat::setApplication(aboutData()->programName(), AlarmCalendar::icalProductId());
 	KARecurrence::setDefaultFeb29Type(Preferences::defaultFeb29Type());
 
 	// Check if the system tray is supported by this window manager
Index: kalarm/recurrenceedit.h
===================================================================
--- kalarm/recurrenceedit.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/recurrenceedit.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,7 +1,7 @@
 /*
  *  recurrenceedit.h  -  widget to edit the event's recurrence definition
  *  Program:  kalarm
- *  Copyright (c) 2002 - 2005 by David Jarvie <software@astrojar.org.uk>
+ *  Copyright © 2002-2005 by David Jarvie <software@astrojar.org.uk>
  *
  *  Based originally on KOrganizer module koeditorrecurrence.h,
  *  Copyright (c) 2000,2001 Cornelius Schumacher <schumacher@kde.org>
@@ -118,9 +118,7 @@
 		void          saveState();
 
 		// Main rule box and choices
-		QGroupBox*        recurGroup;
-		QFrame*           ruleFrame;
-		QWidgetStack*     ruleStack;
+		QWidgetStack*     mRuleStack;
 		Rule*             mRule;         // current rule widget, or 0 if NoRule
 		NoRule*           mNoRule;
 		SubDailyRule*     mSubDailyRule;
@@ -129,7 +127,7 @@
 		MonthlyRule*      mMonthlyRule;
 		YearlyRule*       mYearlyRule;
 
-		ButtonGroup*      ruleButtonGroup;
+		ButtonGroup*      mRuleButtonGroup;
 		RadioButton*      mNoneButton;
 		RadioButton*      mAtLoginButton;
 		RadioButton*      mSubDailyButton;
@@ -171,7 +169,7 @@
 
 		// Current start date and time
 		QDateTime         mCurrStartDateTime;
-		bool              noEmitTypeChanged;         // suppress typeChanged() signal
+		bool              mNoEmitTypeChanged;        // suppress typeChanged() signal
 		bool              mReadOnly;
 
 		// Initial state of non-rule controls
Index: kalarm/calendarcompat.cpp
===================================================================
--- kalarm/calendarcompat.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/calendarcompat.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,7 +1,7 @@
 /*
  *  calendarcompat.cpp -  compatibility for old calendar file formats
  *  Program:  kalarm
- *  Copyright (C) 2001 - 2005 by David Jarvie <software@astrojar.org.uk>
+ *  Copyright © 2001-2006 by David Jarvie <software@astrojar.org.uk>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -22,14 +22,12 @@
 
 #include <qfile.h>
 #include <qtextstream.h>
+#include <qstringlist.h>
 
 #include <kapplication.h>
 #include <kaboutdata.h>
 #include <kdebug.h>
 
-extern "C" {
-#include <libical/ical.h>
-}
 #include <libkcal/calendar.h>
 
 #include "alarmevent.h"
@@ -103,8 +101,8 @@
 	if (i <= 0)
 		return 0;    // missing version string
 	ver = ver.left(i);     // ver now contains the KAlarm version string
-	if (ver == KALARM_VERSION)
-		return 0;      // the calendar was created by the current KAlarm version
+	if (ver == KAlarm::currentCalendarVersionString())
+		return 0;      // the calendar is in the current KAlarm format
 	return KAlarm::getVersionNumber(ver, &subVersion);
 }
 
@@ -126,25 +124,27 @@
 	file.close();
 
 	// Extract the CREATED property for the first VEVENT from the calendar
-	bool result = false;
-	icalcomponent* calendar = icalcomponent_new_from_string(text.local8Bit().data());
-	if (calendar)
+	QString VCALENDAR = QString::fromLatin1("BEGIN:VCALENDAR");
+	QString VEVENT    = QString::fromLatin1("BEGIN:VEVENT");
+	QString CREATED   = QString::fromLatin1("CREATED:");
+	QStringList lines = QStringList::split(QChar('\n'), text);
+	for (QStringList::ConstIterator it = lines.begin();  it != lines.end(); ++it)
 	{
-		if (icalcomponent_isa(calendar) == ICAL_VCALENDAR_COMPONENT)
+		if ((*it).startsWith(VCALENDAR))
 		{
-			icalcomponent* c = icalcomponent_get_first_component(calendar, ICAL_VEVENT_COMPONENT);
-			if (c)
+			while (++it != lines.end())
 			{
-				icalproperty* p = icalcomponent_get_first_property(c, ICAL_CREATED_PROPERTY);
-				if (p)
+				if ((*it).startsWith(VEVENT))
 				{
-					struct icaltimetype datetime = icalproperty_get_created(p);
-					if (datetime.is_utc)
-						result = true;
+					while (++it != lines.end())
+					{
+						if ((*it).startsWith(CREATED))
+							return (*it).endsWith("Z");
+					}
 				}
 			}
+			break;
 		}
-		icalcomponent_free(calendar);
 	}
-	return result;
+	return false;
 }
Index: kalarm/alarmtimewidget.cpp
===================================================================
--- kalarm/alarmtimewidget.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/alarmtimewidget.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -53,7 +53,7 @@
 
 
 /******************************************************************************
-*  Construct a widget with a group box and title.
+* Construct a widget with a group box and title.
 */
 AlarmTimeWidget::AlarmTimeWidget(const QString& groupBoxTitle, int mode, QWidget* parent, const char* name)
 	: ButtonGroup(groupBoxTitle, parent, name),
@@ -65,7 +65,7 @@
 }
 
 /******************************************************************************
-*  Construct a widget without a group box or title.
+* Construct a widget without a group box or title.
 */
 AlarmTimeWidget::AlarmTimeWidget(int mode, QWidget* parent, const char* name)
 	: ButtonGroup(parent, name),
@@ -202,21 +202,27 @@
 /******************************************************************************
 * Select the "Time from now" radio button.
 */
-void AlarmTimeWidget::selectTimeFromNow()
+void AlarmTimeWidget::selectTimeFromNow(int minutes)
 {
 	mAfterTimeRadio->setChecked(true);
 	slotButtonSet(1);
+	if (minutes > 0)
+		mDelayTimeEdit->setValue(minutes);
 }
 
 /******************************************************************************
-*  Fetch the entered date/time.
-*  If 'checkExpired' is true and the entered value <= current time, an error occurs.
-*  In this case, if 'showErrorMessage' is true, output an error message.
-*  'errorWidget' if non-null, is set to point to the widget containing the error.
-*  Reply = invalid date/time if error.
+* Fetch the entered date/time.
+* If 'checkExpired' is true and the entered value <= current time, an error occurs.
+* If 'minsFromNow' is non-null, it is set to the number of minutes' delay selected,
+* or to zero if a date/time was entered.
+* In this case, if 'showErrorMessage' is true, output an error message.
+* 'errorWidget' if non-null, is set to point to the widget containing the error.
+* Reply = invalid date/time if error.
 */
-DateTime AlarmTimeWidget::getDateTime(bool checkExpired, bool showErrorMessage, QWidget** errorWidget) const
+DateTime AlarmTimeWidget::getDateTime(int* minsFromNow, bool checkExpired, bool showErrorMessage, QWidget** errorWidget) const
 {
+	if (minsFromNow)
+		*minsFromNow = 0;
 	if (errorWidget)
 		*errorWidget = 0;
 	QTime nowt = QTime::currentTime();
@@ -281,12 +287,15 @@
 				*errorWidget = mDelayTimeEdit;
 			return DateTime();
 		}
-		return now.addSecs(mDelayTimeEdit->value() * 60);
+		int delayMins = mDelayTimeEdit->value();
+		if (minsFromNow)
+			*minsFromNow = delayMins;
+		return now.addSecs(delayMins * 60);
 	}
 }
 
 /******************************************************************************
-*  Set the date/time.
+* Set the date/time.
 */
 void AlarmTimeWidget::setDateTime(const DateTime& dt)
 {
@@ -313,7 +322,7 @@
 }
 
 /******************************************************************************
-*  Set the minimum date/time to track the current time.
+* Set the minimum date/time to track the current time.
 */
 void AlarmTimeWidget::setMinDateTimeIsCurrent()
 {
@@ -325,8 +334,8 @@
 }
 
 /******************************************************************************
-*  Set the minimum date/time, adjusting the entered date/time if necessary.
-*  If 'dt' is invalid, any current minimum date/time is cleared.
+* Set the minimum date/time, adjusting the entered date/time if necessary.
+* If 'dt' is invalid, any current minimum date/time is cleared.
 */
 void AlarmTimeWidget::setMinDateTime(const QDateTime& dt)
 {
@@ -337,8 +346,8 @@
 }
 
 /******************************************************************************
-*  Set the maximum date/time, adjusting the entered date/time if necessary.
-*  If 'dt' is invalid, any current maximum date/time is cleared.
+* Set the maximum date/time, adjusting the entered date/time if necessary.
+* If 'dt' is invalid, any current maximum date/time is cleared.
 */
 void AlarmTimeWidget::setMaxDateTime(const DateTime& dt)
 {
@@ -354,8 +363,8 @@
 }
 
 /******************************************************************************
-*  If the minimum and maximum date/times fall on the same date, set the minimum
-*  and maximum times in the time edit box.
+* If the minimum and maximum date/times fall on the same date, set the minimum
+* and maximum times in the time edit box.
 */
 void AlarmTimeWidget::setMaxMinTimeIf(const QDateTime& now)
 {
@@ -387,8 +396,8 @@
 }
 
 /******************************************************************************
-*  Set the maximum value for the delay time edit box, depending on the maximum
-*  value for the date/time.
+* Set the maximum value for the delay time edit box, depending on the maximum
+* value for the date/time.
 */
 void AlarmTimeWidget::setMaxDelayTime(const QDateTime& now)
 {
@@ -407,7 +416,7 @@
 }
 
 /******************************************************************************
-*  Set the status for whether a time is specified, or just a date.
+* Set the status for whether a time is specified, or just a date.
 */
 void AlarmTimeWidget::setAnyTime()
 {
@@ -418,7 +427,7 @@
 }
 
 /******************************************************************************
-*  Enable/disable the "any time" checkbox.
+* Enable/disable the "any time" checkbox.
 */
 void AlarmTimeWidget::enableAnyTime(bool enable)
 {
@@ -434,8 +443,8 @@
 }
 
 /******************************************************************************
-*  Called every minute to update the alarm time data entry fields.
-*  If the maximum date/time has been reached, a 'pastMax()' signal is emitted.
+* Called every minute to update the alarm time data entry fields.
+* If the maximum date/time has been reached, a 'pastMax()' signal is emitted.
 */
 void AlarmTimeWidget::slotTimer()
 {
@@ -481,8 +490,8 @@
 
 
 /******************************************************************************
-*  Called when the At or After time radio button states have been set.
-*  Updates the appropriate edit box.
+* Called when the At or After time radio button states have been set.
+* Updates the appropriate edit box.
 */
 void AlarmTimeWidget::slotButtonSet(int)
 {
@@ -501,7 +510,7 @@
 }
 
 /******************************************************************************
-*  Called after the mAnyTimeCheckBox checkbox has been toggled.
+* Called after the mAnyTimeCheckBox checkbox has been toggled.
 */
 void AlarmTimeWidget::slotAnyTimeToggled(bool on)
 {
@@ -510,8 +519,8 @@
 }
 
 /******************************************************************************
-*  Called when the date or time edit box values have changed.
-*  Updates the time delay edit box accordingly.
+* Called when the date or time edit box values have changed.
+* Updates the time delay edit box accordingly.
 */
 void AlarmTimeWidget::dateTimeChanged()
 {
@@ -527,8 +536,8 @@
 }
 
 /******************************************************************************
-*  Called when the delay time edit box value has changed.
-*  Updates the Date and Time edit boxes accordingly.
+* Called when the delay time edit box value has changed.
+* Updates the Date and Time edit boxes accordingly.
 */
 void AlarmTimeWidget::delayTimeChanged(int minutes)
 {
Index: kalarm/kalarm.desktop
===================================================================
--- kalarm/kalarm.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/kalarm.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -15,6 +15,7 @@
 Name[ta]=Kஅலாரம்
 Name[th]=เตือนการนัดหมาย - K
 Name[ven]=Alamu ya K
+Name[zh_TW]=KAlarm 鬧鐘
 Type=Application
 Exec=kalarm -caption "%c" %i
 Icon=kalarm
@@ -31,6 +32,7 @@
 GenericName[es]=Planificador de alarmas personales
 GenericName[et]=Meeldetuletuste ajastaja
 GenericName[eu]=Alarma pertsonalen programatzailea
+GenericName[fa]=زمان‌بند هشدار شخصی 
 GenericName[fi]=Henkilökohtainen hälytysajastin
 GenericName[fr]=Planificateur d'alarme personnel
 GenericName[he]=מנהל זמן אישי
Index: kalarm/recurrenceedit.cpp
===================================================================
--- kalarm/recurrenceedit.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/recurrenceedit.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,7 +1,7 @@
 /*
  *  recurrenceedit.cpp  -  widget to edit the event's recurrence definition
  *  Program:  kalarm
- *  Copyright (c) 2002-2006 by David Jarvie <software@astrojar.org.uk>
+ *  Copyright © 2002-2006 by David Jarvie <software@astrojar.org.uk>
  *
  *  Based originally on KOrganizer module koeditorrecurrence.cpp,
  *  Copyright (c) 2000,2001 Cornelius Schumacher <schumacher@kde.org>
@@ -90,7 +90,7 @@
 	  mWeeklyShown(false),
 	  mMonthlyShown(false),
 	  mYearlyShown(false),
-	  noEmitTypeChanged(true),
+	  mNoEmitTypeChanged(true),
 	  mReadOnly(readOnly)
 {
 	QBoxLayout* layout;
@@ -103,70 +103,70 @@
 	 * selection of its corresponding radio button.
 	 */
 
-	recurGroup = new QGroupBox(1, Qt::Vertical, i18n("Recurrence Rule"), this, "recurGroup");
+	QGroupBox* recurGroup = new QGroupBox(1, Qt::Vertical, i18n("Recurrence Rule"), this, "recurGroup");
 	topLayout->addWidget(recurGroup);
-	ruleFrame = new QFrame(recurGroup, "ruleFrame");
+	QFrame* ruleFrame = new QFrame(recurGroup, "ruleFrame");
 	layout = new QVBoxLayout(ruleFrame, 0);
 	layout->addSpacing(KDialog::spacingHint()/2);
 
 	layout = new QHBoxLayout(layout, 0);
 	QBoxLayout* lay = new QVBoxLayout(layout, 0);
-	ruleButtonGroup = new ButtonGroup(1, Qt::Horizontal, ruleFrame);
-	ruleButtonGroup->setInsideMargin(0);
-	ruleButtonGroup->setFrameStyle(QFrame::NoFrame);
-	lay->addWidget(ruleButtonGroup);
+	mRuleButtonGroup = new ButtonGroup(1, Qt::Horizontal, ruleFrame);
+	mRuleButtonGroup->setInsideMargin(0);
+	mRuleButtonGroup->setFrameStyle(QFrame::NoFrame);
+	lay->addWidget(mRuleButtonGroup);
 	lay->addStretch();    // top-adjust the interval radio buttons
-	connect(ruleButtonGroup, SIGNAL(buttonSet(int)), SLOT(periodClicked(int)));
+	connect(mRuleButtonGroup, SIGNAL(buttonSet(int)), SLOT(periodClicked(int)));
 
-	mNoneButton = new RadioButton(i18n_Norecur(), ruleButtonGroup);
+	mNoneButton = new RadioButton(i18n_Norecur(), mRuleButtonGroup);
 	mNoneButton->setFixedSize(mNoneButton->sizeHint());
 	mNoneButton->setReadOnly(mReadOnly);
 	QWhatsThis::add(mNoneButton, i18n("Do not repeat the alarm"));
 
-	mAtLoginButton = new RadioButton(i18n_l_Atlogin(), ruleButtonGroup);
+	mAtLoginButton = new RadioButton(i18n_l_Atlogin(), mRuleButtonGroup);
 	mAtLoginButton->setFixedSize(mAtLoginButton->sizeHint());
 	mAtLoginButton->setReadOnly(mReadOnly);
 	QWhatsThis::add(mAtLoginButton,
 	      i18n("Trigger the alarm at the specified date/time and at every login until then.\n"
 	           "Note that it will also be triggered any time the alarm daemon is restarted."));
 
-	mSubDailyButton = new RadioButton(i18n_u_HourlyMinutely(), ruleButtonGroup);
+	mSubDailyButton = new RadioButton(i18n_u_HourlyMinutely(), mRuleButtonGroup);
 	mSubDailyButton->setFixedSize(mSubDailyButton->sizeHint());
 	mSubDailyButton->setReadOnly(mReadOnly);
 	QWhatsThis::add(mSubDailyButton,
 	      i18n("Repeat the alarm at hourly/minutely intervals"));
 
-	mDailyButton = new RadioButton(i18n_d_Daily(), ruleButtonGroup);
+	mDailyButton = new RadioButton(i18n_d_Daily(), mRuleButtonGroup);
 	mDailyButton->setFixedSize(mDailyButton->sizeHint());
 	mDailyButton->setReadOnly(mReadOnly);
 	QWhatsThis::add(mDailyButton,
 	      i18n("Repeat the alarm at daily intervals"));
 
-	mWeeklyButton = new RadioButton(i18n_w_Weekly(), ruleButtonGroup);
+	mWeeklyButton = new RadioButton(i18n_w_Weekly(), mRuleButtonGroup);
 	mWeeklyButton->setFixedSize(mWeeklyButton->sizeHint());
 	mWeeklyButton->setReadOnly(mReadOnly);
 	QWhatsThis::add(mWeeklyButton,
 	      i18n("Repeat the alarm at weekly intervals"));
 
-	mMonthlyButton = new RadioButton(i18n_m_Monthly(), ruleButtonGroup);
+	mMonthlyButton = new RadioButton(i18n_m_Monthly(), mRuleButtonGroup);
 	mMonthlyButton->setFixedSize(mMonthlyButton->sizeHint());
 	mMonthlyButton->setReadOnly(mReadOnly);
 	QWhatsThis::add(mMonthlyButton,
 	      i18n("Repeat the alarm at monthly intervals"));
 
-	mYearlyButton = new RadioButton(i18n_y_Yearly(), ruleButtonGroup);
+	mYearlyButton = new RadioButton(i18n_y_Yearly(), mRuleButtonGroup);
 	mYearlyButton->setFixedSize(mYearlyButton->sizeHint());
 	mYearlyButton->setReadOnly(mReadOnly);
 	QWhatsThis::add(mYearlyButton,
 	      i18n("Repeat the alarm at annual intervals"));
 
-	mNoneButtonId     = ruleButtonGroup->id(mNoneButton);
-	mAtLoginButtonId  = ruleButtonGroup->id(mAtLoginButton);
-	mSubDailyButtonId = ruleButtonGroup->id(mSubDailyButton);
-	mDailyButtonId    = ruleButtonGroup->id(mDailyButton);
-	mWeeklyButtonId   = ruleButtonGroup->id(mWeeklyButton);
-	mMonthlyButtonId  = ruleButtonGroup->id(mMonthlyButton);
-	mYearlyButtonId   = ruleButtonGroup->id(mYearlyButton);
+	mNoneButtonId     = mRuleButtonGroup->id(mNoneButton);
+	mAtLoginButtonId  = mRuleButtonGroup->id(mAtLoginButton);
+	mSubDailyButtonId = mRuleButtonGroup->id(mSubDailyButton);
+	mDailyButtonId    = mRuleButtonGroup->id(mDailyButton);
+	mWeeklyButtonId   = mRuleButtonGroup->id(mWeeklyButton);
+	mMonthlyButtonId  = mRuleButtonGroup->id(mMonthlyButton);
+	mYearlyButtonId   = mRuleButtonGroup->id(mYearlyButton);
 
 	lay = new QVBoxLayout(layout);
 
@@ -192,15 +192,15 @@
 	connect(mMonthlyRule, SIGNAL(frequencyChanged()), this, SIGNAL(frequencyChanged()));
 	connect(mYearlyRule, SIGNAL(frequencyChanged()), this, SIGNAL(frequencyChanged()));
 
-	ruleStack = new QWidgetStack(ruleFrame);
-	layout->addWidget(ruleStack);
+	mRuleStack = new QWidgetStack(ruleFrame);
+	layout->addWidget(mRuleStack);
 	layout->addStretch(1);
-	ruleStack->addWidget(mNoRule, 0);
-	ruleStack->addWidget(mSubDailyRule, 1);
-	ruleStack->addWidget(mDailyRule, 2);
-	ruleStack->addWidget(mWeeklyRule, 3);
-	ruleStack->addWidget(mMonthlyRule, 4);
-	ruleStack->addWidget(mYearlyRule, 5);
+	mRuleStack->addWidget(mNoRule, 0);
+	mRuleStack->addWidget(mSubDailyRule, 1);
+	mRuleStack->addWidget(mDailyRule, 2);
+	mRuleStack->addWidget(mWeeklyRule, 3);
+	mRuleStack->addWidget(mMonthlyRule, 4);
+	mRuleStack->addWidget(mYearlyRule, 5);
 	layout->addSpacing(KDialog::marginHint());
 
 	// Create the recurrence range group which contains the controls
@@ -334,7 +334,7 @@
 		layout->addWidget(mDeleteExceptionButton);
 	}
 
-	noEmitTypeChanged = false;
+	mNoEmitTypeChanged = false;
 }
 
 /******************************************************************************
@@ -422,7 +422,7 @@
 
 	if (mRuleButtonType != oldType)
 	{
-		ruleStack->raiseWidget(mRule ? mRule : mNoRule);
+		mRuleStack->raiseWidget(mRule ? mRule : mNoRule);
 		if (oldType == NO_RECUR  ||  none)
 			mRangeButtonGroup->setEnabled(!none);
 		mExceptionGroup->setEnabled(!(none || atLogin));
@@ -433,14 +433,14 @@
 			mRepeatCountButton->setEnabled(!atLogin);
 		}
 		rangeTypeClicked();
-		if (!noEmitTypeChanged)
+		if (!mNoEmitTypeChanged)
 			emit typeChanged(mRuleButtonType);
 	}
 }
 
 void RecurrenceEdit::slotAnyTimeToggled(bool on)
 {
-	QButton* button = ruleButtonGroup->selected();
+	QButton* button = mRuleButtonGroup->selected();
 	mEndTimeEdit->setEnabled(button == mAtLoginButton && !on
 	                     ||  button == mSubDailyButton && mEndDateButton->isChecked());
 }
@@ -465,7 +465,7 @@
 	if (mRule)
 		mRule->setFrequencyFocus();
 	else
-		ruleButtonGroup->selected()->setFocus();
+		mRuleButtonGroup->selected()->setFocus();
 	emit shown();
 }
 
@@ -604,7 +604,7 @@
 
 DateTime RecurrenceEdit::endDateTime() const
 {
-	if (ruleButtonGroup->selected() == mAtLoginButton  &&  mEndAnyTimeCheckBox->isChecked())
+	if (mRuleButtonGroup->selected() == mAtLoginButton  &&  mEndAnyTimeCheckBox->isChecked())
 		return DateTime(mEndDateEdit->date());
 	return DateTime(mEndDateEdit->date(), mEndTimeEdit->time());
 }
@@ -630,7 +630,7 @@
 
 	mEndDateEdit->setDate(fromDate);
 
-	noEmitTypeChanged = true;
+	mNoEmitTypeChanged = true;
 	int button;
 	switch (Preferences::defaultRecurPeriod())
 	{
@@ -643,8 +643,8 @@
 		case NO_RECUR:
 		default:       button = mNoneButtonId;     break;
 	}
-	ruleButtonGroup->setButton(button);
-	noEmitTypeChanged = false;
+	mRuleButtonGroup->setButton(button);
+	mNoEmitTypeChanged = false;
 	rangeTypeClicked();
 	enableExceptionButtons();
 
@@ -678,11 +678,11 @@
 	setDefaults(event.mainDateTime().dateTime());
 	if (event.repeatAtLogin())
 	{
-		ruleButtonGroup->setButton(mAtLoginButtonId);
+		mRuleButtonGroup->setButton(mAtLoginButtonId);
 		mEndDateButton->setChecked(true);
 		return;
 	}
-	ruleButtonGroup->setButton(mNoneButtonId);
+	mRuleButtonGroup->setButton(mNoneButtonId);
 	int repeatDuration;
 	KARecurrence* recurrence = event.recurrence();
 	if (!recurrence)
@@ -691,12 +691,12 @@
 	switch (rtype)
 	{
 		case KARecurrence::MINUTELY:
-			ruleButtonGroup->setButton(mSubDailyButtonId);
+			mRuleButtonGroup->setButton(mSubDailyButtonId);
 			break;
 
 		case KARecurrence::DAILY:
 		{
-			ruleButtonGroup->setButton(mDailyButtonId);
+			mRuleButtonGroup->setButton(mDailyButtonId);
 			QBitArray rDays = recurrence->days();
 			bool set = false;
 			for (int i = 0;  i < 7 && !set;  ++i)
@@ -709,7 +709,7 @@
 		}
 		case KARecurrence::WEEKLY:
 		{
-			ruleButtonGroup->setButton(mWeeklyButtonId);
+			mRuleButtonGroup->setButton(mWeeklyButtonId);
 			QBitArray rDays = recurrence->days();
 			mWeeklyRule->setDays(rDays);
 			break;
@@ -722,7 +722,7 @@
 			{
 				// It's every (Tuesday) of the month. Convert to a weekly recurrence
 				// (but ignoring any non-every xxxDay positions).
-				ruleButtonGroup->setButton(mWeeklyButtonId);
+				mRuleButtonGroup->setButton(mWeeklyButtonId);
 				mWeeklyRule->setFrequency(recurrence->frequency());
 				QBitArray rDays(7);
 				for (QValueList<RecurrenceRule::WDayPos>::ConstIterator it = posns.begin();  it != posns.end();  ++it)
@@ -733,13 +733,13 @@
 				mWeeklyRule->setDays(rDays);
 				break;
 			}
-			ruleButtonGroup->setButton(mMonthlyButtonId);
+			mRuleButtonGroup->setButton(mMonthlyButtonId);
 			mMonthlyRule->setPosition(i, posns.first().day());
 			break;
 		}
 		case KARecurrence::MONTHLY_DAY:     // on nth day of the month
 		{
-			ruleButtonGroup->setButton(mMonthlyButtonId);
+			mRuleButtonGroup->setButton(mMonthlyButtonId);
 			QValueList<int> rmd = recurrence->monthDays();
 			int day = (rmd.isEmpty()) ? event.mainDate().day() : rmd.first();
 			mMonthlyRule->setDate(day);
@@ -750,7 +750,7 @@
 		{
 			if (rtype == KARecurrence::ANNUAL_DATE)
 			{
-				ruleButtonGroup->setButton(mYearlyButtonId);
+				mRuleButtonGroup->setButton(mYearlyButtonId);
 				const QValueList<int> rmd = recurrence->monthDays();
 				int day = (rmd.isEmpty()) ? event.mainDate().day() : rmd.first();
 				mYearlyRule->setDate(day);
@@ -758,7 +758,7 @@
 			}
 			else if (rtype == KARecurrence::ANNUAL_POS)
 			{
-				ruleButtonGroup->setButton(mYearlyButtonId);
+				mRuleButtonGroup->setButton(mYearlyButtonId);
 				QValueList<RecurrenceRule::WDayPos> posns = recurrence->yearPositions();
 				mYearlyRule->setPosition(posns.first().pos(), posns.first().day());
 			}
@@ -830,7 +830,7 @@
 	}
 
 	// Set up the recurrence according to the type selected
-	QButton* button = ruleButtonGroup->selected();
+	QButton* button = mRuleButtonGroup->selected();
 	event.setRepeatAtLogin(button == mAtLoginButton);
 	int frequency = mRule ? mRule->frequency() : 0;
 	if (button == mSubDailyButton)
@@ -909,7 +909,7 @@
  */
 void RecurrenceEdit::saveState()
 {
-	mSavedRuleButton = ruleButtonGroup->selected();
+	mSavedRuleButton = mRuleButtonGroup->selected();
 	if (mRule)
 		mRule->saveState();
 	mSavedRangeButton = mRangeButtonGroup->selected();
@@ -925,7 +925,7 @@
  */
 bool RecurrenceEdit::stateChanged() const
 {
-	if (mSavedRuleButton  != ruleButtonGroup->selected()
+	if (mSavedRuleButton  != mRuleButtonGroup->selected()
 	||  mSavedRangeButton != mRangeButtonGroup->selected()
 	||  mRule  &&  mRule->stateChanged())
 		return true;
Index: kalarm/functions.cpp
===================================================================
--- kalarm/functions.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/functions.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -684,6 +684,17 @@
 }
 
 /******************************************************************************
+* Return the current KAlarm version number.
+*/
+int Version()
+{
+	static int version = 0;
+	if (!version)
+		version = getVersionNumber(KALARM_VERSION);
+	return version;
+}
+
+/******************************************************************************
 * Convert the supplied KAlarm version string to a version number.
 * Reply = version number (double digit for each of major, minor & issue number,
 *         e.g. 010203 for 1.2.3
Index: kalarm/kalarm.tray.desktop
===================================================================
--- kalarm/kalarm.tray.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/kalarm.tray.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -15,6 +15,7 @@
 Name[ta]=Kஅலாரம்
 Name[th]=เตือนการนัดหมาย - K
 Name[ven]=Alamu ya K
+Name[zh_TW]=KAlarm 鬧鐘
 Exec=kalarm --tray
 Icon=kalarm
 Type=Application
@@ -31,6 +32,7 @@
 Comment[es]=Programador de alarma personal: comenzar como icono de la bandeja del sistema
 Comment[et]=Häirete ja meeldetuletuste ajakava: käivitamine süsteemse doki ikoonina
 Comment[eu]=Alarma pertsonalen programatzailea: abiatu sistemaren bandejako ikono bezala
+Comment[fa]=زمان‌بند هشدار شخصی: آغاز به عنوان شمایل سینی سیستم‌
 Comment[fi]=Henkilökohtainen hälytysajastin: käynnistä paneelikuvake
 Comment[fr]=Planificateur d'alarme personnel : démarre dans la boîte à miniatures
 Comment[he]=מתזמן הודעות תזכורת: הפעלה בתור סמל במגש המערכת
Index: kalarm/deferdlg.cpp
===================================================================
--- kalarm/deferdlg.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/deferdlg.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,7 +1,7 @@
 /*
  *  deferdlg.cpp  -  dialogue to defer an alarm
  *  Program:  kalarm
- *  Copyright (C) 2002 - 2005 by David Jarvie <software@astrojar.org.uk>
+ *  Copyright © 2002-2006 by David Jarvie <software@astrojar.org.uk>
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -63,11 +63,11 @@
 
 
 /******************************************************************************
-*  Called when the OK button is clicked.
+* Called when the OK button is clicked.
 */
 void DeferAlarmDlg::slotOk()
 {
-	mAlarmDateTime = mTimeWidget->getDateTime();
+	mAlarmDateTime = mTimeWidget->getDateTime(&mDeferMinutes);
 	if (!mAlarmDateTime.isValid())
 		return;
 	KAEvent::DeferLimitType limitType;
@@ -116,16 +116,24 @@
 }
 
 /******************************************************************************
-*  Called the maximum date/time for the date/time edit widget has been passed.
+* Select the 'Time from now' radio button and preset its value.
 */
+void DeferAlarmDlg::setDeferMinutes(int minutes)
+{
+	mTimeWidget->selectTimeFromNow(minutes);
+}
+
+/******************************************************************************
+* Called the maximum date/time for the date/time edit widget has been passed.
+*/
 void DeferAlarmDlg::slotPastLimit()
 {
 	enableButtonOK(false);
 }
 
 /******************************************************************************
-*  Set the time limit for deferral based on the next occurrence of the alarm
-*  with the specified ID.
+* Set the time limit for deferral based on the next occurrence of the alarm
+* with the specified ID.
 */
 void DeferAlarmDlg::setLimit(const DateTime& limit)
 {
@@ -135,8 +143,8 @@
 }
 
 /******************************************************************************
-*  Set the time limit for deferral based on the next occurrence of the alarm
-*  with the specified ID.
+* Set the time limit for deferral based on the next occurrence of the alarm
+* with the specified ID.
 */
 DateTime DeferAlarmDlg::setLimit(const QString& eventID)
 {
@@ -154,7 +162,7 @@
 }
 
 /******************************************************************************
-*  Called when the Cancel Deferral button is clicked.
+* Called when the Cancel Deferral button is clicked.
 */
 void DeferAlarmDlg::slotUser1()
 {
@@ -163,7 +171,7 @@
 }
 
 /******************************************************************************
-*  Called when the Cancel button is clicked.
+* Called when the Cancel button is clicked.
 */
 void DeferAlarmDlg::slotCancel()
 {
Index: kalarm/alarmcalendar.cpp
===================================================================
--- kalarm/alarmcalendar.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kalarm/alarmcalendar.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -59,6 +59,11 @@
 
 using namespace KCal;
 
+QString AlarmCalendar::icalProductId()
+{
+	return QString::fromLatin1("-//K Desktop Environment//NONSGML " KALARM_NAME " %1//EN").arg(KAlarm::currentCalendarVersionString());
+}
+
 static const KAEvent::Status eventTypes[AlarmCalendar::NCALS] = {
 	KAEvent::ACTIVE, KAEvent::EXPIRED, KAEvent::DISPLAYING, KAEvent::TEMPLATE
 };
Index: korn/KOrn.desktop
===================================================================
--- korn/KOrn.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korn/KOrn.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 GenericName[es]=Aviso de correo
 GenericName[et]=E-kirjade teadustaja
 GenericName[eu]=Mail abisua
+GenericName[fa]=هشدار نامه
 GenericName[fi]=Saapuneen sähköpostin ilmoitus
 GenericName[fr]=Surveillance du courrier électronique
 GenericName[ga]=Fógairt Ríomhphoist
@@ -65,5 +66,6 @@
 Name[eo]=Korno
 Name[hi]=कॉर्न
 Name[ta]=கார்ன்
+Name[zh_TW]=Korn 信件通知
 X-DCOP-ServiceType=Unique
 Categories=Qt;KDE;Network;X-KDE-More;
Index: korn/kornshell.h
===================================================================
--- korn/kornshell.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korn/kornshell.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2004, Mart Kelder (mart.kde@hccnet.nl)
+ * Copyright (C) 2004-2006, Mart Kelder (mart@kelder31.nl)
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -45,13 +45,13 @@
 private slots:
 	void slotDialogClosed();
 	void slotApply();
+	void readConfig();
 	
 private:
-	void readConfig();
-	
 	KConfig *_config;
 	BoxContainer *_box;
 	KDialogBase *_configDialog;
+	bool _show;
 };
 
 #endif //MK_KORNSHELL_H
Index: korn/kornshell.cpp
===================================================================
--- korn/kornshell.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korn/kornshell.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2004, Mart Kelder (mart.kde@hccnet.nl)
+ * Copyright (C) 2004-2006, Mart Kelder (mart@kelder31.nl)
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -26,17 +26,32 @@
 
 #include <kapplication.h>
 #include <kconfig.h>
+#include <kdebug.h>
 #include <kdialogbase.h>
 #include <klocale.h>
 
+#include <qtimer.h>
+
 KornShell::KornShell( QWidget * parent, const char * name )
 	: QWidget( parent, name ),
 	_config( new KConfig( "kornrc" ) ),
 	_box( 0 ),
-	_configDialog( 0 )
+	_configDialog( 0 ),
+	_show( false )
 {
 	_config->checkUpdate( "korn_kde_3_4_config_change", "korn-3-4-config_change.upd" );
-	readConfig();
+	if( kapp->isRestored() )
+	{
+		_config->setGroup( "korn" );
+		QTimer::singleShot( _config->readNumEntry( "session_startup_delay", 200 ), this, SLOT(readConfig()) );
+		kdDebug() << "startup delayed" << endl;
+	}
+	else
+	{
+		kdDebug() << "Startup not delayed" << endl;
+		readConfig();
+	}
+
 }
 
 KornShell::~KornShell()
@@ -49,7 +64,10 @@
 
 void KornShell::show()
 {
-	_box->showBox();
+	if( _box )
+		_box->showBox();
+	else
+		_show = true;
 }
 
 void KornShell::optionDlg()
@@ -103,6 +121,13 @@
 		{
 			kapp->quit();
 		}
+
+	if( _show )
+	{
+		// Show is called, but _box wasn't available at that time
+		show();
+		_show = false;
+	}
 }
 
 void KornShell::slotDialogClosed()
Index: kmailcvt/filter_kmail_maildir.cxx
===================================================================
--- kmailcvt/filter_kmail_maildir.cxx	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmailcvt/filter_kmail_maildir.cxx	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -94,7 +94,6 @@
  * Import of a directory contents.
  * @param info Information storage for the operation.
  * @param dirName The name of the directory to import.
- * @param KMailRootDir The directory's root directory in KMail's folder structure.
  */
 void FilterKMail_maildir::importDirContents( FilterInfo *info, const QString& dirName)
 {
@@ -114,7 +113,45 @@
     }
 }
 
+
 /**
+ * Extract the X-Status flag from a mailfile 
+ * @param info Information storage for the operation.
+ * @param fileName The full path to the file to import
+ */
+QString FilterKMail_maildir::getMessageFlags( FilterInfo *info, const QString& fileName ) {
+	
+	QString status_flag = "";
+       
+	QFile mailfile( fileName );
+        if (! mailfile.open( IO_ReadOnly ) ) {
+            info->alert( i18n("Unable to open %1, skipping").arg( fileName ) );
+	    return status_flag;
+        } else {
+
+            QByteArray input(MAX_LINE);
+
+            while ( ! mailfile.atEnd() ) {
+                QCString seperate;
+
+                while ( ! mailfile.atEnd() && mailfile.readLine(input.data(),MAX_LINE) ) {
+
+			if ((seperate = input.data()).left(10) == "X-Status: ") {
+				status_flag = seperate;
+				status_flag.remove("X-Status: ");
+				status_flag = status_flag.stripWhiteSpace();
+				// qDebug("status_flag: %s", status_flag.latin1() );
+				break;		
+			}
+		}
+	    }
+	    mailfile.close();
+	}
+	return status_flag;
+}
+
+
+/**
  * Import the files within a Folder.
  * @param info Information storage for the operation.
  * @param dirName The name of the directory to import.
@@ -131,7 +168,9 @@
     int currentFile = 1, numFiles = files.size();
     for ( QStringList::Iterator mailFile = files.begin(); mailFile != files.end(); ++mailFile, ++currentFile) {
         if(info->shouldTerminate()) return;
+
         QString temp_mailfile = *mailFile;
+
         if (!(temp_mailfile.endsWith(".index") || temp_mailfile.endsWith(".index.ids") ||
                 temp_mailfile.endsWith(".index.sorted") || temp_mailfile.endsWith(".uidcache") )) {
             if(!generatedPath) {
@@ -160,13 +199,15 @@
                 generatedPath = true;
             }
 
+	    QString msg_flag = getMessageFlags(info, dir.filePath(*mailFile)); 
+
             if(info->removeDupMsg) {
-                if(! addMessage( info, _path, dir.filePath(*mailFile) )) {
+                if(! addMessage( info, _path, dir.filePath(*mailFile), msg_flag )) {
                     info->addLog( i18n("Could not import %1").arg( *mailFile ) );
                 }
                 info->setCurrent((int) ((float) currentFile / numFiles * 100));
             } else {
-                if(! addMessage_fastImport( info, _path, dir.filePath(*mailFile) )) {
+                if(! addMessage_fastImport( info, _path, dir.filePath(*mailFile), msg_flag )) {
                     info->addLog( i18n("Could not import %1").arg( *mailFile ) );
                 }
                 info->setCurrent((int) ((float) currentFile / numFiles * 100));
@@ -174,3 +215,4 @@
         }
     }
 }
+
Index: kmailcvt/filter_kmail_maildir.hxx
===================================================================
--- kmailcvt/filter_kmail_maildir.hxx	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmailcvt/filter_kmail_maildir.hxx	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -34,6 +34,8 @@
 private:
     QString mailDir;
 
+    QString getMessageFlags(FilterInfo*, const QString&);
+
     void importDirContents(FilterInfo*, const QString&);
     void importFiles(FilterInfo*, const QString&);
 };
Index: kmailcvt/filter_lnotes.cxx
===================================================================
--- kmailcvt/filter_lnotes.cxx	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmailcvt/filter_lnotes.cxx	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -124,7 +124,6 @@
                             addMessage_fastImport( inf, folder, tempfile->name() );
 
                         tempfile->unlink();
-                        delete tempfile;
                         state = 0;
 
                         int currentPercentage = (int) ( ( (float) f.at() / filenameInfo.size() ) * 100 );
Index: kmailcvt/filter_mailapp.cxx
===================================================================
--- kmailcvt/filter_mailapp.cxx	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmailcvt/filter_mailapp.cxx	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -47,86 +47,100 @@
     bool first_msg = true;
 
     QString directory = KFileDialog::getExistingDirectory( QDir::homeDirPath(), info->parent() );
-    info->setOverall(0);
 
-    //   kdDebug() << "starting by looking in directory " << directory << endl;
-    traverseDirectory(directory);
+    //qDebug("starting by looking in directory: %s", directory.latin1());
+    if ( directory.isEmpty() ) {
+        info->addLog( i18n("No directory selected."));
+        info->addLog( i18n("No files found for import."));
+    } else {
+        info->setOverall(0);
+        traverseDirectory(info, directory);
 
-    for ( QStringList::Iterator filename = mMboxFiles.begin(); filename != mMboxFiles.end(); ++filename, ++currentFile) {
-        if ( info->shouldTerminate() ) break;
-        QFile mbox( *filename );
-        if (! mbox.open( IO_ReadOnly ) ) {
-            info->alert( i18n("Unable to open %1, skipping").arg( *filename ) );
-        } else {
-            QFileInfo filenameInfo( *filename );
-            kdDebug() << "importing filename " << *filename << endl;
-            QStringList name = QStringList::split("/", *filename);
-            QString folderName(name[name.count() - 2]);
+        for ( QStringList::Iterator filename = mMboxFiles.begin(); filename != mMboxFiles.end(); ++filename, ++currentFile) {
+            if ( info->shouldTerminate() ) break;
+            QFile mbox( *filename );
+            if (! mbox.open( IO_ReadOnly ) ) {
+                info->alert( i18n("Unable to open %1, skipping").arg( *filename ) );
+            } else {
+                QFileInfo filenameInfo( *filename );
+                kdDebug() << "importing filename " << *filename << endl;
+                QStringList name = QStringList::split("/", *filename);
+                QString folderName(name[name.count() - 2]);
 
-            info->setCurrent(0);
-            info->addLog( i18n("Importing emails from %1...").arg( *filename ) );
-            info->setFrom( *filename );
-            info->setTo( folderName );
+                info->setCurrent(0);
+                info->addLog( i18n("Importing emails from %1...").arg( *filename ) );
+                info->setFrom( *filename );
+                info->setTo( folderName );
 
-            QByteArray input(MAX_LINE);
-            long l = 0;
+                QByteArray input(MAX_LINE);
+                long l = 0;
 
-            while ( ! mbox.atEnd() ) {
-                KTempFile tmp;
-                /* comment by Danny:
-                * Don't use QTextStream to read from mbox, etter use QDataStream. QTextStream only 
-                * support Unicode/Latin1/Locale. So you lost information from emails with 
-                * charset!=Unicode/Latin1/Locale (e.g. KOI8-R) and Content-Transfer-Encoding != base64 
-                * (e.g. 8Bit). It also not help to convert the QTextStream to Unicode. By this you
-                * get Unicode/UTF-email but KMail can't detect the correct charset.
-                */
-                QCString seperate;
+                while ( ! mbox.atEnd() ) {
+                    KTempFile tmp;
+                    /* comment by Danny:
+                    * Don't use QTextStream to read from mbox, etter use QDataStream. QTextStream only 
+                    * support Unicode/Latin1/Locale. So you lost information from emails with 
+                    * charset!=Unicode/Latin1/Locale (e.g. KOI8-R) and Content-Transfer-Encoding != base64 
+                    * (e.g. 8Bit). It also not help to convert the QTextStream to Unicode. By this you
+                    * get Unicode/UTF-email but KMail can't detect the correct charset.
+                    */
+                    QCString seperate;
 
-                if(!first_msg)
+                    if(!first_msg)
+                        tmp.file()->writeBlock( input, l );
+                    l = mbox.readLine( input.data(),MAX_LINE); // read the first line, prevent "From "
                     tmp.file()->writeBlock( input, l );
-                l = mbox.readLine( input.data(),MAX_LINE); // read the first line, prevent "From "
-                tmp.file()->writeBlock( input, l );
 
-                while ( ! mbox.atEnd() &&  (l = mbox.readLine(input.data(),MAX_LINE)) && ((seperate = input.data()).left(5) != "From ")) {
-                    tmp.file()->writeBlock( input, l );
-                }
-                tmp.close();
-                first_msg = false;
+                    while ( ! mbox.atEnd() &&  (l = mbox.readLine(input.data(),MAX_LINE)) && ((seperate = input.data()).left(5) != "From ")) {
+                        tmp.file()->writeBlock( input, l );
+                    }
+                    tmp.close();
+                    first_msg = false;
 
-                /* comment by Danny Kukawka:
-                 * addMessage() == old function, need more time and check for duplicates
-                 * addMessage_fastImport == new function, faster and no check for duplicates
-                 */
-                if(info->removeDupMsg)
-                    addMessage( info, folderName, tmp.name() );
-                else
-                    addMessage_fastImport( info, folderName, tmp.name() );
+                    // force stop if user chancel the import
+                    if ( info->shouldTerminate() ) {
+                    tmp.unlink(); 
+                    break;
+                    }
 
-                tmp.unlink();
+                    /* comment by Danny Kukawka:
+                    * addMessage() == old function, need more time and check for duplicates
+                    * addMessage_fastImport == new function, faster and no check for duplicates
+                    */
+                    if(info->removeDupMsg)
+                        addMessage( info, folderName, tmp.name() );
+                    else
+                        addMessage_fastImport( info, folderName, tmp.name() );
 
-                int currentPercentage = (int) ( ( (float) mbox.at() / filenameInfo.size() ) * 100 );
-                info->setCurrent( currentPercentage );
-                if (currentFile == 1)
-                    overall_status = (int)( currentPercentage*((float)currentFile/mMboxFiles.count()));
-                else
-                    overall_status = (int)(((currentFile-1)*(100.0/(float)mMboxFiles.count()))+(currentPercentage*(1.0/(float)mMboxFiles.count())));
-                info->setOverall( overall_status );
-                if ( info->shouldTerminate() ) break;
-            }
+                    tmp.unlink();
 
-            info->addLog( i18n("Finished importing emails from %1").arg( *filename ) );
-            if (count_duplicates > 0) {
-                info->addLog( i18n("1 duplicate message not imported to folder %1 in KMail", 
-                                   "%n duplicate messages not imported to folder %1 in KMail", count_duplicates).arg(folderName));
+                    int currentPercentage = (int) ( ( (float) mbox.at() / filenameInfo.size() ) * 100 );
+                    info->setCurrent( currentPercentage );
+                    if (currentFile == 1)
+                        overall_status = (int)( currentPercentage*((float)currentFile/mMboxFiles.count()));
+                    else
+                        overall_status = (int)(((currentFile-1)*(100.0/(float)mMboxFiles.count()))+(currentPercentage*(1.0/(float)mMboxFiles.count())));
+                    info->setOverall( overall_status );
+                    if ( info->shouldTerminate() ) break;
+                }
+
+                info->addLog( i18n("Finished importing emails from %1").arg( *filename ) );
+                if (count_duplicates > 0) {
+                    info->addLog( i18n("1 duplicate message not imported to folder %1 in KMail", 
+                                    "%n duplicate messages not imported to folder %1 in KMail", count_duplicates).arg(folderName));
+                }
+                count_duplicates = 0;
+                mbox.close();
             }
-            count_duplicates = 0;
-            mbox.close();
         }
     }
+    
     if (info->shouldTerminate()) info->addLog( i18n("Finished import, canceled by user."));
+    info->setCurrent(100);
+    info->setOverall(100);
 }
 
-void FilterMailApp::traverseDirectory(const QString &dirName)
+void FilterMailApp::traverseDirectory(FilterInfo *info, const QString &dirName)
 {
     QDir dir(dirName);
     dir.setFilter(QDir::Dirs | QDir::Files);
@@ -134,13 +148,16 @@
     const QFileInfoList *fileinfolist = dir.entryInfoList();
     QFileInfoListIterator it(*fileinfolist);
     QFileInfo *fi;
+
+    if ( info->shouldTerminate() ) return;
+
     while ((fi = it.current())) {
         if (fi->fileName() == "." || fi->fileName() == "..") {
             ++it;
             continue;
         }
         if (fi->isDir() && fi->isReadable()) {
-            traverseDirectory(fi->filePath());
+            traverseDirectory(info, fi->filePath());
         } else {
             if (!fi->isDir() && fi->fileName() == "mbox") {
                 kdDebug() << "adding the file " << fi->filePath() << endl;
Index: kmailcvt/filter_mailapp.hxx
===================================================================
--- kmailcvt/filter_mailapp.hxx	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmailcvt/filter_mailapp.hxx	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -30,7 +30,7 @@
 
 private:
     QStringList mMboxFiles;
-    void traverseDirectory(const QString &);
+    void traverseDirectory(FilterInfo *info, const QString &);
 };
 
 #endif
Index: kmailcvt/filter_mbox.cxx
===================================================================
--- kmailcvt/filter_mbox.cxx	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kmailcvt/filter_mbox.cxx	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -77,21 +77,34 @@
                 * get Unicode/UTF-email but KMail can't detect the correct charset.
                 */
                 QCString seperate;
+		QString x_status_flag = "";
 
-                if(!first_msg)
+		/* check if the first line start with "From " (and not "From: ") and discard the line 
+		 * in this case because some IMAP servers (e.g. Cyrus) don't accept this header line */
+                if(!first_msg && ((seperate = input.data()).left(5) != "From "))
                     tmp.file()->writeBlock( input, l );
+
                 l = mbox.readLine( input.data(),MAX_LINE); // read the first line, prevent "From "
-                tmp.file()->writeBlock( input, l );
 
+		if ((seperate = input.data()).left(5) != "From ")
+	                tmp.file()->writeBlock( input, l );
+
                 while ( ! mbox.atEnd() &&  (l = mbox.readLine(input.data(),MAX_LINE)) && ((seperate = input.data()).left(5) != "From ")) {
-                       tmp.file()->writeBlock( input, l );
-                       
-                       // workaround to fix hang if a corrupted mbox contains some 
-                       // binary data, for more see bug #106796
-                       if (mbox.at() == filepos)
-                           mbox.at(mbox.size());
-                       else 
-                           filepos = mbox.at();
+			tmp.file()->writeBlock( input, l );
+
+			if ((seperate = input.data()).left(10) == "X-Status: ") {
+				x_status_flag = seperate;
+				x_status_flag.remove("X-Status: ");
+				x_status_flag = x_status_flag.stripWhiteSpace();
+				// qDebug("x_status_flag: %s", x_status_flag.latin1() );		
+			}
+
+			// workaround to fix hang if a corrupted mbox contains some 
+			// binary data, for more see bug #106796
+			if (mbox.at() == filepos)
+			   mbox.at(mbox.size());
+			else 
+			   filepos = mbox.at();
                 }
                 tmp.close();
                 first_msg = false;
@@ -101,9 +114,9 @@
                 * addMessage_fastImport == new function, faster and no check for duplicates
                 */
                 if(info->removeDupMsg)
-                    addMessage( info, folderName, tmp.name() );
+                    addMessage( info, folderName, tmp.name(), x_status_flag );
                 else
-                    addMessage_fastImport( info, folderName, tmp.name() );
+                    addMessage_fastImport( info, folderName, tmp.name(), x_status_flag );
 
                 tmp.unlink();
                 int currentPercentage = (int) ( ( (float) mbox.at() / filenameInfo.size() ) * 100 );
Index: kaddressbook/interfaces/kaddressbook_extension.desktop
===================================================================
--- kaddressbook/interfaces/kaddressbook_extension.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/interfaces/kaddressbook_extension.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -15,6 +15,7 @@
 Comment[es]=Plugin de extensión de KAddressBook
 Comment[et]=KDE aadressiraamatu laiendi plugin
 Comment[eu]=KAddressBook-en luzapen plugin-a
+Comment[fa]=وصلۀ پسوند KAddressBook
 Comment[fi]=KAddressbookin laajennusliitännäinen
 Comment[fr]=Module d'extension pour KAddressBook
 Comment[he]=תוסף הרחבה עבור פנקס הכתובות
Index: kaddressbook/interfaces/kaddressbook_xxport.desktop
===================================================================
--- kaddressbook/interfaces/kaddressbook_xxport.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/interfaces/kaddressbook_xxport.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -16,6 +16,7 @@
 Comment[es]=Plugin para importar/exportar en KAddressBook
 Comment[et]=KDE aadressiraamatu import/eksportplugin
 Comment[eu]=KAddressBook-en inportazio/esportazio plugin-a
+Comment[fa]=وصلۀ صادرات/واردات KAddressBook
 Comment[fi]=KAddressbookin tuonti/vienti-liitännäinen
 Comment[fr]=Module d'import / export pour KAddressBook
 Comment[he]=תוסף ייבוא/יצוא עבור פנקס הכתובות
Index: kaddressbook/interfaces/kaddressbook_contacteditorwidget.desktop
===================================================================
--- kaddressbook/interfaces/kaddressbook_contacteditorwidget.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/interfaces/kaddressbook_contacteditorwidget.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Comment[es]=Accesorio de elemento de editor de contactos para KAddressBook
 Comment[et]=KDE aadressiraamatu kontaktide redigeerimise plugin
 Comment[eu]=KAddressBook-en kontaktu editore trepetaren plugin-a
+Comment[fa]=وصلۀ عنصر ویرایشگر تماس KAddressBook
 Comment[fi]=Osoitekirjan yhteystietojen muokkainliitännäinen
 Comment[fr]=Module d'édition de contacts de KAddressBook
 Comment[he]=תוסף תצוגה עבור עורך אנשי קשר של פנקס הכתובות
Index: kaddressbook/dcopaddressbook.desktop
===================================================================
--- kaddressbook/dcopaddressbook.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/dcopaddressbook.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -16,6 +16,7 @@
 Comment[es]=Libreta de direcciones con un interfaz DCOP
 Comment[et]=Aadressiraamat DCOP-liidesega
 Comment[eu]=DCOP interfazedun helbide-liburua
+Comment[fa]=کتاب نشانی با یک واسط DCOP
 Comment[fi]=Osoitekirja DCOP-rajapinnalla
 Comment[fr]=Carnet d'adresses avec une interface DCOP
 Comment[gl]=Libro de enderezos con interface DCOP
Index: kaddressbook/kaddressbook.desktop
===================================================================
--- kaddressbook/kaddressbook.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/kaddressbook.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -15,6 +15,7 @@
 Name[sv]=Adressbok
 Name[ta]=கேமுகவரிப் புத்தகம்
 Name[tr]=KDE Adres Defteri
+Name[zh_TW]=KAddressBook 通訊錄
 GenericName=Address Manager
 GenericName[bg]=Адресник
 GenericName[br]=Merour ar chomlec'hioù
@@ -27,6 +28,7 @@
 GenericName[es]=Gestor de direcciones
 GenericName[et]=Aadressihaldur
 GenericName[eu]=Helbide kudeatzailea
+GenericName[fa]=مدیر نشانی‌
 GenericName[fi]=Osoitteenhallinta
 GenericName[fr]=Gestionnaire d'adresses
 GenericName[ga]=Bainisteoir na Seoltaí
Index: kaddressbook/csv-templates/outlook2000.desktop
===================================================================
--- kaddressbook/csv-templates/outlook2000.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/csv-templates/outlook2000.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -8,6 +8,7 @@
 Name=Outlook 2000
 Name[ar]=برنامج Outlook 2000
 Name[eo]=Redmondo 2000
+Name[fa]=اوت لوک ۲۰۰۰
 Name[hi]=आउटलुक 2000
 Name[nso]=Bokantle 2000
 Name[ta]=அவுட்லுக் 2000
Index: kaddressbook/csv-templates/yahoo.desktop
===================================================================
--- kaddressbook/csv-templates/yahoo.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/csv-templates/yahoo.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -20,6 +20,7 @@
 Name[es]=Libreta de direcciones de Yahoo!
 Name[et]=Yahoo! aadressiraamat
 Name[eu]=Yahoo! helbide-liburua
+Name[fa]=کتاب نشانی یاهو!
 Name[fi]=Yahoo-osoitekirja
 Name[fr]=Carnet d'adresses Yahoo!
 Name[he]=פנקס כתובת של Yahoo!
Index: kaddressbook/views/tableview.desktop
===================================================================
--- kaddressbook/views/tableview.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/views/tableview.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -15,6 +15,7 @@
 Name[es]=Vista de tabla
 Name[et]=Tabelivaade
 Name[eu]=Taula ikupegia
+Name[fa]=نمای تابلو
 Name[fi]=Taulukkonäkymä
 Name[fr]=Vue en tableaux
 Name[gl]=Vista de árbore
Index: kaddressbook/views/iconview.desktop
===================================================================
--- kaddressbook/views/iconview.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/views/iconview.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -18,6 +18,7 @@
 Name[es]=Vista de icono
 Name[et]=Ikoonivaade
 Name[eu]=Ikono ikuspegia
+Name[fa]=نمای شمایل
 Name[fi]=Kuvakenäkymä
 Name[fr]=Icônes
 Name[ga]=Amharc Deilbhíní
Index: kaddressbook/views/cardview.desktop
===================================================================
--- kaddressbook/views/cardview.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/views/cardview.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -15,6 +15,7 @@
 Name[es]=Vista de tarjeta
 Name[et]=Kaardivaade
 Name[eu]=Txartel ikuspegia
+Name[fa]=نمای کارت‌
 Name[fi]=Korttinäkymä
 Name[fr]=Vue en cartes
 Name[gl]=Vista de tarxetas
Index: kaddressbook/xxport/kde2_xxport.desktop
===================================================================
--- kaddressbook/xxport/kde2_xxport.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/xxport/kde2_xxport.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Plugin KAB para {im,ex}portar KDE2
 Name[et]=KAB KDE2 importplugin
 Name[eu]=KAB-en KDE2 in/esportazio plugin-a
+Name[fa]=وصلۀ KAB KDE2 XXPort 
 Name[fi]=KAB KDE2 -liitännäinen
 Name[fr]=Module d'import / export de KDE 2 pour KAB
 Name[he]=תוסף ייבוא/ייצוא עבור KDE2 של KAB
@@ -55,6 +56,7 @@
 Comment[es]=Plugin para importar de la libreta de direcciones de KDE 2
 Comment[et]=Plugin vana KDE2 aadressiraamatu importimiseks
 Comment[eu]=KDE2-ko helbide-liburu zaharrak inporatzeko plugin-a
+Comment[fa]=وصله برای واردات کتاب نشانی قدیمی KDE ۲
 Comment[fi]=Liitännäinen vanhan KDE2-osoitekirjan tuontiin
 Comment[fr]=Module d'import du vieux carnet d'adresses de KDE 2
 Comment[hi]=पुराना केडीई 2 पता पुस्तिका को आयात के लिए प्लगइन
@@ -65,7 +67,7 @@
 Comment[km]=កម្មវិធី​ជំនួយ​ដើម្បី​នាំចូល​សៀវភៅ​អាសយដ្ឋាន KDE 2 ចាស់ៗ
 Comment[lt]=Priedas senosios KDE 2 adresų knygelės importui
 Comment[ms]=Plug masuk untuk import buku alamat lama KDE 2
-Comment[nb]=Tilleggsprogram for å importere adressebok fra KDE2
+Comment[nb]=Programtillegg for å importere adressebok fra KDE2
 Comment[nds]=Moduul för't Importeren vun KDE2-Adressböker
 Comment[nl]=Plugin voor het importeren van het oude KDE 2-adresboek
 Comment[nn]=Programtillegg for å importera den gamle KDE 2 adresseboka
Index: kaddressbook/xxport/gnokii_xxport.cpp
===================================================================
--- kaddressbook/xxport/gnokii_xxport.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/xxport/gnokii_xxport.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -124,6 +124,8 @@
 
 static QString businit(void)
 {
+	GNOKII_DEBUG( "Using new gnokii version." );
+
 	GNOKII_DEBUG( QString("Compiled with libgnokii version 0x%1\n").arg(QString::number(LIBGNOKII_VERSION,16)) );
 	GNOKII_DEBUG( QString("Using libgnokii runtime version 0x%1\n").arg(QString::number(gn_lib_version(),16)) );
 
@@ -437,15 +439,16 @@
 		s = phonenumber->number();
 		if (s.isEmpty()) continue;
 		gn_phonebook_number_type type;
-		switch (phonenumber->type() & ~KABC::PhoneNumber::Pref) {
-			case KABC::PhoneNumber::Home:	type = GN_PHONEBOOK_NUMBER_Home;	break;
-			case KABC::PhoneNumber::Voice:
-			case KABC::PhoneNumber::Work:	type = GN_PHONEBOOK_NUMBER_Work;	break;
-			case KABC::PhoneNumber::Pager:
-			case KABC::PhoneNumber::Cell:	type = GN_PHONEBOOK_NUMBER_Mobile;	break;
-			case KABC::PhoneNumber::Fax:	type = GN_PHONEBOOK_NUMBER_Fax;		break;
-			default:			type = GN_PHONEBOOK_NUMBER_General;	break;
-		}
+		int pn_type = phonenumber->type();
+		if ((pn_type & KABC::PhoneNumber::Cell))
+			type = GN_PHONEBOOK_NUMBER_Mobile;
+		else if ((pn_type & KABC::PhoneNumber::Fax))
+			type = GN_PHONEBOOK_NUMBER_Fax;
+		else if ((pn_type & KABC::PhoneNumber::Home))
+			type = GN_PHONEBOOK_NUMBER_Home;
+		else if ((pn_type & KABC::PhoneNumber::Work))
+			type = GN_PHONEBOOK_NUMBER_Work;
+		else type = GN_PHONEBOOK_NUMBER_General;
 		gn_lib_set_pb_subentry(state, -1 /* index to append entry */,
 			GN_PHONEBOOK_ENTRY_Number, type, makeValidPhone(s).ascii());
 		/*subentry->id = phone_location<<8+entry.subentries_count;*/
@@ -810,6 +813,8 @@
 	gn_error error;
 	char *aux;
 
+	GNOKII_DEBUG( "Using old gnokii version." );
+
 #if defined(LIBGNOKII_VERSION)
 	if (gn_cfg_read_default()<0)
 #else
@@ -1207,15 +1212,16 @@
 		if (s.isEmpty()) continue;
 		subentry->entry_type  = GN_PHONEBOOK_ENTRY_Number;
 		gn_phonebook_number_type type;
-		switch (phonenumber->type() & ~KABC::PhoneNumber::Pref) {
-			case KABC::PhoneNumber::Home:	type = GN_PHONEBOOK_NUMBER_Home;	break;
-			case KABC::PhoneNumber::Voice:
-			case KABC::PhoneNumber::Work:	type = GN_PHONEBOOK_NUMBER_Work;	break;
-			case KABC::PhoneNumber::Pager:
-			case KABC::PhoneNumber::Cell:	type = GN_PHONEBOOK_NUMBER_Mobile;	break;
-			case KABC::PhoneNumber::Fax:	type = GN_PHONEBOOK_NUMBER_Fax;		break;
-			default:			type = GN_PHONEBOOK_NUMBER_General;	break;
-		}
+		int pn_type = phonenumber->type();
+		if ((pn_type & KABC::PhoneNumber::Cell))
+			type = GN_PHONEBOOK_NUMBER_Mobile;
+		else if ((pn_type & KABC::PhoneNumber::Fax))
+			type = GN_PHONEBOOK_NUMBER_Fax;
+		else if ((pn_type & KABC::PhoneNumber::Home))
+			type = GN_PHONEBOOK_NUMBER_Home;
+		else if ((pn_type & KABC::PhoneNumber::Work))
+			type = GN_PHONEBOOK_NUMBER_Work;
+		else type = GN_PHONEBOOK_NUMBER_General;
 		subentry->number_type = type;
 		strncpy(subentry->data.number, makeValidPhone(s).ascii(), sizeof(subentry->data.number)-1);
 		subentry->id = phone_location<<8+entry.subentries_count;
Index: kaddressbook/xxport/csv_xxport.desktop
===================================================================
--- kaddressbook/xxport/csv_xxport.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/xxport/csv_xxport.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Plugin de KAB para {im,ex}portar CSV
 Name[et]=KAB CSV eksport/importplugin
 Name[eu]=KAB-en CSV in/esportazioa plugin-a
+Name[fa]=وصلۀ KAB CSV XXPort
 Name[fi]=KAB CSV -liitännäinen
 Name[fr]=Module d'import / export CSV pour KAB
 Name[he]=תוסף ייבוא/ייצוא של קבצי CSV של KAB
@@ -54,6 +55,7 @@
 Comment[es]=Plugin para importar y exportar contactos en formato CSV
 Comment[et]=Plugin kontaktide importimiseks ja eksportimiseks CSV vormingus
 Comment[eu]=CSV formatuan kontaktuak esportatu eta inportatzeko plugin-a
+Comment[fa]=وصله برای واردات و صادرات تماسها در قالب CSV
 Comment[fi]=Liitännäinen kontaktien vientiin ja tuontiin CSV-muodossa
 Comment[fr]=Module d'import / export de contacts au format CSV
 Comment[hi]=सम्पर्कों को सीएसवी फार्मेट में निर्यात करने का प्लगइन
@@ -64,7 +66,7 @@
 Comment[km]=កម្មវិធី ជំនួយ​ដើម្បី​នាំចូល និង នាំចេញ​ទំនាក់ទំនង​ក្នុង​ទ្រង់ទ្រាយ​ជា CSV ។
 Comment[lt]=Priedas, skirtas kontaktų eksportui ir importui CSV formatu
 Comment[ms]=Plug masuk untuk import dan eksport alamat perhubungan di dalam format CSV
-Comment[nb]=Tilleggsprogram for import/eksport av kontakter i CSV-format
+Comment[nb]=Programtillegg for import/eksport av kontakter i CSV-format
 Comment[nds]=Moduul för't Im- un Exporteren vun Kontakten in't CSV-Formaat
 Comment[nl]=Plugin voor het importeren en exporteren van contactpersonen in CSV-formaat
 Comment[nn]=Programtillegg for å importera og eksportera kontaktar i CSV-format
Index: kaddressbook/xxport/vcard_xxport.desktop
===================================================================
--- kaddressbook/xxport/vcard_xxport.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/xxport/vcard_xxport.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Plugin KAB para {im,ex}portar vCard
 Name[et]=KAB vCardi eksport/importplugin
 Name[eu]=KAB-en vCard in/esportazio plugin-a
+Name[fa]=وصلۀ KAB vCard XXPort 
 Name[fi]=KAB vCard liitännäinen
 Name[fr]=Module d'import / export vCard pour KAB
 Name[he]=תוסף ייבוא/ייצוא עבור vCard של KAB
@@ -56,6 +57,7 @@
 Comment[es]=Plugin para importar y exportar contactos en formato vCard
 Comment[et]=Plugin kontaktide importimiseks ja eksportimiseks vCardi vormingus
 Comment[eu]=vCard formatuko kontaktuak in/esportatzeko plugin-a
+Comment[fa]=وصله برای واردات و صادرات تماسها در قالب  vCard
 Comment[fi]=Liitännäinen vCard-muodossa olevien kontaktien tuontiin ja vientiin
 Comment[fr]=Module d'import / export de contacts au format vCard
 Comment[gl]=Plugin para importar e exportar contactos en formato vCard
@@ -67,7 +69,7 @@
 Comment[km]=កម្មវិធី​ជំនួយ​ដើម្បី​នាំចូល និង នាំចេញ​ទំនាក់ទំនង​ក្នុង​ទ្រង់ទ្រាយ​ជា vCard
 Comment[lt]=Įskiepis kontaktų importavimui ir eksportavimui vCard formatu
 Comment[ms]=Plugin untuk mengimpot dan mengekspot orang hubungan dalam format vCard 
-Comment[nb]=Tilleggsprogram for import og eksport av kontakter i vCard-format
+Comment[nb]=Programtillegg for import og eksport av kontakter i vCard-format
 Comment[nds]=Moduul för't Im-/Exporteren vun Kontakten in't vCard-Formaat
 Comment[nl]=Plugin voor het importeren en exporteren van contactpersonen in vCard-formaat
 Comment[nn]=Programtillegg for å importera og eksportera kontaktar i vCard-format
Index: kaddressbook/xxport/pab_xxport.desktop
===================================================================
--- kaddressbook/xxport/pab_xxport.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/xxport/pab_xxport.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Name[es]=Plugin de KAB para {im,ex}portar libretas de direcciones personales de MS Exchange
 Name[et]=KAB MS Exchange personaalse aadressiraamatu importplugin
 Name[eu]=KAB-en MS Exchange Personal helbide-liburu in/esportazio plugin-a
+Name[fa]=وصلۀ XXPort  کتاب نشانی شخصی مبادلۀ KAB MS
 Name[fi]=KAB MS Exchangen henkilökohtaisen osoitekirjan liitännäinen
 Name[fr]=Module d'import / export de carnets d'adresses personnels de MS Exchange pour KAB
 Name[hi]=केएबी एमएस एक्सचेंज निजी पता पुस्तिका XXपोर्ट प्लगइन
@@ -22,7 +23,7 @@
 Name[km]=កម្មវិធី​ជំនួយ KAB MS Exchange Personal Addressbook XXPort
 Name[lt]=KAB MS Exchange asmeninės adresų knygelės XXPort priedas
 Name[ms]=Plugin Buku Alamat Peribadi KAB MS Exchange  XXPort Plugin
-Name[nb]=KAB-tilleggsprogram for import fra MS Exchange
+Name[nb]=KAB-programtillegg for import fra MS Exchange
 Name[nds]=MSExchange-Importmoduul för KAdressbook
 Name[nl]=KAB MS Exchange Personal Addressbook XXPort-plugin
 Name[nn]=KAB MS Exchange personleg adressebok XXPort programtillegg
@@ -54,6 +55,7 @@
 Comment[es]=Plugin para importar libretas de direcciones personales de MS Exchange
 Comment[et]=Plugin MS Exchange personaalse aadressiraamatu importimiseks
 Comment[eu]=MS Exchange Personal helbid-liburuak in/esportatzeko plugina-
+Comment[fa]=وصله برای واردات کتابهای نشانی شخصی مبادلۀ  MS
 Comment[fi]=Liitännäinen MS Exchangen henkilökohtaisten osoitekirjojen tuontiin
 Comment[fr]=Module d'import des carnets d'adresses personnels MS Exchange
 Comment[hi]=एमएस एक्सचेंज निजी पता पुस्तिका को आयात करने का प्लगइन
@@ -64,7 +66,7 @@
 Comment[km]=កម្មវិធី​ជំនួយ​ដើម្បី​នាំចូល​សៀវភៅ​អាសយដ្ឋាន​ផ្ទាល់​ខ្លួន​របស់ MS Exchange
 Comment[lt]=Priedas leidžiantis importuoti MS Exchange asmenines adresų knygeles
 Comment[ms]=Plugin untuk mengimpot Buku Alamat Peribadi MS Exchange 
-Comment[nb]=Tilleggsprogram for import av personlige adressebøker fra MS Exchange
+Comment[nb]=Programtillegg for import av personlige adressebøker fra MS Exchange
 Comment[nds]=Moduul för't Importeren vun persöönliche Adressböker ut MS Exchange
 Comment[nl]=Plugin voor het importeren van MS Exchange-adresboeken
 Comment[nn]=Programtillegg for å imortera MS Exchange personleg adressebok
Index: kaddressbook/xxport/opera_xxport.desktop
===================================================================
--- kaddressbook/xxport/opera_xxport.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/xxport/opera_xxport.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Plugin KAB para {im,ex}portar Opera
 Name[et]=KAB Opera importplugin
 Name[eu]=KAB-en Opera in/esportazio plugin-a
+Name[fa]=وصلۀ KAB Opera XXPort 
 Name[fi]=KAB Opera -liitännäinen
 Name[fr]=Module d'import / export Opera pour KAB
 Name[he]=תוסף ייבוא/ייצוא עבור Opera של KAB
@@ -55,6 +56,7 @@
 Comment[es]=Plugin para importar contactos de Opera
 Comment[et]=Plugin Opera kontaktide importimiseks
 Comment[eu]=Operaren kontaktuak inportatzeko plugin-a
+Comment[fa]=وصله برای واردات تماسهای Opera 
 Comment[fi]=Liitännäinen Operan kontaktien tuomiseen
 Comment[fr]=Module d'import de contacts Opera
 Comment[hi]=ऑपेरा सम्पर्कों को आयात करने का प्लगइन
@@ -65,7 +67,7 @@
 Comment[km]=កម្មវិធី​ជំនួយ​ដើម្បី​នាំចូល​ទំនាក់ទំនង​របស់ Opera
 Comment[lt]=Priedas Opera kontaktų importui
 Comment[ms]=Plug masuk untuk import alamat perhubungan Opera
-Comment[nb]=Tilleggsprogram for å importere Opera-kontakter
+Comment[nb]=Programtillegg for å importere Opera-kontakter
 Comment[nds]=Modul för't Importeren vun Opera-Kontakten
 Comment[nl]=Plugin voor het importeren an Opera's contactpersonen
 Comment[nn]=Programtillegg for å imortera Opera-kontaktar
Index: kaddressbook/xxport/gnokii_xxport.desktop
===================================================================
--- kaddressbook/xxport/gnokii_xxport.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/xxport/gnokii_xxport.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -12,6 +12,7 @@
 Name[es]=Plugin de KAB para {im,ex}portar números de móvil
 Name[et]=KAB mobiiltelefoni eksport/importplugin
 Name[eu]=KAB-en mugikorren in/esporatazio plugin-a
+Name[fa]=وصلۀ XXPort تلفن همراه KAB
 Name[fi]=KAB-matkapuhelinliitännäinen
 Name[fr]=Module d'import / export de téléphone portable pour KAB
 Name[he]=תוסף ייבוא/ייצוא עבור טלפונים ניידים של KAB
@@ -23,7 +24,7 @@
 Name[km]=កម្មវិធី​ជំនួយ KAB Mobile Phone XXPort
 Name[lt]=KAB mobilaus telefono XXPort priedas
 Name[ms]=Plug masuk KAB Fon Mudah Alih XXPort
-Name[nb]=KAB-tilleggsprogram for mobiltelefon
+Name[nb]=KAB-programtillegg for mobiltelefon
 Name[nds]=Mobiltelefoon-Im-/Exportmoduul för KAdressbook
 Name[nl]=KAB Mobiele Telefoon XXPort-plugin
 Name[nn]=KAB Mobiltelefon XXPort programtillegg
@@ -54,6 +55,7 @@
 Comment[es]=Plugin para importar y exportar números de móviles de las entradas de la libreta de direcciones
 Comment[et]=Mobiiltelefoni plugin aadressiraamatu kirjete importimiseks ja eksportimiseks
 Comment[eu]=Helbide-liburuko sarrerak in/esportatzeko mugikorren plugin-a
+Comment[fa]=وصلۀ تلفن همراه جهت واردات و صادرات مدخلهای کتاب نشانی‌
 Comment[fi]=Matkapuhelinliitännäinen osoitekirjan kontaktien tuontiin ja vientiin.
 Comment[fr]=Module de téléphone portable pour importer et exporter des entrées du carnet d'adresses
 Comment[hi]=पता पुस्तिका प्रविष्टियों को आयात और निर्यात करने का मोबाइल फोन प्लगइन
@@ -64,7 +66,7 @@
 Comment[km]=កម្មវិធី​ជំនួយ​ទូរស័ព្ទ​ចល័ត​ដើម្បី​នាំចូល និង នាំចេញ​ធាតុ​សៀវភៅ​អាសយដ្ឋាន
 Comment[lt]=Priedas skirtas importuoti ir eksportuoti adresų knygelės įrašus į mobiliuosius telefonus
 Comment[ms]=Plug masuk Fon Mudah Alih untuk Import dan Eksport Input Buku Alamat
-Comment[nb]=Tilleggsprogram for import/eksport av adressebok fra/til mobiltelefon
+Comment[nb]=Programtillegg for import/eksport av adressebok fra/til mobiltelefon
 Comment[nds]=Mobiltelefoon-Moduul för't Im- un Exporteren vun KAdressbook-Indrääg
 Comment[nl]=Mobiele-telefoon-plugin voor het importeren en exporteren van adresboekitems
 Comment[nn]=Programtillegg for å importera og eksportera adressebokoppføringar i mobiltelefon
Index: kaddressbook/xxport/bookmark_xxport.desktop
===================================================================
--- kaddressbook/xxport/bookmark_xxport.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/xxport/bookmark_xxport.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Plugin de KAB para {im,ex}portar marcadores
 Name[et]=KAB järjehoidjate eksportplugin
 Name[eu]=KAB-en laster-marka in/esportazio plugin-a
+Name[fa]=وصلۀ XXPort چوب الف KAB
 Name[fi]=KAB-kirjanmerkkiliitännäinen
 Name[fr]=Module d'import / export de signets pour KAB
 Name[hi]=केएबी  पसंदीदा  XXपोर्ट प्लगइन
@@ -54,6 +55,7 @@
 Comment[es]=Plugin para exportar las direcciones web de los contactos como marcadores
 Comment[et]=Plugin kontaktide veebiaadresside eksportimiseks järjehoidjatena
 Comment[eu]=Kontaktuen web-helbideak laster-markak bezala esportatzeko plugin-a
+Comment[fa]=وصله برای صادرات نشانیهای وب تماسها به عنوان چوب الفها
 Comment[fi]=Liitännäinen, joka muuntaa kontaktien sisältämät verkko-osoitteet kirjanmerkeiksi
 Comment[fr]=Module d'export des adresses internet des contacts en signets
 Comment[hi]=सम्पर्कों के वेब पते को  पसंदीदा  के रूप में निर्यात करने का प्लगइन
@@ -64,7 +66,7 @@
 Comment[km]=កម្មវិធី​ជំនួយ​ដើម្បី​នាំចេញ​អាសយដ្ឋាន​បណ្ដាញ​របស់​ទំនាក់ទំនង ជា​ចំណាំ
 Comment[lt]=Priedas skirtas žiniatinklio adresų kontaktuose eksportavimui į žymeles
 Comment[ms]= Plug masuk untuk eksport alamat web untuk perhubungan sebagai tanda laman
-Comment[nb]=Tilleggsprogram som eksporterer kontaktenes nett-addresser som bokmerker
+Comment[nb]=Programtillegg som eksporterer kontaktenes nett-addresser som bokmerker
 Comment[nds]=Moduul för't Exporteren vun Kontakt-Nettadressen as Leestekens
 Comment[nl]=Plugin voor het exporteren van de webadressen van de contactpersonen als bladwijzers
 Comment[nn]=Programtillegg for å eksportera nettadresser av kontaktar som bokmerker
Index: kaddressbook/xxport/ldif_xxport.desktop
===================================================================
--- kaddressbook/xxport/ldif_xxport.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/xxport/ldif_xxport.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Plugin para {im,ex}portar LDIF
 Name[et]=KAB LDIF eksport/importplugin
 Name[eu]=KAB-en LDIF in/esportazio plugin-a
+Name[fa]=وصلۀ KAB LDIF XXPort 
 Name[fi]=KAB LDIF -liitännäinen
 Name[fr]=Module d'import / export LDIF pour KAB
 Name[he]=תוסף ייבוא/ייצוא עבור LDIF של KAB
@@ -56,6 +57,7 @@
 Comment[es]=Plugin para importar y exportar contactos en el formato de intercambio LDIF de Netscape y Mozilla
 Comment[et]=Plugin kontaktide importimiseks ja ekportimiseks Netscape ja Mozilla LDIF vormingus
 Comment[eu]=Netscape eta Mozilla-ren LDIF formatuan kontaktuak in/esportatzeko plugin-a
+Comment[fa]=وصله برای واردات و صادرات تماسها در قالب LDIF موزیلا و نت‌اسکیپ
 Comment[fi]=Liitännäinen Netscapen ja Mozillan LDIF-muodon kontaktien tuontiin ja vientiin
 Comment[fr]=Module d'import / export des contacts au format LDIF Mozilla et Netscape
 Comment[hi]=नेटस्केप तथा मोजिला एलडीआईएफ फार्मेट में सम्पर्कों को आयात और निर्यात करने का प्लगइन
@@ -66,7 +68,7 @@
 Comment[km]=កម្មវិធី​ជំនួយ​ដើម្បី​នាំចូល និង នាំចេញ​ទំនាក់ទំនង​ក្នុង​ទ្រង់ទ្រាយ​ជា Netscape និង Mozilla LDIF
 Comment[lt]=Priedas, skirtas kontaktų importavimui ir eksportavimui Netscape ir Mozilla LDIFF formatu
 Comment[ms]=Plug masuk untuk import dan eksport alamat perhubungan di dalam format LDIF Netscape dan Mozilla
-Comment[nb]=Tilleggsprogram for import/eksport av kontakter i Netscape og Mozillas LDIF-format
+Comment[nb]=Programtillegg for import/eksport av kontakter i Netscape og Mozillas LDIF-format
 Comment[nds]=Moduul för't Im- un Exporteren vun Kontakten in't LDIF-Formaat vun Netscape und Mozilla
 Comment[nl]=Plugin voor het importeren en exporteren van contactpersonen in Netscape's en Mozilla's LDIF-formaat
 Comment[nn]=Programtillegg for å importera og eksportera kontaktar i Netscape og Mozilla LDIF-format
Index: kaddressbook/xxport/eudora_xxport.desktop
===================================================================
--- kaddressbook/xxport/eudora_xxport.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/xxport/eudora_xxport.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Plugin de KAB para {ex,im}portar de Eudora
 Name[et]=KAB Eudora eksport/importplugin
 Name[eu]=KAB-en Eudora in/esportazio plugin-a
+Name[fa]=وصلۀ KAB Eudora XXPort
 Name[fi]=KAB Euroda -liitännäinen
 Name[fr]=Module d'import / export Eudora pour KAB
 Name[he]=תוסף ייבוא/ייצוא עבור Eurdora של KAB
@@ -55,6 +56,7 @@
 Comment[es]=Plugin para importar y exportar contactos de Eudora
 Comment[et]=Plugin Eudora kontaktide importimiseks ja eksportimiseks
 Comment[eu]=Eudora kontaktuak inportatu/esportatzeko plugin-a
+Comment[fa]=وصله برای واردات و صادرات تماسهای Eudora
 Comment[fi]=Liitännäinen Eudora-kontaktien tuomiseen ja viemiseen
 Comment[fr]=Module d'import / export de contacts Eudora
 Comment[hi]=यूडोरा सम्पर्कों को आयात और निर्यात करने का प्लगइन
@@ -65,7 +67,7 @@
 Comment[km]=កម្មវិធី​ជំនួយ​ដើម្បី​នាំចូល និង នាំចេញ​ទំនាក់ទំនង​របស់ Eudora
 Comment[lt]=Priedas Eudora kontaktų importui ir eksportui
 Comment[ms]=Plug masuk untuk import dan eksport alamat perhubungan Eudora
-Comment[nb]=Tilleggsprogram for import/eksport av Eudora-kontakter
+Comment[nb]=Programtillegg for import/eksport av Eudora-kontakter
 Comment[nds]=Moduul för't Im- un Exporteren vun Eudora-Kontakten
 Comment[nl]=Plugin voor het importeren en exporteren van Eudora-contactpersonen
 Comment[nn]=Programtillegg for å importera og eksportera Eudora-kontaktar
Index: kaddressbook/editors/protocols/jabberprotocol.desktop
===================================================================
--- kaddressbook/editors/protocols/jabberprotocol.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/editors/protocols/jabberprotocol.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -17,6 +17,7 @@
 Comment[es]=Protocolo Jabber
 Comment[et]=Jabberi protokoll
 Comment[eu]=Jabber protokoloa
+Comment[fa]=قرارداد Jabber
 Comment[fi]=Jabber-protokolla
 Comment[fr]=Protocole Jabber
 Comment[ga]=Prótacal Jabber
Index: kaddressbook/editors/protocols/aimprotocol.desktop
===================================================================
--- kaddressbook/editors/protocols/aimprotocol.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/editors/protocols/aimprotocol.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -17,6 +17,7 @@
 Comment[es]=Protocolo AIM
 Comment[et]=AIM protokoll
 Comment[eu]=AIM protokoloa
+Comment[fa]=قرارداد AIM
 Comment[fi]=AIM-protokolla
 Comment[fr]=Protocole AIM
 Comment[ga]=Prótacal AIM
Index: kaddressbook/editors/protocols/meanwhileprotocol.desktop
===================================================================
--- kaddressbook/editors/protocols/meanwhileprotocol.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/editors/protocols/meanwhileprotocol.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -15,6 +15,7 @@
 Comment[es]=Protocolo Meanwhile
 Comment[et]=Meanwhile'i protokoll
 Comment[eu]=Meanwhile protokoloa
+Comment[fa]=قرارداد درضمن‌
 Comment[fi]=Meanwhile-protokolla
 Comment[fr]=Protocole Meanwhile
 Comment[ga]=Prótacal Meanwhile
@@ -45,4 +46,5 @@
 Comment[zh_CN]=Meanwhile 协议
 Comment[zh_TW]=Meanwhile 協定
 Name=Meanwhile
+Name[fa]=در ضمن‌
 
Index: kaddressbook/editors/protocols/skypeprotocol.desktop
===================================================================
--- kaddressbook/editors/protocols/skypeprotocol.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/editors/protocols/skypeprotocol.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Comment[es]=Telefonía por internet con Skype
 Comment[et]=Internetitelefon Skype
 Comment[eu]=Skype-en internet telefonia
+Comment[fa]=ارتباط تلفنی اینترنت Skype
 Comment[fi]=Skype Internet-puhelin
 Comment[fr]=Téléphonie Internet Skype
 Comment[he]=טלפוניית רשת של Skype
Index: kaddressbook/editors/protocols/icqprotocol.desktop
===================================================================
--- kaddressbook/editors/protocols/icqprotocol.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/editors/protocols/icqprotocol.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -17,6 +17,7 @@
 Comment[es]=Protocolo ICQ
 Comment[et]=ICQ protokoll
 Comment[eu]=ICQ protokoloa
+Comment[fa]=قرارداد ICQ
 Comment[fi]=ICQ-protokolla
 Comment[fr]=Protocole ICQ
 Comment[ga]=Prótacal ICQ
Index: kaddressbook/editors/protocols/ircprotocol.desktop
===================================================================
--- kaddressbook/editors/protocols/ircprotocol.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/editors/protocols/ircprotocol.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -6,6 +6,7 @@
 X-KDE-InstantMessagingKABCField=messaging/irc
 Comment=Internet Relay Chat
 Comment[bg]=Протокол IRC
+Comment[fa]=گپ بازپخش اینترنت‌
 Comment[hu]=IRC (Internet Relay Chat)
 Comment[is]=Internet spjall
 Comment[ja]=インターネット・リレー・チャット
Index: kaddressbook/editors/protocols/msnprotocol.desktop
===================================================================
--- kaddressbook/editors/protocols/msnprotocol.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/editors/protocols/msnprotocol.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -7,6 +7,7 @@
 Comment=MSN Messenger
 Comment[bg]=Протокол MSN
 Comment[cy]=Negesydd MSN
+Comment[fa]=پیام‌رسان MSN
 Comment[fr]=Messagerie MSN
 Comment[is]=MSN spjallforritið
 Comment[ja]=MSN メッセンジャー
@@ -18,6 +19,7 @@
 Name=MSN Messenger
 Name[bg]=MSN
 Name[cy]=Negesydd MSN
+Name[fa]=پیام‌رسان MSN
 Name[ja]=MSN メッセンジャー
 Name[km]=កម្មវិធី​ផ្ញើសារ MSN
 Name[nds]=MSN-Kortnarichtenmaker
Index: kaddressbook/editors/protocols/yahooprotocol.desktop
===================================================================
--- kaddressbook/editors/protocols/yahooprotocol.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/editors/protocols/yahooprotocol.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -17,6 +17,7 @@
 Comment[es]=Protocolo Yahoo
 Comment[et]=Yahoo protokoll
 Comment[eu]=Yahoo protokoloa
+Comment[fa]=قرارداد یاهو
 Comment[fi]=Yahoo-protokolla
 Comment[fr]=Protocole Yahoo
 Comment[ga]=Prótacal Yahoo
@@ -51,5 +52,6 @@
 Comment[zh_TW]=Yahoo 協定
 Name=Yahoo
 Name[de]=Yahoo!
+Name[fa]=یاهو
 Name[km]=យ៉ាហ៊ូ
 
Index: kaddressbook/editors/protocols/gaduprotocol.desktop
===================================================================
--- kaddressbook/editors/protocols/gaduprotocol.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/editors/protocols/gaduprotocol.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -17,6 +17,7 @@
 Comment[es]=Protocolo Gadu-Gadu
 Comment[et]=Gadu-Gadu protokoll
 Comment[eu]=Gadu-Gadu protokoloa
+Comment[fa]=قرارداد Gadu-Gadu
 Comment[fi]=Gadu-Gadu -protokolla
 Comment[fr]=Protocole Gadu-Gadu
 Comment[ga]=Prótacal Gadu-Gadu
Index: kaddressbook/editors/protocols/smsprotocol.desktop
===================================================================
--- kaddressbook/editors/protocols/smsprotocol.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/editors/protocols/smsprotocol.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -17,6 +17,7 @@
 Comment[es]=Protocolo SMS
 Comment[et]=SMS protokoll
 Comment[eu]=SMS protokoloa
+Comment[fa]=قرارداد پیام کوتاه‌
 Comment[fi]=SMS-protokolla
 Comment[fr]=Protocole SMS
 Comment[ga]=Prótacal SMS
@@ -50,6 +51,7 @@
 Comment[zh_CN]=短信息协议
 Comment[zh_TW]=SMS 協定
 Name=SMS
+Name[fa]=پیام کوتاه‌
 Name[km]=សេវា​សារ​ខ្លីៗ
 Name[zh_CN]=短信息
 
Index: kaddressbook/editors/protocols/groupwiseprotocol.desktop
===================================================================
--- kaddressbook/editors/protocols/groupwiseprotocol.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/editors/protocols/groupwiseprotocol.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Comment[es]=Servidor de mensajería de Novell GroupWise
 Comment[et]=Novelli GroupWise Messenger
 Comment[eu]=Novell GroupWise mezularia
+Comment[fa]=مدیر Novell GroupWise
 Comment[fr]=Messagerie GroupWise de Novell
 Comment[he]=מסנג'ר של Novell GroupWise
 Comment[is]=Novell GroupWise Samskiptatólið
Index: kaddressbook/editors/cryptosettings.desktop
===================================================================
--- kaddressbook/editors/cryptosettings.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/editors/cryptosettings.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Name[es]=Preferencias de cifrado
 Name[et]=Krüptoseadistused
 Name[eu]=Kriptografia hobespenak
+Name[fa]=تنظیمات مخفی‌
 Name[fi]=Salauksen asetukset
 Name[fr]=Préférences de chiffrement
 Name[gl]=Preferencias de Cifraxe
Index: kaddressbook/editors/imaddresseditor.desktop
===================================================================
--- kaddressbook/editors/imaddresseditor.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/editors/imaddresseditor.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -3,6 +3,7 @@
 Type=Service
 Name=Instant Messaging
 Name[bg]=Мигновени съобщения
+Name[br]=Postelerezh a-benn-kaer
 Name[bs]=Instant poruke
 Name[ca]=Missatgeria instantània
 Name[cs]=Komunikátor
@@ -10,6 +11,7 @@
 Name[es]=Mensajería instantánea
 Name[et]=Kiirsuhtlus
 Name[eu]=Berehalako mezularitza
+Name[fa]=پیام‌دهی فوری‌
 Name[fi]=Pikaviestintä
 Name[fr]=Messagerie instantanée
 Name[gl]=Mensaxería Instantánea
@@ -52,6 +54,7 @@
 Comment[es]=Editor de direcciones de mensajería instantánea
 Comment[et]=Kiirsuhtluse aadresside redaktor
 Comment[eu]=Berehalako mezularitza helbide editorea
+Comment[fa]=ویرایشگر نشانی پیام‌دهی فوری‌
 Comment[fi]=Pikaviestinnän osoitteet
 Comment[fr]=Éditeur d'adresses de messagerie instantanée
 Comment[gl]=Editor de Enderezos de Mensaxería Instantánea
Index: kaddressbook/editors/kaddressbookimprotocol.desktop
===================================================================
--- kaddressbook/editors/kaddressbookimprotocol.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/editors/kaddressbookimprotocol.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Name[es]=Protocolo de mensajería instantánea de KAddressbook
 Name[et]=KDE aadressiraamatu kiirsuhtlusprotokoll
 Name[eu]=KAddressbook berehalako mezularitza protokoloa
+Name[fa]=قرارداد پیام‌دهی فوری KAddressbook
 Name[fi]=KAddresbookin pikaviestintäprotokolla
 Name[fr]=Protocole de messagerie instantanée pour KAddressbook
 Name[gl]=Protocolo de Mensaxería Instantánea de KAddressbook
Index: kaddressbook/kaddressbook_view.desktop
===================================================================
--- kaddressbook/kaddressbook_view.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/kaddressbook_view.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -16,6 +16,7 @@
 Comment[es]=Plugin del visor de KAddressBook
 Comment[et]=KDE aadressiraamatu vaatamise plugin
 Comment[eu]=KAddressBook-en bistaratze plugin-a
+Comment[fa]=وصلۀ نمای KAddressBook 
 Comment[fi]=KAddressbook näyttöliitännäinen
 Comment[fr]=Module d'affichage pour KAddressBook
 Comment[he]=תוסף תצוגה עבור פנקס הכתובות
Index: kaddressbook/kcmconfigs/kabcustomfields.desktop
===================================================================
--- kaddressbook/kcmconfigs/kabcustomfields.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/kcmconfigs/kabcustomfields.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -24,6 +24,7 @@
 Name[es]=Páginas personalizadas
 Name[et]=Omaloodud leheküljed
 Name[eu]=Orri pertsonalizatuak
+Name[fa]=صفحات سفارشی‌
 Name[fi]=Omat sivut
 Name[fr]=Pages personnalisées
 Name[ga]=Leathanaigh Shaincheaptha
@@ -67,6 +68,7 @@
 Comment[es]=Configura las páginas personalizadas
 Comment[et]=Omaloodud lehekülgede seadistamine
 Comment[eu]=Konfiguratu orri pertsonalizatuak
+Comment[fa]=پیکربندی صفحات سفارشی
 Comment[fi]=Muokkaa omia sivuja
 Comment[fr]=Configurer les pages personnalisées
 Comment[ga]=Cumraigh na Leathanaigh Shaincheaptha
@@ -110,6 +112,7 @@
 Keywords[es]=kaddressbook, configurar, opciones, campos personalizados
 Keywords[et]=kde aadressiraamat, seadistamine, seadistused, omaloodud väljad
 Keywords[eu]=kaddressbook, konfiguratu, ezarpenak, eremu pertsonalizatuak
+Keywords[fa]=kaddressbook، پیکربندی، تنظیمات، حوزه‌های سفارشی‌
 Keywords[fi]=osoitekirja, aseta, asetukset, omat kentät
 Keywords[fr]=carnet d'adresses,adresses,kab,kaddressbook,configurer,paramètres,paramètre,champ,personnalisé
 Keywords[ga]=kaddressbook, cumraith, cumraíocht, socruithe, réimsí saincheaptha
Index: kaddressbook/kcmconfigs/kabconfig.desktop
===================================================================
--- kaddressbook/kcmconfigs/kabconfig.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/kcmconfigs/kabconfig.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -23,6 +23,7 @@
 Name[el]=Γενικά
 Name[et]=Üldine
 Name[eu]=Orokorra
+Name[fa]=عمومی
 Name[fi]=Yleinen
 Name[fr]=Général
 Name[ga]=Ginearálta
@@ -69,6 +70,7 @@
 Comment[es]=Configura la libreta de direcciones
 Comment[et]=Aadressiraamatu seadistamine
 Comment[eu]=Konfiguratu helbide-liburua
+Comment[fa]=پیکربندی کتاب نشانی‌
 Comment[fi]=Muokkaa osoitekirjan asetuksia
 Comment[fr]=Configurer le carnet d'adresses
 Comment[ga]=Cumraigh an Leabhar Seoltaí
@@ -118,6 +120,7 @@
 Keywords[es]=kaddressbook, configurar, opciones
 Keywords[et]=kde aadressiraamat, seadistamine, seadistused
 Keywords[eu]=kaddressbook, konfiguratu, ezarpenak
+Keywords[fa]=kaddressbook، پیکربندی، تنظیمات‌
 Keywords[fi]=kaddressbook, aseta, asetukset
 Keywords[fr]=carnet d'adresses,adresses,kab,kaddressbook,configurer,paramètres,paramètre
 Keywords[ga]=kaddressbook, cumraigh, cumraíocht, socruithe
Index: kaddressbook/kcmconfigs/kabldapconfig.desktop
===================================================================
--- kaddressbook/kcmconfigs/kabldapconfig.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/kcmconfigs/kabldapconfig.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -26,6 +26,7 @@
 Name[es]=Búsqueda LDAP
 Name[et]=LDAP otsing
 Name[eu]=LDAP bilaketa
+Name[fa]=مراجعه به LDAP
 Name[fi]=LDAP-haku
 Name[fr]=Consultation LDAP
 Name[ga]=Cuardach LDAP
@@ -69,6 +70,7 @@
 Comment[es]=Configura las opciones de búsqueda LDAP en la libreta de direcciones
 Comment[et]=Aadressiraamatu LDAP seadistused
 Comment[eu]=Konfiguratu Helbide-liburuaren LDAP ezarpenak
+Comment[fa]=پیکربندی تنظیمات LDAP کتاب نشانی‌
 Comment[fi]=Aseta osoitekirjan LDAP-asetuksia
 Comment[fr]=Configurer les paramètres du carnet d'adresses LDAP
 Comment[he]=הגדר את פנקס הכתובות מבוסס LDAP
@@ -114,6 +116,7 @@
 Keywords[es]=kaddressbook, configurar, opciones, LDAP
 Keywords[et]=kde aadressiraamat, seadistamine, seadistused, LDAP
 Keywords[eu]=kaddressbook, konfiguratu,ezarpenak, LDAP
+Keywords[fa]=kaddressbook، پیکربندی، تنظیمات، LDAP
 Keywords[fi]=kaddressbook, aseta, asetukset, LDAP
 Keywords[fr]=carnet d'adresses,adresses,kab,kaddressbook,configurer,paramètres,paramètre,LDAP
 Keywords[ga]=kaddressbook, cumraigh, cumraíocht, socruithe, LDAP
Index: kaddressbook/thumbnailcreator/ldifvcardthumbnail.desktop
===================================================================
--- kaddressbook/thumbnailcreator/ldifvcardthumbnail.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/thumbnailcreator/ldifvcardthumbnail.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Archivos de tarjetas de visita electrónicas
 Name[et]=Elektrooniline visiitkaart
 Name[eu]=Electronic Business Card fitxategiak
+Name[fa]=پرونده‌های کارت تجاری الکترونیکی‌
 Name[fi]=Sähköiset käyntikorttitiedostot
 Name[fr]=Fichiers de cartes de commerce électroniques
 Name[hi]=इलेक्ट्रानिक व्यापार कार्ड फ़ाइलें
Index: kaddressbook/features/distributionlist.desktop
===================================================================
--- kaddressbook/features/distributionlist.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/features/distributionlist.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -15,6 +15,7 @@
 Name[es]=Plugin KAB para listas de distribución
 Name[et]=KAB postiloendi plugin
 Name[eu]=KAB banaketa zerrenda plugin-a
+Name[fa]=وصلۀ فهرست توزیع KAB
 Name[fi]=KAB-jakelulistaliitännäinen
 Name[fr]=Module de liste de diffusion pour KAB
 Name[gl]=Extensión de Lista de Distribución KAB
@@ -26,7 +27,7 @@
 Name[km]=កម្មវិធី​ជំនួយ​បញ្ជី​ចែកចាយ​របស់ KAB
 Name[lt]=KAB platinimo sąrašo priedas
 Name[ms]=Plugin Senarai Agihan KAB 
-Name[nb]=KAB tilleggsprogram for distribusjonslister
+Name[nb]=KAB programtillegg for distribusjonslister
 Name[nds]=Verdeellist-Moduul för KAdressbook
 Name[nl]=KAB Distributielijst-plugin
 Name[nn]=Programtillegg for KAB distribusjonsliste
@@ -60,6 +61,7 @@
 Comment[es]=Plugin para gestionar listas de distribución
 Comment[et]=Plugin postiloendite haldamiseks
 Comment[eu]=Banaketa zerrendak kudeatzeko plugin-a
+Comment[fa]=وصله برای مدیریت فهرستهای توزیع‌
 Comment[fi]=Liitännäinen jakelulistojen hallintaan
 Comment[fr]=Module pour gérer des listes de diffusion
 Comment[gl]=Plugin para manexar listas de distribución
@@ -72,7 +74,7 @@
 Comment[km]=កម្មវិធី​ជំនួយ​ដើម្បី​គ្រប់គ្រង​បញ្ជី​ចែកចាយ
 Comment[lt]=Priedas platinimo sąrašų tvarkymui
 Comment[ms]=Plug masuk untuk pengurusan senarai edaran
-Comment[nb]=Tilleggsprogram for å håndtere distribusjonslister
+Comment[nb]=Programtillegg for å håndtere distribusjonslister
 Comment[nds]=Moduul för't Plegen vun Verdeellisten
 Comment[nl]=Plugin voor het beheren van distributielijsten
 Comment[nn]=Programtillegg for handtering av distibusjonsliste
Index: kaddressbook/features/resourceselection.desktop
===================================================================
--- kaddressbook/features/resourceselection.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/features/resourceselection.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Name[es]=Extensión para gestionar la libreta de direcciones
 Name[et]=Aadressihalduri plugin
 Name[eu]=Helbide-liburu kudeaketa plugin-a
+Name[fa]=وصلۀ مدیریت کتاب نشانی‌
 Name[fi]=Osoitekirjan ylläpidon laajennus
 Name[fr]=Module de gestion de carnet d'adresses
 Name[ga]=Breiseán Bhainisteoireacht Leabhar na Seoltaí
@@ -57,6 +58,7 @@
 Comment[es]=Extenxión para gestionar libretas de direcciones
 Comment[et]=Plugin aadressiraamatute haldamiseks
 Comment[eu]=Helbide-liburuak kudeatzeko plugin-a
+Comment[fa]=وصله برای مدیریت کتابهای نشانی‌
 Comment[fi]=Osoitekirjojen ylläpidon laajennus
 Comment[fr]=Module pour gérer les carnets d'adresses
 Comment[gl]=Extensión para xestionar cadernos de enderezos
@@ -68,7 +70,7 @@
 Comment[km]=កម្មវិធី​ជំនួយ​ដើម្បី​គ្រប់គ្រង​សៀវភៅ​អាសយដ្ឋាន
 Comment[lt]=Priedas adresų knygelių tvarkymui
 Comment[ms]=Plugin untuk pengurusan buku alamat
-Comment[nb]=Tilleggsprogram for å håndtere adressebøker
+Comment[nb]=Programtillegg for å håndtere adressebøker
 Comment[nds]=Moduul för't Plegen vun Adressböker
 Comment[nl]=Plugin voor het beheren van adresboeken
 Comment[nn]=Programtillegg for handtering av adressebøker
Index: kaddressbook/features/resourceselection.cpp
===================================================================
--- kaddressbook/features/resourceselection.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kaddressbook/features/resourceselection.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -191,6 +191,7 @@
   }
 
   resource->setResourceName( i18n( "%1 address book" ).arg( type ) );
+  resource->setAddressBook(core()->addressBook());
 
   KRES::ConfigDialog dlg( this, QString( "contact" ), resource );
 
Index: Makefile.am.in
===================================================================
--- Makefile.am.in	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ Makefile.am.in	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -38,7 +38,7 @@
 COMPILE_BEFORE_knotes = libkdepim
 COMPILE_BEFORE_konsolekalendar = libkdepim
 
-AUTOMAKE_OPTIONS = foreign 1.5
+AUTOMAKE_OPTIONS = foreign 1.6.1
 DISTCLEANFILES = inst-apps
 
 MAINTAINERCLEANFILES = subdirs configure.in acinclude.m4 SUBDIRS
Index: libkholidays/holidays/holiday_ru
===================================================================
--- libkholidays/holidays/holiday_ru	(.../tags/KDE/3.5.4/kdepim)	(revision 0)
+++ libkholidays/holidays/holiday_ru	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -0,0 +1,111 @@
+:
+: Russian holiday file. Copy to ~/.holiday
+:
+: Author: Andrey Cherepanov <sibskull@mail.ru>, September 2006.
+:
+
+: Official holidays
+red		"Новогодние каникулы"			on 1.1
+red		"Новогодние каникулы"			on 2.1
+red		"Новогодние каникулы"			on 3.1
+red		"Новогодние каникулы"			on 4.1
+red		"Новогодние каникулы"			on 5.1
+red		"Рождество Христово"			on 7.1
+red		"День защитника Отечества"		on 23.2
+red		"Международный женский день"	on 8.3
+red		"Праздник Весны и Труда"		on 1.5
+red		"День Победы"					on 9.5
+red		"День России"					on 12.6
+red		"День народного единства"		on 4.11
+
+: Other holidays
+blue 	"День работника прокуратуры Российской Федерации" on 12.1
+blue 	"День российской печати" on 13.1
+blue 	"День инженерных войск" on 21.1
+blue 	"День российского студенчества" on 25.1
+blue 	"День снятия блокады города Ленинграда (1944 год)" on 27.1
+blue 	"Сталинградская битва (1943 год)" on 2.2
+blue 	"День российской науки" on 8.2
+blue 	"День дипломатического работника" on 10.2
+blue 	"День работников геодезии и картографии" on second sunday in march
+blue 	"День работников торговли, бытового обслуживания населения и ЖКХ" on third sunday in march
+blue 	"День внутренних войск МВД" on 27.3
+blue 	"День специалиста юридической службы в Вооружённых Силах" on 29.3
+blue 	"День единения народов" on 2.4
+blue 	"День сотрудников военных комиссариатов" on 8.4
+blue 	"День геолога" on first sunday in april
+blue 	"День космонавтики" on 12.4
+blue 	"День войск противовоздушной обороны" on second sunday in april
+blue 	"День специалиста по радиоэлектронной борьбе" on 15.4
+blue 	"Ледовое побоище (1242 год)" on 18.4
+blue 	"День памяти погибших в радиационных авариях и катастрофах" on 26.4
+blue 	"День пожарной охраны" on 30.4
+blue 	"День радио, праздник работников всех отраслей связи" on 7.5
+blue 	"День химика" on last sunday in may
+blue 	"День славянской письменности и культуры" on 24.5
+blue 	"Общероссийский День библиотек" on 27.5
+blue 	"День пограничника" on 28.5
+blue 	"Пушкинский день России" on 6.6
+blue 	"День социального работника" on 8.6
+blue 	"День работников текстильной и лёгкой промышленности" on second sunday in june
+blue 	"День медицинского работника" on third sunday in june
+blue 	"День изобретателя и рационализатора" on last saturday in june
+blue 	"День памяти и скорби" on 22.6
+blue 	"День молодёжи" on 27.6
+blue 	"День работников морского и речного флота" on first sunday in july
+blue 	"Полтавская битва (1709 год)" on 10.7
+blue 	"День рыбака" on second sunday in july
+blue 	"День российской почты" on second sunday in july
+blue 	"День металлурга" on third sunday in july
+blue 	"День Военно-Морского Флота" on last sunday in july
+blue 	"День Тыла Вооружённых Сил Российской Федерации" on 1.8
+blue 	"День Воздушно-десантных войск" on 2.8
+blue 	"День железнодорожника" on first sunday in august
+blue 	"День Железнодорожных войск Российской Федерации" on 6.8
+blue 	"День победы у мыса Гангут (1714 год)" on 9.8
+blue 	"День Военно-воздушных сил" on 12.8
+blue 	"День физкультурника" on second saturday in august
+blue 	"День строителя" on second sunday in august
+blue 	"День Воздушного Флота России" on third sunday in august
+blue 	"День Государственного флага Российской Федерации" on 22.8
+blue 	"Курская битва (1943 год)" on 23.8
+blue 	"День шахтёра" on last sunday in august
+blue 	"День кино" on 27.8
+blue 	"День знаний" on 1.9
+blue 	"День российской гвардии" on 2.9
+blue 	"День солидарности в борьбе с терроризмом" on 3.9
+blue 	"День специалиста по ядерному обеспечению" on 4.9
+blue 	"День работников нефтяной и газовой промышленности" on first sunday in september
+blue 	"Бородинское сражение (1812 год)" on 8.9
+blue 	"День победы у мыса Тендра (1790 год)" on 11.9
+blue 	"День танкиста" on second sunday in september
+blue 	"Куликовская битва (1380 год)" on 21.9
+blue 	"День работников леса" on third sunday in september
+blue 	"День работника атомной промышленности" on 28.9
+blue 	"День машиностроителя" on last sunday in september
+blue 	"День пожилых людей" on 1.10
+blue 	"День Сухопутных войск" on 1.10
+blue 	"День Космических войск" on 4.10
+blue 	"День учителя" on 5.10
+blue 	"День военного связиста" on 20.10
+blue 	"День подразделений специального назначения" on 24.10
+blue 	"День таможенника Российской Федерации" on 25.10
+blue 	"День работника сельского хозяйства и перерабатывающей промышленности" on second sunday in october
+blue 	"День работников дорожного хозяйства" on third sunday in october
+blue 	"День работников автомобильного транспорта" on last sunday in october
+blue 	"День памяти жертв политических репрессий" on 30.10
+blue 	"День военного разведчика" on 5.11
+blue 	"Октябрьская революция 1917 года" on 7.11
+blue 	"День милиции" on 10.11
+blue 	"День войск радиационной, химической и биологической защиты" on 13.11
+blue 	"День ракетных войск и артиллерии" on 19.11
+blue 	"День работника налоговых органов Российской Федерации" on 21.11
+blue 	"День матери" on last sunday in november
+blue 	"День победы у мыса Синоп (1853 год)" on 1.12
+blue 	"Битва под Москвой (1941 год)" on 5.12
+blue 	"День Конституции Российской Федерации" on 12.12
+blue 	"День Ракетных войск стратегического назначения" on 17.12
+blue 	"День работника органов безопасности Российской Федерации" on 20.12
+blue 	"День энергетика" on third sunday in december
+blue 	"День взятия крепости Измаил (1790 год)" on 24.12
+blue 	"День спасателя Российской Федерации" on 27.12
Index: libkholidays/holidays/holiday_es
===================================================================
--- libkholidays/holidays/holiday_es	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ libkholidays/holidays/holiday_es	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -21,7 +21,6 @@
 : http://www.mtas.es/infpuntual/Fiestas2005/RES061004.htm
 : «Fiesta Nacional no sustituible»
 "Asunción de la Virgen" weekend on august 15
-"Fiesta Nacional de España" weekend on october 12
 "Todos los Santos" weekend on november 1
 "Día de la Constitución Española" weekend on december 6
 "La Inmaculada Concepción" weekend on december 8
Index: libkholidays/holidays/Makefile.am
===================================================================
--- libkholidays/holidays/Makefile.am	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ libkholidays/holidays/Makefile.am	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,7 +11,8 @@
                 holiday_nl \
                 holiday_no holiday_nz holiday_pl holiday_pt holiday_py \
                 holiday_quebec \
-                holiday_ro holiday_se holiday_si holiday_th holiday_us \
+                holiday_ro holiday_ru \ 
+		holiday_se holiday_si holiday_th holiday_us \
                 holiday_uy holiday_ie \
                 holiday_Suedtirol
 
Index: plugins/kmail/bodypartformatter/text_calendar.desktop
===================================================================
--- plugins/kmail/bodypartformatter/text_calendar.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ plugins/kmail/bodypartformatter/text_calendar.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -6,6 +6,7 @@
 Name[da]=Program oktetstrøm
 Name[es]=Aplicación en flujo de octetos
 Name[eu]=Aplikazioa/zortzikote-jarioa
+Name[fa]=Octetstream کاربرد
 Name[fi]=Octetstream-sovellus
 Name[fr]=Application (flux d'octets)
 Name[hu]=Alkalmazás-adatfolyam
@@ -38,6 +39,7 @@
 Comment[es]=Un accesorio de formato para el cuerpo de text/calendar
 Comment[et]=Põhiosa vormindamisplugin (MIME tüübile text/calendar)
 Comment[eu]=Testu/egutegientzako gorputz-zati formateatzaile bat
+Comment[fa]=یک وصلۀ قالب دهندۀ بخش بدنه برای متن/تقویم
 Comment[fi]=Muokkausliitännäinen text/calendar-muodolle
 Comment[fr]=Module de formatage pour le text/calendar
 Comment[hu]=Formázómodul text/calendar adatfolyamok kezeléséhez
Index: plugins/kmail/bodypartformatter/text_vcard.desktop
===================================================================
--- plugins/kmail/bodypartformatter/text_vcard.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ plugins/kmail/bodypartformatter/text_vcard.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -6,6 +6,7 @@
 Name[da]=Program oktetstrøm
 Name[es]=Aplicación en flujo de octetos
 Name[eu]=Aplikazioa/zortzikote-jarioa
+Name[fa]=Octetstream کاربرد
 Name[fi]=Octetstream-sovellus
 Name[fr]=Application (flux d'octets)
 Name[hu]=Alkalmazás-adatfolyam
@@ -39,6 +40,7 @@
 Comment[es]=Un accesorio de formato para el cuerpo de text/vcard
 Comment[et]=Põhiosa vormindamisplugin (MIME tüübile text/vcard)
 Comment[eu]=Testu/vcard-en gorputz-zati formateatzaile bat
+Comment[fa]=یک وصلۀ قالب دهندۀ بخش بدنه برای متن/vcard
 Comment[fi]=Muokkausliitännäinen text/vcard-muodolle
 Comment[fr]=Un formateur de partie de corps pour text/vcard
 Comment[hu]=Formázómodul text/vcard adatfolyamok kezeléséhez
Index: plugins/kmail/bodypartformatter/text_xdiff.desktop
===================================================================
--- plugins/kmail/bodypartformatter/text_xdiff.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ plugins/kmail/bodypartformatter/text_xdiff.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -6,6 +6,7 @@
 Name[da]=Program oktetstrøm
 Name[es]=Aplicación en flujo de octetos
 Name[eu]=Aplikazioa/zortzikote-jarioa
+Name[fa]=Octetstream کاربرد
 Name[fi]=Octetstream-sovellus
 Name[fr]=Application (flux d'octets)
 Name[hu]=Alkalmazás-adatfolyam
@@ -37,6 +38,7 @@
 Comment[es]=Una extensión de formato para el cuerpo de text/x-diff
 Comment[et]=Põhiosa vormindamisplugin (MIME tüübile text/x-diff)
 Comment[eu]=Testu/x-diff-en gorputz-zati formateatzaile bat
+Comment[fa]=یک وصلۀ قالب دهندۀ بخش بدنه برای متن/x-diff
 Comment[fi]=Muokkausliitännäinen text/x-diff-muodolle
 Comment[fr]=Un formateur de partie de corps pour text/x-diff
 Comment[hu]=Formázómodul text/x-diff adatok kezeléséhez
Index: kitchensync/multisynk/konnectorpair.cpp
===================================================================
--- kitchensync/multisynk/konnectorpair.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/multisynk/konnectorpair.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -29,6 +29,7 @@
   : mManager( new KonnectorManager ), mConfig( 0 )
 {
   mUid = KApplication::randomString( 10 );
+  mStrategy = ResolveManually;
 }
 
 KonnectorPair::~KonnectorPair()
Index: kitchensync/multisynk/multisynk.desktop
===================================================================
--- kitchensync/multisynk/multisynk.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/multisynk/multisynk.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 GenericName[es]=Sincronización
 GenericName[et]=Sünkroniseerimine
 GenericName[eu]=Sinkronizazioa
+GenericName[fa]=همگامی‌
 GenericName[fi]=Synkronointi
 GenericName[fr]=Synchronisation
 GenericName[ga]=Sioncrónú
Index: kitchensync/kitchensync/debugger/debugger.desktop
===================================================================
--- kitchensync/kitchensync/debugger/debugger.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/kitchensync/debugger/debugger.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Name[es]=Konnector para depuración
 Name[et]=Konnectori siluja
 Name[eu]=Konnector araztailea
+Name[fa]=اشکال‌زدای Konnector
 Name[fi]=Konnectorin vianjäljitysohjelma
 Name[fr]=Débogueur Konnector
 Name[ga]=Dífhabhtóir Konnector
Index: kitchensync/kitchensync/syncerpart/syncerpart.desktop
===================================================================
--- kitchensync/kitchensync/syncerpart/syncerpart.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/kitchensync/syncerpart/syncerpart.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Name[es]=Parte Synchronizer
 Name[et]=Sünkroniseerija komponent
 Name[eu]=Sinkronizatzaile zatia
+Name[fa]=بخش همگام‌ساز
 Name[fr]=Composant de synchronisation
 Name[he]=רכיב סנכרון
 Name[hi]=सिंक्रोनाइज़र पार्ट
Index: kitchensync/kitchensync/viewer/viewer.desktop
===================================================================
--- kitchensync/kitchensync/viewer/viewer.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/kitchensync/viewer/viewer.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -12,6 +12,7 @@
 Name[es]=Visor de datos
 Name[et]=Andmete näitaja
 Name[eu]=Data ikustailea
+Name[fa]=مشاهده‌گر داده‌
 Name[fi]=Datanäkymä
 Name[fr]=Afficheur de données
 Name[he]=מציג מידע
Index: kitchensync/kitchensync/plucker/kitchensync-pluck-rdf.desktop
===================================================================
--- kitchensync/kitchensync/plucker/kitchensync-pluck-rdf.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/kitchensync/plucker/kitchensync-pluck-rdf.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Añadir a la extensión Plucker de KitchenSync
 Name[et]=Lisa KitchenSynci Pluckeri pluginale
 Name[eu]=Gehitu KitchenSync-i Plucker plugin-a
+Name[fa]=افزودن به وصلۀ KitchenSync Plucker
 Name[fi]=Lisää KitchenSync Plucker -liitännäiseen
 Name[fr]=Ajouter le module Plucker à KitchenSync
 Name[hu]=Hozzáadás a KitchenSync Plucker bővítőmodulhoz
Index: kitchensync/kitchensync/plucker/kitchensync-pluck.desktop
===================================================================
--- kitchensync/kitchensync/plucker/kitchensync-pluck.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/kitchensync/plucker/kitchensync-pluck.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Añadir a la extensión Plucker de KitchenSync
 Name[et]=Lisa KitchenSynci Pluckeri pluginale
 Name[eu]=Gehitu KitchenSync-i Plucker plugin-a
+Name[fa]=افزودن به وصلۀ KitchenSync Plucker
 Name[fi]=Lisää KitchenSync Plucker -liitännäiseen
 Name[fr]=Ajouter le module Plucker à KitchenSync
 Name[hu]=Hozzáadás a KitchenSync Plucker bővítőmodulhoz
Index: kitchensync/kitchensync/plucker/plucker.desktop
===================================================================
--- kitchensync/kitchensync/plucker/plucker.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/kitchensync/plucker/plucker.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -7,6 +7,7 @@
 Name[es]=Parte Plucker
 Name[et]=Pluckeri komponent
 Name[eu]=Plucker zatia
+Name[fa]=بخش Plucker 
 Name[fr]=Composant Plucker
 Name[he]=רכיב Plucker
 Name[hu]=Plucker objektum
Index: kitchensync/kitchensync/backup/restore.desktop
===================================================================
--- kitchensync/kitchensync/backup/restore.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/kitchensync/backup/restore.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Name[es]=Konnector para restauración
 Name[et]=Konnectori taastaja
 Name[eu]=Konnector leheneratu
+Name[fa]=بازگردانی Konnector 
 Name[fi]=Konnectorin palautus
 Name[fr]=Restauration de Konnector
 Name[he]=שחזור של Konnector
Index: kitchensync/kitchensync/backup/backup.desktop
===================================================================
--- kitchensync/kitchensync/backup/backup.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/kitchensync/backup/backup.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -12,6 +12,7 @@
 Name[es]=Konnector para copia de seguridad
 Name[et]=Konnectori varukoopia
 Name[eu]=Konnector babes-kopia
+Name[fa]=پشتیبان Konnector
 Name[fi]=Konnector-varmuuskopio
 Name[fr]=Sauvegarde Konnector
 Name[ga]=Cúltaca Konnector
Index: kitchensync/kitchensync/overview/overview.desktop
===================================================================
--- kitchensync/kitchensync/overview/overview.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/kitchensync/overview/overview.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Name[es]=Parte OverView
 Name[et]=Ülevaatekomponent
 Name[eu]=OverView zatia
+Name[fa]=بخش نمای کلی‌
 Name[fr]=Composant d'aperçu
 Name[he]=רכיב סקירה
 Name[hi]=ओवर-व्यू पार्ट
Index: kitchensync/kitchensync/lib/kitchensync.desktop
===================================================================
--- kitchensync/kitchensync/lib/kitchensync.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/kitchensync/lib/kitchensync.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -12,6 +12,7 @@
 Name[es]=Manipulador KitchenSync
 Name[et]=KitchenSync manipulaator
 Name[eu]=KitchenSync manipulatzailea
+Name[fa]=دست‌کاری کنندۀKitchenSync
 Name[fi]=KitchenSync-muokkain
 Name[fr]=Utilitaire pour KitchenSync
 Name[he]=KitchenSync
Index: kitchensync/libkonnector2/plugins/kabc/kabckonnector.desktop
===================================================================
--- kitchensync/libkonnector2/plugins/kabc/kabckonnector.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/libkonnector2/plugins/kabc/kabckonnector.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Name[es]=Konnector para libreta de direcciones
 Name[et]=Aadressiraamatu Konnector
 Name[eu]=Helbide-liburu Konnector-a
+Name[fa]=Konnector کتاب نشانی‌
 Name[fi]=Osoitekirjan Konnector
 Name[fr]=Konnector pour le carnet d'adresses
 Name[ga]=Konnector Leabhar Seoltaí
Index: kitchensync/libkonnector2/plugins/threadedkonnector/threadedkonnector.desktop
===================================================================
--- kitchensync/libkonnector2/plugins/threadedkonnector/threadedkonnector.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/libkonnector2/plugins/threadedkonnector/threadedkonnector.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Conector de demostración para una implementación con hilos
 Name[et]=Konnectori demo
 Name[eu]=Haridun inplementazioetzako eredu Konnector-a
+Name[fa]=Demo Konnector برای یک پیاده‌سازی رشته‌ای‌
 Name[fi]=Esimerkkiyhteys säikeistetylle toteutukselle
 Name[fr]=Konnector de démonstration pour une implantation avec plusieurs fils d'exécution
 Name[hu]=Demókonnektor többszálú megvalósításra
Index: kitchensync/libkonnector2/plugins/kcal/kcalkonnector.desktop
===================================================================
--- kitchensync/libkonnector2/plugins/kcal/kcalkonnector.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/libkonnector2/plugins/kcal/kcalkonnector.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Konnector para calendario
 Name[et]=Kalendri Konnector
 Name[eu]=Egutegi Konnector-a
+Name[fa]=Konnector تقویم
 Name[fi]=Kalenterin Konnector
 Name[fr]=Konnector pour l'agenda
 Name[ga]=Konnector Féilirí
Index: kitchensync/libkonnector2/plugins/local/localkonnector.desktop
===================================================================
--- kitchensync/libkonnector2/plugins/local/localkonnector.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/libkonnector2/plugins/local/localkonnector.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -15,6 +15,7 @@
 Name[es]=Konnector local
 Name[et]=Kohalik Konnector
 Name[eu]=Konnector lokala
+Name[fa]=Konnector محلی‌
 Name[fi]= Paikallinen Konnector
 Name[fr]=Konnector local
 Name[ga]=Konnector Logánta
Index: kitchensync/libkonnector2/plugins/dummy/dummykonnector.desktop
===================================================================
--- kitchensync/libkonnector2/plugins/dummy/dummykonnector.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/libkonnector2/plugins/dummy/dummykonnector.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Konnector para pruebas
 Name[et]=Fiktiivne Konnector
 Name[eu]=Simulatutako Konnector-a
+Name[fa]=Konnector ساختگی‌
 Name[fi]=Tyhjä Konnector
 Name[fr]=Konnector factice
 Name[ga]=Konnector Caoch
Index: kitchensync/libkonnector2/plugins/remote/remotekonnector.desktop
===================================================================
--- kitchensync/libkonnector2/plugins/remote/remotekonnector.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/libkonnector2/plugins/remote/remotekonnector.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Konnector remoto
 Name[et]=Kaug-Konnector
 Name[eu]=Urruneko Konnector-a
+Name[fa]=Konnector دور
 Name[fi]=Etä-Konnector
 Name[fr]=Konnector distant
 Name[ga]=Konnector Cianda
Index: kitchensync/libkonnector2/filter.desktop
===================================================================
--- kitchensync/libkonnector2/filter.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/libkonnector2/filter.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -12,6 +12,7 @@
 Comment[es]=Filtro para KitchenSync Konnector
 Comment[et]=KitchenSynci Konnectori filter
 Comment[eu]=KitchenSync Konnector-en iragazkia
+Comment[fa]=پالایه برای KitchenSync Konnector
 Comment[fi]=Suodin KitchenSync-liitännäiselle
 Comment[fr]=Filtre pour KitchenSync Konnector
 Comment[he]=תוסף עבור Konnector של KitchenSync
Index: kitchensync/libkonnector2/filters/calendarfilter.desktop
===================================================================
--- kitchensync/libkonnector2/filters/calendarfilter.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/libkonnector2/filters/calendarfilter.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -17,6 +17,7 @@
 Name[es]=Filtro de calendario
 Name[et]=Kalendrifilter
 Name[eu]=Egutegiaren iragazkia
+Name[fa]=پالایۀ تقویم‌
 Name[fi]=Kalenterisuodin
 Name[fr]=Filtre pour le calendrier
 Name[he]=מסנן לוח שנה
@@ -56,6 +57,7 @@
 Comment[es]=Filtra los eventos y las tareas pendientes de un calendario
 Comment[et]=Kalendri sündmuste ja ülesannete filtreerimine
 Comment[eu]=Egutegian gertaerak eta egitekoak iragazten ditu
+Comment[fa]=رویدادهای پالایه‌ها و کارهای انجامی در یک تقویم‌
 Comment[fi]=Suodattaa kalenterin tapahtumia ja tehtäviä
 Comment[fr]=Permet de filtrer les évènements et les tâches du calendrier
 Comment[he]=מסנן אירועים ומטלות בלוח השנה
Index: kitchensync/libkonnector2/filters/addressbookfilter.desktop
===================================================================
--- kitchensync/libkonnector2/filters/addressbookfilter.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/libkonnector2/filters/addressbookfilter.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -17,6 +17,7 @@
 Name[es]=Filtro de la libreta de direcciones
 Name[et]=Aadressiraamatu filter
 Name[eu]=Helbide-liburuaren iragazkia
+Name[fa]=پالایۀ کتاب نشانی
 Name[fi]=Osoitekirjasuodin
 Name[fr]=Filtre pour le carnet d'adresses
 Name[he]=מסנן פנקס כתובות
@@ -56,6 +57,7 @@
 Comment[es]=Filtra los contactos de la libreta de direcciones
 Comment[et]=Kontaktide filtreerimine aadressiraamatus
 Comment[eu]=Helbide-liburuko kontaktuak iragazten ditu
+Comment[fa]=تماسهای پالایه‌ها در یک کتاب نشانی‌
 Comment[fi]=Suodattaa kontakteja osoitekirjassa
 Comment[fr]=Permet de filtrer les contacts du carnet d'adresses
 Comment[he]=מסנן אנשי קשר בפנקס הכתובות
Index: kitchensync/libkonnector2/konnector.desktop
===================================================================
--- kitchensync/libkonnector2/konnector.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kitchensync/libkonnector2/konnector.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -15,6 +15,7 @@
 Comment[es]=Konnector para definiciones
 Comment[et]=Konnectori definitsioonid
 Comment[eu]=Konnector definizioak
+Comment[fa]=تعاریف Konnector 
 Comment[fi]=Konnectorin määritykset
 Comment[fr]=Description de Konnector
 Comment[he]=הגדרות Konnector
Index: libkdepim/kaddrbook.h
===================================================================
--- libkdepim/kaddrbook.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ libkdepim/kaddrbook.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -17,7 +17,7 @@
 public:
   static void addEmail( const QString &addr, QWidget *parent );
   static void addNewAddressee( QWidget* );
-  static void openEmail( const QString &email, const QString &addr, QWidget *parent );
+  static void openEmail( const QString &addr, QWidget *parent );
   static void openAddressBook( QWidget *parent );
 
   static bool addVCard( const KABC::Addressee& addressee, QWidget *parent );
Index: libkdepim/kaddrbook.cpp
===================================================================
--- libkdepim/kaddrbook.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ libkdepim/kaddrbook.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -31,26 +31,54 @@
 #include <unistd.h>
 
 //-----------------------------------------------------------------------------
-void KAddrBookExternal::openEmail( const QString &email, const QString &addr, QWidget *) {
-  //QString email = KMMessage::getEmailAddr(addr);
-  KABC::AddressBook *addressBook = KABC::StdAddressBook::self( true );
-  KABC::Addressee::List addresseeList = addressBook->findByEmail(email);
-  if ( kapp->dcopClient()->isApplicationRegistered( "kaddressbook" ) ){
-    //make sure kaddressbook is loaded, otherwise showContactEditor
-    //won't work as desired, see bug #87233
-    DCOPRef call ( "kaddressbook", "kaddressbook" );
-    call.send( "newInstance()" );
+void KAddrBookExternal::openEmail( const QString &addr, QWidget *parent ) {
+  QString email;
+  QString name;
+
+  KABC::Addressee::parseEmailAddress( addr, name, email );
+
+  KABC::AddressBook *ab = KABC::StdAddressBook::self( true );
+
+  // force a reload of the address book file so that changes that were made
+  // by other programs are loaded
+  ab->asyncLoad();
+
+  // if we have to reload the address book then we should also wait until
+  // it's completely reloaded
+#if KDE_IS_VERSION(3,4,89)
+  // This ugly hack will be removed in 4.0
+  while ( !ab->loadingHasFinished() ) {
+    QApplication::eventLoop()->processEvents( QEventLoop::ExcludeUserInput );
+
+    // use sleep here to reduce cpu usage
+    usleep( 100 );
   }
-  else
-    kapp->startServiceByDesktopName( "kaddressbook" );
+#endif
 
-  DCOPRef call( "kaddressbook", "KAddressBookIface" );
-  if( !addresseeList.isEmpty() ) {
-    call.send( "showContactEditor(QString)", addresseeList.first().uid() );
+  KABC::Addressee::List addressees = ab->findByEmail( email );
+
+  if ( addressees.count() > 0 ) {
+    if ( kapp->dcopClient()->isApplicationRegistered( "kaddressbook" ) ){
+      //make sure kaddressbook is loaded, otherwise showContactEditor
+      //won't work as desired, see bug #87233
+      DCOPRef call ( "kaddressbook", "kaddressbook" );
+      call.send( "newInstance()" );
+    }  else {
+      kapp->startServiceByDesktopName( "kaddressbook" );
+    }
+
+    DCOPRef call( "kaddressbook", "KAddressBookIface" );
+    call.send( "showContactEditor(QString)", addressees.first().uid() );
+  } else {
+    //TODO: Enable the better message at the next string unfreeze
+#if 0
+    QString text = i18n("<qt>The email address <b>%1</b> cannot be "
+                        "found in your addressbook.</qt>").arg( email );
+#else
+    QString text = email + " " + i18n( "is not in address book" );
+#endif
+    KMessageBox::information( parent, text, QString::null, "notInAddressBook" );
   }
-  else {
-    call.send( "addEmail(QString)", addr );
-  }
 }
 
 //-----------------------------------------------------------------------------
Index: libkdepim/komposer/plugins/default/defaulteditor.desktop
===================================================================
--- libkdepim/komposer/plugins/default/defaulteditor.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ libkdepim/komposer/plugins/default/defaulteditor.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -27,6 +27,7 @@
 Name[es]=Editor Komposer
 Name[et]=Komposeri redaktor
 Name[eu]=Komposer editorea
+Name[fa]=ویرایشگر Komposer
 Name[fi]=Komposer-muokkain
 Name[fr]=Éditeur Komposer
 Name[ga]=Eagarthóir Komposer
@@ -64,6 +65,7 @@
 Comment[es]=Editor predefinido Komposer
 Comment[et]=Komposeri vaikeredaktor
 Comment[eu]=Komposer editore lehenetsia
+Comment[fa]=ویرایشگر پیش‌فرض Komposer
 Comment[fi]=Komposer oletusmuokkain
 Comment[fr]=Éditeur Komposer par défaut
 Comment[ga]=Eagarthóir réamhshocraithe Komposer
Index: libkdepim/komposer/core/komposerplugin.desktop
===================================================================
--- libkdepim/komposer/core/komposerplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ libkdepim/komposer/core/komposerplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -15,6 +15,7 @@
 Name[es]=Accesorio Komposer
 Name[et]=Komposeri plugin
 Name[eu]=Komposer plugin-a
+Name[fa]=وصلۀ Komposer
 Name[fi]=Komposer-liitännäinen
 Name[fr]=Module de Komposer
 Name[ga]=Breiseán Komposer
Index: libkdepim/komposer/core/komposereditor.desktop
===================================================================
--- libkdepim/komposer/core/komposereditor.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ libkdepim/komposer/core/komposereditor.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Comment[es]=Editor Komposer
 Comment[et]=Komposeri redaktor
 Comment[eu]=Komposer editorea
+Comment[fa]=ویرایشگر Komposer
 Comment[fi]=Komposer-muokkain
 Comment[fr]=Éditeur Komposer
 Comment[ga]=Eagarthóir Komposer
Index: libkdepim/progressdialog.cpp
===================================================================
--- libkdepim/progressdialog.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ libkdepim/progressdialog.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -81,6 +81,7 @@
 
 void TransactionItemView::resizeContents( int w, int h )
 {
+  // (handling of QEvent::LayoutHint in QScrollView calls this method)
   //kdDebug(5300) << k_funcinfo << w << "," << h << endl;
   QScrollView::resizeContents( w, h );
   // Tell the layout in the parent (progressdialog) that our size changed
@@ -171,7 +172,7 @@
     connect ( mCancelButton, SIGNAL( clicked() ),
               this, SLOT( slotItemCanceled() ));
   }
-  
+
   h = new QHBox( this );
   h->setSpacing( 5 );
   h->setSizePolicy( QSizePolicy( QSizePolicy::Preferred, QSizePolicy::Fixed ) );
@@ -181,6 +182,10 @@
   // always interpret the status text as RichText, but disable word wrapping
   mItemStatus->setTextFormat( Qt::RichText );
   mItemStatus->setAlignment( Qt::AlignAuto | Qt::AlignVCenter | Qt::SingleLine );
+  // richtext leads to sizeHint acting as if wrapping was enabled though,
+  // so make sure we only ever have the height of one line.
+  mItemStatus->setSizePolicy( QSizePolicy( QSizePolicy::Preferred, QSizePolicy::Ignored ) );
+  mItemStatus->setFixedHeight( mItemLabel->sizeHint().height() );
   setCrypto( item->usesCrypto() );
   if( first ) hideHLine();
 }
Index: libkcal/localdir.desktop
===================================================================
--- libkcal/localdir.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ libkcal/localdir.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Calendario en el directorio local
 Name[et]=Kalender kohalikus kataloogis
 Name[eu]=Egutegia direktorio lokalean
+Name[fa]=تقویم در فهرست راهنمای محلی‌
 Name[fi]=Kalenteri paikallisessa kansiossa
 Name[fr]=Calendrier dans un dossier local
 Name[ga]=Féilire i gComhadlann Logánta
Index: libkcal/local.desktop
===================================================================
--- libkcal/local.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ libkcal/local.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Calendario en archivo local
 Name[et]=Kalender kohalikus failis
 Name[eu]=Egutegia fitxategi lokalean
+Name[fa]=تقویم در پروندۀ محلی‌
 Name[fi]=Kalenteri paikallisessa tiedostossa
 Name[fr]=Calendrier dans un fichier local
 Name[ga]=Féilire i gComhad Logánta
Index: libkcal/kcal_manager.desktop
===================================================================
--- libkcal/kcal_manager.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ libkcal/kcal_manager.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Calendario
 Name[et]=Kalender
 Name[eu]=Egutegia
+Name[fa]=تقویم
 Name[fi]=Kalenteri
 Name[fr]=Calendrier
 Name[ga]=Féilire
Index: libkcal/resourcecachedconfig.cpp
===================================================================
--- libkcal/resourcecachedconfig.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ libkcal/resourcecachedconfig.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -52,7 +52,7 @@
            SLOT( slotIntervalStateChanged( int ) ) );
   QHBox *intervalBox = new QHBox( mGroup );
   new QLabel( i18n("Interval in minutes"), intervalBox );
-  mIntervalSpin = new QSpinBox( intervalBox );
+  mIntervalSpin = new QSpinBox( 1,900, 1,intervalBox );
   mIntervalSpin->setEnabled( false );
 }
 
@@ -92,7 +92,7 @@
            SLOT( slotIntervalStateChanged( int ) ) );
   QHBox *intervalBox = new QHBox( mGroup );
   new QLabel( i18n("Interval in minutes"), intervalBox );
-  mIntervalSpin = new QSpinBox( intervalBox );
+  mIntervalSpin = new QSpinBox( 1,900, 1,intervalBox );
   mIntervalSpin->setEnabled( false );
 
   new QRadioButton( i18n("Delayed after changes"), mGroup );
Index: libkcal/libical/zoneinfo/America/Argentina/Jujuy.ics
===================================================================
--- libkcal/libical/zoneinfo/America/Argentina/Jujuy.ics	(.../tags/KDE/3.5.4/kdepim)	(revision 0)
+++ libkcal/libical/zoneinfo/America/Argentina/Jujuy.ics	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -0,0 +1,14 @@
+BEGIN:VCALENDAR
+PRODID:-//Ximian//NONSGML Evolution Olson-VTIMEZONE Converter//EN
+VERSION:2.0
+BEGIN:VTIMEZONE
+TZID:/softwarestudio.org/Olson_20011030_5/America/Argentina/Jujuy
+X-LIC-LOCATION:America/Argentina/Jujuy
+BEGIN:STANDARD
+TZOFFSETFROM:-0300
+TZOFFSETTO:-0300
+TZNAME:ART
+DTSTART:19700101T000000
+END:STANDARD
+END:VTIMEZONE
+END:VCALENDAR
Index: libkcal/libical/zoneinfo/America/Argentina/Cordoba.ics
===================================================================
--- libkcal/libical/zoneinfo/America/Argentina/Cordoba.ics	(.../tags/KDE/3.5.4/kdepim)	(revision 0)
+++ libkcal/libical/zoneinfo/America/Argentina/Cordoba.ics	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -0,0 +1,14 @@
+BEGIN:VCALENDAR
+PRODID:-//Ximian//NONSGML Evolution Olson-VTIMEZONE Converter//EN
+VERSION:2.0
+BEGIN:VTIMEZONE
+TZID:/softwarestudio.org/Olson_20011030_5/America/Argentina/Cordoba
+X-LIC-LOCATION:America/Argentina/Cordoba
+BEGIN:STANDARD
+TZOFFSETFROM:-0300
+TZOFFSETTO:-0300
+TZNAME:ART
+DTSTART:19700101T000000
+END:STANDARD
+END:VTIMEZONE
+END:VCALENDAR
Index: libkcal/libical/zoneinfo/America/Argentina/Catamarca.ics
===================================================================
--- libkcal/libical/zoneinfo/America/Argentina/Catamarca.ics	(.../tags/KDE/3.5.4/kdepim)	(revision 0)
+++ libkcal/libical/zoneinfo/America/Argentina/Catamarca.ics	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -0,0 +1,14 @@
+BEGIN:VCALENDAR
+PRODID:-//Ximian//NONSGML Evolution Olson-VTIMEZONE Converter//EN
+VERSION:2.0
+BEGIN:VTIMEZONE
+TZID:/softwarestudio.org/Olson_20011030_5/America/Argentina/Catamarca
+X-LIC-LOCATION:America/Argentina/Catamarca
+BEGIN:STANDARD
+TZOFFSETFROM:-0300
+TZOFFSETTO:-0300
+TZNAME:ART
+DTSTART:19700101T000000
+END:STANDARD
+END:VTIMEZONE
+END:VCALENDAR
Index: libkcal/libical/zoneinfo/America/Argentina/Mendoza.ics
===================================================================
--- libkcal/libical/zoneinfo/America/Argentina/Mendoza.ics	(.../tags/KDE/3.5.4/kdepim)	(revision 0)
+++ libkcal/libical/zoneinfo/America/Argentina/Mendoza.ics	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -0,0 +1,14 @@
+BEGIN:VCALENDAR
+PRODID:-//Ximian//NONSGML Evolution Olson-VTIMEZONE Converter//EN
+VERSION:2.0
+BEGIN:VTIMEZONE
+TZID:/softwarestudio.org/Olson_20011030_5/America/Argentina/Mendoza
+X-LIC-LOCATION:America/Argentina/Mendoza
+BEGIN:STANDARD
+TZOFFSETFROM:-0300
+TZOFFSETTO:-0300
+TZNAME:ART
+DTSTART:19700101T000000
+END:STANDARD
+END:VTIMEZONE
+END:VCALENDAR
Index: libkcal/libical/zoneinfo/America/Argentina/Buenos_Aires.ics
===================================================================
--- libkcal/libical/zoneinfo/America/Argentina/Buenos_Aires.ics	(.../tags/KDE/3.5.4/kdepim)	(revision 0)
+++ libkcal/libical/zoneinfo/America/Argentina/Buenos_Aires.ics	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -0,0 +1,14 @@
+BEGIN:VCALENDAR
+PRODID:-//Ximian//NONSGML Evolution Olson-VTIMEZONE Converter//EN
+VERSION:2.0
+BEGIN:VTIMEZONE
+TZID:/softwarestudio.org/Olson_20011030_5/America/Argentina/Buenos_Aires
+X-LIC-LOCATION:America/Argentina/Buenos_Aires
+BEGIN:STANDARD
+TZOFFSETFROM:-0300
+TZOFFSETTO:-0300
+TZNAME:ART
+DTSTART:19700101T000000
+END:STANDARD
+END:VTIMEZONE
+END:VCALENDAR
Index: libkcal/libical/zoneinfo/America/Toronto.ics
===================================================================
--- libkcal/libical/zoneinfo/America/Toronto.ics	(.../tags/KDE/3.5.4/kdepim)	(revision 0)
+++ libkcal/libical/zoneinfo/America/Toronto.ics	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -0,0 +1,22 @@
+BEGIN:VCALENDAR
+PRODID:-//Ximian//NONSGML Evolution Olson-VTIMEZONE Converter//EN
+VERSION:2.0
+BEGIN:VTIMEZONE
+TZID:/softwarestudio.org/Olson_20011030_5/America/Toronto
+X-LIC-LOCATION:America/Toronto
+BEGIN:STANDARD
+TZOFFSETFROM:-0400
+TZOFFSETTO:-0500
+TZNAME:EST
+DTSTART:19701025T020000
+RRULE:FREQ=YEARLY;BYMONTH=10;BYDAY=-1SU
+END:STANDARD
+BEGIN:DAYLIGHT
+TZOFFSETFROM:-0500
+TZOFFSETTO:-0400
+TZNAME:EDT
+DTSTART:19700405T020000
+RRULE:FREQ=YEARLY;BYMONTH=4;BYDAY=1SU
+END:DAYLIGHT
+END:VTIMEZONE
+END:VCALENDAR
Index: libkcal/libical/zoneinfo/zones.tab
===================================================================
--- libkcal/libical/zoneinfo/zones.tab	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ libkcal/libical/zoneinfo/zones.tab	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -55,6 +55,11 @@
 +0181200 -0630400 America/Anguilla
 +0170300 -0614800 America/Antigua
 -0071200 -0481200 America/Araguaina
+-0343600 -0582700 America/Argentina/Buenos_Aires
+-0282800 -0654700 America/Argentina/Catamarca
+-0312400 -0641100 America/Argentina/Cordoba
+-0241100 -0651800 America/Argentina/Jujuy
+-0325300 -0684900 America/Argentina/Mendoza
 +0123000 -0685800 America/Aruba
 -0251600 -0574000 America/Asuncion
 +0130600 -0593700 America/Barbados
@@ -162,6 +167,7 @@
 +0763400 -0684700 America/Thule
 +0482300 -0891500 America/Thunder_Bay
 +0323200 -1170100 America/Tijuana
++0433900 -0792300 America/Toronto
 +0182700 -0643700 America/Tortola
 +0491600 -1230700 America/Vancouver
 +0604300 -1350300 America/Whitehorse
@@ -220,19 +226,17 @@
 +0013300 +1102000 Asia/Kuching
 +0292000 +0475900 Asia/Kuwait
 +0221400 +1133500 Asia/Macao
++0221400 +1133500 Asia/Macau
 +0593400 +1504800 Asia/Magadan
--0050700 +1192400 Asia/Makassar
 +0143500 +1210000 Asia/Manila
 +0233600 +0583500 Asia/Muscat
 +0351000 +0332200 Asia/Nicosia
 +0550200 +0825500 Asia/Novosibirsk
 +0550000 +0732400 Asia/Omsk
-+0511300 +0512100 Asia/Oral
 +0113300 +1045500 Asia/Phnom_Penh
 +0000200 +1092000 Asia/Pontianak
 +0390100 +1254500 Asia/Pyongyang
 +0251700 +0513200 Asia/Qatar
-+0444800 +0652800 Asia/Qyzylorda
 +0164700 +0961000 Asia/Rangoon
 +0243800 +0464300 Asia/Riyadh
 +0104500 +1064000 Asia/Saigon
Index: libkcal/libical/zoneinfo/Asia/Macau.ics
===================================================================
--- libkcal/libical/zoneinfo/Asia/Macau.ics	(.../tags/KDE/3.5.4/kdepim)	(revision 0)
+++ libkcal/libical/zoneinfo/Asia/Macau.ics	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -0,0 +1,14 @@
+BEGIN:VCALENDAR
+PRODID:-//Ximian//NONSGML Evolution Olson-VTIMEZONE Converter//EN
+VERSION:2.0
+BEGIN:VTIMEZONE
+TZID:/softwarestudio.org/Olson_20011030_5/Asia/Macau
+X-LIC-LOCATION:Asia/Macau
+BEGIN:STANDARD
+TZOFFSETFROM:+0800
+TZOFFSETTO:+0800
+TZNAME:CST
+DTSTART:19700101T000000
+END:STANDARD
+END:VTIMEZONE
+END:VCALENDAR
Index: libkcal/resourcecached.h
===================================================================
--- libkcal/resourcecached.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ libkcal/resourcecached.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -121,19 +121,11 @@
     int saveInterval() const;
 
     /**
-      Set time of last load.
-    */
-    void setLastLoad( const QDateTime & );
-    /**
       Return time of last load.
     */
     QDateTime lastLoad() const;
 
     /**
-      Set time of last save.
-    */
-    void setLastSave( const QDateTime & );
-    /**
       Return time of last save.
     */
     QDateTime lastSave() const;
Index: libkcal/incidenceformatter.cpp
===================================================================
--- libkcal/incidenceformatter.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ libkcal/incidenceformatter.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -93,24 +93,8 @@
   return tmpStr;
 }
 
-
-static QString eventViewerFormatCategories( Incidence *event )
+static QString linkPerson( const QString& email, QString name, QString uid )
 {
-  QString tmpStr;
-  if ( !event->categoriesStr().isEmpty() ) {
-    if ( event->categories().count() == 1 ) {
-      tmpStr = eventViewerAddTag( "h2", i18n("Category") );
-    } else {
-      tmpStr = eventViewerAddTag( "h2", i18n("Categories") );
-    }
-    tmpStr += eventViewerAddTag( "p", event->categoriesStr() );
-  }
-  return tmpStr;
-}
-
-static QString linkPerson( const QString& email, QString name,
-                           QString uid, const QString& iconPath )
-{
   // Make the search, if there is an email address to search on,
   // and either name or uid is missing
   if ( !email.isEmpty() && ( name.isEmpty() || uid.isEmpty() ) ) {
@@ -144,13 +128,12 @@
   tmpString += '\n';
 
   // Make the mailto link
-  if ( !email.isEmpty() && !iconPath.isNull() ) {
+  if ( !email.isEmpty() ) {
     KCal::Person person( name, email );
     KURL mailto;
     mailto.setProtocol( "mailto" );
     mailto.setPath( person.fullName() );
-    tmpString += eventViewerAddLink( mailto.url(),
-                                     "<img src=\"" + iconPath + "\">" );
+    tmpString += eventViewerAddLink( mailto.url(), QString::null );
   }
   tmpString += "</li>\n";
 
@@ -162,24 +145,21 @@
   QString tmpStr;
   Attendee::List attendees = event->attendees();
   if ( attendees.count() ) {
-    KIconLoader iconLoader;
-    const QString iconPath = iconLoader.iconPath( "mail_generic",
-                                                  KIcon::Small );
 
     // Add organizer link
-    tmpStr += eventViewerAddTag( "h3", i18n("Organizer") );
+    tmpStr += eventViewerAddTag( "i", i18n("Organizer") );
     tmpStr += "<ul>";
     tmpStr += linkPerson( event->organizer().email(),
-                          event->organizer().name(), QString::null, iconPath );
+                          event->organizer().name(), QString::null );
     tmpStr += "</ul>";
 
     // Add attendees links
-    tmpStr += eventViewerAddTag( "h3", i18n("Attendees") );
+    tmpStr += eventViewerAddTag( "i", i18n("Attendees") );
     tmpStr += "<ul>";
     Attendee::List::ConstIterator it;
     for( it = attendees.begin(); it != attendees.end(); ++it ) {
       Attendee *a = *it;
-      tmpStr += linkPerson( a->email(), a->name(), a->uid(), iconPath );
+      tmpStr += linkPerson( a->email(), a->name(), a->uid() );
     }
     tmpStr += "</ul>";
   }
@@ -214,24 +194,20 @@
 static QString eventViewerFormatBirthday( Event *event )
 {
   if ( !event) return  QString::null;
-  if ( event->customProperty("KABC","BIRTHDAY")!= "YES" ) return QString::null;
+  if ( event->customProperty("KABC","BIRTHDAY") != "YES" ) return QString::null;
 
-  QString uid_1 = event->customProperty("KABC","UID-1");
-  QString name_1 = event->customProperty("KABC","NAME-1");
-  QString email_1= event->customProperty("KABC","EMAIL-1");
+  QString uid = event->customProperty("KABC","UID-1");
+  QString name = event->customProperty("KABC","NAME-1");
+  QString email= event->customProperty("KABC","EMAIL-1");
 
-  KIconLoader iconLoader;
-  const QString iconPath = iconLoader.iconPath( "mail_generic",
-                                                  KIcon::Small );
-  //TODO: add a tart icon
   QString tmpString = "<ul>";
-  tmpString += linkPerson( email_1, name_1, uid_1, iconPath );
+  tmpString += linkPerson( email, name, uid );
 
   if ( event->customProperty( "KABC", "ANNIVERSARY") == "YES" ) {
-    QString uid_2 = event->customProperty("KABC","UID-2");
-    QString name_2 = event->customProperty("KABC","NAME-2");
-    QString email_2= event->customProperty("KABC","EMAIL-2");
-    tmpString += linkPerson( email_2, name_2, uid_2, iconPath );
+    uid = event->customProperty("KABC","UID-2");
+    name = event->customProperty("KABC","NAME-2");
+    email= event->customProperty("KABC","EMAIL-2");
+    tmpString += linkPerson( email, name, uid );
   }
 
   tmpString += "</ul>";
@@ -244,35 +220,46 @@
 
   // show icons
   {
-    KIconLoader iconLoader;
-
     tmpStr += "<td>";
 
+    if ( incidence->type() == "Event" ) {
+      tmpStr += "<img src=\"" +
+                KGlobal::iconLoader()->iconPath( "appointment", KIcon::Small ) +
+                "\">";
+    }
     if ( incidence->type() == "Todo" ) {
       tmpStr += "<img src=\"" +
-                iconLoader.iconPath( "todo", KIcon::Small ) +
+                KGlobal::iconLoader()->iconPath( "todo", KIcon::Small ) +
                 "\">";
     }
+    if ( incidence->type() == "Journal" ) {
+      tmpStr += "<img src=\"" +
+                KGlobal::iconLoader()->iconPath( "journal", KIcon::Small ) +
+                "\">";
+    }
     if ( incidence->isAlarmEnabled() ) {
       tmpStr += "<img src=\"" +
-                iconLoader.iconPath( "bell", KIcon::Small ) +
+                KGlobal::iconLoader()->iconPath( "bell", KIcon::Small ) +
                 "\">";
     }
     if ( incidence->doesRecur() ) {
       tmpStr += "<img src=\"" +
-                iconLoader.iconPath( "recur", KIcon::Small ) +
+                KGlobal::iconLoader()->iconPath( "recur", KIcon::Small ) +
                 "\">";
     }
     if ( incidence->isReadOnly() ) {
       tmpStr += "<img src=\"" +
-                iconLoader.iconPath( "readonlyevent", KIcon::Small ) +
+                KGlobal::iconLoader()->iconPath( "readonlyevent", KIcon::Small ) +
                 "\">";
     }
 
     tmpStr += "</td>";
   }
 
-  tmpStr += "<td>" + eventViewerAddTag( "h1", incidence->summary() ) + "</td>";
+  tmpStr += "<td>"
+            + eventViewerAddTag( "u",
+                                 eventViewerAddTag( "b", incidence->summary() ) )
+            + "</td>";
   tmpStr += "</tr></table><br>";
 
   return tmpStr;
@@ -284,12 +271,6 @@
   QString tmpStr = eventViewerFormatHeader( event );
 
   tmpStr += "<table>";
-  if ( !event->location().isEmpty() ) {
-    tmpStr += "<tr>";
-    tmpStr += "<td align=\"right\"><b>" + i18n( "Location" ) + "</b></td>";
-    tmpStr += "<td>" + event->location() + "</td>";
-    tmpStr += "</tr>";
-  }
 
   tmpStr += "<tr>";
   if ( event->doesFloat() ) {
@@ -336,30 +317,46 @@
 
   if ( !event->description().isEmpty() ) {
     tmpStr += "<tr>";
-    tmpStr += "<td></td>";
+    tmpStr += "<td align=\"right\"><b>" + i18n( "Description" ) + "</b></td>";
     tmpStr += "<td>" + eventViewerAddTag( "p", event->description() ) + "</td>";
     tmpStr += "</tr>";
   }
 
+  if ( !event->location().isEmpty() ) {
+    tmpStr += "<tr>";
+    tmpStr += "<td align=\"right\"><b>" + i18n( "Location" ) + "</b></td>";
+    tmpStr += "<td>" + event->location() + "</td>";
+    tmpStr += "</tr>";
+  }
+
   if ( event->categories().count() > 0 ) {
     tmpStr += "<tr>";
-    tmpStr += "<td align=\"right\"><b>" + i18n( "1 category", "%n categories", event->categories().count() )+ "</b></td>";
+    tmpStr += "<td align=\"right\"><b>" + i18n( "1 Category", "%n Categories", event->categories().count() )+ "</b></td>";
     tmpStr += "<td>" + event->categoriesStr() + "</td>";
     tmpStr += "</tr>";
   }
 
   if ( event->doesRecur() ) {
-    QDateTime dt = event->recurrence()->getNextDateTime(
-                                          QDateTime::currentDateTime() );
+    QDateTime dt =
+      event->recurrence()->getNextDateTime( QDateTime::currentDateTime() );
     tmpStr += "<tr>";
-    tmpStr += "<td align=\"right\"><b>" + i18n( "Next Occurrence" )+ "</b></td>";
-    tmpStr += "<td>" + KGlobal::locale()->formatDateTime( dt, true ) + "</td>";
+    tmpStr += "<td align=\"right\"><b>" + i18n( "Next on" ) + "</b></td>";
+    if ( !event->doesFloat() ) {
+      tmpStr += "<td>" +
+                KGlobal::locale()->formatDateTime( dt, true ) + "</td>";
+    } else {
+      tmpStr += "<td>" +
+                KGlobal::locale()->formatDate( dt.date(), true ) + "</td>";
+    }
     tmpStr += "</tr>";
   }
 
-  tmpStr += "<tr><td colspan=\"2\">";
-  tmpStr += eventViewerFormatAttendees( event );
-  tmpStr += "</td></tr>";
+  int attendeeCount = event->attendees().count();
+  if ( attendeeCount > 0 ) {
+    tmpStr += "<tr><td colspan=\"2\">";
+    tmpStr += eventViewerFormatAttendees( event );
+    tmpStr += "</td></tr>";
+  }
 
   int attachmentCount = event->attachments().count();
   if ( attachmentCount > 0 ) {
@@ -370,7 +367,7 @@
   }
 
   tmpStr += "</table>";
-  tmpStr += "<p><em>" + i18n( "Creation date: %1.").arg(
+  tmpStr += "<em>" + i18n( "Creation date: %1.").arg(
     KGlobal::locale()->formatDateTime( event->created() , true ) ) + "</em>";
   return tmpStr;
 }
@@ -380,47 +377,104 @@
   if ( !todo ) return QString::null;
   QString tmpStr = eventViewerFormatHeader( todo );
 
-  if ( !todo->location().isEmpty() ) {
-    tmpStr += eventViewerAddTag( "b", i18n("Location:") + " " );
-    tmpStr += todo->location();
-    tmpStr += "<br>";
-  }
+  tmpStr += "<table>";
+
   if ( todo->hasDueDate() ) {
-    tmpStr += i18n("<b>Due on:</b> %1").arg( todo->dtDueStr() );
+    tmpStr += "<tr>";
+    tmpStr += "<td align=\"right\"><b>" + i18n( "Due on" ) + "</b></td>";
+    if ( !todo->doesFloat() ) {
+      tmpStr += "<td>" +
+                KGlobal::locale()->formatDateTime( todo->dtDue(), true ) +
+                "</td>";
+    } else {
+      tmpStr += "<td>" +
+                KGlobal::locale()->formatDate( todo->dtDue().date(), true ) +
+                "</td>";
+    }
+    tmpStr += "</tr>";
   }
 
-  if ( !todo->description().isEmpty() )
-    tmpStr += eventViewerAddTag( "p", todo->description() );
+  if ( !todo->description().isEmpty() ) {
+    tmpStr += "<tr>";
+    tmpStr += "<td align=\"right\"><b>" + i18n( "Description" ) + "</b></td>";
+    tmpStr += "<td>" + todo->description() + "</td>";
+    tmpStr += "</tr>";
+  }
 
-  tmpStr += eventViewerFormatCategories( todo );
+  if ( !todo->location().isEmpty() ) {
+    tmpStr += "<tr>";
+    tmpStr += "<td align=\"right\"><b>" + i18n( "Location" ) + "</b></td>";
+    tmpStr += "<td>" + todo->location() + "</td>";
+    tmpStr += "</tr>";
+  }
 
-  tmpStr += i18n("<p><b>Priority:</b> %2</p>")
-                .arg( (todo->priority()>0)?(QString::number( todo->priority() )):i18n("Unspecified") );
+  if ( todo->categories().count() > 0 ) {
+    tmpStr += "<tr>";
+    tmpStr += "<td align=\"right\"><b>" + i18n( "1 Category", "%n Categories", todo->categories().count() )+ "</b></td>";
+    tmpStr += "<td>" + todo->categoriesStr() + "</td>";
+    tmpStr += "</tr>";
+  }
 
-  tmpStr += i18n("<p><i>%1 % completed</i></p>")
-                .arg( todo->percentComplete() );
+  tmpStr += "<tr>";
+  tmpStr += "<td align=\"right\"><b>" + i18n( "Priority" ) + "</b></td>";
+  if ( todo->priority() > 0 ) {
+    tmpStr += "<td>" + QString::number( todo->priority() ) + "</td>";
+  } else {
+    tmpStr += "<td>" + i18n( "Unspecified" ) + "</td>";
+  }
+  tmpStr += "</tr>";
 
+  tmpStr += "<tr>";
+  tmpStr += "<td align=\"right\"><b>" + i18n( "Completed" ) + "</b></td>";
+  tmpStr += "<td>" + i18n( "%1 %" ).arg( todo->percentComplete() ) + "</td>";
+  tmpStr += "</tr>";
+
   if ( todo->doesRecur() ) {
-    QDateTime dt = todo->recurrence()->getNextDateTime(
-                                         QDateTime::currentDateTime() );
-    tmpStr += eventViewerAddTag( "p", "<em>" +
-      i18n("This is a recurring to-do. The next occurrence will be on %1.").arg(
-      KGlobal::locale()->formatDateTime( dt, true ) ) + "</em>" );
+    QDateTime dt =
+      todo->recurrence()->getNextDateTime( QDateTime::currentDateTime() );
+    tmpStr += "<tr>";
+    tmpStr += "<td align=\"right\"><b>" + i18n( "Next on" ) + "</b></td>";
+    if ( !todo->doesFloat() ) {
+      tmpStr += "<td>" +
+                KGlobal::locale()->formatDateTime( dt, true ) + "</td>";
+    } else {
+      tmpStr += "<td>" +
+                KGlobal::locale()->formatDate( dt.date(), true ) + "</td>";
+    }
+    tmpStr += "</tr>";
   }
-  tmpStr += eventViewerFormatAttendees( todo );
-  tmpStr += eventViewerFormatAttachments( todo );
-  tmpStr += "<p><em>" + i18n( "Creation date: %1.").arg(
-    KGlobal::locale()->formatDateTime( todo->created() , true ) ) + "</em>";
+
+  int attendeeCount = todo->attendees().count();
+  if ( attendeeCount > 0 ) {
+    tmpStr += "<tr><td colspan=\"2\">";
+    tmpStr += eventViewerFormatAttendees( todo );
+    tmpStr += "</td></tr>";
+  }
+
+  int attachmentCount = todo->attachments().count();
+  if ( attachmentCount > 0 ) {
+    tmpStr += "<tr>";
+    tmpStr += "<td align=\"right\"><b>" + i18n( "1 attachment", "%n attachments", attachmentCount )+ "</b></td>";
+    tmpStr += "<td>" + eventViewerFormatAttachments( todo ) + "</td>";
+    tmpStr += "</tr>";
+  }
+
+  tmpStr += "</table>";
+  tmpStr += "<em>" + i18n( "Creation date: %1.").arg(
+    KGlobal::locale()->formatDateTime( todo->created(), true ) ) + "</em>";
   return tmpStr;
 }
 
 static QString eventViewerFormatJournal( Journal *journal )
 {
   if ( !journal ) return QString::null;
+
   QString tmpStr;
-  if ( !journal->summary().isEmpty() )
-    tmpStr+= eventViewerAddTag( "h1", journal->summary() );
-  tmpStr += eventViewerAddTag( "h2", i18n("Journal for %1").arg( journal->dtStartDateStr( false ) ) );
+  if ( !journal->summary().isEmpty() ) {
+    tmpStr += eventViewerAddTag( "u",
+                                 eventViewerAddTag( "b", journal->summary() ) );
+  }
+  tmpStr += eventViewerAddTag( "b", i18n("Journal for %1").arg( journal->dtStartDateStr( false ) ) );
   if ( !journal->description().isEmpty() )
     tmpStr += eventViewerAddTag( "p", journal->description() );
   return tmpStr;
@@ -429,8 +483,12 @@
 static QString eventViewerFormatFreeBusy( FreeBusy *fb )
 {
   if ( !fb ) return QString::null;
-  QString tmpStr( eventViewerAddTag( "h1", i18n("Free/Busy information for %1").arg( fb->organizer().fullName() ) ) );
-  tmpStr += eventViewerAddTag( "h3", i18n("Busy times in date range %1 - %2:")
+
+  QString tmpStr =
+    eventViewerAddTag( "u",
+                       eventViewerAddTag( "b", i18n("Free/Busy information for %1")
+                                          .arg( fb->organizer().fullName() ) ) );
+  tmpStr += eventViewerAddTag( "i", i18n("Busy times in date range %1 - %2:")
       .arg( KGlobal::locale()->formatDate( fb->dtStart().date(), true ) )
       .arg( KGlobal::locale()->formatDate( fb->dtEnd().date(), true ) ) );
 
@@ -1006,7 +1064,7 @@
   // The InvitationHeaderVisitor returns false if the incidence is somehow invalid, or not handled
   if ( !headerVisitor.act( incBase, msg ) )
     return QString::null;
-  html += "<h2>" + headerVisitor.result() + "</h2>";
+  html += "<b>" + headerVisitor.result() + "</b>";
 
   InvitationBodyVisitor bodyVisitor;
   if ( !bodyVisitor.act( incBase, msg ) )
@@ -1690,6 +1748,9 @@
 
 QString IncidenceFormatter::ToolTipVisitor::generateToolTip( Incidence* incidence, QString dtRangeText )
 {
+  if ( !incidence )
+    return QString::null;
+
   QString tmp = "<qt><b>"+ incidence->summary().replace("\n", "<br>")+"</b>";
 
   tmp += dtRangeText;
Index: libkcal/todo.cpp
===================================================================
--- libkcal/todo.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ libkcal/todo.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -292,7 +292,7 @@
 
 bool Todo::isOverdue() const
 {
-  bool inPast = doesFloat() ? mDtDue.date() < QDate::currentDate()
-                            : mDtDue < QDateTime::currentDateTime();
+  bool inPast = doesFloat() ? dtDue().date() < QDate::currentDate()
+                            : dtDue() < QDateTime::currentDateTime();
   return ( inPast && !isCompleted() );
 }
Index: libkcal/icalformat.cpp
===================================================================
--- libkcal/icalformat.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ libkcal/icalformat.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -169,8 +169,10 @@
           setException(new ErrorFormat(ErrorFormat::ParseErrorKcal));
         }
         success = false;
-      } else
+      } else {
         mLoadedProductId = mImpl->loadedProductId();
+      }
+      icalcomponent_free( comp );
     }
   } else if (icalcomponent_isa(calendar) != ICAL_VCALENDAR_COMPONENT) {
     kdDebug(5800) << "ICalFormat::load(): No VCALENDAR component found" << endl;
@@ -489,7 +491,7 @@
   }
 
   kdDebug(5800) << "ICalFormat::parseScheduleMessage() restriction..." << endl;
-  
+
   if (!icalrestriction_check(message)) {
     kdWarning(5800) << k_funcinfo << endl << "libkcal reported a problem while parsing:" << endl;
     kdWarning(5800) << Scheduler::translatedMethodName(method) + ": " + mImpl->extractErrorProperty(c)<< endl;
Index: kpilot/conduits/sysinfoconduit/sysinfo_conduit.desktop
===================================================================
--- kpilot/conduits/sysinfoconduit/sysinfo_conduit.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kpilot/conduits/sysinfoconduit/sysinfo_conduit.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Comment[es]=Este conducto escribe la información subre su agenda electrónica y la sincronización a un archivo.
 Comment[et]=See kanal salvestab info pihuarvuti kohta failina.
 Comment[eu]=Kanal honek zure agenda elektronikoari buruzko informazioa eta sinkronizazio fitxategi batean gordetzen ditu.
+Comment[fa]=این لوله، اطلاعات دربارۀ دستی شما و ترکیب‌دهی به پرونده را می‌نویسد.
 Comment[fi]=Tämä yhdyskäytävä kirjoittaa tietoja taskutietokoneelta ja synkronoi ne tiedostoon.
 Comment[fr]=Ce canal écrit des informations sur votre périphérique et la synchronisation dans un fichier.
 Comment[hi]=यह कन्ड्यूइट आपके हैंण्डहेल्ड के बारे में जानकारी लिखता है तथा एक फ़ाइल में सिंक करता है.
@@ -54,6 +55,7 @@
 Name[es]=Información del sistema
 Name[et]=Süsteemi info
 Name[eu]=Sistemaren informazioa
+Name[fa]=اطلاعات سیستم‌
 Name[fi]=Järjestelmätiedot
 Name[fr]=Informations sur le système
 Name[ga]=Faisnéis Córais
Index: kpilot/conduits/notepadconduit/notepad-conduit.desktop
===================================================================
--- kpilot/conduits/notepadconduit/notepad-conduit.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kpilot/conduits/notepadconduit/notepad-conduit.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -27,6 +27,7 @@
 Comment[es]=Este conducto copia los dibujos del bloc de notas en una carpeta local.
 Comment[et]=See kanal teeb NotePadi joonistustest varukoopia kohalikku kataloogi.
 Comment[eu]=Kanal honek Ohar-blokaren marrazkiak karpeta lokal batera gordetzen ditu.
+Comment[fa]=این لوله، ترسیمهای NotePad را در یک پوشۀ محلی پشتیبانی می‌کند.
 Comment[fi]=Tämä yhdyskäytävä tekee varmuuskopion NotePad -piirroksista paikalliseen kansioon.
 Comment[fr]=Ce conduit sauvegarde les dessins (Notes) dans un dossier local
 Comment[hu]=Bővítőmodul NotePad-rajzok helyi könyvtárba való lementéséhez.
Index: kpilot/conduits/memofileconduit/memofile-conduit.desktop
===================================================================
--- kpilot/conduits/memofileconduit/memofile-conduit.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kpilot/conduits/memofileconduit/memofile-conduit.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[es]=Archivo de nota
 Name[et]=Memofail
 Name[eu]=Ohar fitxategia
+Name[fa]=پروندۀ Memo
 Name[fi]=Muistiotiedosto
 Name[fr]=Fichier mémo
 Name[ga]=Comhad Meamraim
@@ -46,6 +47,7 @@
 Comment[es]=Este conducto sincroniza las notas de su agenda electrónica con el directorio local.
 Comment[et]=See kanal sünkroniseerib pihuarvutis ja arvutis olevad memod.
 Comment[eu]=Kanal honek zure agendako oharrak direktorio lokal batekin sinkronizatzen ditu.
+Comment[fa]=این لوله، memo‌های دستی خود را با یک فهرست راهنمای محلی همگام‌سازی کنید.
 Comment[fi]=Tämä yhdyskäytävä synkronoi taskutietokoneen muistiot paikalliseen kansioon.
 Comment[fr]=Ce canal synchronise les mémos du Palm avec ceux de KDE.
 Comment[hu]=Ezzel a csatolóval egy kézi számítógép memóit lehet szinkronizálni a helyi címjegyzékkel.
Index: kpilot/conduits/timeconduit/time_conduit.desktop
===================================================================
--- kpilot/conduits/timeconduit/time_conduit.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kpilot/conduits/timeconduit/time_conduit.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Comment[es]=Este conducto fija la hora de su agenda electrónica según el reloj de su PC.
 Comment[et]=See kanal sünkroniseerib pihuarvuti aja PC kellaga.
 Comment[eu]=Kanal honek zure agenda elektronikoko ordua PC-aren ordura ezartzen du.
+Comment[fa]=این لوله، از طریق ساعت PC زمان دستی شما را تنظیم می‌کند.
 Comment[fi]=Tämä yhdyskäytävä asettaa taskutietokoneen kellonajan PC:n kellosta.
 Comment[fr]=Ce canal règle l'heure de votre périphérique depuis celle du PC.
 Comment[hi]=यह कन्ड्यूइट आपके हैंण्डहेल्ड में पीसी घड़ी द्वारा समय नियत करता है.
@@ -54,6 +55,7 @@
 Name[es]=Sincronización de hora
 Name[et]=Aja sünkroniseerimine
 Name[eu]=Ordu sinkronizazioa
+Name[fa]=همگام‌سازی زمان 
 Name[fi]=Ajan synkronointi
 Name[fr]=Synchronisation de l'heure
 Name[gl]=Sincronización Horaria
Index: kpilot/conduits/perlconduit/perl-conduit.desktop
===================================================================
--- kpilot/conduits/perlconduit/perl-conduit.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kpilot/conduits/perlconduit/perl-conduit.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Name[es]=Perl (Ejemplo)
 Name[et]=Perl (näidis)
 Name[eu]=Perl (adibidea)
+Name[fa]=Perl (نمونه)
 Name[fi]=Perl (esimerkki)
 Name[fr]=Perl (exemple)
 Name[ga]=Perl (Sampla)
@@ -56,6 +57,7 @@
 Comment[es]=Este conducto de ejemplo ejecuta un intérprete de Perl
 Comment[et]=See näidiskanal käivitab Perli interpretaatori.
 Comment[eu]=Adibide honek Perl interpretatzaile bat exekutatzen du.
+Comment[fa]=این لولۀ نمونه، یک مفسر Perlرا اجرا می‌کند.
 Comment[fi]=Tämä esimerkkiyhdyskäytävä suorittaa Perl-tulkkia.
 Comment[fr]=Cet exemple de canal lance un interpréteur Perl.
 Comment[ga]=Ritheann an seoladán samplach seo léirmhínitheoir Perl.
Index: kpilot/conduits/docconduit/kpalmdoc.desktop
===================================================================
--- kpilot/conduits/docconduit/kpalmdoc.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kpilot/conduits/docconduit/kpalmdoc.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -17,6 +17,7 @@
 GenericName[es]=Conversor de PalmDOC
 GenericName[et]=PalmDOC konverter
 GenericName[eu]=PalmDOC bihurtzailea
+GenericName[fa]=مبدل PalmDOC
 GenericName[fi]=PalmDOC-muunnin
 GenericName[fr]=Convertisseur PalmDOC
 GenericName[ga]=Tiontaire PalmDOC
Index: kpilot/conduits/docconduit/doc_conduit.desktop
===================================================================
--- kpilot/conduits/docconduit/doc_conduit.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kpilot/conduits/docconduit/doc_conduit.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Comment[es]=Añade archivos de texto a su agenda electrónica. Compatible con los lectores DOC.
 Comment[et]=Lisab DOC-riiderile sobilikud tekstifailid sinu pihuseadmele.
 Comment[eu]=Zure agenda elektronikora DOC irakurleentzako aproposak diren testu fitxategiak gehitzen ditu.
+Comment[fa]=پرونده‌های متن را به دستی شما اضافه می‌کند، که برای خوانندگان DOC مفید است.
 Comment[fi]=Lisää tekstitiedostoja taskutietokoneeseen. Tämä on käyttökelpoinen DOC-lukijoille.
 Comment[fr]=Ajoute des fichiers texte à votre Palm, approprié pour les lecteurs de DOC.
 Comment[hu]=Szöveges fájlok hozzáadása a kézi számítógéphez, DOC-olvasók számára.
@@ -42,6 +43,7 @@
 Name[ca]=DOC de Palm
 Name[cy]=DOC Palm
 Name[de]=Palm-DOC
+Name[fa]=رایانۀ جیبی DOC
 Name[hi]=पॉम डॉक
 Name[nds]=Palm-DOC
 Name[pt]=DOC do Palm
Index: kpilot/conduits/malconduit/mal_conduit.desktop
===================================================================
--- kpilot/conduits/malconduit/mal_conduit.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kpilot/conduits/malconduit/mal_conduit.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Name[es]=Conducto MAL (AvantGo)
 Name[et]=MAL (AvantGo) kanal
 Name[eu]=MAL (AvantGo) kanala
+Name[fa]=لولۀ MAL (AvantGo)
 Name[fi]=MAL (AvantGo)- yhdyskäytävä
 Name[fr]=MAL (AvantGo) Canal
 Name[ga]=Seoladán MAL (AvantGo)
@@ -54,6 +55,7 @@
 Comment[es]=Sincroniza AvantGo (o más genéricamente, el contenido de un servidor MAL) con la agenda electrónica. Le permite ver páginas web en la agenda electrónica sin estar conectado, como la programación de televisión o la cartelera de cine, o cualquier otra página web.
 Comment[et]=See kanal sünkroniseerib AvantGo (või üldisemalt MAL serveri sisu) pihuarvutiga. See võimaldab vaadata veebilehekülgi pihuseadmelt ilma võrguühendusega, näiteks uurida kino- või telekava või mis tahes muud huvipakkuvat veebilehekülge.
 Comment[eu]=Sinkronizatu AvantGo (edo orokorrean MAL zerbitzariaren edukina) agenda elektronikora. Honek web-orriak agendan konexio gabe ikusteko aukera ematen dizu, zure zine edo TB antolatzailean bezala, edo beste web orri bat bezala.
+Comment[fa]=همگام‌سازی AvantGo (یا عموماً یک محتوای کارساز MAL) با دستی. به شما اجازه می‌دهد که صفحات وب برون خطی روی دستی، مانند برنامۀ سینما یا تلویزیون شما، یا هر صفحه وب دیگری را مشاهده کنید. 
 Comment[fi]=Synkronoi AvantGo (tai yleisesti MAL-palvelimen sisältö) taskutietokoneeseen. Tämä mahdollistaa web-sivujen lukemisen offline-tilassa (esim. elokuva- tai tv-ohjelmasivujen).
 Comment[fr]=Synchronise AvantGo (ou plus généralement tout serveur MAL) avec votre Palm. Ceci vous permet de consulter des pages Web hors ligne sur votre Palm, comme des programmes TV, Cinéma ou n'importe quelle page Web.
 Comment[hu]=AvantGo (vagy MAL-kiszolgáló) adatainak szinkronizálása a kézi számítógéppel. Lehetővé teszi weboldalak offline módban való megtekintését, például a mozi- vagy tévéműsort, vagy bármi mást.
Index: kpilot/conduits/popmail/popmail-conduit.desktop
===================================================================
--- kpilot/conduits/popmail/popmail-conduit.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kpilot/conduits/popmail/popmail-conduit.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Comment[es]=Envía el correo de la agenda electrónica a través de KMail.
 Comment[et]=Saadab pihuseadmest KMaili vahendusel e-kirja.
 Comment[eu]=Bidali posta zure agenda elektronikotik KMail-en bidez.
+Comment[fa]=ارسال نامه از طریق KMail، از دستی شما.
 Comment[fi]=Lähetä sähköpostia taskutietokoneelta KMailin kautta.
 Comment[fr]=Permet d'envoyer des messages du Palm vers KMail
 Comment[hu]=Ezzel a csatolóval kézi számítógépről lehet levelet küldeni a KMailen keresztül.
@@ -48,6 +49,7 @@
 Name[es]=Correo
 Name[et]=E-post
 Name[eu]=Posta
+Name[fa]=نامه
 Name[fi]=Sähköposti
 Name[fr]=Messages
 Name[ga]=Ríomhphost
Index: kpilot/conduits/knotes/knotes-conduit.desktop
===================================================================
--- kpilot/conduits/knotes/knotes-conduit.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kpilot/conduits/knotes/knotes-conduit.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Comment[es]=Este conducto sincroniza la aplicación de Notas con KNotes.
 Comment[et]=See kanal sünkroniseerib Memo Pad rakenduse ja KNotesi.
 Comment[eu]=Kanal honek Memo Pad aplikazioa KNotes-ekin sinkronizatzen du.
+Comment[fa]=این لوله، کاربرد Memo Pad را با KNotes همگام می‌سازد.
 Comment[fi]=Tämä yhdyskäytävä synkronoi Memo Pad -ohelman KNotesin kanssa.
 Comment[fr]=Ce canal synchronise l'application « Memo Pad » avec KNotes.
 Comment[hi]=यह कन्ड्यूइट मेमो पेड अनुप्रयोगों को के-नोट्स के साथ सिंक करता है
Index: kpilot/conduits/pythonconduit/python-conduit.desktop
===================================================================
--- kpilot/conduits/pythonconduit/python-conduit.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kpilot/conduits/pythonconduit/python-conduit.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Name[es]=Python (Ejemplo)
 Name[et]=Python (näidis)
 Name[eu]=Python (adibidea)
+Name[fa]=Python (نمونه)
 Name[fi]=Python (esimerkki)
 Name[fr]=Python (exemple)
 Name[ga]=Python (Sampla)
@@ -56,6 +57,7 @@
 Comment[es]=Este conducto de ejemplo ejecuta un intérprete de Python
 Comment[et]=See näidiskanal käivitab Pythoni interpretaatori.
 Comment[eu]=Adibide honek Python interpretatzaile bat exekutatzen du.
+Comment[fa]=این لولۀ نمونه، یک مفسر Python را اجرا می‌کند.
 Comment[fi]=Tämä esimerkkiyhdyskäytävä suorittaa Python-tulkkia.
 Comment[fr]=Cet exemple de canal lance un interpréteur Python.
 Comment[ga]=Ritheann an seoladán samplach seo léirmhínitheoir Python.
Index: kpilot/conduits/null/null-conduit.desktop
===================================================================
--- kpilot/conduits/null/null-conduit.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kpilot/conduits/null/null-conduit.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -3,6 +3,7 @@
 Type=Service
 Name=NULL
 Name[ca]=NUL
+Name[fa]=پوچ
 Name[ro]=NUL
 Name[sk]=NIČ
 Name[ta]=வெற்று மதிப்பு
@@ -18,6 +19,7 @@
 Comment[el]=Αυτός ο σύνδεσμος δεν κάνει τίποτα.
 Comment[et]=See kanal ei tee mitte kui midagi.
 Comment[eu]=Kanal honek ez du ezer egiten.
+Comment[fa]=این لوله هیچ چیز ندارد.
 Comment[fi]=Tämä yhdyskäytävä ei tee mitään.
 Comment[fr]=Ce canal ne fait rien.
 Comment[ga]=Ní dhéanann an seoladán seo faic.
Index: kpilot/conduits/vcalconduit/todo-conduit.desktop
===================================================================
--- kpilot/conduits/vcalconduit/todo-conduit.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kpilot/conduits/vcalconduit/todo-conduit.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Comment[es]=Este conducto sincroniza la lista de tareas pendientes de su agenda electrónica con KOrganizer.
 Comment[et]=See kanal sünkroniseerib pihuarvuti ja KOrganizeri ülesannete nimekirja.
 Comment[eu]=Kanal honek zure agenda elektronikoko egitekoen zerrenda KOrganizer-era sinkronizatzen du.
+Comment[fa]=این لوله، فهرست کارهایی که باید انجام شود را از دستی شما با KOrganizer همگام‌سازی می‌کند.
 Comment[fi]=Tämä yhdyskäytävä synkronoi taskutietokoneen tehtävälistan KOrganizeriin.
 Comment[fr]=Ce canal synchronise la liste des tâches de votre Palm sur KOrganizer.
 Comment[hi]=यह कन्ड्यूइट आपके हैंण्डहेल्ड से टू-डू सूची को के-आर्गेनाइज़र में सिंक करता है
@@ -53,6 +54,7 @@
 Name[es]=Tareas pendientes (KOrganizer)
 Name[et]=Ülesanded (KOrganizer)
 Name[eu]=Egitekoak (KOrganizer)
+Name[fa]=کارهایی که باید انجام شوند (KOrganizer)
 Name[fi]=Tehtävät (KOrganizer)
 Name[fr]=Tâches (KOrganizer)
 Name[ga]=Tascanna (KOrganizer)
@@ -69,7 +71,7 @@
 Name[nds]=Opgaven (KOrganizer)
 Name[nl]=Taken (KOrganizer)
 Name[nn]=Oppgåveliste (KOrganizer)
-Name[pl]=Do zrobienia (Organizator)
+Name[pl]=Do zrobienia (Korganizer)
 Name[pt]=Por Fazer (KOrganizer)
 Name[pt_BR]=Tarefas (KOrganizer)
 Name[ru]=Задачи (KOrganizer)
Index: kpilot/conduits/vcalconduit/vcal-conduit.desktop
===================================================================
--- kpilot/conduits/vcalconduit/vcal-conduit.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kpilot/conduits/vcalconduit/vcal-conduit.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Name[es]=Calendario (KOrganizer)
 Name[et]=Kalender (KOrganizer)
 Name[eu]=Egutegia (KOrganizer)
+Name[fa]=تقویم (KOrganizer)
 Name[fi]=Kalenteri (KOrganizer)
 Name[fr]=Agenda (KOrganizer)
 Name[ga]=Féilire (KOrganizer)
@@ -29,7 +30,7 @@
 Name[nds]=Kalenner (KOrganizer)
 Name[nl]=Agenda (KOrganizer)
 Name[nn]=Kalender (KOrganizer)
-Name[pl]=Kalendarz (Organizator)
+Name[pl]=Kalendarz (Korganizer)
 Name[pt]=Calendário (KOrganizer)
 Name[pt_BR]=Calendário (KOrganizer)
 Name[ru]=Календарь (KOrganizer)
@@ -56,6 +57,7 @@
 Comment[es]=Este conducto sincroniza su agenda electrónica con la libreta de fechas de KOrganizer.
 Comment[et]=See kanal sünkroniseerib pihuseadme ja KOrganizeri kalendri.
 Comment[eu]=Kanal honek zure agenda elektronikoa  KOrganizer-en data-liburuarekin sinkronizatzen du.
+Comment[fa]=این لوله، دستی شما را با کتاب دادۀ KOrganizer  همگام می‌سازد.
 Comment[fi]=Tämä yhdyskäytävä synkronoi taskutietokoneen KOrganizerin päiväkirjaan.
 Comment[fr]=Ce canal synchronise votre Palm avec l'agenda KOrganizer.
 Comment[hu]=Ezzel a csatolóval szinkronizálhatók a kézi számítógép és a KOrganizer dátumai.
Index: kpilot/conduits/abbrowserconduit/abbrowser_conduit.desktop
===================================================================
--- kpilot/conduits/abbrowserconduit/abbrowser_conduit.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kpilot/conduits/abbrowserconduit/abbrowser_conduit.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Comment[es]=Este conducto sincroniza la libreta de direcciones de su agenda electrónica con la de KDE
 Comment[et]=See kanal sünkroniseerib pihuarvuti ja KDE aadressiraamatu.
 Comment[eu]=Kanal honek agenda-elektronikoaren helbide-liburua KDE-ren helbide-liburuarekin sinkronizatzen du.
+Comment[fa]=این لوله، کتاب نشانی دستی را با کتاب نشانی KDE همگام می‌سازد.
 Comment[fi]=Tämä yhdyskäytävä synkronoi taskutietokoneen KDE:n osoitekirjan kanssa
 Comment[fr]=Ce canal synchronise le carnet d'adresses du périphérique avec celui de KDE.
 Comment[hi]=यह कन्ड्यूइट हैंडहेल्ड पता-पुस्तिका को केडीई के पता-पुस्तिका से सिंक करती है.
@@ -57,6 +58,7 @@
 Name[es]=Libreta de direcciones
 Name[et]=Aadressiraamat
 Name[eu]=Helbide-liburua
+Name[fa]=کتاب نشانی
 Name[fi]=Osoitekirja
 Name[fr]=Carnet d'adresses
 Name[ga]=Leabhar Seoltaí
Index: kpilot/kpilot/kpilot_config.desktop
===================================================================
--- kpilot/kpilot/kpilot_config.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kpilot/kpilot/kpilot_config.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -23,6 +23,7 @@
 Name[es]=Configuración de KPilot
 Name[et]=KPiloti seadistamine
 Name[eu]=KPilot-en konfigurazioa
+Name[fa]=پیکربندی KPilot
 Name[fi]=KPilot-asetukset
 Name[fr]=Configuration de KPilot
 Name[ga]=Cumraíocht KPilot
@@ -66,6 +67,7 @@
 Comment[es]=Configuración principal de KPilot
 Comment[et]=KPiloti põhiseadistused
 Comment[eu]=KPilot-en konfigurazio nagusia
+Comment[fa]=پیکربندی اصلی KPilot
 Comment[fi]=KPilotin pääasetukset
 Comment[fr]=Configuration principale de KPilot
 Comment[ga]=Príomhchumraíocht KPilot
@@ -106,6 +108,7 @@
 Keywords[es]=kpilot,principal
 Keywords[et]=kpilot,peamine
 Keywords[eu]=kpilot,nagusia
+Keywords[fa]=kpilot،اصلی
 Keywords[fi]=kpilot
 Keywords[fr]=kpilot,principal
 Keywords[ga]=kpilot,príomh
Index: kpilot/kpilot/kpilot.desktop
===================================================================
--- kpilot/kpilot/kpilot.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kpilot/kpilot/kpilot.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -29,6 +29,7 @@
 GenericName[es]=Herramienta para Palm Pilot
 GenericName[et]=PalmPiloti rakendus
 GenericName[eu]=PalmPilot tresna
+GenericName[fa]=ابزار PalmPilot
 GenericName[fi]=Palm Pilot -työkalu
 GenericName[fr]=Outil pour le Palm Pilot
 GenericName[ga]=Uirlis PalmPilot
Index: kpilot/kpilot/kpilotconduit.desktop
===================================================================
--- kpilot/kpilot/kpilotconduit.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kpilot/kpilot/kpilotconduit.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -18,6 +18,7 @@
 Comment[es]=Conducto KPilot
 Comment[et]=KPiloti kanal
 Comment[eu]=KPilot kanala
+Comment[fa]=لولۀ KPilot
 Comment[fi]=KPilot-yhdyskäytävä
 Comment[fr]=Canal de KPilot
 Comment[ga]=Seoladán KPilot
Index: knotes/local.desktop
===================================================================
--- knotes/local.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ knotes/local.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Name[es]=Avisos sobre el archivo local
 Name[et]=Märkmed kohalikus failis
 Name[eu]=Oharrak fitxategi lokalean
+Name[fa]=یادداشتها در پروندۀ محلی‌
 Name[fi]=Muistiot paikallisessa tiedostossa
 Name[fr]=Notes dans un fichier local
 Name[ga]=Nótaí i gComhad Logánta
Index: knotes/knotes_manager.desktop
===================================================================
--- knotes/knotes_manager.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ knotes/knotes_manager.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Name[es]=Notas
 Name[et]=Märkmed
 Name[eu]=Oharrak
+Name[fa]=یادداشتها
 Name[fi]=Muistio
 Name[ga]=Nótaí
 Name[gl]=Notas
Index: knotes/knotes.desktop
===================================================================
--- knotes/knotes.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ knotes/knotes.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -21,6 +21,7 @@
 GenericName[es]=Notas emergentes
 GenericName[et]=Hüpikmärkmed
 GenericName[eu]=Laster-lehio oharrak
+GenericName[fa]=یادداشتهای بالاپر
 GenericName[fi]=Muistilaput
 GenericName[fr]=Éditeur de petites notes
 GenericName[gl]=Notas Emerxentes
@@ -80,6 +81,7 @@
 Name[sv]=Knotes
 Name[ta]=கேகுறிப்புகள்
 Name[th]=บันทึกช่วยจำ
+Name[zh_TW]=KNotes 便利貼
 
 X-KDE-StartupNotify=true
 X-DCOP-ServiceType=Unique
Index: kontact/plugins/test/kptestplugin.desktop
===================================================================
--- kontact/plugins/test/kptestplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/test/kptestplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -23,6 +23,7 @@
 Comment[es]=Plugin de prueba para Kontact
 Comment[et]=Kontacti testplugin
 Comment[eu]=Kontact-en proba plugin-a
+Comment[fa]=وصلۀ آزمون Kontact
 Comment[fi]=Kontactin testiliitännäinen
 Comment[fr]=Module de test pour Kontact
 Comment[gl]=Extensión de Proba para Kontact
@@ -63,6 +64,7 @@
 Name[de]=TestModul
 Name[el]=Πρόσθετο ελέγχου
 Name[eo]=Testo-kromaĵo
+Name[fa]=وصلۀ آزمون
 Name[fr]=Module de test
 Name[he]=תוסף ניסיון
 Name[hi]=टेस्ट-प्लगइन
Index: kontact/plugins/akregator/akregatorplugin.desktop
===================================================================
--- kontact/plugins/akregator/akregatorplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/akregator/akregatorplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -24,6 +24,7 @@
 Comment[es]=Extensión de Akregator
 Comment[et]=Akregatori plugin
 Comment[eu]=Akregator plugin-a
+Comment[fa]=وصلۀ Akregator
 Comment[fi]=Akregator-liitännäinen
 Comment[fr]=Module pour Akregator
 Comment[ga]=Breiseán Akregator
@@ -64,6 +65,7 @@
 Name[es]=Orígenes
 Name[et]=Kanalid
 Name[eu]=Iturriak
+Name[fa]=خوراندن
 Name[fi]=Syötteet
 Name[fr]=Flux
 Name[ga]=Fothaí
Index: kontact/plugins/akregator/akregatorplugin3.2.desktop
===================================================================
--- kontact/plugins/akregator/akregatorplugin3.2.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/akregator/akregatorplugin3.2.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -23,6 +23,7 @@
 Comment[es]=Extensión de Akregator
 Comment[et]=Akregatori plugin
 Comment[eu]=Akregator plugin-a
+Comment[fa]=وصلۀ Akregator
 Comment[fi]=Akregator-liitännäinen
 Comment[fr]=Module pour Akregator
 Comment[ga]=Breiseán Akregator
@@ -63,6 +64,7 @@
 Name[es]=Orígenes
 Name[et]=Kanalid
 Name[eu]=Iturriak
+Name[fa]=خوراندن
 Name[fi]=Syötteet
 Name[fr]=Flux
 Name[ga]=Fothaí
Index: kontact/plugins/kitchensync/kitchensync.desktop
===================================================================
--- kontact/plugins/kitchensync/kitchensync.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/kitchensync/kitchensync.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -26,6 +26,7 @@
 Comment[es]=Accesorio de KitchenSync
 Comment[et]=KitchenSynci plugin
 Comment[eu]=KitchenSync plugin-a
+Comment[fa]=وصلۀ KitchenSync
 Comment[fi]=KitchenSync-liitännäinen
 Comment[fr]=Module KitchenSync
 Comment[ga]=Breiseán KitchenSync
@@ -72,6 +73,7 @@
 Name[es]=Sincronización
 Name[et]=Sünkroniseerimine
 Name[eu]=Sinkronizazioa
+Name[fa]=همگام‌سازی
 Name[fi]=Synkronointi
 Name[fr]=Synchronisation
 Name[ga]=Sioncrónú
Index: kontact/plugins/karm/karmplugin.desktop
===================================================================
--- kontact/plugins/karm/karmplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/karm/karmplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -24,6 +24,7 @@
 Comment[es]=Extensión KArm
 Comment[et]=KArmi plugin
 Comment[eu]=KArm plugina
+Comment[fa]=وصلۀ KArm
 Comment[fi]=KArm-liitännäinen
 Comment[fr]=Module pour KArm
 Comment[ga]=Breiseán KArm
@@ -62,3 +63,4 @@
 Name[sv]=Karm
 Name[ta]=Kஅம்
 Name[xh]=KAlrm
+Name[zh_TW]=KArm 個人時程紀錄
Index: kontact/plugins/summary/kcmkontactsummary.desktop
===================================================================
--- kontact/plugins/summary/kcmkontactsummary.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/summary/kcmkontactsummary.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -21,6 +21,7 @@
 Name[el]=Στοιχεία
 Name[et]=Komponendid
 Name[eu]=Osagaiak
+Name[fa]=محتواها
 Name[fi]=Komponentit
 Name[fr]=Composants
 Name[ga]=Comhpháirteanna
@@ -62,6 +63,7 @@
 Comment[es]=Configuración general de la vista del resumen de Kontact
 Comment[et]=Kontacti kokkuvõttevaate üldised seadistused
 Comment[eu]=Kontact-en laburpen ikuspegiaren konfigurazio orokorra
+Comment[fa]=پیکربندی عمومی نمای خلاصۀ Kontact
 Comment[fi]=Kontactin yhteenvetonäkymän yleiset asetukset
 Comment[fr]=Configuration générale de la vue résumée de Kontact
 Comment[gl]=Configuración xeral para a vista de resumo de Kontact
Index: kontact/plugins/summary/summaryplugin.desktop
===================================================================
--- kontact/plugins/summary/summaryplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/summary/summaryplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -24,6 +24,7 @@
 Comment[es]=Accesorio Vista resumen para Kontact
 Comment[et]=Kontakti kokkuvõttevaate plugin
 Comment[eu]=Kontact-en SummaryView plugin-a
+Comment[fa]=وصلۀ نمای خلاصۀ Kontact
 Comment[fi]=Kontactin yhteenvetonäkymän liitännäinen
 Comment[fr]=Module de vue résumée pour Kontact
 Comment[gl]=Extensión de VistaResumo para Kontact
@@ -67,6 +68,7 @@
 Name[es]=Resumen
 Name[et]=Kokkuvõte
 Name[eu]=Laburpena
+Name[fa]=خلاصه
 Name[fi]=Yhteenveto
 Name[fr]=Résumé
 Name[ga]=Achoimre
Index: kontact/plugins/kmail/kmailplugin.desktop
===================================================================
--- kontact/plugins/kmail/kmailplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/kmail/kmailplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -31,6 +31,7 @@
 Comment[es]=Plugin de KMail para Kontact
 Comment[et]=Kontacti KMaili plugin
 Comment[eu]=Kontact-en KMail plugin-a
+Comment[fa]=وصلۀ Kontact KMail
 Comment[fi]=Kontactin KMail-liitännäinen
 Comment[fr]=Module KMail pour Kontact
 Comment[ga]=Breiseán KMail le haghaidh Kontact
@@ -76,6 +77,7 @@
 Name[es]=Correo
 Name[et]=E-post
 Name[eu]=Posta
+Name[fa]=نامه
 Name[fi]=Sähköposti
 Name[fr]=Messages
 Name[ga]=Ríomhphost
Index: kontact/plugins/kmail/kcmkmailsummary.desktop
===================================================================
--- kontact/plugins/kmail/kcmkmailsummary.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/kmail/kcmkmailsummary.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -22,6 +22,7 @@
 Name[es]=Correo
 Name[et]=E-post
 Name[eu]=Posta
+Name[fa]=نامه
 Name[fi]=Sähköposti
 Name[fr]=Messages
 Name[ga]=Ríomhphost
@@ -70,6 +71,7 @@
 Comment[es]=Configuración del resumen de correo
 Comment[et]=E-posti kokkuvõtte seadistus
 Comment[eu]=Postaren laburpenaren konfigurazioa
+Comment[fa]=برپایی خلاصۀ نامه
 Comment[fi]=Sähköpostiyhteenvedon asetukset
 Comment[fr]=Configuration du résumé du courrier
 Comment[gl]=Configuración do Resumo de Correo-e
@@ -112,6 +114,7 @@
 Keywords[es]=correo, resumen, configurar, opciones
 Keywords[et]=e-post, meil, seadistamine, seadistused
 Keywords[eu]=eposta, laburpena, konfiguratu, ezarpenak
+Keywords[fa]=email، خلاصه، پیکربندی، تنظیمات
 Keywords[fi]=sähköposti, yhteenveto, asetukset
 Keywords[fr]=message,messagerie,courrier,résumé,vue,configurer,paramètres,paramètre
 Keywords[ga]=ríomhphost, achoimre, cumraigh, socruithe
Index: kontact/plugins/weather/weatherplugin.desktop
===================================================================
--- kontact/plugins/weather/weatherplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/weather/weatherplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -29,6 +29,7 @@
 Comment[es]=Extensión de meteorología para Kontact
 Comment[et]=Kontacti ilmaplugin
 Comment[eu]=Kontact-en eguraldi plugin-a
+Comment[fa]=وصلۀ آب و هوای Kontact 
 Comment[fi]=Kontactin sääliitännäinen
 Comment[fr]=Module météo pour Kontact
 Comment[gl]=Extensión de clima para Kontact
@@ -73,6 +74,7 @@
 Name[es]=Servicio meteorológico
 Name[et]=Ilmateade
 Name[eu]=Eguraldiaren zerbitzua
+Name[fa]=خدمت آب و هوا
 Name[fi]=Sääpalvelu
 Name[fr]=KWeatherService
 Name[ga]=Seirbhís Aimsire
Index: kontact/plugins/multisynk/multisynk.desktop
===================================================================
--- kontact/plugins/multisynk/multisynk.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/multisynk/multisynk.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -23,6 +23,7 @@
 Comment[es]=Extensión MultiSynk
 Comment[et]=MultiSynki plugin
 Comment[eu]=MultiSynk plugin-a
+Comment[fa]=وصلۀ MultiSynk
 Comment[fi]=MultiSynk-liitännäinen
 Comment[fr]=Module MultiSynk
 Comment[ga]=Breiseán MultiSynk
@@ -66,6 +67,7 @@
 Name[es]=Sincronización
 Name[et]=Sünkroniseerimine
 Name[eu]=Sinkronizazioa
+Name[fa]=همگام‌سازی
 Name[fi]=Synkronointi
 Name[fr]=Synchronisation
 Name[ga]=Sioncrónú
Index: kontact/plugins/knode/knodeplugin.desktop
===================================================================
--- kontact/plugins/knode/knodeplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/knode/knodeplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -28,6 +28,7 @@
 Comment[es]=Accesorio KNode para Kontact
 Comment[et]=Kontacti KNode plugin
 Comment[eu]=Kontact-en KNode plugin-a
+Comment[fa]=وصلۀ Kontact KNode
 Comment[fi]=Kontactin KNode-liitännäinen
 Comment[fr]=Module KNode pour Kontact
 Comment[ga]=Breiseán KNode le haghaidh Kontact
@@ -75,6 +76,7 @@
 Name[es]=Noticias
 Name[et]=Uudised
 Name[eu]=Berriak
+Name[fa]=اخبار
 Name[fi]=Uutiset
 Name[fr]=Nouvelles
 Name[ga]=Nuacht
Index: kontact/plugins/specialdates/kcmsdsummary.desktop
===================================================================
--- kontact/plugins/specialdates/kcmsdsummary.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/specialdates/kcmsdsummary.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -21,6 +21,7 @@
 Name[es]=Fechas especiales
 Name[et]=Tähtpäevad
 Name[eu]=Data bereziak
+Name[fa]=تاریخهای ویژه
 Name[fi]=Erikoispäivät
 Name[fr]=Dates particulières
 Name[ga]=Dátaí Speisialta
@@ -61,6 +62,7 @@
 Comment[es]=Configuración del resumen de las fechas especiales
 Comment[et]=Tähtpäevade kokkuvõtte seadistus
 Comment[eu]=Data berezien laburpenen konfigurazioa
+Comment[fa]=برپایی خلاصۀ تاریخهای ویژه
 Comment[fi]=Erikoispäivien yhteenvedon asetukset
 Comment[fr]=Configuration du résumé des dates particulières
 Comment[he]=תצורת תאריכים מיוחדים
@@ -99,6 +101,7 @@
 Keywords[es]=cumpleaños, aniversario, vacaciones, configurar, preferencias
 Keywords[et]=sünnipäev, tähtpäev, pidupäev, seadistamine, seadistused
 Keywords[eu]=urtebetezea, urteurrena, jaia, konfiguratu, ezarpenak
+Keywords[fa]=تولد، جشن سالانه، تعطیلات، پیکربندی، تنظیمات
 Keywords[fi]=syntymäpäivä, juhlapäivä, loma, aseta, asetukset
 Keywords[fr]=anniversaire,date de naissance,vacances,configurer,paramètres,préférences
 Keywords[he]=birthday, anniversary, holiday, configure, settings, יום הולדת, הולדת, שנה, יום שנה, חג, חגים, תצורה, הגדרות
Index: kontact/plugins/specialdates/specialdatesplugin.desktop
===================================================================
--- kontact/plugins/specialdates/specialdatesplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/specialdates/specialdatesplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -24,6 +24,7 @@
 Name[es]=Fechas especiales
 Name[et]=Tähtpäevad
 Name[eu]=Data bereziak
+Name[fa]=تاریخهای ویژه
 Name[fi]=Erikoispäivät
 Name[fr]=Dates particulières
 Name[ga]=Dátaí Speisialta
@@ -64,6 +65,7 @@
 Comment[es]=Extensión para fechas especiales
 Comment[et]=Tähtpäevade plugin
 Comment[eu]=Data berezien plugin-a
+Comment[fa]=وصلۀ تاریخهای ویژه
 Comment[fi]=Kalenteriliitännäinen
 Comment[fr]=Module de dates particulières
 Comment[he]=תוסף תאריכים חשובים
Index: kontact/plugins/specialdates/sdsummarywidget.cpp
===================================================================
--- kontact/plugins/specialdates/sdsummarywidget.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/specialdates/sdsummarywidget.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -268,8 +268,9 @@
   // Search for Birthdays, Anniversaries, Holidays, and Special Occasions
   // in the Calendar
   QDate dt;
-  for ( dt=QDate::currentDate();
-        dt<=QDate::currentDate().addDays( mDaysAhead - 1 );
+  QDate currentDate = QDate::currentDate();
+  for ( dt=currentDate;
+        dt<=currentDate.addDays( mDaysAhead - 1 );
         dt=dt.addDays(1) ) {
     KCal::Event::List events = mCalendar->events( dt,
                                                   KCal::EventSortStartDate,
@@ -356,8 +357,8 @@
   // Seach for Holidays
   if ( mShowHolidays ) {
     if ( initHolidays() ) {
-      for ( dt=QDate::currentDate();
-            dt<=QDate::currentDate().addDays( mDaysAhead - 1 );
+      for ( dt=currentDate;
+            dt<=currentDate.addDays( mDaysAhead - 1 );
             dt=dt.addDays(1) ) {
         QValueList<KHoliday> holidays = mHolidays->getHolidays( dt );
         QValueList<KHoliday>::ConstIterator it = holidays.begin();
@@ -436,7 +437,7 @@
       QString datestr;
 
       //Muck with the year -- change to the year 'daysTo' days away
-      int year = QDate::currentDate().addDays( (*addrIt).daysTo ).year();
+      int year = currentDate.addDays( (*addrIt).daysTo ).year();
       QDate sD = QDate::QDate( year,
                            (*addrIt).date.month(), (*addrIt).date.day() );
 
Index: kontact/plugins/kpilot/kpilotplugin.desktop
===================================================================
--- kontact/plugins/kpilot/kpilotplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/kpilot/kpilotplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -29,6 +29,7 @@
 Comment[es]=Accesorio KPilot para Kontact
 Comment[et]=Kontacti KPiloti plugin
 Comment[eu]=Kontact-en KPilot plugin-a
+Comment[fa]=وصلۀ Kontact KPilot
 Comment[fi]=Kontactin KPilot-liitännäinen
 Comment[fr]=Module KPilot pour Kontact
 Comment[ga]=Breiseán KPilot le haghaidh Kontact
@@ -73,6 +74,7 @@
 Name[es]=Configuración de KPilot
 Name[et]=KPiloti seadistamine
 Name[eu]=KPilot-en konfigurazioa
+Name[fa]=پیکربندی KPilot
 Name[fi]=KPilot-asetukset
 Name[fr]=Configuration de KPilot
 Name[ga]=Cumraíocht KPilot
Index: kontact/plugins/knotes/knotesplugin.desktop
===================================================================
--- kontact/plugins/knotes/knotesplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/knotes/knotesplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -28,6 +28,7 @@
 Comment[es]=Plugin de KNotes para Kontact
 Comment[et]=Kontacti KNotesi plugin
 Comment[eu]=Kontact-en KNotes plugin-a
+Comment[fa]=وصلۀ Kontact KNotes
 Comment[fi]=Kontactin KNotes-liitännäinen
 Comment[fr]=Module KNotes pour Kontact
 Comment[ga]=Breiseán KNotes le haghaidh Kontact
@@ -73,6 +74,7 @@
 Name[es]=Notas
 Name[et]=Märkmed
 Name[eu]=Oharrak
+Name[fa]=یادداشتها
 Name[fi]=Muistio
 Name[ga]=Nótaí
 Name[gl]=Notas
Index: kontact/plugins/korganizer/summarywidget.cpp
===================================================================
--- kontact/plugins/korganizer/summarywidget.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/korganizer/summarywidget.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -81,7 +81,7 @@
   mLabels.clear();
   mLabels.setAutoDelete( false );
 
-  KIconLoader loader( "korganizer" );
+  KIconLoader loader( "kdepim" );
 
   KConfig config( "kcmkorgsummaryrc" );
 
@@ -93,11 +93,26 @@
   QPixmap pm = loader.loadIcon( "appointment", KIcon::Small );
 
   QDate dt;
-  for ( dt=QDate::currentDate();
-        dt<=QDate::currentDate().addDays( days - 1 );
+  QDate currentDate = QDate::currentDate();
+  for ( dt=currentDate;
+        dt<=currentDate.addDays( days - 1 );
         dt=dt.addDays(1) ) {
     KCal::Event::List events = mCalendar->events( dt );
 
+    KCal::Event *ev;
+    KCal::Event::List::ConstIterator it;
+    QDateTime qdt;
+
+    // Find recurring events, replacing the QDate with the currentDate
+    for ( it=events.begin(); it!=events.end(); ++it ) {
+      ev = *it;
+      if ( ev->recursOn( dt ) ) {
+        qdt = ev->dtStart();
+        qdt.setDate( dt );
+        ev->setDtStart( qdt );
+      }
+    }
+
     // sort the events for this date by summary
     events = KCal::Calendar::sortEvents( &events,
                                          KCal::EventSortSummary,
@@ -107,8 +122,6 @@
                                          KCal::EventSortStartDate,
                                          KCal::SortDirectionAscending );
 
-    KCal::Event *ev;
-    KCal::Event::List::ConstIterator it;
     for ( it=events.begin(); it!=events.end(); ++it ) {
       ev = *it;
 
@@ -116,8 +129,8 @@
       int span=1; int dayof=1;
       if ( ev->isMultiDay() ) {
         QDate d = ev->dtStart().date();
-        if ( d < QDate::currentDate() ) {
-          d = QDate::currentDate();
+        if ( d < currentDate ) {
+          d = currentDate;
         }
         while ( d < ev->dtEnd().date() ) {
           if ( d < dt ) {
@@ -146,12 +159,12 @@
 
       // Modify event date for printing
       QDate sD = QDate::QDate( dt.year(), dt.month(), dt.day() );
-      if ( ( sD.month() == QDate::currentDate().month() ) &&
-           ( sD.day()   == QDate::currentDate().day() ) ) {
+      if ( ( sD.month() == currentDate.month() ) &&
+           ( sD.day()   == currentDate.day() ) ) {
         datestr = i18n( "Today" );
         makeBold = true;
-      } else if ( ( sD.month() == QDate::currentDate().addDays( 1 ).month() ) &&
-                  ( sD.day()   == QDate::currentDate().addDays( 1 ).day() ) ) {
+      } else if ( ( sD.month() == currentDate.addDays( 1 ).month() ) &&
+                  ( sD.day()   == currentDate.addDays( 1 ).day() ) ) {
         datestr = i18n( "Tomorrow" );
       } else {
         datestr = KGlobal::locale()->formatDate( sD );
@@ -160,8 +173,9 @@
       // Print the date span for multiday, floating events, for the
       // first day of the event only.
       if ( ev->isMultiDay() && ev->doesFloat() && dayof == 1 && span > 1 ) {
-        QString endstr = KGlobal::locale()->formatDate( sD.addDays( span-1 ) );
-        datestr += " -\n " + endstr;
+        datestr = KGlobal::locale()->formatDate( ev->dtStart().date() );
+        datestr += " -\n " +
+                   KGlobal::locale()->formatDate( sD.addDays( span-1 ) );
       }
 
       label = new QLabel( datestr, this );
Index: kontact/plugins/korganizer/kcmkorgsummary.desktop
===================================================================
--- kontact/plugins/korganizer/kcmkorgsummary.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/korganizer/kcmkorgsummary.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -20,6 +20,7 @@
 Name[es]=Citas y tareas pendientes
 Name[et]=Kohtumised ja ülesanded
 Name[eu]=Hitzorduak eta egitekoak
+Name[fa]=قرارهای ملاقات و کارهایی که باید انجام شوند
 Name[fi]=Tapaamiset ja tehtävät
 Name[fr]=Évènements et tâches
 Name[he]=פגישות ומטלות
@@ -55,6 +56,7 @@
 Comment[es]=Configuración del resumen de citas y de tareas pendientes
 Comment[et]=Kohtumiste ja ülesannete kokkuvõtte seadistus
 Comment[eu]=Hitzordu eta egitekoen laburpenen konfigurazioa
+Comment[fa]=برپایی خلاصۀ قرارهای ملاقات و کارهایی که باید انجام شوند.
 Comment[fi]=Tapaamiset ja tehtävät -yhteenvedon asetukset
 Comment[fr]=Configuration du résumé des évènements et des tâches
 Comment[hu]=A találkozók és feladatok áttekintőjének beállítása
@@ -91,6 +93,7 @@
 Keywords[es]=calendario, tareas pendientes, configurar, opciones
 Keywords[et]=kalender, ülesanded, seadistamine, seadistused
 Keywords[eu]=egutegia, egitekoak, konfiguratu, ezarpenak
+Keywords[fa]=تقویم، کارهای انجامی، پیکربندی، تنظیمات
 Keywords[fi]=kalenteri, tehtävät, muokkaa, asetukset
 Keywords[fr]=calendrier,agenda,tâches,configurer,paramètres,paramètre
 Keywords[ga]=féilire, tascanna, cumraigh, socruithe
Index: kontact/plugins/korganizer/todoplugin.desktop
===================================================================
--- kontact/plugins/korganizer/todoplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/korganizer/todoplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -26,6 +26,7 @@
 Comment[es]=Extensión de tareas pendientes de KOrganizer para Kontact
 Comment[et]=Kontacti KOrganizeri ülesannete nimekirja plugin
 Comment[eu]=Kontact-en KOrganizer-en egitekoen plugin-a
+Comment[fa]=وصلۀ فهرست کارهای انجامی Kontact KOrganizer
 Comment[fi]=Kontact KOrganizer -tehtävät-liitännäinen
 Comment[fr]=Module de liste des tâches de KOrganizer pour Kontact
 Comment[ga]=Breiseán Tascliosta KOrganizer le haghaidh Kontact
@@ -65,6 +66,7 @@
 Name[es]=Tareas pendientes
 Name[et]=Ülesanded
 Name[eu]=Egitekoen zerrenda
+Name[fa]=فهرست کارهایی که باید انجام شود
 Name[fi]=Tehtäväluettelo
 Name[fr]=Liste de tâches
 Name[ga]=Tascliosta
Index: kontact/plugins/korganizer/journalplugin.desktop
===================================================================
--- kontact/plugins/korganizer/journalplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/korganizer/journalplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -26,6 +26,7 @@
 Comment[es]=Extensión de Kontact para el diario de KOrganizer
 Comment[et]=Kontacti KOrganizeri päevikuplugin
 Comment[eu]=Kontact-en KOrganizer egunkari plugin-a
+Comment[fa]=وصلۀ نشریۀ Kontact KOrganizer
 Comment[fi]=Päiväkirjaliitännäinen
 Comment[fr]=Module de journal KOrganizer pour Kontact
 Comment[hu]=Kontact-bővítőmodul a KOrganizer-naplóhoz
@@ -62,6 +63,7 @@
 Name[es]=Diario
 Name[et]=Päevik
 Name[eu]=Egunkaria
+Name[fa]=نشریه
 Name[fi]=Päiväkirja
 Name[ga]=Iris
 Name[he]=יומן
Index: kontact/plugins/korganizer/korganizerplugin.desktop
===================================================================
--- kontact/plugins/korganizer/korganizerplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/korganizer/korganizerplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -30,6 +30,7 @@
 Comment[es]=Plugin de KOrganizer para Kontact
 Comment[et]=Kontacti KOrganizeri plugin
 Comment[eu]=Kontact-en KOrganizer plugin-a
+Comment[fa]=وصلۀ Kontact KOrganizer
 Comment[fi]=Kontactin KOrganizer-liitännäinen
 Comment[fr]=Module KOrganizer pour Kontact
 Comment[ga]=Breiseán KOrganizer le haghaidh Kontact
@@ -77,6 +78,7 @@
 Name[es]=Calendario
 Name[et]=Kalender
 Name[eu]=Egutegia
+Name[fa]=تقویم
 Name[fi]=Kalenteri
 Name[fr]=Calendrier
 Name[ga]=Féilire
Index: kontact/plugins/korganizer/todoplugin.cpp
===================================================================
--- kontact/plugins/korganizer/todoplugin.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/korganizer/todoplugin.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -52,7 +52,7 @@
     mIface( 0 )
 {
   setInstance( TodoPluginFactory::instance() );
-  instance()->iconLoader()->addAppDir("korganizer");
+  instance()->iconLoader()->addAppDir("kdepim");
 
   insertNewAction( new KAction( i18n( "New To-do..." ), "newtodo",
                    CTRL+SHIFT+Key_T, this, SLOT( slotNewTodo() ), actionCollection(),
Index: kontact/plugins/korganizer/todosummarywidget.cpp
===================================================================
--- kontact/plugins/korganizer/todosummarywidget.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/korganizer/todosummarywidget.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -85,11 +85,12 @@
   config.setGroup( "Todo" );
   bool showAllTodos = config.readBoolEntry( "ShowAllTodos", false );
 
-  KIconLoader loader( "korganizer" );
+  KIconLoader loader( "kdepim" );
 
   QLabel *label = 0;
   int counter = 0;
 
+  QDate currentDate = QDate::currentDate();
   KCal::Todo::List todos = mCalendar->todos();
   if ( todos.count() > 0 ) {
     QPixmap pm = loader.loadIcon( "todo", KIcon::Small );
@@ -106,26 +107,27 @@
 
       // show uncomplete todos from the last days
       if ( todo->hasDueDate() && !todo->isCompleted() &&
-           todo->dtDue().date() < QDate::currentDate() ) {
+           todo->dtDue().date() < currentDate ) {
         accepted = true;
         stateText = i18n( "overdue" );
       }
 
       // show todos which started somewhere in the past and has to be finished in future
-      if ( todo->hasStartDate() && todo->hasDueDate() && todo->dtStart().date()
-           < QDate::currentDate() && QDate::currentDate() < todo->dtDue().date() ) {
+      if ( todo->hasStartDate() && todo->hasDueDate() &&
+           todo->dtStart().date() < currentDate &&
+           currentDate < todo->dtDue().date() ) {
         accepted = true;
         stateText = i18n( "in progress" );
       }
 
       // all todos which start today
-      if ( todo->hasStartDate() && todo->dtStart().date() == QDate::currentDate() ) {
+      if ( todo->hasStartDate() && todo->dtStart().date() == currentDate ) {
         accepted = true;
         stateText = i18n( "starts today" );
       }
 
       // all todos which end today
-      if ( todo->hasDueDate() && todo->dtDue().date() == QDate::currentDate() ) {
+      if ( todo->hasDueDate() && todo->dtDue().date() == currentDate ) {
         accepted = true;
         stateText = i18n( "ends today" );
       }
Index: kontact/plugins/korganizer/Makefile.am
===================================================================
--- kontact/plugins/korganizer/Makefile.am	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/korganizer/Makefile.am	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -54,4 +54,3 @@
 
 kde_services_DATA = kcmkorgsummary.desktop
 
-KDE_ICON = AUTO
Index: kontact/plugins/korganizer/journalplugin.cpp
===================================================================
--- kontact/plugins/korganizer/journalplugin.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/korganizer/journalplugin.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -46,7 +46,7 @@
     mIface( 0 )
 {
   setInstance( JournalPluginFactory::instance() );
-  instance()->iconLoader()->addAppDir("korganizer");
+  instance()->iconLoader()->addAppDir("kdepim");
 
   insertNewAction( new KAction( i18n( "New Journal..." ), "newjournal",
                    CTRL+SHIFT+Key_J, this, SLOT( slotNewJournal() ), actionCollection(),
Index: kontact/plugins/korganizer/korganizerplugin.cpp
===================================================================
--- kontact/plugins/korganizer/korganizerplugin.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/korganizer/korganizerplugin.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -54,9 +54,9 @@
 {
 
   setInstance( KOrganizerPluginFactory::instance() );
-  instance()->iconLoader()->addAppDir("korganizer");
+  instance()->iconLoader()->addAppDir("kdepim");
 
-  insertNewAction( new KAction( i18n( "New Event..." ), "appointment",
+  insertNewAction( new KAction( i18n( "New Event..." ), "newappointment",
                    CTRL+SHIFT+Key_E, this, SLOT( slotNewEvent() ), actionCollection(),
                    "new_event" ) );
 
Index: kontact/plugins/kaddressbook/kaddressbookplugin.desktop
===================================================================
--- kontact/plugins/kaddressbook/kaddressbookplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/kaddressbook/kaddressbookplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -30,6 +30,7 @@
 Comment[es]=Plugin de KAddressbook para Kontact
 Comment[et]=Kontacti KDE aadressiraamatu plugin
 Comment[eu]=Kontact-en KAddressBook plugin-a
+Comment[fa]=وصلۀ کتاب نشانی Kontact
 Comment[fi]=Kontactin KAddressBook-liitännäinen
 Comment[fr]=Module KAddressBook pour Kontact
 Comment[ga]=Breiseán KAddressBook Kontact
@@ -76,6 +77,7 @@
 Name[es]=Contactos
 Name[et]=Kontaktid
 Name[eu]=Kontaktuak
+Name[fa]=تماسها
 Name[fi]=Yhteystiedot
 Name[ga]=Teagmhálacha
 Name[gl]=Contactos
Index: kontact/plugins/newsticker/kcmkontactknt.desktop
===================================================================
--- kontact/plugins/newsticker/kcmkontactknt.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/newsticker/kcmkontactknt.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -24,6 +24,7 @@
 Name[es]=Teletipo de noticias
 Name[et]=Uudistejälgija
 Name[eu]=Berri markatzailea
+Name[fa]=Ticker اخبار
 Name[fi]=Uutisnäytin
 Name[fr]=Téléscripteur de nouvelles
 Name[gl]=Colector de Novas
@@ -73,6 +74,7 @@
 Comment[es]=Configuración del resumen del teletipo de noticias
 Comment[et]=Uudistejälgija kokkuvõtte seadistus
 Comment[eu]=Berri markatzailearen laburpenaren konfigurazioa
+Comment[fa]=برپایی خلاصۀTicker اخبار
 Comment[fi]=Uutisnäyttimen yhteenvedon asetukset
 Comment[fr]=Configuration du résumé du téléscripteur de nouvelles
 Comment[he]=הגדרות תקציר חדשות רצות
@@ -109,6 +111,7 @@
 Keywords[es]=teletipo de noticias, configurar, opciones
 Keywords[et]=uudistejälgija, seadistamine, seadistused
 Keywords[eu]=berri markatzaileak, konfiguratu, ezarpenak
+Keywords[fa]=ticker اخبار، پیکربندی، تنظیمات
 Keywords[fi]=uutiset, asetukset, muokkaa
 Keywords[fr]=configurer,paramètre,news ticker, téléscripteur
 Keywords[gl]=capturador de novas, configurar, opcións
Index: kontact/plugins/newsticker/newstickerplugin.desktop
===================================================================
--- kontact/plugins/newsticker/newstickerplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/newsticker/newstickerplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -26,6 +26,7 @@
 Comment[es]=Extensión de teletipo de noticias para Kontact
 Comment[et]=Kontacti uudistejälgija plugin
 Comment[eu]=Kontact-en NewsTicker plugin-a
+Comment[fa]=وصلۀ Kontact NewsTicker
 Comment[fi]=Kontactin uutisnäytin
 Comment[fr]=Module NewsTicker pour Kontact
 Comment[ga]=Breiseán NewsTicker le haghaidh Kontact
@@ -64,6 +65,7 @@
 Name[el]=Προβολέας ειδήσεων
 Name[es]=Teletipo de noticias
 Name[et]=Uudistejälgija
+Name[fa]=Ticker اخبار
 Name[fi]=Uutisnäytin
 Name[fr]=Téléscripteur de nouvelles
 Name[he]=חדשות רצות
Index: kontact/plugins/newsticker/kcmkontactknt.cpp
===================================================================
--- kontact/plugins/newsticker/kcmkontactknt.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/plugins/newsticker/kcmkontactknt.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -79,7 +79,7 @@
 
   mTitle->setText( title );
   mURL->setText( url );
-
+  mTitle->setFocus();
   connect( mTitle, SIGNAL( textChanged( const QString& ) ),
            this, SLOT( modified() ) );
   connect( mURL, SIGNAL( textChanged( const QString& ) ),
Index: kontact/interfaces/kontactplugin.desktop
===================================================================
--- kontact/interfaces/kontactplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/interfaces/kontactplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -15,6 +15,7 @@
 Name[es]=Plugin Kontact
 Name[et]=Kontacti plugin
 Name[eu]=Kontact plugin-a
+Name[fa]=وصلۀ 
 Name[fi]=Kontact-liitännäinen
 Name[fr]=Module Kontact
 Name[ga]=Breiseán Kontact
Index: kontact/src/kontact.setdlg
===================================================================
--- kontact/src/kontact.setdlg	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/src/kontact.setdlg	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Name[es]=Resumen
 Name[et]=Kokkuvõte
 Name[eu]=Laburpena
+Name[fa]=خلاصه
 Name[fi]=Yhteenveto
 Name[fr]=Résumé
 Name[ga]=Achoimre
@@ -56,6 +57,7 @@
 Comment[es]=Vista del resumen
 Comment[et]=Kokkuvõttevaade
 Comment[eu]=Laburpen ikuspegia
+Comment[fa]=نمای خلاصه
 Comment[fi]=Yhteenvetonäyttö
 Comment[fr]=Vue résumée
 Comment[he]=תצוגת תקציר
@@ -99,6 +101,7 @@
 Name[es]=Correo
 Name[et]=E-post
 Name[eu]=Posta
+Name[fa]=نامه
 Name[fi]=Sähköposti
 Name[fr]=Messages
 Name[ga]=Ríomhphost
@@ -148,6 +151,7 @@
 Comment[es]=Componente de correo
 Comment[et]=E-posti komponent
 Comment[eu]=Posta osagaia
+Comment[fa]=محتوای نامه
 Comment[fi]=Sähköpostiohjelma
 Comment[fr]=Composant messagerie
 Comment[he]=רכיב דואר
@@ -193,6 +197,7 @@
 Name[es]=Contactos
 Name[et]=Kontaktid
 Name[eu]=Kontaktuak
+Name[fa]=تماسها
 Name[fi]=Yhteystiedot
 Name[ga]=Teagmhálacha
 Name[gl]=Contactos
@@ -239,6 +244,7 @@
 Comment[es]=Componente de la libreta de direcciones
 Comment[et]=Aadressiraamatu komponent
 Comment[eu]=Helbide-liburu osagaia
+Comment[fa]=محتوای کتاب نشانی
 Comment[fi]=Osoitekirja
 Comment[fr]=Composant de carnet d'adresses
 Comment[he]=רכיב פנקס כתובות
@@ -280,6 +286,7 @@
 Name[es]=Resumen de fechas especiales
 Name[et]=Tähtpäevade kokkuvõte
 Name[eu]=Data berezien laburpena
+Name[fa]=خلاصۀ تاریخهای ویژه
 Name[fi]=Erikoispäivien yhteenveto
 Name[fr]=Résumé des dates particulières
 Name[he]=תקציר תאריכים מיוחדים
@@ -318,6 +325,7 @@
 Comment[es]=Componente de resumen de fechas especiales
 Comment[et]=Tähtpäevade kokkuvõtte komponent
 Comment[eu]=Data berezien laburpenaren osagaia
+Comment[fa]=محتوای خلاصۀ تاریخهای ویژه
 Comment[fi]=Erikoispäivien yhteenvedon komponentti
 Comment[fr]=Composant de résumé des dates particulières
 Comment[he]=רכיב תאריכים חשובים
@@ -363,6 +371,7 @@
 Name[es]=Calendario
 Name[et]=Kalender
 Name[eu]=Egutegia
+Name[fa]=تقویم
 Name[fi]=Kalenteri
 Name[fr]=Calendrier
 Name[ga]=Féilire
@@ -409,6 +418,7 @@
 Comment[es]=Componente de calendario
 Comment[et]=Kalendrikomponent
 Comment[eu]=Egutegi osagaia
+Comment[fa]=محتوای تقویم
 Comment[fi]=Kalenterikomponentti
 Comment[fr]=Composant d'agenda
 Comment[he]=רכיב לוח שנה
@@ -454,6 +464,7 @@
 Name[es]=Noticias
 Name[et]=Uudised
 Name[eu]=Berriak
+Name[fa]=اخبار
 Name[fi]=Uutiset
 Name[fr]=Nouvelles
 Name[ga]=Nuacht
@@ -500,6 +511,7 @@
 Comment[es]=Componente de noticias
 Comment[et]=Uudistekomponent
 Comment[eu]=Berrien osagaia
+Comment[fa]=محتوای اخبار
 Comment[fi]=Uutiskomponentti
 Comment[fr]=Composant de Nouvelles
 Comment[he]=רכיב חדשות
@@ -545,6 +557,7 @@
 Name[es]=Meteorología
 Name[et]=Ilm
 Name[eu]=Eguraldia
+Name[fa]=آب و هوا
 Name[fi]=Sää
 Name[fr]=Météo
 Name[ga]=Aimsir
@@ -593,6 +606,7 @@
 Comment[es]=Información meteorológica
 Comment[et]=Ilmateade
 Comment[eu]=Eguraldi informazioa
+Comment[fa]=اطلاعات آب و هوا
 Comment[fi]=Säätiedot
 Comment[fr]=Informations météo
 Comment[ga]=Eolas faoin aimsir
@@ -640,6 +654,7 @@
 Name[es]=Teletipo de noticias
 Name[et]=Uudistejälgija
 Name[eu]=Berri markatzailea
+Name[fa]=Ticker اخبار
 Name[fi]=Uutisnäytin
 Name[fr]=Téléscripteur de nouvelles
 Name[gl]=Colector de Novas
@@ -689,6 +704,7 @@
 Comment[es]=Componente de teletipo de noticias
 Comment[et]=Uudistejälgija komponent
 Comment[eu]=Berri markatzaile osagaia
+Comment[fa]=محتوای Ticker اخبار
 Comment[fi]=Uutiskomponentti
 Comment[fr]=Composant d'affichage de nouvelles
 Comment[hu]=Hírmegjelenítő komponens
Index: kontact/src/kontactconfig.desktop
===================================================================
--- kontact/src/kontactconfig.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/src/kontactconfig.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -18,6 +18,7 @@
 Name[hi]=कॉन्टेक्ट
 Name[sv]=Kontakt
 Name[ta]=தொடர்பு கொள்
+Name[zh_TW]=Kontact 個人資訊管理
 Comment=KDE Kontact
 Comment[be]=Кантакт KDE
 Comment[bg]=Управление на личната информация
Index: kontact/src/Kontact.desktop
===================================================================
--- kontact/src/Kontact.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kontact/src/Kontact.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -5,6 +5,7 @@
 Name[hi]=कॉन्टेक्ट
 Name[sv]=Kontakt
 Name[ta]=தொடர்பு கொள்
+Name[zh_TW]=Kontact 個人資訊管理
 Exec=kontact
 Type=Application
 Icon=kontact
@@ -21,6 +22,7 @@
 GenericName[es]=Gestor de información personal
 GenericName[et]=Personaalse info haldur
 GenericName[eu]=Informazio pertsonalaren kudeatzailea
+GenericName[fa]=مدیر اطلاعات شخصی
 GenericName[fi]=Henkilötietojen hallinta
 GenericName[fr]=Gestionnaire d'informations personnelles
 GenericName[gl]=Xestor de Información Persoal
Index: kandy/src/kandy.desktop
===================================================================
--- kandy/src/kandy.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kandy/src/kandy.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -15,6 +15,7 @@
 Comment[es]=Herramienta para sincronizar datos de la libreta de direcciones con teléfonos móviles
 Comment[et]=Vahend aadressiraamatu andmete sünkroniseerimiseks mobiiltelefoniga
 Comment[eu]=Helbide-liburua zure mugikorrarekin sinkronizatzeko tresna
+Comment[fa]=ابزار برای همگام‌سازی دادۀ کتاب نشانی با تلفنهای همراه
 Comment[fi]=Osoitekirjan tietojan ja kännykän liitostyökalu
 Comment[fr]=Outil pour synchroniser les données de carnets d'adresses avec les téléphones mobiles
 Comment[hu]=Segédprogram számítógép és mobiltelefon címjegyzékének szinkronizálásához
@@ -61,6 +62,7 @@
 GenericName[es]=Gestor de teléfonos móviles
 GenericName[et]=Mobiiltelefoni rakendus
 GenericName[eu]=Telefono mugikorrendako Tresna
+GenericName[fa]=ابزار تلفن همراه‌
 GenericName[fi]=Matkapuhelintyökalu
 GenericName[fr]=Outil de connexion à votre téléphone portable
 GenericName[he]=כלי טלפון נייד
Index: ktnef/gui/ktnef.desktop
===================================================================
--- ktnef/gui/ktnef.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ ktnef/gui/ktnef.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -12,6 +12,7 @@
 GenericName[es]=Visor de archivos TNEF
 GenericName[et]=TNEF-failide näitaja
 GenericName[eu]=TNEF fitxategi ikustailea
+GenericName[fa]=مشاهده‌گر پروندۀ TNEF
 GenericName[fi]=TNEF-tiedostonäytin
 GenericName[fr]=Afficheur de fichiers TNEF
 GenericName[ga]=Amharcán Comhad TNEF
@@ -56,6 +57,7 @@
 Comment[es]=A visor/extractor para archivos TNEF
 Comment[et]=TNEF-failide näitaja/ekstraktija
 Comment[eu]=TNEF fitxategien ikustaile/erauzlea
+Comment[fa]=یک مشاهده‌گر/استخراجگر برای پرونده‌های TNEF
 Comment[fi]=Näytin/purkaja TNEF-tiedostoille
 Comment[fr]=Pour afficher / extraire des fichiers TNEF
 Comment[hi]=टीएनईएफ फ़ाइलों के लिए एक प्रदर्शक/एक्सट्रेक्टर
@@ -63,7 +65,7 @@
 Comment[hu]=Nézegetőprogram TNEF-fájlokhoz
 Comment[is]=Sýnir/lesari fyrir TNEF skrár
 Comment[it]=Un visualizzatore/estrattore di file TNEF
-Comment[ja]=TNEF ファイル用のビューア/extractor
+Comment[ja]=TNEF ファイルのためのビューア/展開ツール
 Comment[km]=កម្មវិធី​មើល និង ស្រង់​ឯកសារ TNEF
 Comment[lt]=TNEF bylų žiūryklė - išpakuotojas
 Comment[ms]=Pemapar/pengekstrak untuk fail TNEF 
Index: ktnef/gui/ms-tnef.desktop
===================================================================
--- ktnef/gui/ms-tnef.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ ktnef/gui/ms-tnef.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -16,6 +16,7 @@
 Comment[es]=Archivo TNEF
 Comment[et]=TNEF-fail
 Comment[eu]=TNEF fitxategia
+Comment[fa]=پروندۀ TNEF
 Comment[fi]=TNEF-tiedosto
 Comment[fr]=Fichier TNEF
 Comment[ga]=Comhad TNEF
Index: kfile-plugins/rfc822/kfile_rfc822.desktop
===================================================================
--- kfile-plugins/rfc822/kfile_rfc822.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kfile-plugins/rfc822/kfile_rfc822.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Info de correo electrónico
 Name[et]=Kirja info
 Name[eu]=E-posta informazioa
+Name[fa]=اطلاعات رایانامه‌
 Name[fi]=Sähköpostitiedot
 Name[fr]=Informations sur le courrier électronique
 Name[he]=מידע על דוא"ל
Index: kfile-plugins/ics/kfile_ics.desktop
===================================================================
--- kfile-plugins/ics/kfile_ics.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kfile-plugins/ics/kfile_ics.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Name[es]=Información ICS
 Name[et]=ICS info
 Name[eu]=ICS informazioa
+Name[fa]=اطلاعات ICS
 Name[fi]=ICS-tiedot
 Name[fr]=Information sur ICS
 Name[he]=מידע של ICS
Index: kfile-plugins/palm-databases/kfile_palm.desktop
===================================================================
--- kfile-plugins/palm-databases/kfile_palm.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kfile-plugins/palm-databases/kfile_palm.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -14,6 +14,7 @@
 Name[es]=Info. de la base de datos de PalmOS
 Name[et]=PalmOS andmebaasi info
 Name[eu]=PalmOS datu-base informazioa
+Name[fa]=اطلاعات دادگان PalmOS
 Name[fi]=PalmOS-tietokannan tiedot
 Name[fr]=Informations sur les bases de données PalmOS
 Name[ga]=Eolas faoin Bhunachar Sonraí PalmOS
Index: kfile-plugins/vcf/kfile_vcf.desktop
===================================================================
--- kfile-plugins/vcf/kfile_vcf.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ kfile-plugins/vcf/kfile_vcf.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -16,6 +16,7 @@
 Name[es]=Info de vCard
 Name[et]=vCardi info
 Name[eu]=vCard informazioa
+Name[fa]=اطلاعات vCard
 Name[fi]=vCard-tiedot
 Name[fr]=Informations vCard
 Name[he]=מידע vCard
Index: korganizer/korganizer-import.desktop
===================================================================
--- korganizer/korganizer-import.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/korganizer-import.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -1,58 +0,0 @@
-[Desktop Entry]
-Encoding=UTF-8
-MimeType=text/calendar;text/x-vcalendar;
-Exec=korganizer --import %u
-Icon=korganizer
-Path=
-DocPath=korganizer/index.html
-Type=Application
-Terminal=false
-Name=Import Calendar
-Name[be]=Імпартаваць каляндар
-Name[bg]=Импорт на календар
-Name[br]=Enporzh an deiziadur
-Name[ca]=Importa calendari
-Name[cs]=Importovat kalendář
-Name[cy]=Mewnforio Calendr
-Name[da]=Importér kalender
-Name[de]=Kalender importieren
-Name[el]=Εισαγωγή ημερολογίου
-Name[es]=Importar calendario
-Name[et]=Kalendri import
-Name[eu]=Inportatu egutegia
-Name[fi]=Tuo kalenteri
-Name[fr]=Importer un calendrier
-Name[ga]=Iompórtáil Féilire
-Name[he]=ייבוא לוח שנה
-Name[hu]=Naptár importálása
-Name[is]=Flytja inn dagatal
-Name[it]=Importa calendario
-Name[ja]=カレンダーをインポート
-Name[km]=នាំចូល​ប្រតិទិន
-Name[lt]=Importuoti kalendorių
-Name[ms]=Impot Kalendar
-Name[nb]=Importer kalender
-Name[nds]=Kalenner importeren
-Name[nl]=Agenda importeren
-Name[nn]=Importer kalender
-Name[pl]=Importuj kalendarz
-Name[pt]=Importar Calendário
-Name[pt_BR]=Importar Calendário
-Name[ru]=Импорт календаря
-Name[sk]=Import kalendára
-Name[sl]=Uvozi koledar
-Name[sr]=Увези календар
-Name[sr@Latn]=Uvezi kalendar
-Name[sv]=Importera kalender
-Name[ta]=இறக்கும் நாட்காட்டி
-Name[tr]=Takvim Aktar
-Name[uk]=Імпорт календаря
-Name[zh_CN]=导入日历
-Name[zh_TW]=匯入行事曆
-ServiceTypes=Browser/View,DCOP/Organizer
-X-KDE-Library=libkorganizerpart
-X-KDE-StartupNotify=true
-X-DCOP-ServiceType=Unique
-X-DCOP-ServiceName=korganizer
-InitialPreference=5
-
Index: korganizer/korganizer_configfonts.desktop
===================================================================
--- korganizer/korganizer_configfonts.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/korganizer_configfonts.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -28,6 +28,7 @@
 Name[es]=Tipografías
 Name[et]=Fondid
 Name[eu]=Letra-tipoak
+Name[fa]=قلمها
 Name[fi]=Kirjasimet
 Name[fr]=Polices
 Name[ga]=Clónna
@@ -84,6 +85,7 @@
 Comment[es]=Configuración de las tipografías de KOrganizer
 Comment[et]=KOrganizeri fontide seadistamine
 Comment[eu]=KOrganizer-en letra-tipoen konfigurazioa
+Comment[fa]=پیکربندی قلمهای KOrganizer
 Comment[fi]=Korganizer kirjasinten asetukset
 Comment[fr]=Configuration des polices de KOrganizer
 Comment[gl]=Configuración de Fontes de KOrganizer
@@ -130,6 +132,7 @@
 Keywords[es]=korganizer,tipografías
 Keywords[et]=korganizer,fondid
 Keywords[eu]=korganizer,letra-tipoak
+Keywords[fa]=korganizer،قلمها
 Keywords[fi]=korganizer,kirjasimet
 Keywords[fr]=KOrganizer,polices
 Keywords[ga]=korganizer,clónna,clófhoirne
Index: korganizer/printing/calprintdefaultplugins.cpp
===================================================================
--- korganizer/printing/calprintdefaultplugins.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/printing/calprintdefaultplugins.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -123,8 +123,6 @@
 
 void CalPrintDay::saveConfig()
 {
-  kdDebug(5850) << "CalPrintDay::saveConfig()" << endl;
-
   readSettingsWidget();
   if ( mConfig ) {
     mConfig->writeEntry( "Start time", QDateTime( QDate(), mStartTime ) );
@@ -487,6 +485,8 @@
 
 CalPrintTodos::CalPrintTodos() : CalPrintPluginBase()
 {
+  mTodoSortField = TodoFieldUnset;
+  mTodoSortDirection = TodoDirectionUnset;
 }
 
 CalPrintTodos::~CalPrintTodos()
@@ -525,6 +525,8 @@
 
 void CalPrintTodos::setSettingsWidget()
 {
+  kdDebug() << "CalPrintTodos::setSettingsWidget" << endl;
+
   CalPrintTodoConfig_Base *cfg =
       dynamic_cast<CalPrintTodoConfig_Base *>( mConfigWidget );
   if ( cfg ) {
@@ -542,16 +544,22 @@
     cfg->mConnectSubTodos->setChecked( mConnectSubTodos );
     cfg->mStrikeOutCompleted->setChecked( mStrikeOutCompleted );
 
-    cfg->mSortField->insertItem( i18n("Summary") );
-    cfg->mSortField->insertItem( i18n("Start Date") );
-    cfg->mSortField->insertItem( i18n("Due Date") );
-    cfg->mSortField->insertItem( i18n("Priority") );
-    cfg->mSortField->insertItem( i18n("Percent Complete") );
-    cfg->mSortField->setCurrentItem( mTodoSortField );
+    if ( mTodoSortField != TodoFieldUnset ) {
+      // do not insert if already done so.
+      cfg->mSortField->insertItem( i18n("Summary") );
+      cfg->mSortField->insertItem( i18n("Start Date") );
+      cfg->mSortField->insertItem( i18n("Due Date") );
+      cfg->mSortField->insertItem( i18n("Priority") );
+      cfg->mSortField->insertItem( i18n("Percent Complete") );
+      cfg->mSortField->setCurrentItem( (int)mTodoSortField );
+    }
 
-    cfg->mSortDirection->insertItem( i18n( "Ascending" ) );
-    cfg->mSortDirection->insertItem( i18n( "Descending" ) );
-    cfg->mSortDirection->setCurrentItem( mTodoSortDirection );
+    if ( mTodoSortDirection != TodoDirectionUnset ) {
+      // do not insert if already done so.
+      cfg->mSortDirection->insertItem( i18n("Ascending") );
+      cfg->mSortDirection->insertItem( i18n("Descending") );
+      cfg->mSortDirection->setCurrentItem( (int)mTodoSortDirection );
+    }
   }
 }
 
@@ -660,6 +668,8 @@
     sortField = TodoSortPriority; break;
   case TodoFieldPercentComplete:
     sortField = TodoSortPercentComplete; break;
+  case TodoFieldUnset:
+    break;
   }
 
   SortDirection sortDirection;
@@ -668,11 +678,12 @@
     sortDirection = SortDirectionAscending; break;
   case TodoDirectionDescending:
     sortDirection = SortDirectionDescending; break;
+  case TodoDirectionUnset:
+    break;
   }
 
   // Create list of to-dos which will be printed
-  // Also sort toplevel by summaries.
-  todoList = mCalendar->todos( TodoSortSummary,  sortDirection );
+  todoList = mCalendar->todos( sortField,  sortDirection );
   switch( mTodoPrintType ) {
   case TodosAll:
     break;
Index: korganizer/printing/calprintdefaultplugins.h
===================================================================
--- korganizer/printing/calprintdefaultplugins.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/printing/calprintdefaultplugins.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -118,7 +118,7 @@
     virtual QWidget *createConfigWidget(QWidget*);
 
   public:
-    void print(QPainter &p, int width, int height);
+    void print( QPainter &p, int width, int height );
     virtual void readSettingsWidget();
     virtual void setSettingsWidget();
     virtual void loadConfig();
@@ -134,11 +134,13 @@
     enum eTodoSortField {
       TodoFieldSummary=0,
       TodoFieldStartDate, TodoFieldDueDate,
-      TodoFieldPriority, TodoFieldPercentComplete
+      TodoFieldPriority, TodoFieldPercentComplete,
+      TodoFieldUnset
     } mTodoSortField;
 
     enum eTodoSortDirection {
-      TodoDirectionAscending=0, TodoDirectionDescending
+      TodoDirectionAscending=0, TodoDirectionDescending,
+      TodoDirectionUnset
     } mTodoSortDirection;
 
     bool mIncludeDescription;
Index: korganizer/koglobals.cpp
===================================================================
--- korganizer/koglobals.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/koglobals.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -71,6 +71,7 @@
   // in case we are a KPart
   mOwnInstance = new KInstance( "korganizer" );
   mOwnInstance->config()->setGroup( "General" );
+  mOwnInstance->iconLoader()->addAppDir( "kdepim" );
 
   mAlarmClient = new AlarmClient;
 }
Index: korganizer/korganizer_configplugins.desktop
===================================================================
--- korganizer/korganizer_configplugins.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/korganizer_configplugins.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -25,6 +25,7 @@
 Name[es]=Extensiones
 Name[et]=Pluginad
 Name[eu]=Plugin-ak
+Name[fa]=وصله‌ها
 Name[fi]=Liitännäiset
 Name[fr]=Modules externes
 Name[ga]=Breiseáin
@@ -66,6 +67,7 @@
 Comment[es]=Configuración de las extensiones de KOrganizer
 Comment[et]=KOrganizeri pluginate seadistused
 Comment[eu]=KOrganizer-en plugin konfigurazioa
+Comment[fa]=پیکربندی وصلۀ KOrganizer
 Comment[fi]=KOrganizerin liitännäisen asetukset
 Comment[fr]=Configuration du module KOrganizer
 Comment[he]=הגדרות תוסף הארגונית
@@ -105,6 +107,7 @@
 Keywords[es]=korganizer,extensión,plugin,módulo
 Keywords[et]=korganizer,plugin,moodul
 Keywords[eu]=korganizer,plugin-a,modulua
+Keywords[fa]=korganizer،وصله،پیمانه
 Keywords[fi]=korganizer,liitännäinen,moduuli
 Keywords[fr]=KOrganizer,module
 Keywords[ga]=korganizer,breiseán,modúl
Index: korganizer/korganizer_configtime.desktop
===================================================================
--- korganizer/korganizer_configtime.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/korganizer_configtime.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -27,6 +27,7 @@
 Name[es]=Fecha y hora
 Name[et]=Aeg
 Name[eu]=Ordua eta data
+Name[fa]=زمان و تاریخ
 Name[fi]=Aika ja päiväys
 Name[fr]=Date et heure
 Name[ga]=Am & Dáta
@@ -76,6 +77,7 @@
 Comment[es]=Configuración de la hora de KOrganizer
 Comment[et]=KOrganizeri ajaseadistused
 Comment[eu]=KOrganizer-en ordu/data konfigurazioa
+Comment[fa]=پیکربندی زمان KOrganizer
 Comment[fi]=KOrganizerin aika-asetukset
 Comment[fr]=Configuration de l'heure de KOrganizer
 Comment[gl]=Configuración de Hora de KOrganizer
@@ -122,6 +124,7 @@
 Keywords[es]=korganizer,hora
 Keywords[et]=korganizer,aeg
 Keywords[eu]=korganizer,ordua,data
+Keywords[fa]=korganizer،زمان
 Keywords[fi]=korganizer,aika
 Keywords[fr]=KOrganizer,date
 Keywords[ga]=korganizer,am
Index: korganizer/koeditorgeneral.cpp
===================================================================
--- korganizer/koeditorgeneral.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/koeditorgeneral.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -222,7 +222,9 @@
   mAlarmIncrCombo->setEnabled( false );
 
   mAlarmEditButton = new QPushButton( i18n("Advanced"), parent );
+  mAlarmEditButton->setEnabled( false );
   alarmLayout->addWidget( mAlarmEditButton );
+  connect( mAlarmButton, SIGNAL(toggled(bool)), mAlarmEditButton, SLOT(setEnabled( bool)));
   connect( mAlarmEditButton, SIGNAL( clicked() ),
       SLOT( editAlarms() ) );
 
@@ -290,11 +292,13 @@
   if ( mAlarmList.isEmpty() ) {
     mAlarmStack->raiseWidget( SimpleAlarmPage );
     mAlarmButton->setChecked( false );
+    mAlarmEditButton->setEnabled( false );
   } else if ( mAlarmList.count() > 1 ) {
     mAlarmStack->raiseWidget( AdvancedAlarmLabel );
-    mAlarmInfoLabel->setText( i18n("1 reminder configured",
-                                   "%n reminders configured",
+    mAlarmInfoLabel->setText( i18n("1 advanced reminder configured",
+                                   "%n advanced reminders configured",
                                    mAlarmList.count() ) );
+    mAlarmEditButton->setEnabled( true );
   } else {
     Alarm *alarm = mAlarmList.first();
     // Check if its the trivial type of alarm, which can be
@@ -320,6 +324,7 @@
     } else {
       mAlarmStack->raiseWidget( AdvancedAlarmLabel );
       mAlarmInfoLabel->setText( i18n("1 advanced reminder configured") );
+      mAlarmEditButton->setEnabled( true );
     }
   }
 }
Index: korganizer/kogroupwareprefspage.ui
===================================================================
--- korganizer/kogroupwareprefspage.ui	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/kogroupwareprefspage.ui	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -84,6 +84,9 @@
                                 <property name="name">
                                     <cstring>publishDelay</cstring>
                                 </property>
+                                <property name="minValue">
+                                    <number>1</number>
+                                </property>
                                 <property name="whatsThis" stdset="0">
                                     <string>Configure minimum the interval of time in minutes between each upload here. This configuration is only effective in case you choose to publish your information automatically.</string>
                                 </property>
@@ -591,6 +594,22 @@
         <slot>slotChanged()</slot>
     </connection>
 </connections>
+<tabstops>
+    <tabstop>groupwareTab</tabstop>
+    <tabstop>publishEnable</tabstop>
+    <tabstop>publishDelay</tabstop>
+    <tabstop>publishDays</tabstop>
+    <tabstop>publishUrl</tabstop>
+    <tabstop>publishUser</tabstop>
+    <tabstop>publishPassword</tabstop>
+    <tabstop>publishSavePassword</tabstop>
+    <tabstop>retrieveEnable</tabstop>
+    <tabstop>fullDomainRetrieval</tabstop>
+    <tabstop>retrieveUrl</tabstop>
+    <tabstop>retrieveUser</tabstop>
+    <tabstop>retrievePassword</tabstop>
+    <tabstop>retrieveSavePassword</tabstop>
+</tabstops>
 <includes>
     <include location="global" impldecl="in declaration">kdepimmacros.h</include>
     <include location="local" impldecl="in implementation">kogroupwareprefspage.ui.h</include>
Index: korganizer/korganizer_configgroupscheduling.desktop
===================================================================
--- korganizer/korganizer_configgroupscheduling.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/korganizer_configgroupscheduling.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -25,6 +25,7 @@
 Name[es]=Planificación de grupo
 Name[et]=Grupitöö ajakavad
 Name[eu]=Talde antolaketa
+Name[fa]=زمان‌بندی گروه
 Name[fi]=Ryhmän ajastus
 Name[fr]=Planification des tâches
 Name[gl]=Organización de Grupo
@@ -70,6 +71,7 @@
 Comment[es]=Configuración de la planificación de grupos de KOrganizer
 Comment[et]=Korganizeri grupitöö ajakavade seadistamine
 Comment[eu]=KOrganizer-en talde antolaketaren konfigurazioa
+Comment[fa]=پیکربندی زمان‌بندی گروه KOrganizer
 Comment[fi]=KOrganizer ryhmäajastuksen asetukset
 Comment[fr]=Configuration de la planification des groupes de KOrganizer
 Comment[gl]=Configuración da Axenda de Grupo de KOrganizer
@@ -113,6 +115,7 @@
 Keywords[es]=korganizer,grupo,planificación
 Keywords[et]=korganizer,grupid,grupitöö,ajakavad
 Keywords[eu]=korganizer,taldea,antolaketa
+Keywords[fa]=korganizer،گروه،زمان‌بندی
 Keywords[fi]=korganizer,ryhmä,ajastus
 Keywords[fr]=KOrganizer,groupes,planification
 Keywords[gl]=korganizer,grupo,programar
Index: korganizer/koagendaitem.h
===================================================================
--- korganizer/koagendaitem.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/koagendaitem.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -155,6 +155,7 @@
     void dropEvent(QDropEvent *e);
     void paintEvent(QPaintEvent *e);
     void paintFrame(QPainter *p, const QColor &color);
+    void paintEventIcon(QPainter *p, int &x, int ft);
     void paintTodoIcon(QPainter *p, int &x, int ft);
 
     // paint all visible icons
Index: korganizer/actionmanager.cpp
===================================================================
--- korganizer/actionmanager.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/actionmanager.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -328,36 +328,46 @@
   //************************** VIEW MENU *********************************
 
   //~~~~~~~~~~~~~~~~~~~~~~~~~~~~ VIEWS ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-  new KAction( i18n("What's &Next"), "whatsnext", 0,
-                    mCalendarView->viewManager(), SLOT( showWhatsNextView() ),
-                    mACollection, "view_whatsnext" );
-  new KAction( i18n("&Day"), "1day", 0,
-                    mCalendarView->viewManager(), SLOT( showDayView() ),
-                    mACollection, "view_day" );
-  mNextXDays = new KAction( "", "xdays", 0, mCalendarView->viewManager(),
-                    SLOT( showNextXView() ), mACollection, "view_nextx" );
+  new KAction( i18n("What's &Next"),
+               KOGlobals::self()->smallIcon( "whatsnext" ), 0,
+               mCalendarView->viewManager(), SLOT( showWhatsNextView() ),
+               mACollection, "view_whatsnext" );
+  new KAction( i18n("&Day"),
+               KOGlobals::self()->smallIcon( "1day" ), 0,
+               mCalendarView->viewManager(), SLOT( showDayView() ),
+               mACollection, "view_day" );
+  mNextXDays = new KAction( "",
+                            KOGlobals::self()->smallIcon( "xdays" ), 0,
+                            mCalendarView->viewManager(),
+                            SLOT( showNextXView() ),
+                            mACollection, "view_nextx" );
   mNextXDays->setText( i18n( "&Next Day", "Ne&xt %n Days",
                              KOPrefs::instance()->mNextXDays ) );
-  new KAction( i18n("W&ork Week"), "5days", 0,
-                    mCalendarView->viewManager(), SLOT( showWorkWeekView() ),
-                    mACollection, "view_workweek" );
-  new KAction( i18n("&Week"), "7days", 0,
-                    mCalendarView->viewManager(), SLOT( showWeekView() ),
-                    mACollection, "view_week" );
-  new KAction( i18n("&Month"), "month", 0,
-                    mCalendarView->viewManager(), SLOT( showMonthView() ),
-                    mACollection, "view_month" );
-  new KAction( i18n("&List"), "list", 0,
-                    mCalendarView->viewManager(), SLOT( showListView() ),
-                    mACollection, "view_list" );
-  new KAction( i18n("&To-do List"), "todo", 0,
-                    mCalendarView->viewManager(), SLOT( showTodoView() ),
-                    mACollection, "view_todo" );
-  new KAction( i18n("&Journal"), "journal", 0,
-                    mCalendarView->viewManager(), SLOT( showJournalView() ),
-                    mACollection, "view_journal" );
+  new KAction( i18n("W&ork Week"),
+               KOGlobals::self()->smallIcon( "5days" ), 0,
+               mCalendarView->viewManager(), SLOT( showWorkWeekView() ),
+               mACollection, "view_workweek" );
+  new KAction( i18n("&Week"),
+               KOGlobals::self()->smallIcon( "7days" ), 0,
+               mCalendarView->viewManager(), SLOT( showWeekView() ),
+               mACollection, "view_week" );
+  new KAction( i18n("&Month"),
+               KOGlobals::self()->smallIcon( "month" ), 0,
+               mCalendarView->viewManager(), SLOT( showMonthView() ),
+               mACollection, "view_month" );
+  new KAction( i18n("&List"),
+               KOGlobals::self()->smallIcon( "list" ), 0,
+               mCalendarView->viewManager(), SLOT( showListView() ),
+               mACollection, "view_list" );
+  new KAction( i18n("&To-do List"),
+               KOGlobals::self()->smallIcon( "todo" ), 0,
+               mCalendarView->viewManager(), SLOT( showTodoView() ),
+               mACollection, "view_todo" );
+  new KAction( i18n("&Journal"),
+               KOGlobals::self()->smallIcon( "journal" ), 0,
+               mCalendarView->viewManager(), SLOT( showJournalView() ),
+               mACollection, "view_journal" );
 
-
   //~~~~~~~~~~~~~~~~~~~~~~~~~~~ FILTERS ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   new KAction( i18n("&Refresh"), 0,
                     mCalendarView, SLOT( updateView() ),
@@ -408,29 +418,31 @@
                         mCalendarView,SLOT( goPrevious() ),
                         mACollection, "go_previous" );
 
-  // Changing the action text by setText makes the toolbar button disappear.   
-  // This has to be fixed first, before the connects below can be reenabled.   
+  // Changing the action text by setText makes the toolbar button disappear.
+  // This has to be fixed first, before the connects below can be reenabled.
   /*
-  connect( mCalendarView, SIGNAL( changeNavStringPrev( const QString & ) ),   
-           action, SLOT( setText( const QString & ) ) );   
-  connect( mCalendarView, SIGNAL( changeNavStringPrev( const QString & ) ),   
+  connect( mCalendarView, SIGNAL( changeNavStringPrev( const QString & ) ),
+           action, SLOT( setText( const QString & ) ) );
+  connect( mCalendarView, SIGNAL( changeNavStringPrev( const QString & ) ),
            this, SLOT( dumpText( const QString & ) ) );*/
 
   action = new KAction( i18n("Go &Forward"), isRTL ? "back" : "forward", 0,
                         mCalendarView,SLOT( goNext() ),
                         mACollection, "go_next" );
   /*
-  connect( mCalendarView,SIGNAL( changeNavStringNext( const QString & ) ),   
-           action,SLOT( setText( const QString & ) ) );   
+  connect( mCalendarView,SIGNAL( changeNavStringNext( const QString & ) ),
+           action,SLOT( setText( const QString & ) ) );
   */
 
 
   //************************** Actions MENU *********************************
-  new KAction( i18n("New E&vent..."), "appointment", 0,
-               mCalendarView,SLOT( newEvent() ),
+  new KAction( i18n("New E&vent..."),
+               KOGlobals::self()->smallIcon( "newappointment" ), 0,
+               mCalendarView, SLOT( newEvent() ),
                mACollection, "new_event" );
-  new KAction( i18n("New &To-do..."), "newtodo", 0,
-               mCalendarView,SLOT( newTodo() ),
+  new KAction( i18n("New &To-do..."),
+               KOGlobals::self()->smallIcon( "newtodo" ), 0,
+               mCalendarView, SLOT( newTodo() ),
                mACollection, "new_todo" );
   action = new KAction( i18n("New Su&b-to-do..."), 0,
                         mCalendarView,SLOT( newSubTodo() ),
@@ -438,8 +450,9 @@
   action->setEnabled( false );
   connect( mCalendarView,SIGNAL( todoSelected( bool ) ),
            action,SLOT( setEnabled( bool ) ) );
-  new KAction( i18n("New &Journal..."), 0,
-               mCalendarView,SLOT( newJournal() ),
+  new KAction( i18n("New &Journal..."),
+               KOGlobals::self()->smallIcon( "newjournal" ), 0,
+               mCalendarView, SLOT( newJournal() ),
                mACollection, "new_journal" );
 
   mShowIncidenceAction = new KAction( i18n("&Show"), 0,
Index: korganizer/kowhatsnextview.cpp
===================================================================
--- korganizer/kowhatsnextview.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/kowhatsnextview.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -87,9 +87,9 @@
 
 void KOWhatsNextView::updateView()
 {
-  KIconLoader kil("korganizer");
+  KIconLoader kil("kdepim");
   QString *ipath = new QString();
-  kil.loadIcon("korganizer",KIcon::NoGroup,32,KIcon::DefaultState,ipath);
+  kil.loadIcon("kdepim",KIcon::NoGroup,32,KIcon::DefaultState,ipath);
 
   mText = "<table width=\"100%\">\n";
   mText += "<tr bgcolor=\"#3679AD\"><td><h1>";
Index: korganizer/korgac/korgac.desktop
===================================================================
--- korganizer/korgac/korgac.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/korgac/korgac.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -11,6 +11,7 @@
 Name[es]=Cliente de recordatorio para KOrganizer
 Name[et]=KOrganizeri meeldetuletuse klientprogramm
 Name[eu]=KOrganizer-en oroigarrien bezeroa
+Name[fa]=کارخواه یادآوری کنندۀ KOrganizer
 Name[fi]=KOrganizer-hälytysasiakas
 Name[fr]=Client d'alarme de KOrganizer
 Name[hu]=KOrganizer-emlékeztető kliens
@@ -48,6 +49,7 @@
 GenericName[es]=Cliente del daemon de recordatorio para KOrganizer
 GenericName[et]=KOrganizeri meeldetuletusdeemoni klientprogramm
 GenericName[eu]=KOrganizer-en oroigarrien deabruaren bezeroa
+GenericName[fa]=کارخواه شبح یادآوری KOrganizer
 GenericName[fi]=KOrganizer hälytyspalvelimen asiakas
 GenericName[fr]=Client pour le démon d'alarme de KOrganizer
 GenericName[hu]=KOrganizer emlékeztető szolgáltatás kliense
Index: korganizer/interfaces/calendar/calendarplugin.desktop
===================================================================
--- korganizer/interfaces/calendar/calendarplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/interfaces/calendar/calendarplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -20,6 +20,7 @@
 Comment[es]=Plugin de calendario
 Comment[et]=Kalendriplugin
 Comment[eu]=Egutegi plugin-a
+Comment[fa]=وصلۀ تقویم
 Comment[fi]=Kalenteriliitännäinen
 Comment[fr]=Module d'agenda
 Comment[gl]=Extensión de Calendario
Index: korganizer/interfaces/calendar/calendardecoration.desktop
===================================================================
--- korganizer/interfaces/calendar/calendardecoration.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/interfaces/calendar/calendardecoration.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -18,6 +18,7 @@
 Comment[es]=Plugin de decoración de calendario
 Comment[et]=Kalendri dekoratsiooni plugin
 Comment[eu]=Egutegi apainketa plugin-a
+Comment[fa]=وصلۀ تزئین تقویم
 Comment[fi]=Kalenteritekstin koristeluliitännäinen
 Comment[fr]=Module de décoration d'agenda
 Comment[gl]=Extensión para a Decoración do Calendario
Index: korganizer/interfaces/korganizer/korgprintplugin.desktop
===================================================================
--- korganizer/interfaces/korganizer/korgprintplugin.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/interfaces/korganizer/korgprintplugin.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -16,6 +16,7 @@
 Comment[es]=Parte de KOrganizer
 Comment[et]=KOrganizeri komponent
 Comment[eu]=KOrganizer zatia
+Comment[fa]=بخش KOrganizer
 Comment[fr]=Composant KOrganizer
 Comment[he]=רכיב KOrganizer
 Comment[hi]=के-आर्गेनाइज़र हिस्सा
Index: korganizer/interfaces/korganizer/korganizerpart.desktop
===================================================================
--- korganizer/interfaces/korganizer/korganizerpart.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/interfaces/korganizer/korganizerpart.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -16,6 +16,7 @@
 Comment[es]=Parte de KOrganizer
 Comment[et]=KOrganizeri komponent
 Comment[eu]=KOrganizer zatia
+Comment[fa]=بخش KOrganizer
 Comment[fr]=Composant KOrganizer
 Comment[he]=רכיב KOrganizer
 Comment[hi]=के-आर्गेनाइज़र हिस्सा
Index: korganizer/komonthview.cpp
===================================================================
--- korganizer/komonthview.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/komonthview.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -198,13 +198,15 @@
   mIncidence = incidence;
   mDateTime = qd;
 
-  mTodoPixmap      = KOGlobals::self()->smallIcon("todo");
-  mTodoDonePixmap  = KOGlobals::self()->smallIcon("checkedbox");
-  mAlarmPixmap     = KOGlobals::self()->smallIcon("bell");
-  mRecurPixmap     = KOGlobals::self()->smallIcon("recur");
-  mReplyPixmap     = KOGlobals::self()->smallIcon("mail_reply");
+  mEventPixmap     = KOGlobals::self()->smallIcon( "appointment" );
+  mTodoPixmap      = KOGlobals::self()->smallIcon( "todo" );
+  mTodoDonePixmap  = KOGlobals::self()->smallIcon( "checkedbox" );
+  mAlarmPixmap     = KOGlobals::self()->smallIcon( "bell" );
+  mRecurPixmap     = KOGlobals::self()->smallIcon( "recur" );
+  mReplyPixmap     = KOGlobals::self()->smallIcon( "mail_reply" );
 
   mResourceColor = QColor();
+  mEvent     = false;
   mTodo      = false;
   mTodoDone  = false;
   mRecur     = false;
@@ -234,6 +236,11 @@
     p->eraseRect( offset, offset, listBox()->maxItemWidth()-2*offset, height( listBox() )-2*offset );
   }
   int x = 3;
+// Do NOT put on the event pixmap because it takes up too much space
+//  if ( mEvent ) {
+//    p->drawPixmap( x, 0, mEventPixmap );
+//    x += mEventPixmap.width() + 2;
+//  }
   if ( mTodo ) {
     p->drawPixmap( x, 0, mTodoPixmap );
     x += mTodoPixmap.width() + 2;
@@ -482,6 +489,7 @@
       }
 
       mItem = new MonthViewItem( event, dt, text );
+      mItem->setEvent( true );
       if (KOPrefs::instance()->monthViewUsesCategoryColor()) {
         QStringList categories = event->categories();
         QString cat = categories.first();
@@ -875,6 +883,11 @@
   mLabel->setText( i18n( "monthname year", "%1 %2" )
                    .arg( calSys->monthName( start ) )
                    .arg( calSys->year( start ) ) );
+  if ( !KOPrefs::instance()->fullViewMonth() ) {
+    mLabel->show();
+  } else {
+    mLabel->hide();
+  }
 
   bool primary = false;
   uint i;
@@ -968,10 +981,13 @@
     }
   } else {
     // addSecs(-1) is added to handle 0:00 cases (because it's non-inclusive according to rfc)
-    QDate endDate = gdv.endDate().addSecs( floats ? 0 : -1).date();
-    for ( QDate date = gdv.startDate().date(); date <= endDate; date = date.addDays( 1 ) ) {
-      MonthViewCell *mvc = mDateToCell[ date ];
-      if ( mvc ) mvc->addIncidence( incidence, v );
+    if ( gdv.endDate().isValid() ) {
+      QDate endDate = gdv.endDate().addSecs( floats ? 0 : -1).date();
+      for ( QDate date = gdv.startDate().date();
+            date <= endDate; date = date.addDays( 1 ) ) {
+        MonthViewCell *mvc = mDateToCell[ date ];
+        if ( mvc ) mvc->addIncidence( incidence, v );
+      }
     }
   }
 }
Index: korganizer/koeditoralarms.h
===================================================================
--- korganizer/koeditoralarms.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/koeditoralarms.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -40,7 +40,6 @@
     ~KOEditorAlarms();
 
   protected slots:
-    void slotApply();
     void slotOk();
     void slotAdd();
     void slotDuplicate();
Index: korganizer/plugins/datenums/datenums.desktop
===================================================================
--- korganizer/plugins/datenums/datenums.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/plugins/datenums/datenums.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -12,6 +12,7 @@
 Name[es]=Accesorio de números de fecha para calendarios
 Name[et]=Kuupäeva nummerdamise plugin kalendritele
 Name[eu]=Egutegientzako data zenbakiak
+Name[fa]=وصلۀ عدد تاریخ برای تقویمها
 Name[fi]=Päivämääräliitännäinen kalentereihin
 Name[fr]=Module de numérotation des jours
 Name[he]=תוסף מספרי תאריכים ללוחות שנה
@@ -51,6 +52,7 @@
 Comment[es]=Para cada día, esta extensión mostrará el número del día en el año en la parte superior de la vista de la agenda. Por ejemplo, el 1 de febrero es el día número 32 del año.
 Comment[et]=See plugin näitab iga päevakavavaate ülaosas iga päeva järjekorranumbrit aastas. Näiteks 1. veebruar on aasta 32. päev.
 Comment[eu]=Egun bakoitzeko, plugin honek bere urteko egun-zenbakia erakutsiko du agenda ikuspegiaren goiko aldean. Adibidez, Otsailak 1 urtearen 32. eguna da.
+Comment[fa]=در هر روز، این وصله عدد مربوط به روز سال را در بالای نمای agenda را نمایش می‌دهد. مثلاً ۱ فوریه، سی و دومین روز سال می‌باشد.
 Comment[fi]=Tämä liitännäinen näyttää jokaisen päivän järjestysnumeron vuoden alusta agendanäkymässä. Esimerkiksi helmikuun ensimmäinen päivä on vuoden 32. päivä.
 Comment[fr]=Pour chaque jour, ce module montre le numéro du jour en haut de la vue agenda. Par exemple, le 1er février est le 32ème jour de l'année.
 Comment[hu]=Megjeleníti az év elejétől eltelt napok számát az áttekintő nézet tetején. Például február elseje az év 32. napja.
Index: korganizer/plugins/projectview/projectview.desktop
===================================================================
--- korganizer/plugins/projectview/projectview.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/plugins/projectview/projectview.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -18,6 +18,7 @@
 Name[es]=Plugin de visor de proyectos para KOrganizer
 Name[et]=KOrganizeri projektivaate plugin
 Name[eu]=KOrganizer-en proiektu ikuspegi plugin-a
+Name[fa]=وصلۀ نمای پروژه برای KOrganizer
 Name[fi]=Projektinäkymäliitännäinen KOrganizeriin
 Name[fr]=Module afficheur de projet pour KOrganizer
 Name[gl]=Extensión para Vista de Proxecto para KOrganizer
@@ -68,6 +69,7 @@
 Comment[es]=Esta extensión proporciona una vista de planificación de proyectos para KOrganizer (como las vistas de tareas pendientes o de mes). Si activa esta extensión, puede pasar a la vista del proyecto y ver la lista de tareas pendientes como en un planificador de proyectos.
 Comment[et]=See plugin lisab KOrganizerile projekti planeerimise vaate (nagu ülesannete või kuuvaade). Selle lubamisel saab lülituda projektivaatele ning näha oma ülesannete nimekirja projektiplaneerija moodi.
 Comment[eu]=Plugin honek KOrganizer-en proiektuaren plangintza ikuspegi bat eskeintzen du (egiteko edo hilabete ikupegien antzera). Plugin hau gaitzen baduzu, proiektuaren ikuspegira alda zaitezke eta egitekoak proiektu plangintza batean bezala ikus dezakezu.
+Comment[fa]=این وصله، برای KOrganizer یک نمای طراحی پروژه )مثل نماهای کارهای انجامی یا ماهانه( فراهم می‌‌کند. اگر این وصله را فعال کنید، می‌توانید به نمای پروژه سودهی کرده و مانند طراح پروژه، فهرست کارهای انجامی خود را مشاهده کنید.
 Comment[fi]=Tämä liitännäinen mahdollistaa projektin suunnittelunäkymän KOrganizeriin (kuten tehtävälista- tai kuukausinäkymän). Jos kytket tämän päälle, voit vaihtaa projektinäkymään ja katsoa tehtävälistaa kuten projektin suunnittelussa.
 Comment[fr]=Ce module propose une vue en projet pour KOrganizer. Si vous activez ce module, vous pourrez visualiser vos tâches sous la forme d'un planning projet.
 Comment[hu]=Ezzel a modullal projekttervező nézet alakítható ki a KOrganizerben (például a feladatokhoz vagy a havi nézetekhez). Ha aktiválja ezt a modult, átválthat projektnézetbe, hogy a feladatok projekttervként legyenek megtekinthetők.
@@ -77,7 +79,7 @@
 Comment[km]=កម្មវិធី​ជំនួយ​នេះ​ផ្ដល់​នូវ​ទិដ្ឋភាព​រៀបចំ​គម្រោង​សម្រាប់ korganizer (ដូចជា ទិដ្ឋភាព​ការងារ​ត្រូវ​ធ្វើ ឬ ទិដ្ឋភាព​ខែ​ជាដើម) ។ បើ​អ្នក​ធ្វើ​ឲ្យ​កម្មវិធី​ជំនួយ​នេះ​ប្រើ​បាន អ្នក​នឹង​អាច​ប្ដូរ​ទិដ្ឋភាព​គម្រោង ហើយ​មើល​ព្រឹត្តិការណ៍​របស់​អ្នក​ដូចជា​នៅ​ក្នុងកម្មវិធី​រៀបចំ​គម្រោង​អញ្ចឹង​ដែរ ។
 Comment[lt]=Šis priedas pateikia KOrganizaer projekto planavimo vaizdą (panašiai kaip darbų ar mėnesio vaizdai). Jei įjungsite šį įskiepį, galėsite peršokti į projekto vaizdą ir peržiūrėti savo darbų sąrašą kaip projektą.
 Comment[ms]=Plugin ini menyediakan paparan perancangan projek untuk KOrganizer (seperti tugasan atau paparan bulan). Jika plugin ini diaktifkan, anda boleh beralih ke paparan projek dan paparkan senarai tugasan seperti dalam perancang projek. 
-Comment[nb]=Dette tilleggsprogrammet lager en prosjektplan-visning for KOrganizer (som i gjørelister og månedsvisninger). Slår du på dette tilleggsprogrammet kan du bytte til prosjektvisning og se på gjørelista som i en prosjektplan.
+Comment[nb]=Dette programtilleggmet lager en prosjektplan-visning for KOrganizer (som i gjørelister og månedsvisninger). Slår du på dette programtilleggmet kan du bytte til prosjektvisning og se på gjørelista som i en prosjektplan.
 Comment[nds]=Mit dit Moduul kannst Du in KOrganizer en Projektplaan-Ansicht opropen (jüst as de Opgaven- oder Maandansichten). Wenn Du dit Moduul aktiveerst, kannst Du na de Projektansicht wesseln un Dien Opgavenlist as mit en Projektplaner ankieken.
 Comment[nl]=Deze plugin biedt een projectweergave voor KOrganizer (net zoals een takenlijst of maandweergave). Wanneer u deze plugin aanzet, kunt u deze weergave aanzetten om uw takenlijst te bekijken als een projectplanner.
 Comment[nn]=Dette programtillegget lagar ei prosjektplanvising for KOrganizer (slik som oppgåve- eller månadsvisingane). Dersom du brukar dette programtillegget, kan du visa oppgåvelista som i ein prosjektplanleggjar.
Index: korganizer/plugins/exchange/exchange.desktop
===================================================================
--- korganizer/plugins/exchange/exchange.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/plugins/exchange/exchange.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Name[es]=Accesorio de Microsoft Exchange 2000 para KOrganizer
 Name[et]=Microsoft Exchange 2000 plugin KOrganizeri jaoks
 Name[eu]=KOrganizer-en Microsoft Exchange 2000 plugin-a
+Name[fa]=وصلۀ Microsoft Exchange ۲۰۰۰ برای KOrganizer
 Name[fi]=KOrganizerin Microsoft Exchange 2000 -liitännäinen
 Name[fr]=Module Microsoft Exchange 2000 pour KOrganizer
 Name[ga]=Breiseán Microsoft Exchange 2000 le haghaidh KOrganizer
@@ -53,6 +54,7 @@
 Comment[es]=Esta extensión permite que los usuarios de korganizer trabajen con servidores de groupware de Microsoft Exchange 2000.
 Comment[et]=See plugin võimaldab KOrganizeri kasutajatel pruukida Microsoft Exchange 2000 grupitööservereid.
 Comment[eu]=Plugin honek korganizer-en erabiltzaileei Microsoft Exchange 2000 groupware zerbitzariekin lan egiteko aukera ematen die.
+Comment[fa]=این وصله به کاربران korganizer اجازه می‌دهد که با کارسازهای Microsoft Exchange 2000 groupware کار می‌کند.
 Comment[fi]=Tämä liitännäinen mahdollistaa KOrganizer-käyttäjien työskentelemisen Microsoft Exchange 2000 -ryhmätyöpalvelimien kanssa.
 Comment[fr]=Ce module permet à KOrganizer de fonctionner avec Microsoft Exchange 2000
 Comment[hu]=Ez a modul lehetővé teszi KOrganizer-felhasználóknak Microsoft Exchange 2000-kiszolgálón tárolt csoportmunka-adatok elérését.
Index: korganizer/plugins/printing/whatsnext/whatsnextprint.desktop
===================================================================
--- korganizer/plugins/printing/whatsnext/whatsnextprint.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/plugins/printing/whatsnext/whatsnextprint.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[es]=Estilo de impresión de «Qué es lo siguiente»
 Name[et]="Mis järgmiseks?" trükkimise stiil
 Name[eu]="Zer da hurrengoa" inprimatzeko estiloa
+Name[fa]=سبک چاپ بعدی چیست
 Name[fi]=Mitä seuraavaksi -tulostustyyli
 Name[fr]=Impression de la suite du programme
 Name[hu]=A közeljövő eseményeinek kinyomtatása
@@ -47,6 +48,7 @@
 Comment[es]=Esta extensión le permite imprimir una lista de todos los eventos y tareas pendientes futuros.
 Comment[et]=See plugin võimaldab trükkida kõigi eelseisvate sündmuste ja ülesannete nimekirja.
 Comment[eu]=Plugin honek gertatuko diren gertaera eta egitekoen zerrenda bat inprimatzeko aukera ematen dizu.
+Comment[fa]=این وصله به شما اجازه می‌دهد که فهرستی از همۀ رویدادها و کارهای انجامی که بالا می‌آیند را چاپ کنید.
 Comment[fi]=Tämä liitännäinen mahdollistaa tulevien tapahtumien ja tehtävien tulostuksen listana.
 Comment[fr]=Ce module vous permet d'imprimer la liste des prochaines évènements et des prochaines tâches.
 Comment[hu]=Ezzel a modullal kinyomtathatók a rövidesen aktuálissá váló feladatok és események.
@@ -56,7 +58,7 @@
 Comment[km]=កម្មវិធី​ជំនួយ​នេះ​អនុញ្ញាត​ឲ្យ​អ្នក​បោះពុម្ព​បញ្ជី​នៃ​ព្រឹត្តិការណ៍ និង ការងារ​ត្រូវ​ធ្វើ​បន្តបន្ទាប់
 Comment[lt]=Šis priedas leidžia spausdinti sąrašą visų artėjančių įvykių ir darbų.
 Comment[ms]=Plugin ini membenarkan anda mencetak senarai semua peristiwa dan tugasan mendatang. 
-Comment[nb]=Med dette tilleggsprogrammet kan du skrive ut en liste over kommende hendelser og ting som skal gjøres.
+Comment[nb]=Med dette programtilleggmet kan du skrive ut en liste over kommende hendelser og ting som skal gjøres.
 Comment[nds]=Mit dit Moduul kann en List vun de direktemang nakamen Begeefnissen un Opgaven utdruckt warrn.
 Comment[nl]=Deze plugin maakt het mogelijk om een lijst van alle komende evenementen en taken uit te printen.
 Comment[nn]=Dette programtillegget lèt deg skriva ut ei liste over alle dei komande hendingane og oppføringane i hugselista.
Index: korganizer/plugins/printing/journal/journalprint.desktop
===================================================================
--- korganizer/plugins/printing/journal/journalprint.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/plugins/printing/journal/journalprint.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[es]=Estilo de impresión del diario
 Name[et]=Päeviku trükkimise stiil
 Name[eu]=Egunkariak inprimatzeko estiloa
+Name[fa]=سبک چاپ نشریه
 Name[fi]=Päiväkirjan tulostustyyli
 Name[fr]=Impression en journal
 Name[hu]=Naplónyomtatási stílus
@@ -47,6 +48,7 @@
 Comment[es]=Esta extensión le permite imprimir entradas del diario.
 Comment[et]=See plugin võimaldab trükkida päeviku sissekandeid.
 Comment[eu]=Plugin honek egunkarien sarrerak (eguneroko sarrerak) inprimatzeko aukera ematen dizu.
+Comment[fa]=این وصله، به شما اجازه می‌دهد که مدخلهای نشریه )مدخلهای روزانه( را چاپ کنید.
 Comment[fi]=Tämä liitännäinen mahdollistaa päiväkirjan tulostuksen.
 Comment[fr]=Ce module vous permet d'imprimer l'ensemble de vos journaux personnels
 Comment[hu]=Ez a modul naplóbejegyzések kinyomtatását teszi lehetővé.
@@ -56,7 +58,7 @@
 Comment[km]=កម្មវិធី​ជំនួយ​នេះ​អនុញ្ញាត​ឲ្យ​អ្នក​បោះពុម្ព​ធាតុ​ទិនានុប្បវត្តិ (ធាតុ​កំណត់ហេតុ​ប្រចាំ​ថ្ងៃ) ។
 Comment[lt]=Šis priedas leidžia spausdinti dienyno įrašus.
 Comment[ms]=Plugin ini membenarkan anda mencetak entri jurnal  (entri diari).
-Comment[nb]=Med dette tilleggsprogrammet kan du skrive ut oppføringer i dagboka.
+Comment[nb]=Med dette programtilleggmet kan du skrive ut oppføringer i dagboka.
 Comment[nds]=Mit dit Moduul köönt Daagbook-Indrääg utdruckt warrn.
 Comment[nl]=Deze plugin maakt het mogelijk om journalen uit te printen (dagboekitems).
 Comment[nn]=Dette programtillegget lèt deg skriva ut dagboksoppføringar.
Index: korganizer/plugins/printing/list/listprint.desktop
===================================================================
--- korganizer/plugins/printing/list/listprint.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/plugins/printing/list/listprint.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[es]=Estilo de impresión de la lista
 Name[et]=Nimekirja trükkimise stiil
 Name[eu]=Zerrenda inprimatzeko estiloa
+Name[fa]=سبک چاپ فهرست
 Name[fi]=Listatulostustyyli
 Name[fr]=Impression en liste
 Name[hu]=Eseménylista kinyomtatása
@@ -47,6 +48,7 @@
 Comment[es]=Esta extensión le permite imprimir eventos y tareas pendientes en forma de lista.
 Comment[et]=See plugin võimaldab trükkida sündmusi ja ülesandeid nimekirjana.
 Comment[eu]=Plugin honek gertaerak eta egitekoak zerrenda moduan inprimatzeko aukera ematen dizu.
+Comment[fa]=این وصله به شما اجازه می‌دهد که رویدادها و کارهایی که باید انجام شوند را در برگۀ فهرست چاپ کنید.
 Comment[fi]=Tämä liitännäinen mahdollistaa tapahtumien ja tehtävien tulostuksen listana.
 Comment[fr]=Ce module vous permet d'imprimer les évènements et les tâches sous forme de liste
 Comment[hu]=Ezzel a modullal listaként kinyomtathatók a feladatok és események.
@@ -56,7 +58,7 @@
 Comment[km]=កម្មវិធី​ជំនួយ​នេះ​អនុញ្ញាត​ឲ្យ​អ្នក​បោះពុម្ព​ព្រឹត្តិការណ៍ និង ការងារ​ត្រូវ​ធ្វើក្នុង​ទម្រង់​ជា​បញ្ជី ។
 Comment[lt]=Šis priedas leidžia spausdinti įvykius ir darbus sąrašo forma.
 Comment[ms]=Plugin ini membenarkan anda mencetak peristiwa dan tugasan dalam borang senarai.
-Comment[nb]=Med dette tilleggsprogrammet kan du skrive ut hendelser og gjørelister på liste-form.
+Comment[nb]=Med dette programtilleggmet kan du skrive ut hendelser og gjørelister på liste-form.
 Comment[nds]=Mit dit Moduul köönt Begeefnissen un Opgaven as Listen utdruckt warrn.
 Comment[nl]=Deze plugin maakt het mogelijk om evenementen en taken in lijstvorm uit te printen.
 Comment[nn]=Dette programtillegget lèt deg skriva ut hendingar og hugselister på listeform.
Index: korganizer/plugins/timespanview/timespanview.desktop
===================================================================
--- korganizer/plugins/timespanview/timespanview.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/plugins/timespanview/timespanview.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -10,6 +10,7 @@
 Name[es]=Extensión de visor de Timespan para KOrganizer
 Name[et]=KOrganizeri perioodivaate plugin
 Name[eu]=KOrganizer-rako denbora-barruti ukuspegi plugin-a
+Name[fa]=وصلۀ نمای گسترۀ زمان برای KOrganizer
 Name[fi]=Ajankulkunäkymäliitännäinen Korganizeriin
 Name[fr]=Module d'affichage de planification pour KOrganizer
 Name[hu]=Időszakáttekintő bővítőmodul a KOrganizerhez
@@ -47,6 +48,7 @@
 Comment[es]=Esta extensión proporciona una vista de timespan para korganizer (como la vista de tareas pendientes o la mensual). Si activa esta extensión, puede pasar a la vista de timespan y ver sus eventos como un diagrama de Gantt.
 Comment[et]=See plugin lisab KOrganizerile perioodivaate (nagu ülesannete või kuuvaade). Selle lubamisel saab lülituda perioodivaatele ning näha oma sündmusi Gantti diagrammina.
 Comment[eu]=Plugin honek KOrganizer-entzat denbora barruti ikuspegi bat eskeintzen du. Plugin hau gaitzen baduzu denbora-barruti ikuspegira alda zaitezke gertaerak Gantt diagrama batean bezala ikusi.
+Comment[fa]=این وصله، برای KOrganizer یک نمای گسترۀ زمان )مثل نماهای کارهای انجامی یا ماهانه( فراهم می‌‌کند. اگر این وصله را فعال کنید، می‌توانید به گسترۀ زمان سودهی کرده و مانند یک نمودار  Gantt، رویدادهای خود را مشاهده کنید.
 Comment[fi]=Tämä liitännäinen mahdollistaa ajankulkunäkymän KOrganizeriin (kuten tehtävälista- tai kuukausinäkymän). Jos kytket tämän päälle, voit vaihtaa ajankulkunäkymään ja katsoa tapahtumia kuten Gantt-diagrammissa.
 Comment[fr]=Ce module vous permet d'avoir une vue de KOrganizer qui affiche les évènements selon l'axe temporel. Si vous activez cette vue, vous verrez vos évènements comme un diagramme de Gantt.
 Comment[hu]=Ezzel modullal egy időszakot lehet áttekinteni a KOrganizerben (például a feladatokat vagy a havi nézeteket). Ha aktiválja ezt a modult, átválthat időszakos nézetbe, hogy az események Gantt-diagramon legyenek megtekinthetők.
@@ -56,7 +58,7 @@
 Comment[km]=កម្មវិធី​ជំនួយ​នេះ​ផ្ដល់​នូវ​ទិដ្ឋភាព​រយៈពេល​សម្រាប់ korganizer (ដូចជា ទិដ្ឋភាព​ការងារ​ត្រូវ​ធ្វើ ឬ ទិដ្ឋភាព​ខែ​ជាដើម) ។ បើ​អ្នក​ធ្វើ​ឲ្យ​កម្មវិធី​ជំនួយ​នេះ​ប្រើ​បាន អ្នក​នឹង​អាច​ប្ដូរ​ទិដ្ឋភាព​រយៈពេល ហើយ​មើល​ព្រឹត្តិការណ៍​របស់​អ្នក​ដូចជា​នៅ​ក្នុងដ្យាក្រាម Gantt អញ្ចឹង​ដែរ ។
 Comment[lt]=Šis priedas korganizer programoje sudaro galimybę apžvelgti laiko tarpą (pvz., darbų arba mėnesio peržiūra). Įgalinus šį priedą galėsite persijungti į laiko tarpo peržiūrą ir žiūrėti įvykius tarsi Gantt diagramoje.
 Comment[ms]=Plugin ini menyediakan paparan kitar waktu  untuk korganizer (seperti tugasan atau paparan bulan). Jika plugin ini diaktifkan,anda boleh beralih ke paparan kitar masa dan paparkan peristiwa seperti dalam diagram Gantt. 
-Comment[nb]=Dette tilleggsprogrammet lager en periodevisning for korganizer (slik som gjøreliste og månedsvisning). Hvis du slår på dette tilleggsprogrammet kan du bytte til periodevisning og se hendelser som i et Gantt-diagram.
+Comment[nb]=Dette programtilleggmet lager en periodevisning for korganizer (slik som gjøreliste og månedsvisning). Hvis du slår på dette programtilleggmet kan du bytte til periodevisning og se hendelser som i et Gantt-diagram.
 Comment[nds]=Mit dit Moduul kannst Du in KOrganizer en Tietbruuk-Ansicht opropen (jüst as de Opgaven- oder Maandansichten). Wenn Du dit Moduul aktiveerst, kannst Du na de Tietbruukansicht wesseln un Dien Begeefnissen as Ganntt-Diagramm ankieken.
 Comment[nl]=Deze plugin biedt een weergave voor KOrganizer (zoals de takenlijst en de maandweergave). Wanneer u deze plugin inschakelt kunt u kiezen voor een weergave waarin u uw evenementen in een Gantt-diagram kunt bekijken.
 Comment[pl]=Ta wtyczka tworzy widok zakresu czasu w KOrganizerze (tak jak widok zadań do zrobienia lub widok miesiąca). Po włączeniu tej wtyczki możliwe jest przełączenie się na widok zakresu czasu i przeglądanie zdarzeń jak na diagramie Gantta.
Index: korganizer/plugins/hebrew/hebrew.desktop
===================================================================
--- korganizer/plugins/hebrew/hebrew.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/plugins/hebrew/hebrew.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -13,6 +13,7 @@
 Name[es]=Accesorio de calendario judío
 Name[et]=Juudi kalendri plugin
 Name[eu]=Egutegi judutar plugin-a
+Name[fa]=وصلۀ تقویم یهودی
 Name[fi]=Juutalaisen kalenterin laajennus
 Name[fr]=Module de prise en charge du calendrier juif
 Name[gl]=Extensión para Calendario Xudeu
@@ -52,6 +53,7 @@
 Comment[es]=Muestra todas las fechas de korganizer también en el sistema de calendario judío.
 Comment[et]=Näitab KOrganizeris kõiki kuupäevi ka juudi kalendri järgi.
 Comment[eu]=korganizer-en data guztiak egutegi judutar sisteman ere erakusten ditu.
+Comment[fa]=همۀ تاریخهای korganizer، همچنین سیستم تقویم یهودی را نمایش می‌دهد.
 Comment[fi]=Näyttää kaikki päivät KOrganizerissa myös Juutalaisen kalenterijärjestelmän mukaan.
 Comment[fr]=Affiche toutes les dates de KOrganizer selon le calendrier Juif
 Comment[he]=מציג את כל התאריכים בארגונית גם בלוח השנה העברי
Index: korganizer/plugins/hebrew/configdialog.cpp
===================================================================
--- korganizer/plugins/hebrew/configdialog.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/plugins/hebrew/configdialog.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -26,7 +26,7 @@
 #include <kstandarddirs.h>
 #include <ksimpleconfig.h>
 
-ConfigDialog::ConfigDialog(QWidget * parent):KDialogBase(Plain, i18n("Configure Holidays"), Ok, Ok,
+ConfigDialog::ConfigDialog(QWidget * parent):KDialogBase(Plain, i18n("Configure Holidays"), Ok|Cancel, Ok,
             parent)
 {
   QFrame *topFrame = plainPage();
Index: korganizer/komonthview.h
===================================================================
--- korganizer/komonthview.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/komonthview.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -77,6 +77,7 @@
   public:
     MonthViewItem( Incidence *, const QDateTime &qd, const QString & title );
 
+    void setEvent(bool on) { mEvent = on; }
     void setTodo(bool on)  { mTodo  = on; }
     void setTodoDone(bool on) { mTodoDone = on; }
     void setRecur(bool on) { mRecur = on; }
@@ -98,12 +99,14 @@
     //Color of the resource
     QColor mResourceColor;
   private:
+    bool mEvent;
     bool mTodo;
     bool mTodoDone;
     bool mRecur;
     bool mAlarm;
     bool mReply;
 
+    QPixmap mEventPixmap;
     QPixmap mTodoPixmap;
     QPixmap mTodoDonePixmap;
     QPixmap mAlarmPixmap;
Index: korganizer/koagendaitem.cpp
===================================================================
--- korganizer/koagendaitem.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/koagendaitem.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -662,11 +662,23 @@
   x += pxmp.width() + ft;
 }
 
+void KOAgendaItem::paintEventIcon( QPainter *p, int &x, int ft )
+{
+  if ( !mIncidence ) return;
+  static const QPixmap eventPxmp =
+    KOGlobals::self()->smallIcon( "appointment" );
+  if ( mIncidence->type() != "Event" )
+    return;
+  conditionalPaint( p, true, x, ft, eventPxmp );
+}
+
 void KOAgendaItem::paintTodoIcon( QPainter *p, int &x, int ft )
 {
   if ( !mIncidence ) return;
-  static const QPixmap todoPxmp = KOGlobals::self()->smallIcon("todo");
-  static const QPixmap completedPxmp = KOGlobals::self()->smallIcon("checkedbox");
+  static const QPixmap todoPxmp =
+    KOGlobals::self()->smallIcon( "todo" );
+  static const QPixmap completedPxmp =
+    KOGlobals::self()->smallIcon( "checkedbox" );
   if ( mIncidence->type() != "Todo" )
     return;
   bool b = ( static_cast<Todo *>( mIncidence ) )->isCompleted();
@@ -676,6 +688,7 @@
 
 void KOAgendaItem::paintIcons( QPainter *p, int &x, int ft )
 {
+  paintEventIcon( p, x, ft );
   paintTodoIcon( p, x, ft );
   conditionalPaint( p, mIconAlarm,          x, ft, *alarmPxmp );
   conditionalPaint( p, mIconRecur,          x, ft, *recurPxmp );
Index: korganizer/version.h
===================================================================
--- korganizer/version.h	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/version.h	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -53,6 +53,6 @@
     3.2 alpha1
 */
 
-static const char korgVersion[] = "3.5.3";
+static const char korgVersion[] = "3.5.5";
 
 #endif
Index: korganizer/korganizer_configfreebusy.desktop
===================================================================
--- korganizer/korganizer_configfreebusy.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/korganizer_configfreebusy.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -24,6 +24,7 @@
 Name[es]=Libre/Ocupado
 Name[et]=Vaba/hõivatud
 Name[eu]=Libre/Lanpetuta
+Name[fa]=آزاد/اشغال
 Name[fi]=Vapaa/Varattu
 Name[fr]=Disponibilité
 Name[gl]=Ceibe/Ocupado
@@ -39,7 +40,7 @@
 Name[nds]=Free/Bunnen
 Name[nl]=Vrij/bezet
 Name[nn]=Ledig/opptatt
-Name[pl]=Wolny/Zajęty
+Name[pl]=Wolny/zajęty
 Name[pt]=Livre/Ocupado
 Name[pt_BR]=Livre/Ocupado
 Name[ru]=Занятое время
@@ -67,6 +68,7 @@
 Comment[es]=Configuración de libre/ocupado de KOrganizer
 Comment[et]=KOrganizeri vaba/hõivatuse seadistused
 Comment[eu]=KOrganizer-en Libre/Lanpetuta konfigurazioa
+Comment[fa]=پیکربندی آزاد/اشغال KOrganizer
 Comment[fi]=KOrganizer vapaa/varattu asetukset
 Comment[fr]=Configuration de la disponibilité pour KOrganizer
 Comment[gl]=Configuración de Dispoñibilidade de Korganizer
@@ -109,6 +111,7 @@
 Keywords[es]=korganizer,libreocupado,planificación
 Keywords[et]=korganizer,vaba,hõivatud,ajakava
 Keywords[eu]=korganizer,libre, lanpetuta,antolaketa
+Keywords[fa]=korganizer،آزاد اشغال،زمان‌بندی
 Keywords[fi]=korganizer,vapaa,varattu,ajastus
 Keywords[fr]=KOrganizer,disponibilité, planification
 Keywords[gl]=korganizer,dispoñibilidade,axenda
Index: korganizer/pixmaps/cr16-action-inverse_recur.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr22-action-newtodo.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr16-action-bell.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr16-action-recur.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr22-action-checkmark.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr22-action-appointment.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr22-action-checkedbox.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr32-action-appointment.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr16-action-appointment.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr32-action-todo.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr16-action-todo.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr22-action-journal.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr32-action-journal.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr16-action-journal.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr16-action-readonlyevent.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr22-action-newjournal.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr22-action-newrecurevent.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr22-action-todo.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr22-action-checkedclipboard.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png
Index: korganizer/pixmaps/cr22-action-checkedbox_mask.png
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = image/png

Property changes on: korganizer/pixmaps
___________________________________________________________________
Name: svn:ignore
   - Makefile.in
Makefile

Index: korganizer/korganizer_part.cpp
===================================================================
--- korganizer/korganizer_part.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/korganizer_part.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -106,7 +106,7 @@
   QVBoxLayout *topLayout = new QVBoxLayout( canvas );
   topLayout->addWidget( mView );
 
-  KGlobal::iconLoader()->addAppDir( "korganizer" );
+  KGlobal::iconLoader()->addAppDir( "kdepim" );
 
   new KParts::SideBarExtension( mView->leftFrame(), this, "SBE" );
 
Index: korganizer/korganizer.desktop
===================================================================
--- korganizer/korganizer.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/korganizer.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -16,6 +16,7 @@
 Comment[es]=Calendario y planificador
 Comment[et]=Kalendri ja ajakava haldamise rakendus
 Comment[eu]=Egutegi eta antolaketa progrmaa
+Comment[fa]=تقویم و برنامۀ زمان‌بندی
 Comment[fi]=Kalenteri ja ajanhallintaohjelma
 Comment[fr]=Calendrier et agenda personnel
 Comment[gl]=Programa de Calendario e Axenda
@@ -25,7 +26,7 @@
 Comment[hu]=Határidőnapló és eseményszervező
 Comment[is]=Dagbók og skipulag
 Comment[it]=Programma di calendario e di agenda
-Comment[ja]=カレンダー、スケジュールプログラム
+Comment[ja]=カレンダーとスケジュール管理プログラム
 Comment[km]=កម្មវិធី​ប្រតិទិន និង កាលវិភាគ
 Comment[lt]=Kalendoriaus ir planavimo programa
 Comment[lv]=Kalendāra un Plānošanas Programma
@@ -35,7 +36,7 @@
 Comment[nb]=Et kalender- og tidsplanleggingsprogram
 Comment[nds]=Kalenner un Tietplaner
 Comment[nl]=Agenda- en afsprakenprogramma
-Comment[nn]=Kalender- og planleggjingsprogram
+Comment[nn]=Kalender- og planleggingsprogram
 Comment[nso]=Lenaneo la Peakanyo ya Tshupamabaka
 Comment[pl]=Kalendarz i terminarz
 Comment[pt]=Calendário e Programa de Escalonamento
@@ -60,7 +61,7 @@
 Comment[zh_CN]=日历和日程安排程序
 Comment[zh_TW]=行事曆與排程軟體
 Comment[zu]=Ikhalenda kanye Neprogramu Yokugcina isikhathi
-Exec=korganizer %u
+Exec=korganizer --import %u
 Icon=korganizer
 Path=
 DocPath=korganizer/index.html
@@ -80,6 +81,7 @@
 Name[sv]=Korganizer
 Name[ta]=கேஅமைப்பாளர்
 Name[ven]=Mulugisi wa K
+Name[zh_TW]=KOrganizer 行事曆
 GenericName=Personal Organizer
 GenericName[be]=Пэрсанальны арганізатар
 GenericName[bg]=Организатор
@@ -94,6 +96,7 @@
 GenericName[es]=Organizador personal
 GenericName[et]=Personaalne ajaarvestus
 GenericName[eu]=Antolatzaile pertsonala
+GenericName[fa]=سازمان‌دهندۀ شخصی‌
 GenericName[fi]=Henkilökohtainen ajanhallintaohjelma
 GenericName[fr]=Organiseur personnel
 GenericName[gl]=Organizador Persoal
Index: korganizer/koeditoralarms_base.ui
===================================================================
--- korganizer/koeditoralarms_base.ui	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/koeditoralarms_base.ui	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -27,7 +27,7 @@
                 <cstring>mTimeGroup</cstring>
             </property>
             <property name="title">
-                <string>Time</string>
+                <string>Time Offset</string>
             </property>
             <vbox>
                 <property name="name">
@@ -57,17 +57,17 @@
                         <widget class="QComboBox">
                             <item>
                                 <property name="text">
-                                    <string>Minutes</string>
+                                    <string>minute(s)</string>
                                 </property>
                             </item>
                             <item>
                                 <property name="text">
-                                    <string>Hours</string>
+                                    <string>hour(s)</string>
                                 </property>
                             </item>
                             <item>
                                 <property name="text">
-                                    <string>Days</string>
+                                    <string>day(s)</string>
                                 </property>
                             </item>
                             <property name="name">
@@ -77,22 +77,22 @@
                         <widget class="QComboBox">
                             <item>
                                 <property name="text">
-                                    <string>Before the Start</string>
+                                    <string>before the start</string>
                                 </property>
                             </item>
                             <item>
                                 <property name="text">
-                                    <string>After the Start</string>
+                                    <string>after the start</string>
                                 </property>
                             </item>
                             <item>
                                 <property name="text">
-                                    <string>Before the End</string>
+                                    <string>before the end</string>
                                 </property>
                             </item>
                             <item>
                                 <property name="text">
-                                    <string>After the End</string>
+                                    <string>after the end</string>
                                 </property>
                             </item>
                             <property name="name">
@@ -175,7 +175,7 @@
                                 </sizepolicy>
                             </property>
                             <property name="text">
-                                <string>&amp;Repeating:</string>
+                                <string>&amp;Repeat:</string>
                             </property>
                         </widget>
                         <widget class="QSpinBox" row="1" column="2">
@@ -189,7 +189,7 @@
                                 <string>every </string>
                             </property>
                             <property name="suffix">
-                                <string> Minute(s)</string>
+                                <string> minute(s)</string>
                             </property>
                             <property name="maxValue">
                                 <number>999</number>
@@ -249,7 +249,7 @@
                                 <cstring>mTypeDisplayRadio</cstring>
                             </property>
                             <property name="text">
-                                <string>&amp;Display reminder</string>
+                                <string>&amp;Reminder Dialog</string>
                             </property>
                             <property name="checked">
                                 <bool>true</bool>
@@ -260,7 +260,7 @@
                                 <cstring>mTypeSoundRadio</cstring>
                             </property>
                             <property name="text">
-                                <string>&amp;Sound</string>
+                                <string>A&amp;udio</string>
                             </property>
                         </widget>
                         <widget class="QRadioButton">
@@ -268,7 +268,7 @@
                                 <cstring>mTypeAppRadio</cstring>
                             </property>
                             <property name="text">
-                                <string>Application / script</string>
+                                <string>Program</string>
                             </property>
                         </widget>
                         <widget class="QRadioButton">
@@ -279,7 +279,7 @@
                                 <bool>false</bool>
                             </property>
                             <property name="text">
-                                <string>Send Email</string>
+                                <string>Email</string>
                             </property>
                         </widget>
                         <spacer>
@@ -338,7 +338,7 @@
                                     <cstring>mDisplayTextLabel</cstring>
                                 </property>
                                 <property name="text">
-                                    <string>Reminder &amp;text:</string>
+                                    <string>Reminder Dialog &amp;text:</string>
                                 </property>
                                 <property name="buddy" stdset="0">
                                     <cstring>mDisplayText</cstring>
@@ -370,7 +370,7 @@
                                     <cstring>mSoundFileLabel</cstring>
                                 </property>
                                 <property name="text">
-                                    <string>Sound &amp;file:</string>
+                                    <string>Audio &amp;file:</string>
                                 </property>
                                 <property name="buddy" stdset="0">
                                     <cstring>mSoundFile</cstring>
@@ -422,7 +422,7 @@
                                     <cstring>mApplicationLabel</cstring>
                                 </property>
                                 <property name="text">
-                                    <string>&amp;Application / Script:</string>
+                                    <string>&amp;Program file:</string>
                                 </property>
                                 <property name="buddy" stdset="0">
                                     <cstring>mApplication</cstring>
@@ -441,7 +441,7 @@
                                     <cstring>mAppArgumentsLabel</cstring>
                                 </property>
                                 <property name="text">
-                                    <string>Ar&amp;guments:</string>
+                                    <string>Program ar&amp;guments:</string>
                                 </property>
                                 <property name="buddy" stdset="0">
                                     <cstring>mAppArguments</cstring>
@@ -490,7 +490,7 @@
                                     <cstring>mEmailTextLabel</cstring>
                                 </property>
                                 <property name="text">
-                                    <string>&amp;Text of the message:</string>
+                                    <string>Email &amp;message text:</string>
                                 </property>
                                 <property name="buddy" stdset="0">
                                     <cstring>mEmailText</cstring>
@@ -511,7 +511,7 @@
                                     <cstring>mEmailToLabel</cstring>
                                 </property>
                                 <property name="text">
-                                    <string>&amp;To:</string>
+                                    <string>Email &amp;address(es):</string>
                                 </property>
                                 <property name="buddy" stdset="0">
                                     <cstring>unnamed</cstring>
@@ -573,22 +573,22 @@
                 </spacer>
                 <widget class="QListView" row="0" column="0" rowspan="4" colspan="1">
                     <column>
-                      <property name="text">
-                        <string>Type</string>
-                      </property>
-                      <property name="clickable">
-                        <bool>true</bool>
-                      </property>
-                      <property name="resizable">
-                        <bool>true</bool>
-                      </property>
+                        <property name="text">
+                            <string>Type</string>
+                        </property>
+                        <property name="clickable">
+                            <bool>false</bool>
+                        </property>
+                        <property name="resizable">
+                            <bool>true</bool>
+                        </property>
                     </column>
                     <column>
                         <property name="text">
-                            <string>Offset</string>
+                            <string>Time Offset</string>
                         </property>
                         <property name="clickable">
-                            <bool>true</bool>
+                            <bool>false</bool>
                         </property>
                         <property name="resizable">
                             <bool>true</bool>
@@ -599,7 +599,7 @@
                             <string>Repeat</string>
                         </property>
                         <property name="clickable">
-                            <bool>true</bool>
+                            <bool>false</bool>
                         </property>
                         <property name="resizable">
                             <bool>true</bool>
Index: korganizer/dcopcalendar.desktop
===================================================================
--- korganizer/dcopcalendar.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/dcopcalendar.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -17,6 +17,7 @@
 Comment[es]=Organizador con un interfaz DCOP
 Comment[et]=KOrganizer DCOP-liidesega
 Comment[eu]=DCOP interfazedun antolatzailea
+Comment[fa]=سازمان‌دهنده با یک واسط DCOP
 Comment[fi]=Kalenteri DCOP-rajapinnalla
 Comment[fr]=Organiseur avec une interface DCOP
 Comment[gl]=Organizador con interface DCOP
Index: korganizer/koprefs.cpp
===================================================================
--- korganizer/koprefs.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/koprefs.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -47,6 +47,7 @@
 #include <libkpimidentities/identity.h>
 #include <libemailfunctions/email.h>
 #include <kabc/stdaddressbook.h>
+#include <ktimezones.h>
 #include "kocore.h"
 
 KOPrefs *KOPrefs::mInstance = 0;
@@ -146,18 +147,9 @@
 {
   QString zone;
 
-  char zonefilebuf[100];
-  int len = readlink("/etc/localtime",zonefilebuf,100);
-  if (len > 0 && len < 100) {
-    zonefilebuf[len] = '\0';
-    zone = zonefilebuf;
-    zone = zone.mid(zone.find("zoneinfo/") + 9);
-  } else {
-    tzset();
-    zone = tzname[0];
-  }
+  zone = KTimezones().local()->name();
 
-  kdDebug () << "----- time zone: " << zone << endl;
+  kdDebug() << "----- time zone: " << zone << endl;
 
   mTimeZoneId = zone;
 }
Index: korganizer/korganizer_configcolors.desktop
===================================================================
--- korganizer/korganizer_configcolors.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/korganizer_configcolors.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -29,6 +29,7 @@
 Name[es]=Colores
 Name[et]=Värvid
 Name[eu]=Koloreak
+Name[fa]=رنگها
 Name[fi]=Värit
 Name[fr]=Couleurs
 Name[ga]=Dathanna
@@ -89,6 +90,7 @@
 Comment[es]=Configuración de los colores de KOrganizer
 Comment[et]=KOrganizeri värvide seadistamine
 Comment[eu]=KOrganizer-en koloreen konfigurazioa
+Comment[fa]=پیکربندی رنگهای KOrganizer
 Comment[fi]=KOrganizer värien asetukset
 Comment[fr]=Configuration des couleurs de KOrganizer
 Comment[gl]=Configuración de Cores de KOrganizer
@@ -136,6 +138,7 @@
 Keywords[es]=korganizer,colores
 Keywords[et]=korganizer,värvid
 Keywords[eu]=korganizer,koloreak
+Keywords[fa]=korganizer،رنگها
 Keywords[fi]=korganizer,värit
 Keywords[fr]=KOrganizer,couleurs
 Keywords[ga]=korganizer,dathanna
Index: korganizer/resourceview.cpp
===================================================================
--- korganizer/resourceview.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/resourceview.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -452,7 +452,7 @@
 void ResourceView::editResource()
 {
   ResourceItem *item = currentItem();
-
+  if (!item) return;
   ResourceCalendar *resource = item->resource();
 
   KRES::ConfigDialog dlg( this, QString("calendar"), resource,
Index: korganizer/korganizer_configdesignerfields.desktop
===================================================================
--- korganizer/korganizer_configdesignerfields.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/korganizer_configdesignerfields.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -24,6 +24,7 @@
 Name[es]=Páginas personalizadas
 Name[et]=Omaloodud leheküljed
 Name[eu]=Orri pertsonalizatuak
+Name[fa]=صفحات سفارشی‌
 Name[fi]=Omat sivut
 Name[fr]=Pages personnalisées
 Name[ga]=Leathanaigh Shaincheaptha
@@ -67,6 +68,7 @@
 Comment[es]=Configura las páginas personalizadas
 Comment[et]=Omaloodud lehekülgede seadistamine
 Comment[eu]=Konfiguratu orri pertsonalizatuak
+Comment[fa]=پیکربندی صفحات سفارشی
 Comment[fi]=Muokkaa omia sivuja
 Comment[fr]=Configurer les pages personnalisées
 Comment[ga]=Cumraigh na Leathanaigh Shaincheaptha
@@ -109,6 +111,7 @@
 Keywords[es]=korganizer, configurar, opciones, campos personalizados
 Keywords[et]=korganizer, seadistamine, seadistused, omaloodud väljad
 Keywords[eu]=korganizer, konfiguratu, ezarpenak, eremu pertsonalizatuak
+Keywords[fa]=korganizer، پیکربندی، تنظیمات، حوزه‌های سفارشی
 Keywords[fi]=kaddressbook, aseta, asetukset,omat kentät
 Keywords[fr]=KOrganizer, configuration, configurer, champs personnalisés
 Keywords[ga]=korganizer, cumraigh, socruithe, réimsí saincheaptha
Index: korganizer/kolistview.cpp
===================================================================
--- korganizer/kolistview.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/kolistview.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -93,7 +93,7 @@
 {
   mItem->setText(0,e->summary());
   if ( e->isAlarmEnabled() ) {
-    static const QPixmap alarmPxmp = KOGlobals::self()->smallIcon("bell");
+    static const QPixmap alarmPxmp = KOGlobals::self()->smallIcon( "bell" );
     mItem->setPixmap(1,alarmPxmp);
     mItem->setSortKey(1,"1");
   }
@@ -101,14 +101,14 @@
     mItem->setSortKey(1,"0");
 
   if ( e->doesRecur() ) {
-    static const QPixmap recurPxmp = KOGlobals::self()->smallIcon("recur");
+    static const QPixmap recurPxmp = KOGlobals::self()->smallIcon( "recur" );
     mItem->setPixmap(2,recurPxmp);
     mItem->setSortKey(2,"1");
   }
   else
     mItem->setSortKey(2,"0");
 
-  static const QPixmap eventPxmp = KOGlobals::self()->smallIcon("appointment");
+  static const QPixmap eventPxmp = KOGlobals::self()->smallIcon( "appointment" );
   mItem->setPixmap(0, eventPxmp);
 
   mItem->setText( 3,e->dtStartDateStr());
@@ -128,12 +128,12 @@
 
 bool KOListView::ListItemVisitor::visit(Todo *t)
 {
-  static const QPixmap todoPxmp = KOGlobals::self()->smallIcon("todo");
-  static const QPixmap todoDonePxmp = KOGlobals::self()->smallIcon("checkedbox");
+  static const QPixmap todoPxmp = KOGlobals::self()->smallIcon( "todo" );
+  static const QPixmap todoDonePxmp = KOGlobals::self()->smallIcon( "checkedbox" );
   mItem->setPixmap(0, t->isCompleted() ? todoDonePxmp : todoPxmp );
   mItem->setText(0,t->summary());
   if ( t->isAlarmEnabled() ) {
-    static const QPixmap alarmPxmp = KOGlobals::self()->smallIcon("bell");
+    static const QPixmap alarmPxmp = KOGlobals::self()->smallIcon( "bell" );
     mItem->setPixmap(1,alarmPxmp);
     mItem->setSortKey(1, "1");
   }
@@ -141,7 +141,7 @@
     mItem->setSortKey(1, "0");
 
   if ( t->doesRecur() ) {
-    static const QPixmap recurPxmp = KOGlobals::self()->smallIcon("recur");
+    static const QPixmap recurPxmp = KOGlobals::self()->smallIcon( "recur" );
     mItem->setPixmap(2,recurPxmp);
     mItem->setSortKey(2, "1");
   }
@@ -181,7 +181,7 @@
 
 bool KOListView::ListItemVisitor::visit(Journal *t)
 {
-  static const QPixmap jrnalPxmp = KOGlobals::self()->smallIcon("journal");
+  static const QPixmap jrnalPxmp = KOGlobals::self()->smallIcon( "journal" );
   mItem->setPixmap(0,jrnalPxmp);
   // Just use the first line
   mItem->setText( 0, t->description().section( "\n", 0, 0 ) );
Index: korganizer/kdatenavigator.cpp
===================================================================
--- korganizer/kdatenavigator.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/kdatenavigator.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -207,6 +207,7 @@
 void KDateNavigator::updateView()
 {
 //   kdDebug(5850) << "KDateNavigator::updateView(), view " << this << endl;
+
   updateDayMatrix();
   repaint();
 }
Index: korganizer/korganizer_configgroupautomation.desktop
===================================================================
--- korganizer/korganizer_configgroupautomation.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/korganizer_configgroupautomation.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -25,6 +25,7 @@
 Name[es]=Automatización del grupo
 Name[et]=Grupitöö
 Name[eu]=Talde automatizazioa
+Name[fa]=خودکار سازی گروه
 Name[fi]=Ryhmän automatisointi
 Name[fr]=Automatisation des groupes
 Name[gl]=Automatización de Grupo
@@ -68,6 +69,7 @@
 Comment[es]=Configuración del automatización del grupo de KOrganizer
 Comment[et]=KOrganizeri grupitöö seadistamine
 Comment[eu]=KOrganizer-en talde automatizazioaren konfigurazioa
+Comment[fa]=پیکربندی خودکارسازی گروه KOrganizer
 Comment[fi]=Korganizer ryhmän automatisoinnin asetukset
 Comment[fr]=Configuration de l'automatisation des groupes de KOrganizer
 Comment[gl]=Configuración da Automatización de Grupo de KOrganizer
@@ -111,6 +113,7 @@
 Keywords[es]=korganizer,grupo,automatización
 Keywords[et]=korganizer,grupid,grupitöö
 Keywords[eu]=korganizer,taldea,automatizazioa
+Keywords[fa]=korganizer،گروه،خودکارسازی
 Keywords[fi]=korganizer,ryhmä,automaatio
 Keywords[fr]=KOrganizer,groupes,automatisation
 Keywords[gl]=korganizer,grupo,automatización
Index: korganizer/korganizer_configviews.desktop
===================================================================
--- korganizer/korganizer_configviews.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/korganizer_configviews.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -27,6 +27,7 @@
 Name[es]=Vistas
 Name[et]=Vaated
 Name[eu]=Ikuspegiak
+Name[fa]=نماها
 Name[fi]=Näkymät
 Name[fr]=Vues
 Name[ga]=Amhairc
@@ -75,6 +76,7 @@
 Comment[es]=Configuración de la vista de KOrganizer
 Comment[et]=KOrganizeri vaateseadistused
 Comment[eu]=KOrganizer-en ikuspegi konfigurazioa
+Comment[fa]=پیکربندی نمای KOrganizer
 Comment[fi]=KOrganizerin näkymäasetukset
 Comment[fr]=Configuration des vues de KOrganizer
 Comment[gl]=Configuración de Vista de KOrganizer
@@ -119,6 +121,7 @@
 Keywords[es]=korganizer,vista
 Keywords[et]=korganizer,vaade
 Keywords[eu]=korganizer,ikuspegia
+Keywords[fa]=korganizer،نما
 Keywords[fi]=korganizer,näkymä
 Keywords[fr]=KOrganizer,vues
 Keywords[ga]=korganizer,amharc
Index: korganizer/freebusymanager.cpp
===================================================================
--- korganizer/freebusymanager.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/freebusymanager.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -51,7 +51,9 @@
 #include <kdebug.h>
 #include <kmessagebox.h>
 #include <ktempfile.h>
+#include <kio/jobclasses.h>
 #include <kio/netaccess.h>
+#include <kio/scheduler.h>
 #include <kapplication.h>
 #include <kconfig.h>
 #include <klocale.h>
@@ -71,11 +73,12 @@
                                           const char *name )
   : QObject( manager, name ), mManager( manager ), mEmail( email )
 {
-  KIO::Job *job = KIO::get( url, false, false );
+  KIO::TransferJob *job = KIO::get( url, false, false );
   connect( job, SIGNAL( result( KIO::Job * ) ),
            SLOT( slotResult( KIO::Job * ) ) );
   connect( job, SIGNAL( data( KIO::Job *, const QByteArray & ) ),
            SLOT( slotData( KIO::Job *, const QByteArray & ) ) );
+  KIO::Scheduler::scheduleJob( job );
 }
 
 FreeBusyDownloadJob::~FreeBusyDownloadJob()
@@ -361,7 +364,7 @@
 
   KURL sourceURL = freeBusyUrl( email );
 
-  kdDebug(5850) << "FreeBusyManager::retrieveFreeBusy(): url: " << sourceURL.url()
+  kdDebug(5850) << "FreeBusyManager::processRetrieveQueue(): url: " << sourceURL.url()
             << endl;
 
   if ( !sourceURL.isValid() ) {
@@ -397,6 +400,7 @@
   cfg.setGroup( email );
   QString url = cfg.readEntry( "url" );
   if ( !url.isEmpty() ) {
+    kdDebug(5850) << "found cached url: " << url << endl; 
     return KURL( url );
   }
   // Try with the url configurated by preferred email in kaddressbook
@@ -445,7 +449,7 @@
       << email << '\'' << endl;
     return KURL();
 }
-
+  kdDebug(5850) << "Server FreeBusy url: " << sourceURL.url() << endl;
   if ( KOPrefs::instance()->mFreeBusyFullDomainRetrieval )
     sourceURL.setFileName( email + ".ifb" );
   else
@@ -453,6 +457,7 @@
   sourceURL.setUser( KOPrefs::instance()->mFreeBusyRetrieveUser );
   sourceURL.setPass( KOPrefs::instance()->mFreeBusyRetrievePassword );
 
+  kdDebug(5850) << "Results in generated: " << sourceURL.url() << endl;
   return sourceURL;
 }
 
Index: korganizer/koeditoralarms.cpp
===================================================================
--- korganizer/koeditoralarms.cpp	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/koeditoralarms.cpp	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -77,17 +77,23 @@
 {
   if ( mAlarm ) {
     // Alarm type:
-    QString type( i18n("Unknown") );
+    QString type;
     switch ( mAlarm->type() ) {
-      case KCal::Alarm::Display: type = i18n("Reminder Dialog");
+      case KCal::Alarm::Display:
+        type = i18n("Reminder Dialog");
         break;
-      case KCal::Alarm::Procedure: type = i18n("Application/Script");
+      case KCal::Alarm::Procedure:
+        type = i18n("Program");
         break;
-      case KCal::Alarm::Email: type = i18n("Email");
+      case KCal::Alarm::Email:
+        type = i18n("Email");
         break;
-      case KCal::Alarm::Audio: type = i18n("Audio");
+      case KCal::Alarm::Audio:
+        type = i18n("Audio");
         break;
-      default: break;
+      default:
+        type = i18n("Unknown");
+        break;
     }
     setText( ColAlarmType, type );
 
@@ -130,6 +136,8 @@
     // Alarm repeat
     if ( mAlarm->repeatCount()>0 ) {
       setText( ColAlarmRepeat, i18n("Yes") );
+    } else {
+      setText( ColAlarmRepeat, i18n("No") );
     }
   }
 }
@@ -137,7 +145,7 @@
 
 KOEditorAlarms::KOEditorAlarms( KCal::Alarm::List *alarms, QWidget *parent,
                                 const char *name )
-  : KDialogBase( parent, name, true, i18n("Edit Reminders"), Ok | Apply | Cancel ), mAlarms( alarms ),mCurrentItem(0L)
+  : KDialogBase( parent, name, true, i18n("Edit Reminders"), Ok | Cancel ), mAlarms( alarms ),mCurrentItem(0L)
 {
   setMainWidget( mWidget = new KOEditorAlarms_base( this ) );
   mWidget->mAlarmList->setColumnWidthMode( 0, QListView::Maximum );
@@ -323,7 +331,7 @@
   }
 }
 
-void KOEditorAlarms::slotApply()
+void KOEditorAlarms::slotOk()
 {
   // copy the mAlarms list
   if ( mAlarms ) {
@@ -337,11 +345,6 @@
       ++it;
     }
   }
-}
-
-void KOEditorAlarms::slotOk()
-{
-  slotApply();
   accept();
 }
 
Index: korganizer/korganizer_configmain.desktop
===================================================================
--- korganizer/korganizer_configmain.desktop	(.../tags/KDE/3.5.4/kdepim)	(revision 590906)
+++ korganizer/korganizer_configmain.desktop	(.../branches/KDE/3.5/kdepim)	(revision 590906)
@@ -25,6 +25,7 @@
 Name[el]=Προσωπικό
 Name[et]=Isiklik
 Name[eu]=Pertsonala
+Name[fa]=شخصی
 Name[fi]=Henkilökohtainen
 Name[fr]=Personnel
 Name[ga]=Pearsanta
@@ -72,6 +73,7 @@
 Comment[es]=Configuración principal de KOrganizer
 Comment[et]=KOrganizeri põhiseadistused
 Comment[eu]=KOrganizer-en konfigurazio nagusia
+Comment[fa]=پیکربندی اصلی KOrganizer
 Comment[fi]=KOrganizerin pääasetukset
 Comment[fr]=Configuration principale de KOrganizer
 Comment[ga]=Príomhchumraíocht KOrganizer
@@ -117,6 +119,7 @@
 Keywords[es]=korganizer,principal,personal
 Keywords[et]=korganizer,peamine,isiklik
 Keywords[eu]=korganizer,nagusia,pertsonala
+Keywords[fa]=korganizer،اصلی،شخصی
 Keywords[fi]=korganizer,pää,henkilökohtainen
 Keywords[fr]=KOrganizer,principal,personnel
 Keywords[gl]=korganizer,principal,persoal

Property changes on: .
___________________________________________________________________
Name: svn:externals
   + admin https://svn.kde.org/home/kde/branches/KDE/3.5/kde-common/admin


